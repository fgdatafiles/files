!function(a){var b={version:11,isLive:!1,modules:{},lib:"js/",libPrefix:a.PlayhouseLibPrefix||"",nocache:document.location.href.match(/(\?|\&)nocache/)?"?"+Date.now():"",useConsole:!0,_current:null,_moduleQueue:[],_waitForLoad:0,_loadComplete:!1,_domReady:!1,_ignoredObjects:[],ignoreObject:function(a){-1===this._ignoredObjects.indexOf(a)&&this._ignoredObjects.push(a)},_checkIgnoredObjects:function(a){for(var b=0;b<this._ignoredObjects.length;b++)if(a instanceof this._ignoredObjects[b])return!0;return!1},copy:function(a){var c,d,e=0;if(!a||"object"!=typeof a||a instanceof HTMLElement||a instanceof b.Class||this._checkIgnoredObjects(a))return a;if(a instanceof Array)for(c=[];e<a.length;e++)c.push(b.copy(a[e]));else{c={};for(d in a)c[d]=b.copy(a[d])}return c},merge:function(a,c){var d,e;for(d in c)e=c[d],"object"!=typeof e||e instanceof HTMLElement||e instanceof b.Class||this._checkIgnoredObjects(e)||null===e?a[d]=e:(a[d]&&"object"==typeof a[d]||(a[d]=e instanceof Array?[]:{}),b.merge(a[d],e));return a},$:function(a){return"#"==a.charAt(0)?document.getElementById(a.substr(1)):document.getElementsByTagName(a)},$new:function(a){return document.createElement(a)},log:function(){this.useConsole&&window.console&&window.console.log.apply(window.console,arguments)},warn:function(){this.useConsole&&window.console&&window.console.warn.apply(window.console,arguments)},error:function(){this.useConsole&&window.console&&window.console.error.apply(window.console,arguments)},getUrlVar:function(a){var b={};return window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(a,c,d){b[c]=d}),b[a]||null},setVendorAttribute:function(a,b,c){var d=b.charAt(0).toUpperCase()+b.substr(1);a[b]=a["ms"+d]=a["moz"+d]=a["webkit"+d]=a["o"+d]=c},getVendorAttribute:function(a,b){var c=b.charAt(0).toUpperCase()+b.substr(1);return a[b]||a["ms"+c]||a["moz"+c]||a["webkit"+c]||a["o"+c]},normalizeVendorAttribute:function(a,c){var d=b.getVendorAttribute(a,c);!a[c]&&d&&(a[c]=d)},module:function(a){if(this._current)throw'Module "'+this._current.name+'" defines nothing';if(this.modules[a]&&this.modules[a].body)throw'Module "'+a+'" is already defined';return this._current={name:a,requires:[],loaded:!1,body:null},this.modules[a]=this._current,this._moduleQueue.push(this._current),this},requires:function(){return this._current.requires=Array.prototype.slice.call(arguments),this},defines:function(a){this._current.body=a||function(){},this._current=null,this._loadComplete&&this._loadModules()},_loadScript:function(a,c){if(this._waitForLoad++,this.modules[a]={name:a,requires:[],loaded:!1,body:null},!this.isLive){var d=this.libPrefix+this.lib+a.replace(/\./g,"/")+".js"+this.nocache,e=b.$new("script");e.type="text/javascript",e.src=d,e.onload=function(){b._waitForLoad--,b._loadModules()},e.onerror=function(){throw'Failed to load module "'+a+'" at path "'+d+'" required from "'+c+'"'},b.$("head")[0].appendChild(e)}},_loadModules:function(){for(var a,b,c,d,e=!1,f=0;f<this._moduleQueue.length;f++){for(b=this._moduleQueue[f],a=!0,d=0;d<b.requires.length;d++)c=b.requires[d],this.modules[c]?this.modules[c].loaded||(a=!1):(a=!1,this._loadScript(c,b.name));a&&b.body&&(this._moduleQueue.splice(f,1),b.loaded=!0,b.body(),e=!0,f--)}if(e&&this._moduleQueue.length)this._loadModules();else{if(!this._waitForLoad&&this._moduleQueue.length){var g,h=[],i=[];for(f=0;f<this._moduleQueue.length;f++){for(i.length=0,g=this._moduleQueue[f].requires,d=0;d<g.length;d++)b=this.modules[g[d]],b&&b.loaded||i.push(g[d]);h.push(this._moduleQueue[f].name+" (requires "+i.join(", ")+")")}throw"Unresolved modules:\n"+h.join("\n")}this._loadComplete=!0}},_domReadyComplete:function(){if(!this._domReady){if(!document.body)return setTimeout(this._domReadyComplete.bind(this),42);this._domReady=!0,this._loadModules()}},_boot:function(){"complete"===document.readyState?this._domReadyComplete():(document.addEventListener("DOMContentLoaded",this._domReadyComplete.bind(this),!1),window.addEventListener("load",this._domReadyComplete.bind(this),!1))}},c=!1,d=/xyz/.test(function(){})?/\bparent\b/:/.*/,e=function(a){var b,c=this.prototype,e={},f=function(a,b){return function(){var c=this.parent;this.parent=e[a];var d=b.apply(this,arguments);return this.parent=c,d}};for(b in a)"function"==typeof a[b]&&"function"==typeof c[b]&&d.test(a[b])?(e[b]=c[b],c[b]=f(b,a[b])):c[b]=a[b]};b.Class=function(){},b.Class.extend=function(a){function f(){if(!c){if(this.staticInit){var a=this.staticInit.apply(this,arguments);if(a)return a}this.set=this.set||function(a){for(var b in a)this[b]=a[b];return this};for(var d in this)"object"==typeof this[d]&&(this[d]=b.copy(this[d]));this.init&&this.init.apply(this,arguments)}return this}var g=this.prototype;c=!0;var h=new this;c=!1;var i=function(a,b){return function(){var c=this.parent;this.parent=g[a];var d=b.apply(this,arguments);return this.parent=c,d}};for(var j in a)"function"==typeof a[j]&&"function"==typeof g[j]&&d.test(a[j])?h[j]=i(j,a[j]):h[j]=a[j];return f.prototype=h,f.prototype.constructor=f,f.extend=b.Class.extend,f.inject=e,f},a.PlayhouseMixin&&b.merge(b,a.PlayhouseMixin),a.ph||(a.ph=b),b._boot()}(window),ph.Debug=ph.Class.extend({div:null,timers:{},values:{},staticInit:function(){return ph.debug||null},init:function(){ph.debug=this},setup:function(){var a=ph.$new("div");a.style.position="absolute",a.style.backgroundColor="#000",a.style.color="#fff",a.style.fontSize="16px",a.style.fontFamily="arial",a.style.top=0,this.div=a,ph.system.wrapper.appendChild(this.div),createjs.Ticker.on("tick",this.update,this)},update:function(){var a,b,c,d="";d+="&nbsp; "+Math.round(createjs.Ticker.getMeasuredFPS())+" &nbsp; ";for(a in this.values)c=this.values[a],d+=a+": "+c+" &nbsp; ";for(a in this.timers)b=this.timers[a],c=b.end?.001*(b.end-b.start):0,d+=a+": "+Math.ceil(1e3*(0>c?-c:c))+"ms &nbsp; ";this.div.innerHTML=d},value:function(a,b){this.values[a]=isNaN(parseFloat(b))?b:b.toFixed(3)},time:function(a){var b=this.timers[a];b||(b=this.timers[a]={start:0,end:0}),b.end=0,b.start=window.performance?window.performance.now():Date.now()},timeEnd:function(a){var b=this.timers[a];b&&(b.end=window.performance?window.performance.now():Date.now())}}),function(){var a=navigator.userAgent,b={};if(b.pixelRatio=window.devicePixelRatio||1,b.iPod=/ipod/i.test(a),b.iPhone=/iphone/i.test(a),b.iPad=/ipad/i.test(a),b.iOS=b.iPod||b.iPhone||b.iPad,b.iOSVersion=b.iOS?parseFloat(((a.match(/os (\d+_\d+)?/i)||["",""])[1]+"").replace("_",".")):-1,b.kindle=/silk/i.test(a),b.android=/android/i.test(a),b.androidPhone=/(?=.*\bandroid\b)(?=.*\bmobile\b)/i.test(a),b.androidTablet=!b.androidPhone&&b.android||b.kindle,b.android=b.androidPhone||b.androidTablet,b.androidVersion=a.match(/android\s([0-9\.]*)/i),b.androidVersion=b.androidVersion?b.androidVersion[1]:-1,b.winPhone=/(iemobile|windows phone)/i.test(a),b.winTablet=/(?=.*\bwindows\b)(?=.*\\btouch\b)/i.test(a),b.chrome=/chrome/i.test(a),b.safari=/safari/i.test(a),b.ie=/msie 9/i.test(a)||!!a.match(/trident.*rv:/i),b.firefox=/firefox/i.test(a),b.mobile=b.iOS||b.android||b.winPhone||b.winTablet||/mobile/i.test(a),b.tablet=b.iPad||b.androidTablet||b.winTablet,b.opera=/opera/i.test(a)||/opr/i.test(a),b.cordova=/^file:\/{3}[^\/]/i.test(window.location.href),b.crosswalk=/crosswalk/i.test(a),b.cocoonJS=!!navigator.isCocoonJS,b.ejecta=/ejecta/i.test(a),b.facebook=/fb/i.test(a),b.wiiu=/nintendo wiiu/i.test(a),b.touchDevice="ontouchstart"in window||window.navigator.msMaxTouchPoints,b.mobile){for(var c,d=document.getElementsByTagName("meta"),e=0,f=!1;e<d.length;e++)c=d[e],"viewport"==c.name&&(f=!0);if(!f){var g=document.createElement("meta");g.name="viewport",g.content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no",7.1===b.iOSVersion&&(g.content+=", minimal-ui"),document.getElementsByTagName("head")[0].appendChild(g)}}ph.device=b}(),Math.rand=function(a,b){var c=Math.random();return a||b?a%1===0&&b%1===0?Math.floor(c*(b-a+1))+a:c*(b-a)+a:c},Math.lerp=function(a,b,c){return a+c*(b-a)},Math.distance=function(a,b,c,d,e){var f,g;return arguments.length>3?(f=c-a,g=d-b):(f=b.x-a.x,g=b.y-a.y,e=c),e?Math.sqrt(f*f+g*g):f*f+g*g},Math.angle=function(a,b,c,d,e){var f;return arguments.length>3?f=Math.atan2(d-b,c-a):(f=Math.atan2(b.y-a.y,b.x-a.x),e=c),e?Math.toDeg(f):f},Math.limit=function(a,b,c){return a>c?c:b>a?b:a},Math.toRad=function(a){return a/180*Math.PI},Math.toDeg=function(a){return 180*a/Math.PI},Number.prototype.toOrdinal=function(){var a=["th","st","nd","rd"],b=this%100;return this+(a[(b-20)%20]||a[b]||a[0])},Number.prototype.map=function(a,b,c,d){return c+(d-c)*((this-a)/(b-a))},Number.prototype.commaFormat=function(){return(this+"").replace(/\B(?=(\d{3})+(?!\d))/g,",")},Number.prototype.round=function(a){return a=Math.pow(10,a||0),Math.round(this*a)/a},String.prototype.ucwords=function(){return this.toLowerCase().replace(/(^([a-zA-Z\p{M}]))|([ -][a-zA-Z\p{M}])/g,function(a){return a.toUpperCase()})},Array.prototype.erase||Object.defineProperty(Array.prototype,"erase",{value:function(a){var b=this.indexOf(a);return b>-1&&this.splice(b,1),this}}),Array.prototype.random||Object.defineProperty(Array.prototype,"random",{value:function(){return 1===this.length?this[0]:this[Math.rand(0,this.length-1)]}}),Array.prototype.shuffle||Object.defineProperty(Array.prototype,"shuffle",{value:function(){for(var a,b,c=this.length;c;a=parseInt(Math.random()*c),b=this[--c],this[c]=this[a],this[a]=b);return this}}),Array.prototype.random||Object.defineProperty(Array.prototype,"unique",{value:function(){var a,b,c=this.concat();for(a=0;a<c.length;++a)for(b=a+1;b<c.length;++b)c[a]===c[b]&&c.splice(b--,1);return c}}),Array.prototype.last||Object.defineProperty(Array.prototype,"last",{value:function(){return this[this.length-1]}}),Array.prototype.append||Object.defineProperty(Array.prototype,"append",{enumerable:!1,writable:!1,value:function(){var a,b,c;for(b=0;b<arguments.length;++b)if(a=arguments[b],Array.isArray(a))for(c=0,jLength=a.length;c<jLength;++c)this.push(a[c]);else this.push(a);return this}}),ph.KEY={MOUSE1:-1,MOUSE2:-3,MWHEEL_UP:-4,MWHEEL_DOWN:-5,BACKSPACE:8,TAB:9,ENTER:13,PAUSE:19,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,_0:48,_1:49,_2:50,_3:51,_4:52,_5:53,_6:54,_7:55,_8:56,_9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SHIFT:16,CTRL:17,ALT:18,PLUS:187,COMMA:188,MINUS:189,PERIOD:190},ph.Input=ph.Class.extend({bindings:{},actions:{},presses:{},locks:{},delayedKeyup:{},staticInit:function(){return ph.input||null},init:function(){ph.input=this;var a=this.mousewheel.bind(this);document.addEventListener("mousewheel",a,!1),document.addEventListener("DOMMouseScroll",a,!1),window.addEventListener("blur",this.keysreset.bind(this),!1);var b=this.keydown.bind(this),c=this.keyup.bind(this);window.addEventListener("keydown",b,!1),window.addEventListener("keyup",c,!1),"touchstart"in window?(window.addEventListener("touchstart",b,!1),window.addEventListener("touchup",c,!1)):(window.addEventListener("mousedown",b,!1),window.addEventListener("mouseup",c,!1))},mousewheel:function(a){var b=a.wheelDelta?a.wheelDelta:-1*a.detail,c=b>0?ph.KEY.MWHEEL_UP:ph.KEY.MWHEEL_DOWN,d=this.bindings[c];d&&(this.actions[d]=!0,this.presses[d]=!0,this.delayedKeyup[d]=!0,a.stopPropagation(),a.preventDefault())},keydown:function(a){var b=a.target.tagName.toLowerCase();if("input"!==b&&"textarea"!==b&&"select"!==b){var c="keydown"===a.type?a.keyCode:2===a.button?ph.KEY.MOUSE2:ph.KEY.MOUSE1,d=this.bindings[c];d&&(this.actions[d]=!0,this.locks[d]||(this.presses[d]=!0,this.locks[d]=!0),c>0&&(a.stopPropagation(),a.preventDefault()))}},keyup:function(a){var b=a.target.tagName.toLowerCase();if("input"!==b&&"textarea"!==b&&"select"!==b){var c="keyup"===a.type?a.keyCode:2===a.button?ph.KEY.MOUSE2:ph.KEY.MOUSE1,d=this.bindings[c];d&&(this.delayedKeyup[d]=!0,a.stopPropagation(),a.preventDefault())}},keysreset:function(){for(var a in this.delayedKeyup)this.actions[a]=!1,delete this.delayedKeyup[a]},bind:function(a,b){this.bindings[a]=b||a+""},unbind:function(a){var b=this.bindings[a];this.delayedKeyup[b]=!0,this.bindings[a]=null},unbindAll:function(){this.bindings={},this.actions={},this.presses={},this.delayedKeyup={}},state:function(a){return this.actions[a]},pressed:function(a){return this.presses[a]},released:function(a){return!!this.delayedKeyup[a]},clearPressed:function(){var a;for(a in this.delayedKeyup)this.actions[a]=!1,this.locks[a]=!1,delete this.delayedKeyup[a];for(a in this.presses)delete this.presses[a]}}),ph.Loader=ph.Class.extend({status:0,basePath:"",loadQueue:null,loadCallback:null,loadScope:null,loadParmas:null,_loadedObjects:{},staticInit:function(){return ph.loader||null},init:function(){ph.loader=this},load:function(a,b,c,d){this.loadCallback=b||this.loadCallback,this.loadScope=d||this.loadScope,this.loadParams=c||this.loadParams;for(var e=0;e<a.length;e++)this.get(a[e].id)?(a.splice(e,1),e--):a[e].src+=ph.nocache;a.length?this.loadManifest(a):this.handleComplete()},unload:function(a){if(arguments.length)for(var b=0;b<a.length;b++)this.set("object"==typeof a[b]?a[b].id:a[b],null);else for(var c in this._loadedObjects)this.set(c,null);return this},loadManifest:function(a){this.loadQueue||(this.status=0,this.loadQueue=new createjs.LoadQueue(!0,this.basePath),this.loadQueue.setMaxConnections(32),this.loadQueue.installPlugin(createjs.Sound),this.loadQueue.on("fileload",this.handleFileload,this)),this.loadQueue.loadManifest(a)},handleFileload:function(a){this.status=this.loadQueue?this.loadQueue.getItems(!0).length/this.loadQueue.getItems().length:this.status,this.set(a.item.id,a.result),this.status>=1&&this.handleComplete()},handleComplete:function(a){this.status=1;var b=this.loadCallback,c=this.loadScope,d=this.loadParams;this.loadCallback=null,this.loadScope=null,this.loadParams=null;var e=this.loadQueue;this.loadQueue=null,e&&(e.unregisterLoader(),e.removeAll(),e.removeAllEventListeners()),b&&b.apply(c,d)},get:function(a){return this._loadedObjects[a]||null},set:function(a,b){this._loadedObjects[a]=b,null===b&&delete this._loadedObjects[a]}}),ph.Music=ph.Class.extend({id:null,soundObj:null,staticInit:function(){return ph.music||null},init:function(){ph.music=this},play:function(a,b,c){this.id!==a&&(this.id=a,this.soundObj?this.fadeTo(0,b).wait(100).call(this._play,[a,b,c],this):this._play(a,b,c))},_play:function(a,b,c){this.soundObj=createjs.Sound.play(a,{loop:-1,volume:0}),this.fadeTo(c||1,b)},resume:function(){this.soundObj&&this.soundObj.setPaused(!1)},pause:function(){this.soundObj&&this.soundObj.setPaused(!0)},stop:function(a){this.fadeTo(0,a||0).call(this.set,[{soundObj:null}],null,this)},fadeTo:function(a,b){return createjs.Tween.get(this.soundObj,{override:!0}).to({volume:a},b||600)}}),function(){function a(){this.Container_constructor(),this.name="scene",this.screenX=.5,this.screenY=.5,ph.scene&&(ph.scene.removeAllChildren(!0),ph.scene.parent.removeChild(ph.scene),ph.scene.removeAllEventListeners()),ph.scene=this,ph.system.stage.addChild(ph.scene)}var b=createjs.extend(a,createjs.Container);b.start=function(){},b.end=function(){},ph.Scene=createjs.promote(a,"Container")}(),ph.Session=ph.Class.extend({hasLocalStorage:!0,prefix:"",expires:365,staticInit:function(){return ph.session||null},init:function(){ph.session=this,this.hasLocalStorage="undefined"!=typeof window.localStorage},set:function(a,b,c){if(this.hasLocalStorage)try{window.localStorage.setItem(this.prefix+a,JSON.stringify(b))}catch(d){d===QUOTA_EXCEEDED_ERR}else{c||(c=this.expires);var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3);var f="; expires="+e.toGMTString();document.cookie=this.prefix+a+"="+b+f+"; path=/"}},get:function(a){if(this.hasLocalStorage)try{return JSON.parse(localStorage.getItem(this.prefix+a))}catch(b){return window.localStorage.getItem(a)}else for(var c,d=this.prefix+a+"=",e=document.cookie.split(";"),f=0;f<e.length;f++){for(c=e[f];" "===c.charAt(0);)c=c.substring(1,c.length);if(0===c.indexOf(d))return c.substring(d.length,c.length)}},remove:function(a){this.hasLocalStorage?window.localStorage.removeItem(this.prefix+a):this.set(a,"",-1)},clear:function(){this.hasLocalStorage?window.localStorage.clear():document.cookie.split(";").forEach(function(a){document.cookie=a.replace(/^ +/,"").replace(/=.*/,"=;expires="+(new Date).toUTCString()+";path=/")})}}),ph.System=ph.Class.extend({isWrongOrientation:!1,wrapper:"#game-wrapper",dom:"#game-dom",stage:"#game-stage",delegate:null,width:480,height:320,widthMin:480,widthMax:480,heightMin:320,heightMax:320,hiddenEventType:null,_lastWidth:0,_lastHeight:0,staticInit:function(){return ph.system||null},init:function(a,b){ph.system=this,this.widthMin=b&&b.width&&b.width.min||this.widthMin,this.widthMax=b&&b.width&&b.width.max||this.widthMax,this.heightMin=b&&b.height&&b.height.min||this.heightMin,this.heightMax=b&&b.height&&b.height.max||this.heightMax,this.setupElements(),this.setupEvents(),this.setupStage(),this.checkWindow(),this.delegate=new a,createjs.Ticker.on("tick",this.update,this)},update:function(a){this.checkWindow(),ph.timer&&ph.timer.step(a),this.delegate.update(a),this.stage.update(a),ph.input&&ph.input.clearPressed()},checkWindow:function(){var a=window.innerWidth,b=window.innerHeight;if(this._lastWidth!==a||this._lastHeight!==b){this._lastWidth=a,this._lastHeight=b;var c,d=a/this.widthMin,e=b/this.heightMin,f=this.widthMin,g=this.heightMin,h=this.wrapper.style,i=this.dom.style;d>e?f=a>this.widthMax*e?this.widthMax:a<this.widthMin*e?this.widthMin:a/e:g=b>this.heightMax*d?this.heightMax:b<this.heightMin*d?this.heightMin:b/d,f=~~f,g=~~g,this.resize(f,g),this.isWrongOrientation=f/g>a/b,c=d>e?b/g:a/f,h.maxWidth=h.maxHeight=h.margin="",h.width=~~(f*c)+"px",h.height=~~(g*c)+"px",h.marginTop=~~(.5*(b-g*c))+"px",i.transform=i["-moz-transform"]=i["-webkit-transform"]=i["-ms-transform"]="scale("+c+")",setTimeout(function(){window.scrollTo&&window.scrollTo(0,0)},1)}},resize:function(a,b){this.width=a,this.height=b;for(var c,d=this.wrapper.getElementsByTagName("canvas"),e=0;e<d.length;e++)c=d[e],c.width!==this.width&&(c.width=this.width),c.height!==this.height&&(c.height=this.height)},setupElements:function(){var a=ph.$(this.wrapper)||ph.$new("div");a.id=this.wrapper.substr(1),a.parentNode||document.body.appendChild(a),this.wrapper=a;var b=ph.$(this.dom)||ph.$new("div");b.id=this.dom.substr(1),b.parentNode||this.wrapper.appendChild(b),this.dom=b},setupEvents:function(){var a=this.onPageShow.bind(this),b=this.onPageHide.bind(this),c=this.onChange.bind(this);window.addEventListener("pageshow",a,!1),window.addEventListener("pagehide",b,!1),window.addEventListener("focus",a,!1),window.addEventListener("blur",b,!1);var d="hidden";d in document?document.addEventListener("visibilitychange",c):(d="mozHidden")in document?document.addEventListener("mozvisibilitychange",c):(d="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",c):(d="msHidden")in document&&document.addEventListener("msvisibilitychange",c),this.hiddenEventType=d,document.ontouchmove=function(a){a.preventDefault()}},setupStage:function(){var a=ph.$(this.stage)||ph.$new("canvas");a||this.wrapper.appendChild(a);var b=new createjs.Stage(a);b.preventSelection=!1,b.snapToPixelEnabled=!1,ph.device.mobile?(createjs.Touch.enable(b,!0),b.enableDOMEvents(!1)):b.enableMouseOver(20),this.stage=b},_isVisible:!0,_wasMuted:!1,onPageShow:function(){this._isVisible||(this._isVisible=!0,createjs.Sound.muted=this._wasMuted)},onPageHide:function(){this._isVisible&&(this._isVisible=!1,this._wasMuted=createjs.Sound.muted,createjs.Sound.muted=!0)},onChange:function(a){document[this.hiddenEventType]?this.onPageHide():this.onPageShow()}}),ph.timer=new(ph.Class.extend({scale:1,time:0,delta:0,deltaScale:0,step:function(a){var b=.001*a.delta;this.time+=b,this.delta=b,this.deltaScale=b*this.scale,a.delta*=this.scale}})),ph.Timer=ph.Class.extend({target:0,base:0,last:0,pausedAt:0,ignoreScale:!1,init:function(a,b){this.base=ph.timer.time,this.last=ph.timer.time,this.ignoreScale=!!b,this.target=a||0},set:function(a){return this.target=a||0,this.reset()},reset:function(){return this.base=this.ignoreScale?ph.timer.delta:ph.timer.time,this.pausedAt=0,this},delta:function(){return this.ignoreScale?(this.pausedAt||ph.timer.delta)-this.base-this.target:(this.pausedAt||ph.timer.time)-this.base-this.target},pause:function(){return this.pausedAt||(this.pausedAt=this.ignoreScale?ph.timer.delta:ph.timer.time),this},resume:function(){return this.pausedAt&&(this.base+=(this.ignoreScale?ph.timer.delta:ph.timer.time)-this.pausedAt,this.pausedAt=0),this}}),ph.VoiceOver=ph.Class.extend({isPlaying:!1,index:0,sequence:[],completeCallback:null,completeScope:null,completeParams:null,soundObj:null,staticInit:function(){return ph.vo||null},init:function(){ph.vo=this},play:function(a,b,c,d){this.stop(),this.sequence=a instanceof Array?a:[a],this.completeCallback=b||null,this.completeScope=d||null,this.completeParams=c||null,this.playNext()},playNext:function(){var a=this.sequence[this.index++];a?cjs.Tween.get(this,{override:!0}).wait("object"==typeof a?a.delay||0:0).call(this._startVO,[a],this):this.stop(!0)},_startVO:function(a){this.soundObj=createjs.Sound.play("object"==typeof a?a.id:a,createjs.Sound.INTERRUPT_ANY,1),this.soundObj.on("succeeded",this._startedVO,this,!0,a),this.soundObj.on("complete",this._endVO,this,!0,a)},_startedVO:function(a,b){this.isPlaying=!0,"object"==typeof b&&"function"==typeof b.beginCallback&&b.beginCallback.apply(b.beginScope||this.completeScope,b.beginParams)},_endVO:function(a,b){this.isPlaying&&("object"==typeof b&&"function"==typeof b.endCallback&&b.endCallback.apply(b.endScope||this.completeScope,b.endParams),this.playNext())},stop:function(a){createjs.Tween.removeTweens(this),this.soundObj&&(this.soundObj.stop(),this.soundObj.removeAllEventListeners(),createjs.Tween.removeTweens(this.soundObj)),this.soundObj=null,this.index=0,this.isPlaying=!1;var b=this.completeCallback,c=this.completeScope,d=this.completeParams;this.completeCallback=null,this.completeScope=null,this.completeParams=null,a&&b&&b.apply(c,d)},fadeOut:function(a,b){return this.soundObj?(this.isPlaying=!1,createjs.Tween.removeTweens(this),this.soundObj?createjs.Tween.get(this.soundObj,{override:!0}).to({volume:0},a||600).call(this.stop,[b],this):void 0):createjs.Tween.get({})}}),function(){new ph.Debug,new ph.Input,new ph.Loader,new ph.Music,new ph.Session,new ph.VoiceOver}(),ph.System.inject({init:function(a){ph.system=this,this.stage=window.app.display.stage,this.stage.snapToPixelEnabled=!0,createjs.Touch.disable(this.stage),createjs.Touch.enable(this.stage,!0),this.delegate=new a},update:function(a){ph.timer&&ph.timer.step(a),this.delegate.update(),ph.input&&ph.input.clearPressed()},resize:function(a,b){this.width=a,this.height=b}}),ph.timer.step=function(a){a*=.001,this.time+=a,this.delta=a},ph.Music.inject({play:function(a,b,c){app.music!==a&&this._play(a,b,c)},_play:function(a,b,c){app.music=a},stop:function(a){this.fadeTo(0,a||0).call(function(){app.music=""})},fadeTo:function(a,b){return app.musicInstance?createjs.Tween.get(app.musicInstance,{override:!0}).to({volume:a},b||600):createjs.Tween.get(this).wait(b||600)}}),ph.Loader.inject({_compositions:{},loadManifest:function(a){this.loadQueue||(this.status=0,this.loadQueue=new createjs.LoadQueue(!0,this.basePath),this.loadQueue.setMaxConnections(2),this.loadQueue.installPlugin(createjs.Sound),this.loadQueue.registerLoader(createjs.FlashAnimationLoader),this.loadQueue.on("fileload",this.handleFileload,this)),this.loadQueue.loadManifest(a)}}),function(){function a(a,b,c){this.AbstractLoader_constructor(a,b,"flash-animation"),this._manifestQueue=null,this._basePath=c||""}var b=createjs.extend(a,createjs.AbstractLoader),c=a;c.MANIFEST_PROGRESS=.25,c.canLoadItem=function(a){return"flash-animation"===a.type},b.destroy=function(){this.AbstractLoader_destroy(),this._manifestQueue.close()},b._createRequest=function(){this._request=new createjs.JavaScriptLoader(this._item)},b.handleEvent=function(a){switch(a.type){case"complete":if(this._rawResult=a.target.getResult(!0),!AdobeAn.compositions)throw"Using out of date flash export! "+this._item.src;for(var b,d=Object.keys(AdobeAn.compositions),e=d.length-1;e>=0;e--)if(!ph.loader._compositions[d[e]]){b=d[e];break}ph.loader._compositions[b]=AdobeAn.compositions[b],ph.loader.set(this._item.id,AdobeAn.compositions[b]);var f=this._item.comp=AdobeAn.compositions[b],g=this._result=this._item.lib=f.getLibrary();if(delete AdobeAn.compositions[b],!g)throw"Something went wrong. Lib not found";return this._sendProgress(c.MANIFEST_PROGRESS),void this._loadManifest(g);case"progress":return a.loaded*=c.MANIFEST_PROGRESS,this.progress=a.loaded/a.total,(isNaN(this.progress)||this.progress==1/0)&&(this.progress=0),void this._sendProgress(a)}this.AbstractLoader_handleEvent(a)},b._loadManifest=function(a){if(a.properties.manifest&&a.properties.manifest.length){var b=this._item.src.slice(0,this._item.src.lastIndexOf("/")+1),c=this._manifestQueue=new createjs.LoadQueue(this._preferXHR,this._item.path,this._item.crossOrigin);c.on("complete",this._handleManifestComplete,this,!0),c.on("fileload",this._handleManifestFileLoad,this),c.on("progress",this._handleManifestProgress,this),c.on("error",this._handleManifestError,this,!0);for(var d=a.properties.manifest.length-1;d>=0;d--)a.properties.manifest[d].src=this._basePath+b+a.properties.manifest[d].src;c.loadManifest(a.properties.manifest)}else this._sendComplete()},b._handleManifestFileLoad=function(a){if(a&&"image"===a.item.type){var b=this._item.comp,c=b.getImages();c[a.item.id]=a.result}},b._handleManifestComplete=function(a){for(var b=this._item.comp,c=b.getLibrary(),d=b.getSpriteSheet(),e=a.target,f=c.ssMetadata,g=0;g<f.length;g++)d[f[g].name]=new createjs.SpriteSheet({images:[e.getResult(f[g].name)],frames:f[g].frames});this._sendComplete()},b._handleManifestProgress=function(a){this.progress=a.progress*(1-c.MANIFEST_PROGRESS)+c.MANIFEST_PROGRESS,this._sendProgress(this.progress)},b._handleManifestError=function(a){var b=new createjs.Event("fileerror");b.item=a.data,this.dispatchEvent(b)},createjs.FlashAnimationLoader=createjs.promote(a,"AbstractLoader")}(),function(){window.cjs||(window.cjs=createjs),cjs.Ticker.timingMode=cjs.Ticker.RAF,cjs.Ticker.maxDelta=50,cjs.Sound.registerPlugins([cjs.WebAudioPlugin,cjs.HTMLAudioPlugin]),cjs.Sound.alternateExtensions=["mp3","ogg"],cjs.Sound.EXTENSION_MAP.mp3="mpeg",cjs.LoadItem.LOAD_TIMEOUT_DEFAULT=6e4,cjs.Tween.tick=function(a,b){for(var c=cjs.Tween._tweens,d=c.length-1;d>=0;d--){var e=c[d];b&&!e.ignoreGlobalPause||e._paused||e.tick(e._useTicks?1:a)}},cjs.Shadow.prototype.set=function(a){for(var b in a)this[b]=a[b];return this},cjs.DisplayObject.prototype._zIndex=0,Object.defineProperties(cjs.DisplayObject.prototype,{zIndex:{get:function(){return this._zIndex},set:function(a){this._zIndex=a,this.parent instanceof cjs.Container&&this.parent.useZIndex&&this.parent.sortChildren(this.parent._sortChildrenZIndex)}}}),cjs.Sprite.prototype.play=function(){return this.paused=!1,this},cjs.Sprite.prototype.stop=function(){return this.paused=!0,this},cjs.Sprite.prototype.gotoAndPlay=function(a){return this.paused=!1,this._skipAdvance=!0,this._goto(a),this},cjs.Sprite.prototype.gotoAndStop=function(a){return this.paused=!0,this._goto(a),this},cjs.Sprite.prototype.advance=function(a){var b=this.framerate||this.spriteSheet.framerate,c=b&&null!=a?a/(1e3/b):1;return this._normalizeFrame(c),this},cjs.Container.prototype.getChildByName=function(a,b){for(var c,d=this.children,e=d.length,f=0;e>f&&!c;f++)d[f].name==a?c=d[f]:b&&d[f]instanceof cjs.Container&&(c=d[f].getChildByName(a,b));return c},cjs.Container.prototype.getChildById=function(a,b){for(var c,d=this.children,e=d.length,f=0;e>f&&!c;f++)d[f].id==a?c=d[f]:b&&d[f]instanceof cjs.Container&&(c=d[f].getChildById(a,b));return c},cjs.Container.prototype.getChildByType=function(a,b){for(var c,d=this.children,e=d.length,f=0;e>f&&!c;f++)d[f]instanceof a?c=d[f]:b&&d[f]instanceof cjs.Container&&(c=d[f].getChildByType(a,b));return c},cjs.Container.prototype.addChild=function(a){if(null==a)return a;var b=arguments.length;if(b>1){for(var c=0;b>c;c++)this.addChild(arguments[c]);return arguments[b-1]}return a.parent&&a.parent.removeChild(a),a.parent=this,this.children.push(a),this.useZIndex&&this.sortChildren(this._sortChildrenZIndex),a.dispatchEvent("added"),a},cjs.Container.prototype.useZIndex=!0,cjs.Container.prototype._sortChildrenZIndex=function(a,b){return a.zIndex-b.zIndex},cjs.Container.prototype.screenX=null,cjs.Container.prototype.screenY=null,cjs.Container.prototype._tick=function(a){var b=this.stage?this.stage.canvas:null;if(null!==this.screenX&&b&&(this.x=b.width*this.screenX),null!==this.screenY&&b&&(this.y=b.height*this.screenY),this.tickChildren)for(var c=this.children.length-1;c>=0;c--){var d=this.children[c];d.tickEnabled&&d._tick&&d._tick(a)}this.DisplayObject__tick(a)},cjs.Bitmap.prototype.draw=function(a,b){if(this.DisplayObject_draw(a,b)||!this.image)return!0;var c=this.image,d=this.sourceRect;if(d){var e=d.x,f=d.y,g=e+d.width,h=f+d.height,i=0,j=0,k=c.naturalWidth,l=c.naturalHeight;0>e&&(i-=e,e=0),g>k&&(g=k),0>f&&(j-=f,f=0),h>l&&(h=l),a.drawImage(c,e,f,g-e,h-f,i,j,g-e,h-f)}else a.drawImage(c,0,0);return!0}}(),ph.assets=function(a){a="string"==typeof a?[a]:a;for(var b=[{id:"sprites-curtain",src:"assets/images/curtain/sprites.json",type:"spritesheet",tags:["prereq"]},{id:"bg-title",src:"assets/images/title/bg.jpg",tags:["title"]},{id:"sprites-title",src:"assets/images/title/sprites.json",type:"spritesheet",tags:["title"]},{id:"anim-title",src:"assets/animations/title/anim.js",type:"flash-animation",tags:["title"]},{id:"sprites-cutscene",src:"assets/images/cutscene/sprites.json",type:"spritesheet",tags:["cutscene"]},{id:"bg-game",src:"assets/images/menu/bg.jpg",tags:["cutscene","menu","game"]},{id:"sprites-menu",src:"assets/images/menu/sprites.json",type:"spritesheet",tags:["menu"]},{id:"sprites-game-art",src:"assets/images/game/art/"+(ph.game&&ph.game.data.isOctober?"halloween":"sprites")+".json",type:"spritesheet",tags:["game"]},{id:"sprites-game-ui",src:"assets/images/game/ui/sprites.json",type:"spritesheet",tags:["game"]},{id:"sprites-gallery",src:"assets/images/gallery/sprites.json",type:"spritesheet",tags:["gallery"]}],c=[],d=0;d<b.length;d++)for(var e=b[d].tags||[],f=0;f<a.length;f++)(e.indexOf(a[f])>-1||e.indexOf("*")>-1)&&c.push(b[d]);return c},function(){ph.Game=ph.Class.extend({data:{isOctober:!1,instructions:!0,levelN:1,tutorialN:0,nextLevel:0,completed:!1,galleryN:1},staticInit:function(){return ph.game||null},init:function(){ph.game=this,window.edit&&window.edit.init(ph.system.stage),createjs.MotionGuidePlugin.install();var a=new Date,b=new Date(a.getFullYear(),9,1),c=new Date(a.getFullYear(),10,30);this.data.isOctober=a>=b&&c>=a,this.setupSessions(),this.setupFullscreen(),this.curtain=ph.system.stage.addChild(new cjs.Curtain);var d=(ph.getUrlVar("scene")||"title").ucwords();this.switchScene(ph.Scene[d])},update:function(){},switchScene:function(a){var b;a===ph.Scene.Title?b=ph.assets("title"):a===ph.Scene.Cutscene?b=ph.assets("cutscene"):a===ph.Scene.Menu?b=ph.assets("menu"):a===ph.Scene.Game?b=ph.assets("game"):a===ph.Scene.Gallery&&(b=ph.assets("gallery")),this.curtain.show(a,b)},setupSessions:function(){ph.session.prefix="watts-of-trouble-";var a=ph.session.get("level-1");null===a&&(ph.session.set("level-1",0),ph.game.data.nextLevel=1)},setupFullscreen:function(){ph.device.mobile&&document.addEventListener("touchstart",function a(){document.removeEventListener("touchstart",a,!1);
var b=document.documentElement;b.requestFullScreen?b.requestFullScreen():b.webkitRequestFullScreen?b.webkitRequestFullScreen():b.mozRequestFullScreen&&b.mozRequestFullScreen()},!1)},trackEvent:function(a,b,c,d){window.ga&&ga("send",{hitType:"event",eventCategory:a,eventAction:b,eventLabel:c,eventValue:d})}})}(),function(){function a(a){this.Container_constructor();var b=new cjs.Sprite(ph.loader.get("sprites-game-art"),"people/"+a+"/walk").set({regX:15,regY:57,framerate:24});this.addChild(b),this.name="character",this.person=a,this.speed=20,this.dirX=0,this.dirY=0,this.startX=0,this.startY=0,this.tileX=0,this.tileY=0,this.lastY=0,this.timer=0}var b=cjs.extend(a,cjs.Container);b._tick=function(a){this.updateWalk(),this.scaleX=this.dirX<0?-1:1,this.x+=this.dirX*ph.timer.delta,this.y+=this.dirY*ph.timer.delta,this.tileX=~~(this.x/120),this.tileY=~~(this.y/120),Math.abs(this.y-this.lastY)>4&&(this.lastY=this.y,this.zIndex=this.lastY),this.Container__tick(a)},b.updateWalk=function(){if(this.timer-=ph.timer.delta,this.timer<0){this.timer=Math.rand(1.8,4.2);var a=this.getChildAt(0);if(a.paused){a.play();for(var b=[{x:1,y:0},{x:0,y:1},{x:-1,y:0},{x:0,y:-1}].shuffle(),c=ph.scene.device.board,d=0;d<b.length;d++){var e=b[d],f=this.tileX+e.x,g=this.tileY+e.y;if(!(0>f||f>=c.cols||0>g||g>=c.rows)&&c.tilePath[g][f]&&!c.tilePiece[g][f]){this.dirX=e.x*this.speed,this.dirY=e.y*this.speed,cjs.Tween.get(a).to({x:e.y>0?-14:e.y<0?14:0,y:e.x>0?-6:e.x<0?12:0},1600,cjs.Ease.cubicOut),e.x&&(this.zIndex=this.lastY+(e.x>0?-7:e.x<0?13:0));break}}}else a.gotoAndStop("people/"+this.person+"/walk"),this.dirX=this.dirY=0}},b.reset=function(){this.x=this.startX,this.y=this.startY,this.tileX=~~(this.x/120),this.tileY=~~(this.y/120),this.timer=this.dirX=this.dirY=this.lastY=0,this.getChildAt(0).gotoAndStop("people/"+this.person+"/walk")},cjs.GameCharacter=cjs.promote(a,"Container")}(),function(){function a(){this.Container_constructor(),this.name="device",this.pt=null,this.drag=null,this.wire=null,this.tags=[],this.signs=[],this.lightnings=[];for(var a=ph.loader.get("sprites-game-art"),b=ph.loader.get("sprites-game-ui"),c=0;18>c;c++){var d=new cjs.GameTag;this.tags.push(this.addChild(d));var e=(new cjs.Container).set({name:"sign",alpha:0,mouseEnabled:!1,zIndex:99,tilePiece:null});e.addChild(new cjs.Sprite(a,"sign-plus").set({regX:17,regY:17.5})),this.signs.push(this.addChild(e))}for(a._data["lightning/lightning"].next=!1,c=0;3>c;c++){var f=new cjs.Sprite(a,"lightning/lightning").set({regX:107,regY:90,visible:!1,framerate:24,zIndex:102});this.lightnings.push(this.addChild(f))}var g=new cjs.Sprite(b,"device/left").set({name:"device-left",x:-18,y:300,regX:19,regY:303,mouseEnabled:!1,zIndex:-100}),h=new cjs.Sprite(b,"device/right").set({name:"device-right",x:1040,y:256,regX:111.5,regY:328.5,mouseEnabled:!1,zIndex:-100}),i=new cjs.Sprite(b,"device/left-extra").set({name:"device-left-extra",x:-130,y:416,regX:117,regY:200,mouseEnabled:!1,zIndex:-101});this.board=new cjs.GameBoard,this.pause=(new cjs.GamePause).set({x:480,y:300,alpha:0,zIndex:150}),this.popup=(new cjs.GamePopup).set({x:480,y:300,zIndex:150});var j=new cjs.Shape((new cjs.Graphics).s("#000").ss(4).dr(-1,-1,962,602)).set({zIndex:100});this.addChild(g,i,h,this.pause,this.board,this.popup,j),this.on("mousedown",this.interaction,this),this.on("click",this.interaction,this),this.on("pressup",this.interaction,this),this.on("removed",this.removed,this),this.reset()}var b=cjs.extend(a,cjs.Container),c=null;b._tick=function(a){var b=ph.system.stage;handSpr=ph.scene.gameTutorial?ph.scene.gameTutorial.handSpr:null,this.drag?(c=this.drag.isTut&&this.drag.followHand&&handSpr?this.drag.parent.localToLocal(handSpr.x,handSpr.y,handSpr.parent,c):this.drag.parent.globalToLocal(b.mouseX,b.mouseY,c),c&&this.board.highlightTileWithItem(this.drag,c.x,c.y)):this.wire&&(c=this.wire.isTut&&this.wire.followHand&&handSpr?this.wire.parent.localToLocal(handSpr.x,handSpr.y,handSpr.parent.parent,c):this.wire.parent.globalToLocal(b.mouseX,b.mouseY,c),c&&this.board.highlightTileWithWire(this.wire,c.x,c.y)),this.Container__tick(a)},b.removed=function(){for(this.board&&this.removeChild(this.board),this.pause&&this.removeChild(this.pause),this.popup&&this.removeChild(this.popup),this.board=null,this.pause=null,this.popup=null,this.drag=null,this.wire=null;this.tags.length;){var a=this.tags.pop();a.parent&&a.parent.removeChild(a)}for(;this.signs.length;){var b=this.signs.pop();b.parent&&b.parent.removeChild(b)}for(;this.lightnings.length;){var c=this.lightnings.pop();c.parent&&c.parent.removeChild(c)}this.removeAllChildren(!0),this.removeAllEventListeners()},b.reset=function(){if(this.board.reset(),!ph.scene.isPaused)for(var a=this.tags.length-1;a>=0;a--)this.tags[a].tilePiece&&cjs.Tween.get(this.tags[a]).to({alpha:1},400)},b.complete=function(){this.drag&&this.moveBack(this.drag),this.drag=null,this.wire&&this.wire.fadeOut(!0),this.wire=null,this.board.wire=null,this.board.hideTileMarkers(),cjs.Tween.removeTweens(this.board);for(var a=this.tags.length-1;a>=0;a--)this.tags[a].alpha&&cjs.Tween.get(this.tags[a]).to({alpha:0},400);for(a=this.signs.length-1;a>=0;a--)this.signs[a].alpha&&cjs.Tween.get(this.signs[a]).to({alpha:0},400)},b.startDrag=function(a,b,c){this.drag=a;var d=a.wireId;a.removeNeighbors(),this.board.tilePiece[c][b]=0;var e=a.parent.localToLocal(a.x,a.y,ph.scene.device);switch(a.lastX=a.x,a.lastY=a.y,a.origX=e.x,a.origY=e.y,a.tileX=-1,a.tileY=-1,ph.scene.device.addChild(a.set({x:e.x,y:e.y,zIndex:100})),ph.scene.checkComplete(d),d&&app.sound.play("power-off"),a.props.sprite){case"dam":app.sound.play("energy-dam");break;case"wind":app.sound.play("energy-wind");break;case"solar":app.sound.play("energy-solar")}},b.moveBack=function(a){var b=ph.scene.tileData,c=b.width,d=b.height,e=~~(a.lastX/c),f=~~(a.lastY/d);cjs.Tween.get(a).to({x:a.origX,y:a.origY},200,cjs.Ease.quadOut).call(this.board.addChild,[a],this.board).set({x:a.lastX,y:a.lastY,tileX:e,tileY:f,zIndex:10,alpha:1}),this.board.tilePiece[f][e]=a},b.startWire=function(a,b,c,d,e){a.wireId&&this.board.getWire(a.wireId).fadeOut(),this.wire=this.board.wire=this.board.getWire(0),this.wire.set({startX:b,startY:c,startTile:a,alpha:1}),this.wire.path.length||(this.wire.path.push({x:b+(e?1:0),y:c+(d?1:0)}),d&&this.wire.path.push({x:b,y:c}),this.wire.setPath(this.wire.path))},b.interaction=function(a){var b,c,d=a.target?a.target.name||"":"";if(d.indexOf("tile-")>-1){var e=d.split("-");b=parseInt(e.pop()),c=parseInt(e.pop())}if("mousedown"===a.type){if(this.drag||this.wire||ph.scene.isPaused)return;if(!isNaN(b)&&!isNaN(c)){var f,g=ph.scene.gameTutorial,h=this.board.tilePiece[c][b],i=!1,j=!1;if(!h){var k=this.board.tilePiece[c+1]?this.board.tilePiece[c+1][b]:null;!k||"ride"!==k.type||"ferris"!==k.rideType&&"drop"!==k.rideType?(k=this.board.tilePiece[c][b+1]||null,k&&"ride"===k.type&&"coaster"===k.rideType&&(h=k,j=!0)):(h=k,i=!0)}if(h&&"ride"===h.type){if(g){if(0===ph.game.data.tutorialN&&g.step<=2)return;if(0===ph.game.data.tutorialN&&g.step<=4&&g.step5(),0===ph.game.data.tutorialN&&g.step>=6)return;if(1===ph.game.data.tutorialN&&(7===g.step||8===g.step))return;if(1===ph.game.data.tutorialN&&9===g.step&&g.stopSteps(),1===ph.game.data.tutorialN&&g.step>=10)return}this.board.wire&&!this.board.wire.connected&&(this.board.wire.fadeOut(!0),this.board.wire=null),this.startWire(h,b,c,i,j)}else if(h&&"energy"===h.type){if(g){if(0===ph.game.data.tutorialN)return;if(1===ph.game.data.tutorialN&&7===g.step&&g.step8(),1===ph.game.data.tutorialN&&g.step>=9)return}this.board.wire?(f=this.board.wire.path,Math.abs(f.last().x-b)+Math.abs(f.last().y-c)>=2?(this.board.wire.fadeOut(!0),this.board.wire=null,this.board.hideTileMarkers(),this.startDrag(h,b,c)):this.wire=this.board.wire):this.startDrag(h,b,c)}else this.board.wire&&(f=this.board.wire.path,Math.abs(f.last().x-b)+Math.abs(f.last().y-c)>=2?(this.board.wire.fadeOut(!0),this.board.wire=null,this.board.hideTileMarkers()):this.wire=this.board.wire)}}else"pressup"===a.type&&(this.drag&&this.board.placeItemOnTile(this.drag),this.wire&&this.board.placeWireOnTile(this.wire))},cjs.GameDevice=cjs.promote(a,"Container")}(),function(){function a(){for(this.Container_constructor(),this.name="board",this.cols=8,this.rows=5,this.tileGround=[],this.tilePath=[],this.tileWater=[],this.tileObstacle=[],this.tilePiece=[],this.tileWire=[],this.characters=[],this.wires=[],this.wire=null,i=0;i<18;i++)this.wires.push(this.addChild(new cjs.GameWire));for(this.extraTiles=4,this.selectedX=-1,this.selectedY=-1,this.selectedOk=!0,this.lastSelectedX=-1,this.lastSelectedY=-1,this.tileMarkers=[],i=0;i<4;i++){var a=(new cjs.Shape).set({name:"tile-marker",zIndex:1e3,alpha:.3,mouseEnabled:!1});this.tileMarkers.push(this.addChild(a))}var b=ph.scene.tileData;this.mask=new cjs.Shape((new cjs.Graphics).f("#fff").dr(0,0,b.width*this.cols,b.height*this.rows)),this.on("removed",this.removed,this)}var b=cjs.extend(a,cjs.Container);b.removed=function(){this.tileGround.length=0,this.tilePath.length=0,this.tileWater.length=0,this.tileObstacle.length=0,this.tilePiece.length=0,this.tileWire.length=0,this.tileMarkers.length=0,this.characters.length=0,this.wires.length=0,this.wire=null,this.mask=null,this.removeAllEventListeners()},b.reset=function(){var a,b,c,d=ph.scene.tileData,e=d.width,f=d.height,g=[];for(a=0;a<this.tilePiece.length;a++)for(g[a]=[],b=0;b<this.tilePiece[a].length;b++)g[a][b]=0;for(a=0;a<this.tilePiece.length;a++)for(b=0;b<this.tilePiece[a].length;b++)this.tileWire[a][b]=0,c=this.tilePiece[a][b],c&&(c.x=c.startX,c.y=c.startY,c.zIndex="energy"===c.type&&"water"===c.tileType?-2:c.y,c.tileX=~~(c.x/e),c.tileY=~~(c.y/f),c.removeNeighbors(),g[c.tileY][c.tileX]=c);for(a=this.characters.length-1;a>=0;a--)this.characters[a].reset();this.hideWires(),this.hideTileMarkers(),this.tilePiece=g,this.selectedX=this.selectedY=-1,this.selectedOk=0,this.wire=null},b.hideWires=function(){for(var a=this.wires.length-1;a>=0;a--)this.wires[a].fadeOut(!0)},b.hideTileMarkers=function(){for(var a=this.tileMarkers.length-1;a>=0;a--)this.tileMarkers[a].visible=!1},b.checkLastSelected=function(a,b,c,d){var e=a!==this.lastSelectedX||b!==this.lastSelectedY;(e||d)&&(c?app.sound.play("square-thread"):app.sound.play("energy-move-wrong")),this.lastSelectedX=a,this.lastSelectedY=b},b.getWire=function(a){for(var b=this.wires.length-1;b>=0;b--)if(0===a&&this.wires[b].alpha<=0||this.wires[b].id===a)return cjs.Tween.removeTweens(this.wires[b]),this.wires[b];return null},b.breakWire=function(a,b,c,d){var e=this.getWire(a);if(e.path.length)if(e.path[0].x===b&&e.path[0].y===c)this.tileWire[c][b]=0,e.path.length>2&&!d?(e.path.shift(),e.setPath(e.path),e.drawPath(e.connected,!1)):e.fadeOut(ph.scene.isPaused);else if(e.path.last().x===b&&e.path.last().y===c)this.tileWire[c][b]=0,e.path.length>2&&!d?(e.path.pop(),e.setPath(e.path),e.drawPath(e.connected,!1)):e.fadeOut(ph.scene.isPaused);else{for(this.tileWire[c][b]=0;e.path.length>2;){var f=e.path.pop();this.tileWire[f.y][f.x]=0}e.ball.alpha=0,e.wire.shadow=null,e.setPath(e.path),e.drawPath(!1,!1)}},b.placeWire=function(a,b){var c=this.tilePiece[b][a];if(this.wire){var d=this.wire.path;if(Math.abs(d.last().x-a)+Math.abs(d.last().y-b)>=2)return;if(!this.isWireAcceptable(a,b)&&1!==d.length)return void(d.length>2&&this.checkLastSelected(a,b,!1));if(d.length>1&&d[d.length-2].x===a&&d[d.length-2].y===b?d.pop():d.push({x:a,y:b}),this.checkLastSelected(a,b,!0),this.selectedX=a,this.selectedY=b,this.wire.setPath(d),c&&"energy"===c.type)return this.canConnectToEnergy(c)?(this.wire.drawPath(!0,!1),ph.scene.device.wire=this.wire,ph.scene.device.interaction({type:"pressup"}),this.wire=null,this.hideTileMarkers(),!0):void 0;this.wire.drawPath(!1,!1)}else if(!this.wire)return c&&"ride"===c.type?(this.wire=this.getWire(0),this.wire.set({startX:a,startY:b,startTile:c,alpha:1}),this.wire.path.push({x:a,y:b}),this.wire.setPath(this.wire.path),!0):void 0;var e=ph.scene.tileData,f=e.width,g=e.height;return this.tileMarkers[0].set({x:(a+1)*f,y:b*g,visible:!0}),this.tileMarkers[0].graphics.c().f(this.isWireAcceptable(a+1,b)?"#0f0":"#f00").dr(0,0,f,g),this.tileMarkers[1].set({x:a*f,y:(b+1)*g,visible:!0}),this.tileMarkers[1].graphics.c().f(this.isWireAcceptable(a,b+1)?"#0f0":"#f00").dr(0,0,f,g),this.tileMarkers[2].set({x:(a-1)*f,y:b*g,visible:!0}),this.tileMarkers[2].graphics.c().f(this.isWireAcceptable(a-1,b)?"#0f0":"#f00").dr(0,0,f,g),this.tileMarkers[3].set({x:a*f,y:(b-1)*g,visible:!0}),this.tileMarkers[3].graphics.c().f(this.isWireAcceptable(a,b-1)?"#0f0":"#f00").dr(0,0,f,g),!0},b.isWireAcceptable=function(a,b){if(0>a||a>=this.cols||0>b||b>=this.rows)return!1;var c=!0,d=this.tilePiece[b][a],e=this.wire?this.wire.path:null;return this.tilePath[b][a]&&e&&this.tilePath[e.last().y][e.last().x]&&(c=!1),this.tileWater[b][a]&&(e&&this.tileWater[e.last().y][e.last().x]&&(c=!1),this.tileWater[b][a].corner&&!d&&(c=!1)),this.tileWire[b][a]&&c&&(c=!1,e&&this.tileWire[b][a]===this.wire.id&&e.last().x===a&&e.last().y===b&&(c=!0),e&&e.length>=2&&e[e.length-2].x===a&&e[e.length-2].y===b&&(c=!0)),d&&"ride"===d.type&&c&&(c=!1,d.wireId&&this.wire&&d.wireId===this.wire.id&&e.length<3&&(c=!0),e&&e[0].x===a&&e[0].y===b&&(c=!0)),d&&"energy"===d.type&&(d.wireId&&!this.getWire(d.wireId).connected&&(c=!0),d.neighbors.length>=2&&(c=!1),e&&this.tileWater[e.last().y][e.last().x]&&this.tileWater[b][a]&&(c=!1),e&&this.tilePath[e.last().y][e.last().x]&&(this.tilePiece[e.last().y][e.last().x]||(c=!1))),this.tileObstacle[b][a]&&(c=!1),c},b.canConnectToEnergy=function(a){var b=!0;if(a.wireId){var c=this.getWire(a.wireId);c.connected?b=!1:a.neighbors.length>=2&&(b=!1)}return b},b.highlightTileWithWire=function(a,b,c){var d=ph.scene.tileData,e=d.width,f=d.height;if(!(0>b||b>e*this.cols||0>c||c>e*this.rows)){var g=~~(b/e),h=~~(c/f);a.mouseX=b,a.mouseY=c,this.selectedX!==g||this.selectedY!==h?this.placeWire(g,h)||a.drawPath(!1,!0):a.path&&a.drawPath(!1,!0)}},b.placeWireOnTile=function(a){if(ph.scene.device.wire=null,!(this.selectedY<0||this.selectedX<0)){var b=this.tilePiece[this.selectedY][this.selectedX];if(!b)return void a.drawPath(!1,!1);if(a.path[0].x===this.selectedX&&a.path[0].y===this.selectedY)return void this.placeWire(this.selectedX,this.selectedY);if(b.wireId!==a.id){var c=this.getWire(b.wireId);b.tileX===c.path[0].x&&b.tileY===c.path[0].y?(c.path.reverse(),c.path.pop(),c.path.append(a.path.reverse())):b.tileX===c.path.last().x&&b.tileY===c.path.last().y&&(c.path.pop(),c.path.append(a.path.reverse())),a.startTile.wireId=c.id,c.setPath(c.path),b.neighbors.push(a.startTile),a.fadeOut(!0),a=c}else a.startTile.wireId=a.id,b.wireId=a.id,b.neighbors.push(a.startTile),a.setPath(a.path.reverse());a.setPath(a.path),a.drawPath(!0,!1),ph.scene.checkComplete(a.id)}},b.highlightTileWithItem=function(a,b,c){if(null===a)return void(this.tileMarkers[0].visible=!1);var d=ph.scene.tileData,e=d.width,f=d.height;if(0>b||b>e*this.cols||0>c||c>e*this.rows)return a.x=Math.lerp(a.x,b-.5*e,.12),a.y=Math.lerp(a.y,c-.5*f,.12),a.alpha=.7,this.tileMarkers[0].visible=!1,void(this.selectedOk=!1);var g=~~(b/e),h=~~(c/f);this.tileMarkers[0].x=g*e,this.tileMarkers[0].y=h*f,this.tileMarkers[0].visible=!0;var i=this.parent.localToLocal(this.tileMarkers[0].x,this.tileMarkers[0].y,a.parent);a.x=Math.lerp(a.x,i.x,.12),a.y=Math.lerp(a.y,i.y,.12),a.tileX=g,a.tileY=h,a.alpha=1;var j=!0;this.tileWire[h][g]&&(j=!1),this.tilePath[h][g]&&(j=!1),this.tilePiece[h][g]&&(j=!1),this.tileObstacle[h][g]&&(j=!1),this.tileWater[h][g]||"water"!==a.tileType||(j=!1),this.tileWater[h][g]&&"ground"===a.tileType&&(j=!1);var k=this.tilePiece[h+1]?this.tilePiece[h+1][g]:null;!k||"ride"!==k.type||"drop"!==k.rideType&&"ferris"!==k.rideType||(j=!1),k=this.tilePiece[h][g+1]||null,k&&"ride"===k.type&&"coaster"===k.rideType&&(j=!1),a.isTut&&(j=a.tileX===g&&a.tileY===h),this.selectedX=g,this.selectedY=h,this.selectedOk=j,this.tileMarkers[0].graphics.c().f(this.selectedOk?"#0f0":"#f00").dr(0,0,e,f)},b.placeItemOnTile=function(a){if(ph.scene.device.drag=null,this.highlightTileWithItem(null),this.selectedOk){this.tilePiece[this.selectedY][this.selectedX]=a,this.addChild(a);var b=this.parent.localToLocal(a.x,a.y,this);a.x=b.x,a.y=b.y,this.addChild(a);var c=ph.scene.tileData,d=c.width,e=c.height;cjs.Tween.get(a,{override:!0}).to({x:this.selectedX*d,y:this.selectedY*e},200,cjs.Ease.quadOut).set({zIndex:"water"===a.tileType?-2:this.selectedY*e}),a.tileX=this.selectedX,a.tileY=this.selectedY,a.lastX=a.tileX*d,a.lastY=a.tileY*e,a.checkSignPos(),a.animSign(),a._lastCheckX=a._lastCheckY=-1;var f=a.checkPossibleConnections().slice(0,2);f.length&&app.sound.play("power-on");for(var g=0;g<f.length;g++){var h=this.tilePiece[a.tileY+f[g].y][a.tileX+f[g].x];if(h.canConnect()){h.animSign();var i,j=!1,k=h.wireId;k||(k=a.wireId,j=!0),k?h.neighbors.length<2&&(i=this.getWire(k),j?a.tileX===i.path[0].x&&a.tileY===i.path[0].y?i.path.unshift({x:h.tileX,y:h.tileY}):a.tileX===i.path.last().x&&a.tileY===i.path.last().y&&i.path.push({x:h.tileX,y:h.tileY}):h.tileX===i.path[0].x&&h.tileY===i.path[0].y?i.path.unshift({x:a.tileX,y:a.tileY}):h.tileX===i.path.last().x&&h.tileY===i.path.last().y&&i.path.push({x:a.tileX,y:a.tileY}),i.setPath(i.path),i.drawPath(i.connected,!1)):(i=this.getWire(0),i.set({alpha:1,startX:a.tileX,startY:a.tileY,startTile:a}),i.setPath([{x:a.tileX,y:a.tileY},{x:h.tileX,y:h.tileY}]),i.drawPath(!1,!1)),i&&(a.addNeighbor(h).set({wireId:i.id}),h.addNeighbor(a).set({wireId:i.id}))}}ph.scene.gameTutorial&&a.wireId&&ph.scene.gameTutorial.stepComplete(),ph.scene.checkComplete(a.wireId)}else ph.scene.device.moveBack(a);this.selectedX=this.selectedY=-1,this.selectedOk=0},b.spawnCharacters=function(){for(var a=ph.loader.get("sprites-game"),b=0;b<this.characterPaths.length;b++)for(var c=0;4>c;c++){var d=new cjs.GameCharacter(a,"header/short-blue").set({regX:31,regY:34});this.addChild(d.setPath(this.characterPaths[b])),cjs.Tween.get(d).wait(120*Math.rand(6,12)).call(d.getNextDir,null,d)}},b.shuffleRideWatts=function(){var a,b,c,d=[],e=[],f=ph.scene.gameTutorial;for(a=0;a<this.tilePiece.length;a++)for(b=0;b<this.tilePiece[a].length;b++)c=this.tilePiece[a][b],c&&"ride"===c.type&&(d.push(c),e.push(c.props.watts));for(app.sound.play(f?"power-disrupt-short":"power-disrupt"),a=0;a<d.length;a++){var g=ph.scene.device.lightnings[a];g.x=d[a].x+(f?60:102),g.y=d[a].y+(f?60:102),g.visible=!0,cjs.Tween.get(this).wait(400*a).call(g.gotoAndPlay,["lightning/lightning"],g).wait(200).call(this.shuffleRideWatts2,[d[a],e[(a+1)%e.length]],this)}},b.shuffleRideWatts2=function(a,b){ph.scene.gameTutorial?a.hasPower(!1):(a.props.watts=b,a.tag.setWatts(b,!0),ph.scene.checkComplete(a.wireId,!0))},b.getLevelData=function(){for(var a=ph.scene.levelDataTiles,b=[],c=0;c<this.rows;c++){b[c]=[];for(var d=0;d<this.cols;d++)b[c][d]=a[c*this.cols+d]}return b},b.buildLevel=function(){var a=this.getLevelData(),b=this.extraTiles,c=ph.scene.tileData,d=c.width,e=c.height;this.tileGround.length&&(a=this._beforeTiles(a));var f,g,h,i,j=this.tileGround.length?d*this.cols:0,k=ph.loader.get("sprites-game-art"),l=[],m=[],n=[],o=[],p=[],q=[];for(h=0;h<a.length;h++)for(l[h]=[],m[h]=[],n[h]=[],o[h]=[],p[h]=[],q[h]=[],i=0;i<a[0].length;i++){f=j+i*d,g=h*e,n[h][i]=0,m[h][i]=0,o[h][i]=0,p[h][i]=0,q[h][i]=0,l[h][i]=new cjs.Sprite(k,"tiles/grass/"+Math.rand(5,8)).set({x:f,y:g,zIndex:-100,cursor:"pointer"});var r,s=a[h][i];s>0?(r=c.type[s-1],r&&r.mix?(m[h][i]=new cjs.Sprite(k,c.type[r.mix[0]].sprite.random()).set({name:"path",x:f,y:g,zIndex:-90}),o[h][i]=new cjs.Sprite(k,c.type[r.mix[1]].sprite.random()).set({name:"obstacle",x:f,y:g,zIndex:g,regX:120,regY:120})):r&&"path"===r.type?m[h][i]=new cjs.Sprite(k,r.sprite.random()).set({name:"path",x:f,y:g,zIndex:-90,dir:r.dir}):r&&"water"===r.type?n[h][i]=new cjs.GameWater(k,r.sprite.random()).set({name:"water",x:f,y:g,zIndex:-90}):r&&"obstacle"===r.type&&(o[h][i]=new cjs.Sprite(k,r.sprite.random()).set({name:"obstacle",x:f,y:g,zIndex:g,regX:r.regX||0,regY:r.regY||0}))):0>s&&Math.rand()<.3&&(r=c.type[Math.rand(21,23)],o[h][i]=new cjs.Sprite(k,r.sprite).set({name:"junk",x:f,y:g,zIndex:g,regX:120,regY:120})),l[h][i]&&this.addChild(l[h][i]),m[h][i]&&this.addChild(m[h][i]),n[h][i]&&this.addChild(n[h][i]),o[h][i]&&this.addChild(o[h][i])}for(h=0;h<ph.scene.levelDataObjects.length;h++){var t=ph.scene.levelDataObjects[h],u=~~(t.x/d),v=~~(t.y/e),w=~~(Math.abs(~~(j/d))/2);f=j+(u+w)*d;var x=new cjs.GameTile(t.type,t.properties).set({x:f,y:t.y,startX:t.x,startY:t.y,lastX:t.x,lastY:t.y,tileX:u,tileY:v,zIndex:t.y});for(i=ph.scene.device.tags.length-1;i>=0;i--){var y=ph.scene.device.tags[i];if(!y.tilePiece){x.tag=y.set({alpha:0}),y.tilePiece=x,y.setWatts(t.properties.watts,"ride"===t.type);break}}for(i=ph.scene.device.signs.length-1;i>=0;i--){var z=ph.scene.device.signs[i];if(!z.tilePiece){x.sign=z,z.tilePiece=x;break}}ph.scene.gameTutorial&&0===ph.game.data.tutorialN&&x.icon.set({paused:!1,framerate:12}),p[v][u+w]=this.addChild(x)}var A=this.setupCharacters(m,p),B=cjs.Tween.get(this).set({mouseEnabled:!1});return this.tileGround.length?(B.wait(400).call(app.sound.play,["level-transition"],app.sound).to({x:this.x-d*(this.cols+b)},1800,cjs.Ease.sineInOut).call(this._afterTiles,[l,m,n,o,p,q,A],this),cjs.Tween.get(this).wait(1700).call(this.hideWires,null,this)):B.call(this._setTiles,[l,m,n,o,p,q,A],this),B.set({mouseEnabled:!0})},b._beforeTiles=function(a){var b,c,d=this.extraTiles;for(b=0;b<this.rows;b++)for(c=0;d>c;c++)a[b].unshift(-1);return a},b._afterTiles=function(a,b,c,d,e,f,g){var h,i,j=this.extraTiles;for(h=0;h<this.tileGround.length;h++)for(i=0;i<this.tileGround[0].length;i++)this.tileGround[h][i]&&this.removeChild(this.tileGround[h][i]),this.tilePath[h][i]&&this.removeChild(this.tilePath[h][i]),this.tileWater[h][i]&&this.removeChild(this.tileWater[h][i]),this.tileObstacle[h][i]&&this.removeChild(this.tileObstacle[h][i]),this.tilePiece[h][i]&&(this.tilePiece[h][i].tag.tilePiece=null,this.tilePiece[h][i].tag=null,this.tilePiece[h][i].sign.tilePiece=null,this.tilePiece[h][i].sign=null,this.removeChild(this.tilePiece[h][i]));for(;this.characters.length;)this.removeChild(this.characters.pop());for(h=0;h<this.rows;h++)for(i=0;j>i;i++)this.removeChild(a[h].shift()),this.removeChild(b[h].shift()),this.removeChild(c[h].shift()),this.removeChild(d[h].shift()),this.removeChild(e[h].shift());this._setTiles(a,b,c,d,e,f,g)},b._setTiles=function(a,b,c,d,e,f,g){function h(a,b){a&&("piece"===b&&(b="ride"===a.type?"ride":"energy"),a.name=b+"-tile-"+j+"-"+k,a.x+=i.x)}this.tileGround=a,this.tilePath=b,this.tileWater=c,this.tileObstacle=d,this.tilePiece=e,this.tileWire=f,this.characters=g;for(var i=this,j=0;j<this.rows;j++)for(var k=0;k<this.cols;k++)h(this.tileGround[j][k],"ground"),h(this.tilePath[j][k],"path"),h(this.tileWater[j][k],"water"),h(this.tileObstacle[j][k],"obstacle"),h(this.tilePiece[j][k],"piece");this.x-=this.x},b.setupCharacters=function(a,b){var c,d,e=[],f=0,g=[1,2,3,4,5,6,7,8,9].shuffle(),h=this.tileGround.length?this.extraTiles:0;for(c=0;c<a.length;c++)for(d=0;d<a[c].length;d++)if(a[c][d]&&!b[c][d]){var i=a[c][d].x,j=a[c][d].y,k=new cjs.GameCharacter(g[++f%g.length]).set({x:i+60,y:j+60,zIndex:j+60,startX:120*(d-h)+60,startY:120*c+60});e.push(this.addChild(k))}return e},cjs.GameBoard=cjs.promote(a,"Container")}(),function(){function a(){this.Container_constructor(),this.name="popup",this.mouseEnabled=!1;var a=new cjs.Shape((new cjs.Graphics).f("#000").dr(0,0,960,600)).set({name:"bg",regX:480,regY:300,alpha:0,zIndex:-100});this.addChild(a);var b=ph.loader.get("sprites-game-art");ph.loader.get("anim-spark");this.sparks=[new cjs.Sprite(b,"spark/spark").set({name:"spark-1",regX:75,regY:75,alpha:0,mouseEnabled:!1,framerate:24}),new cjs.Sprite(b,"spark/spark").set({name:"spark-2",regX:75,regY:75,alpha:0,mouseEnabled:!1,framerate:24}),new cjs.Sprite(b,"spark/spark").set({name:"spark-3",regX:75,regY:75,alpha:0,mouseEnabled:!1,framerate:24})],this.mask=new cjs.Shape((new cjs.Graphics).f("#fff").dr(0,0,960,600)),this.on("click",this.interaction,this),this.on("removed",this.removeAllEventListeners,this)}var b=cjs.extend(a,cjs.Container);b.showLevel=function(){if(ph.scene.mouseEnabled=ph.scene.device.mouseEnabled=!1,ph.scene.timer.pause(),window.app.config.game.quick)ph.scene.gameTutorial?ph.scene.gameTutorial.start():ph.scene.start2();else{var a=ph.scene.gameTutorial?"How to Play":"Level "+ph.game.data.levelN,b=ph.loader.get("sprites-game-ui"),c=new cjs.Sprite(b,"popup-level").set({regX:235,regY:78,zIndex:-1}),d=new cjs.Text(a,"63px russo-one","#fff").set({y:-12,textAlign:"center",textBaseline:"middle",maxWidth:420});d.shadow=new cjs.Shadow("rgba(0, 0, 0, 0.5)",0,4,0);var e=(new cjs.Container).set({y:-1024,mouseEnabled:!1});e.addChild(c,d);var f=cjs.Tween.get(this.addChild(e)).to({y:0},600,cjs.Ease.quadOut).wait(1e3).to({y:-1024},600,cjs.Ease.quadIn).call(e.removeAllChildren,[!0],e).call(this.removeChild,[e],this),g=cjs.Tween.get(this.getChildByName("bg")).to({alpha:.5},400);if(ph.scene.gameTutorial)f.call(ph.scene.gameTutorial.start,null,ph.scene.gameTutorial),g.wait(1400).to({alpha:0},400);else{var h=ph.game.data.levelN;1===h||3===h||5===h?f.call(this.talkAboutEnergy,[h],this):(f.call(ph.scene.start2,null,ph.scene),g.wait(1400).to({alpha:0},400))}}},b.talkAboutEnergy=function(a){var b,c;1===a?(b="016_MotherBoard_CYB-WOT_03_SELECT",c="solar"):3===a?(b="014_MotherBoard_CYB-WOT_03_SELECT",c="wind"):5===a&&(b="015_MotherBoard_CYB-WOT_02_SELECT",c="dam");var d=new cjs.Sprite(ph.loader.get("sprites-game-ui"),"sample/"+c).set({regX:152.5,regY:146,alpha:0,mouseEnabled:!1});cjs.Tween.get(this.addChild(d)).to({alpha:1},400);var e=this;app.voPlayer.play(b,function(){cjs.Tween.get(d).to({alpha:0},400),cjs.Tween.get(e.getChildByName("bg")).wait(400).to({alpha:0},400).call(ph.scene.start2,null,ph.scene)})},b.showResults=function(a){a&&ph.game.trackEvent("WOT","Level "+ph.game.data.levelN,"Pass"),this.mouseEnabled=!0;var b,c,d=ph.loader.get("sprites-game-ui"),e=(new cjs.Container).set({name:"box",y:-1024}),f=new cjs.Text("Level "+ph.game.data.levelN+" Complete","25px russo-one","#fff").set({y:-150,maxWidth:360,textAlign:"center",textBaseline:"middle",mouseEnabled:!1}),g=new cjs.Text("You did it!","50px russo-one","#fff").set({y:-100,maxWidth:400,textAlign:"center",textBaseline:"middle",mouseEnabled:!1});a?(b=new cjs.Button(d,"btn/next/bg","btn/next/icon").set({name:"btn-next",y:154}).pulse(),c=new cjs.Button(d,"btn/restart/small/bg","btn/restart/small/icon").set({name:"btn-restart",x:-170,y:162}),e.addChild(c)):b=new cjs.Button(d,"btn/restart/big/bg","btn/restart/big/icon").set({name:"btn-restart",y:154}).pulse(),a||(f.text="Oh no!",g.text="Time ran out."),e.addChild(this.sparks[0].set({x:-130,y:24,alpha:0,scaleX:0,scaleY:0,zIndex:-10}),this.sparks[1].set({x:0,y:0,alpha:0,scaleX:0,scaleY:0,zIndex:-10}),this.sparks[2].set({x:130,y:24,alpha:0,scaleX:0,scaleY:0,zIndex:-10}));var h=new cjs.Sprite(d,"star-empty").set({x:-130,y:24,regX:55,regY:53.5,zIndex:-1}),i=h.clone().set({x:0,y:0,zIndex:-1}),j=i.clone().set({x:130,y:24,zIndex:-1}),k=new cjs.Sprite(d,"star-full").set({name:"star-1",x:-130,y:24,regX:55,regY:53.5,scaleX:1.8,scaleY:1.8,alpha:0,zIndex:0}),l=k.clone().set({name:"star-2",x:0,y:0}),m=l.clone().set({name:"star-3",x:130,y:24});e.addChild(h,i,j,k,l,m);for(var n=1;a>=n;n++)cjs.Tween.get(e.getChildByName("star-"+n)).wait(800+200*n).call(app.sound.play,["star-"+n],app.sound).to({scaleX:1,scaleY:1,alpha:1},400,cjs.Ease.quadIn),cjs.Tween.get(this.sparks[n-1]).wait(900+200*n).to({alpha:1,scaleX:1.4,scaleY:1.4},600,cjs.Ease.sineOut).wait(1200).to({alpha:0},800);f.shadow=g.shadow=new cjs.Shadow("rgba(0, 0, 0, 0.5)",0,4,0);var o=new cjs.Button(d,"btn/home/bg","btn/home/icon").set({name:"btn-home",x:170,y:162}),p=new cjs.Sprite(d,"popup-results").set({regX:269.5,regY:193,zIndex:-10,mouseEnabled:!1});e.addChild(p,f,g,o,b);var q="034_MotherBoard_CYB-WOT_02a_SELECT";1===a?q="035_MotherBoard_CYB-WOT_02b_SELECT":2===a?q="038_MotherBoard_CYB-WOT_02a_SELECT":3===a&&(q="039_MotherBoard_CYB-WOT_04a_SELECT"),cjs.Tween.get(this.addChild(e)).to({y:0},600,cjs.Ease.quadOut).wait(400+200*a).call(app.voPlayer.play,[q,this.voComplete.bind(this,a)],app.voPlayer),cjs.Tween.get(this.getChildByName("bg")).to({alpha:.5},400)},b.voComplete=function(a){a&&Math.rand(0,1)&&15!==ph.game.data.levelN&&app.voPlayer.play("Lets-Power-Up")},b.hideResults=function(){this.mouseEnabled=!1,cjs.Tween.get(this.getChildByName("bg")).to({alpha:0},400);var a=this.getChildByName("box");return cjs.Tween.get(a,{override:!0}).to({y:-1024},600,cjs.Ease.quadIn).call(a.removeAllChildren,[!0],a).call(this.removeChild,[a],this)},b.interaction=function(a){var b=a.target.name||"";"click"===a.type&&(this.mouseEnabled=!1,"btn-restart"===b?(app.voPlayer.stop(),ph.scene.reset(),cjs.Tween.get(this).wait(400).call(function(){this.hideResults().call(ph.scene.start2,null,ph.scene)},null,this)):"btn-next"===b?cjs.Tween.get(this).wait(400).call(function(){ph.game.switchScene(ph.game.data.completed?ph.Scene.Cutscene:ph.Scene.Menu)},null,this):"btn-home"===b&&ph.game.switchScene(ph.Scene.Menu))},cjs.GamePopup=cjs.promote(a,"Container")}(),function(){function a(){this.Container_constructor(),this.name="con-pause",this.position=0,this.time=0;var a=ph.loader.get("sprites-game-ui"),b=new cjs.Sprite(a,"static"),c=(new cjs.Container).set({name:"bg",regX:480,regY:300,mouseChildren:!1,cursor:"default"});c.addChild(b,b.clone().set({x:480}),b.clone().set({y:300}),b.clone().set({x:480,y:300}));var d=new cjs.Text("Paused","92px russo-one","#fff").set({name:"text",y:-90,textAlign:"center",textBaseline:"middle",mouseEnabled:!1});d.shadow=new cjs.Shadow("rgba(0, 0, 0, 0.5)",0,4,0);var e=new cjs.Text("Resume","36px russo-one","#fff").set({y:200,textAlign:"center",textBaseline:"alphabetic",mouseEnabled:!1}),f=new cjs.Button(a,"btn/play",null).set({name:"btn-play",y:96}),g=new cjs.Text("Restart","30px russo-one","#fff").set({x:-240,y:200,textAlign:"center",textBaseline:"alphabetic",mouseEnabled:!1}),h=new cjs.Button(a,"btn/restart",null).set({name:"btn-restart",x:-240,y:96}),i=new cjs.Text("Home","30px russo-one","#fff").set({x:240,y:200,textAlign:"center",textBaseline:"alphabetic",mouseEnabled:!1}),j=new cjs.Button(a,"btn/home",null).set({name:"btn-home",x:240,y:96});this.addChild(c,d,f,e,h,g,j,i),this.on("click",this.interaction,this),this.on("removed",this.removed,this)}var b=cjs.extend(a,cjs.Container);b._tick=function(a){if(ph.scene.isPaused&&(this.time+=ph.timer.delta,this.time>.2)){this.time=0,this.position++;var b=this.getChildByName("bg");if(!b)return;switch(this.position%4){case 0:b.scaleX=1,b.scaleY=1;break;case 1:b.scaleX=1,b.scaleY=-1;break;case 2:b.scaleX=-1,b.scaleY=1;break;case 3:b.scaleX=-1,b.scaleY=-1}}},b.removed=function(){this.removeAllChildren(!0),this.removeAllEventListeners()},b.interaction=function(a){var b=a.target.name||"";"click"===a.type&&("btn-play"===b?cjs.Tween.get(this).set({mouseEnabled:!1}).wait(400).call(ph.scene.interaction,[{type:"click",target:ph.scene.btnPause}],ph.scene):"btn-home"===b?cjs.Tween.get(this).set({mouseEnabled:!1}).wait(400).call(ph.game.switchScene,[ph.Scene.Menu],ph.game):"btn-restart"===b&&cjs.Tween.get(this).set({mouseEnabled:!1}).wait(400).call(ph.scene.reset,null,ph.scene).call(ph.scene.interaction,[{type:"click",target:ph.scene.btnPause}],ph.scene).wait(800))},cjs.GamePause=cjs.promote(a,"Container")}(),function(){function a(){this.Container_constructor(),this.mouseEnabled=!1,this.name="tag",this.zIndex=101,this.tilePiece=null;var a=new cjs.Sprite(ph.loader.get("sprites-game-art"),"spark/spark").set({name:"sparks",zIndex:-100,regX:75,regY:75,alpha:0,framerate:24,paused:!0});this.con=new cjs.Container,this.addChild(this.con,a)}var b=cjs.extend(a,cjs.Container);b._tick=function(a){this.tilePiece?"ride"===this.tilePiece.type&&(this.getChildAt(0).alpha=0):this.getChildAt(0).alpha=0,this.Container__tick(a)},b.setWatts=function(a,b){this.con.uncache(),this.con.removeAllChildren(!0);var c=new cjs.Text(parseInt(a)>=10?"00":"0","30px russo-one","#000").set({
textAlign:"center",textBaseline:"middle"}),d=this.con.addChild(new cjs.Container);d.addChild(c);var e=d.getBounds(),f=Math.limit(e.width,28,128),g=Math.limit(e.height,42,128);c.text=a,c.x=.5*f+8,c.y=.5*g+2;var h=(new cjs.Shape).set({zIndex:-1});return h.graphics.f(b?"#fff94f":"#1ded39").s("#000").ss(3),b?h.graphics.mt(0,0).lt(10,4).lt(10+f,0).lt(10+f+2,g).lt(5,g).lt(6,14).lt(0,0).es():h.graphics.dc(c.x,c.y-1,parseInt(a)>=10?24:21),this.con.addChild(h),this.con.cache(-4,-4,f+f,g+g),this.getChildAt(0).set({alpha:1,scaleX:.8,scaleY:.8,x:.5*f,y:.5*g,paused:!1}),this},b.clone=function(b){var c=this._cloneProps(new a);return b&&this._cloneChildren(c),c},cjs.GameTag=cjs.promote(a,"Container")}(),function(){function a(a,b){this.Container_constructor(),this.mouseEnabled=!1,this.name=a,this.type=a,this.props=b,this.watts=b.watts,this.startX=0,this.startY=0,this.lastX=0,this.lastY=0,this.origX=0,this.origY=0,this.tileX=-1,this.tileY=-1,this.sizeX=1,this.sizeY=1,this.tileType=null,"energy"===this.type?(this.tileType="dam"===this.props.sprite?"water":"ground",this.energyType=this.props.sprite):this.rideType=this.props.sprite,this.neighbors=[],this.wireId=0,this.outputDirX=[],this.outputDirY=[],this.outputDirConnected=[];var c=ph.loader.get("sprites-game-art");if("energy"===this.type)this.icon=new cjs.Sprite(c,"tiles/energy/"+this.energyType+"/"+this.energyType).set({name:"icon",framerate:24});else if("ride"===this.type){var d=Math.rand(0,1)?"a":"b";if("drop"!==this.rideType)if("coaster"===this.rideType){this.icon=new cjs.Sprite(c,"tiles/rides/coaster/ride").set({name:"icon",framerate:12,regX:120,regY:30}),this.icon.paused=!0;var e=new cjs.Sprite(c,"tiles/rides/coaster/bg").set({regX:120,regY:30,zIndex:-1});this.addChild(e,this.icon)}else this.icon=new cjs.Sprite(c,"tiles/rides/"+this.rideType+"-"+d+"/ride").set({name:"icon",framerate:12,regY:120}),this.icon.paused=!0;else{var f=new cjs.Sprite(c,"tiles/rides/drop-"+d+"/tower").set({regY:120,zIndex:-1}),g=new cjs.Sprite(c,"tiles/rides/drop-"+d+"/cart").set({x:59,y:80,regX:38,regY:37});this.addChild(f,g),this.tweenObj1=cjs.Tween.get(g,{loop:!0,paused:!0}).wait(1200).to({y:-40},4200).wait(800).to({y:80},600,cjs.Ease.sineIn).wait(400),this.tweenObj2=cjs.Tween.get(g,{loop:!0,paused:!0}).wait(6200).to({scaleX:.7},200,cjs.Ease.sineIn).wait(200).to({scaleX:1},200,cjs.Ease.sineIn).to({scaleY:.5},200,cjs.Ease.sineOut).to({scaleY:1},200,cjs.Ease.backOut),this.on("removed",this.removed,this)}var h=new cjs.Sprite(c,"spark/spark").set({name:"sparks",x:"coaster"!==this.rideType?60:0,y:60,zIndex:-10,regX:75,regY:75,visible:!1,mouseEnabled:!1,framerate:24});this.addChild(h)}this.addChild(this.icon)}a.maxConnections=3;var b=cjs.extend(a,cjs.Container);b.removed=function(){cjs.Tween.removeTweens(this.tweenObj1.target),cjs.Tween.removeTweens(this.tweenObj2.target),this.tweenObj1=this.tweenObj2=null,this.removeAllEventListeners()},b._tick=function(a){this.updateTag(),"energy"===this.type&&(this.offsetIcon(),this.wireId?this.checkSignPosWithWire():this.checkSignPos()),this.Container__tick(a)},b.offsetIcon=function(){if(!("water"!==this.tileType||this.tileY<0||this.tileX<0)){var a=ph.scene.device.board.tileWater;a&&a.length&&(a=a[this.tileY][this.tileX],a&&a.tricky?this.icon.x<11.99&&this.icon.y>-11.99&&(this.icon.x=Math.lerp(this.icon.x,12,.18),this.icon.y=Math.lerp(this.icon.y,-12,.18)):a&&a.tricky||this.icon.x>.01&&this.icon.y<.01&&(this.icon.x=Math.lerp(this.icon.x,0,.18),this.icon.y=Math.lerp(this.icon.y,0,.18)))}};var c=null;b._lastPosX=0,b._lastPosY=0,b.updateTag=function(){if(this.tag){if(this._lastPosX===this.x&&this._lastPosY===this.y)return;this._lastPosX=this.x,this._lastPosY=this.y,c=this.tag.parent.localToLocal(this.x,this.y,this.parent,c),this.tag.x=c.x+78,this.tag.y=c.y+78}},b.checkSignPosWithWire=function(){for(var a,b=ph.scene.device.board.getWire(this.wireId),c=this.isConnected(),d=0;d<b.path.length;d++)if(a=b.path[d],a.x===this.tileX&&a.y===this.tileY){a=b.path[d+1]||{x:this.tileX,y:this.tileY},a.x===this.tileX||c?a.y===this.tileY||c?this.setSignPos(-1):this.setSignPos(a.y>this.tileY?1:3):this.setSignPos(a.x>this.tileX?0:2);break}return b.path},b._lastCheckX=-1,b._lastCheckY=-1,b._lastCheckConnections=null,b.checkPossibleConnections=function(b,c){if(b=b||this.tileX,c=c||this.tileY,b===this._lastCheckX&&c===this._lastCheckY)return this._lastCheckConnections;this._lastCheckX=b,this._lastCheckY=c;var d,e,f=[],g=[],h=this.checkTile(b+1,c),i=this.checkTile(b,c+1),j=this.checkTile(b-1,c),k=this.checkTile(b,c-1);for(h&&h.canConnect()&&f.push({x:1,y:0}),i&&i.canConnect()&&f.push({x:0,y:1}),j&&j.canConnect()&&f.push({x:-1,y:0}),k&&k.canConnect()&&f.push({x:0,y:-1}),d=0;d<f.length;d++)if(e=ph.scene.device.board.tilePiece[c+f[d].y][b+f[d].x],e.isConnected(!0)){g.push(f[d]);break}if(!g.length&&f.length){var l,m=0;for(d=0;d<f.length;d++)e=ph.scene.device.board.tilePiece[c+f[d].y][b+f[d].x],l=e.getConnectionCount(),m+l<a.maxConnections-1&&(m+=l,g.push({x:f[d].x,y:f[d].y,count:l}));g=g.sort(function(a,b){return a.count-b.count})}return this._lastCheckConnections=g.length?g:f,this._lastCheckConnections},b.checkSignPos=function(){var a=ph.scene.device.drag,b=this.tileX,c=this.tileY,d=-1;if(a&&a!==this)a.tileX===b+1&&a.tileY===c?d=0:a.tileX===b&&a.tileY===c+1?d=1:a.tileX===b-1&&a.tileY===c?d=2:a.tileX===b&&a.tileY===c-1&&(d=3),(0===a.found&&2===d||1===a.found&&3===d||2===a.found&&0===d||3===a.found&&1===d)&&(d=-1);else if(a===this&&ph.scene.device.board.selectedOk){b=ph.scene.device.board.selectedX,c=ph.scene.device.board.selectedY;var e=this.checkPossibleConnections(b,c).slice(0,1);e.length&&(e[0].x>0?d=0:e[0].y>0?d=1:e[0].x<0?d=2:e[0].y<0&&(d=3))}this.setSignPos(d)},b.setSignPos=function(a){if(!ph.scene.isPaused){this.found=a;var b=this.sign;a>-1?(b.alpha<.98&&(b.alpha=Math.lerp(b.alpha,1,.12)),c=b.parent.localToLocal(this.x,this.y,this.parent,c),0===a?(b.x=c.x+120,b.y=c.y+60):1===a?(b.x=c.x+60,b.y=c.y+120):2===a?(b.x=c.x+0,b.y=c.y+60):3===a&&(b.x=c.x+60,b.y=c.y+0)):b.alpha>.02&&(b.alpha=Math.lerp(b.alpha,0,.12))}},b.checkTile=function(a,b){var c,d=ph.scene.device.board.tilePiece,e=null;return b>-1&&b<d.length&&a>-1&&a<d[b].length&&(c=d[b][a],c&&"ride"!==c.type&&(e=c!==this?c:null)),e},b.isConnected=function(a){var b,c=!1;if(a)this.wireId&&(c=ph.scene.device.board.getWire(this.wireId).connected);else for(b=0;b<this.neighbors.length;b++)"ride"===this.neighbors[b].type&&(c=!0);return c},b.getConnectionCount=function(){var a=0;if(this.wireId){var b=ph.scene.device.board.getWire(this.wireId);a=b.getConnections().length}return a},b.canConnect=function(){var b=!0,c=this.getConnectionCount();return c>=a.maxConnections&&(b=!1),2===this.neighbors.length&&(b=!1),this.neighbors.length&&this.neighbors[0].neighbors.length>1&&c>=a.maxConnections&&(b=!1),b},b.addNeighbor=function(a){return this.neighbors.indexOf(a)<0&&this.neighbors.push(a),this},b.removeNeighbors=function(a){var b=this.isConnected();if(a)this.neighbors.erase(a);else for(;this.neighbors.length;)this.neighbors.pop().removeNeighbors(this);return this.neighbors.length||(this.wireId&&(ph.scene.device.board.breakWire(this.wireId,~~(this.lastX/120),~~(this.lastY/120),b),"ride"!==this.type||ph.scene.gameTutorial||this.hasPower(!1)),this.wireId=0),this},b.hasPower=function(a){"drop"===this.rideType?a?(this.tweenObj1.setPaused(!1),this.tweenObj2.setPaused(!1)):this.tweenObj1.position&&this.tweenObj1.duration-this.tweenObj1.position<1e3?cjs.Tween.get(this).wait(1e3).call(this.tweenObj1.setPaused,[{paused:!0}],this.tweenObj1).call(this.tweenObj2.setPaused,[{paused:!0}],this.tweenObj2):(this.tweenObj1.setPaused(!0),this.tweenObj2.setPaused(!0)):cjs.Tween.get(this.icon.set({paused:a?!0:this.icon.paused,framerate:a?1:12})).to({framerate:a?12:1},1800,a?cjs.Ease.quadIn:cjs.Ease.quadOut).call(this.icon.set,[{paused:!a}],this.icon),a?(app.sound.play("power-ride-on"),this.showSparks()):this.wireId&&app.sound.play("power-ride-off")},b.brokenWire=function(){this.neighbors.length=0,this.wireId=0,"ride"===this.type&&this.hasPower(!1)},b.animSign=function(){for(var a=this.sign,b=cjs.Tween.get(a,{override:!0}),c=0;3>c;c++)b.to({scaleX:-1},120+60*c,cjs.Ease.sineInOut).to({scaleX:1},120+60*c,cjs.Ease.sineInOut);cjs.Tween.get(a.getChildAt(0),{override:!0}).to({scaleX:1.4,scaleY:1.4},200,cjs.Ease.sineOut).to({scaleX:1,scaleY:1},1200,cjs.Ease.sineIn)},b.showSparks=function(){var a=this.getChildByName("sparks");cjs.Tween.get(a,{override:!0}).set({visible:!0}).to({scaleX:1.8,scaleY:1.8},800,cjs.Ease.backOut).wait(1800).to({scaleX:0,scaleY:0},800,cjs.Ease.backIn).set({visible:!1})},cjs.GameTile=cjs.promote(a,"Container")}(),function(){function a(a,b){this.Container_constructor(),this.mouseEnabled=!1,this.timer=Math.rand(.25,1.25),this.corner=/tiles\/water\/(2|5|6|7)/i.test(b),this.tricky="tiles/water/2"===b,this.addChild(new cjs.Sprite(a,b).set({zIndex:-(1/0)})),this.twinkles=[];for(var c=0;4>c;c++){var d=new cjs.Sprite(a,"twinkle/twinkle").set({regX:6,regY:6,framerate:12}).stop();this.twinkles.push(this.addChild(d))}a._data["twinkle/twinkle"].next=!1,this.on("removed",this.removed,this)}var b=cjs.extend(a,cjs.Container);b.removed=function(){this.removeAllChildren(!0),this.removeAllEventListeners()},b._tick=function(a){if(this.timer-=ph.timer.delta,this.timer<=0){this.timer=Math.rand(.25,1.25);for(var b=this.twinkles.length-1;b>=0;b--){var c=this.twinkles[b];if(c.paused){c.gotoAndPlay("twinkle/twinkle"),c.x=60+Math.rand(-32,32),c.y=60+Math.rand(-32,32),c.alpha=Math.rand(.1,.6);break}}}this.Container__tick(a)},cjs.GameWater=cjs.promote(a,"Container")}(),function(){ph.GameTutorial=ph.Class.extend({step:0,tilePieces:[],tileRide:null,btnSkip:null,handSpr:null,arrowSpr1:null,arrowSpr2:null,mbSpr:null,init:function(){var a=ph.loader.get("sprites-game-ui");this.btnSkip=new cjs.Button(a,"btn/skip/bg","btn/skip/icon").set({name:"btn-skip",x:435,y:310,scaleX:0,scaleY:0,zIndex:1e3,cursor:"pointer"}),this.handSpr=new cjs.Sprite(a,"hand").set({name:"hand",x:-100,y:200,regX:20,regY:20,zIndex:101,alpha:0,mouseEnabled:!1}),this.arrowSpr1=new cjs.Sprite(a,"arrow").set({name:"arrow-1",regX:44.5,regY:39,zIndex:9999,alpha:0,mouseEnabled:!1}),this.arrowSpr2=new cjs.Sprite(a,"arrow").set({name:"arrow-2",regX:44.5,regY:39,zIndex:9999,alpha:0,mouseEnabled:!1}),this.mbSpr=new cjs.Sprite(a,"motherboard").set({name:"motherboard",x:860,y:-412,regX:85.5,regY:87,mouseEnabled:!1,zIndex:1e4}),ph.scene.addChild(this.btnSkip,this.handSpr,this.arrowSpr1,this.arrowSpr2),ph.scene.device.board.addChild(this.mbSpr),this.btnSkip.on("click",this.interaction,this)},start:function(){ph.scene.mouseEnabled=!0,ph.scene.device.mouseEnabled=!0,cjs.Tween.get(this.btnSkip).to({scaleX:1,scaleY:1},600,cjs.Ease.backOut),this.step1()},close:function(){this.stopSteps(),cjs.Tween.removeTweens(this),window.app.voPlayer.stop();for(var a=0;a<this.tilePieces.length;a--){var b=this.tilePieces[a];b.tag.tilePiece=b.sign.tilePiece=null,b.tag=b.sign=null}this.tilePieces.length=0,this.tileRide=null;var c=this.btnSkip.set({mouseEnabled:!1});c&&cjs.Tween.get(c,{override:!0}).to({scaleX:0,scaleY:0},400,cjs.Ease.backIn).call(c.removeAllEventListeners,null,c).call(c.parent.removeChild,[c],c.parent);var d=this.handSpr;d&&cjs.Tween.get(d,{override:!0}).to({alpha:0},200).call(d.parent.removeChild,[d],d.parent);var e=this.arrowSpr1;e&&cjs.Tween.get(e,{override:!0}).to({alpha:0},200).call(e.parent.removeChild,[e],e.parent);var f=this.arrowSpr2;f&&cjs.Tween.get(f,{override:!0}).to({alpha:0},200).call(f.parent.removeChild,[f],f.parent);var g=this.mbSpr;g&&cjs.Tween.get(g,{override:!0}).call(g.parent.removeChild,[g],g.parent),this.btnSkip.removeAllEventListeners(),this.btnSkip=this.handSpr=this.arrowSpr1=this.arrowSpr2=this.mbSpr=null,ph.game.switchScene(ph.Scene.Menu)},interaction:function(a){"btn-skip"===a.target.name&&(a.target.mouseEnabled=!1,a.target.removeAllEventListeners(),cjs.Tween.get(this).wait(400).call(this.close,null,this))},step1:function(){this.step=1,cjs.Tween.get(this.mbSpr).wait(800).call(ph.scene.hackerShow,[!0],ph.scene).wait(3200).to({y:100},600,cjs.Ease.circOut).call(app.voPlayer.play,["tutorial/step-1",this.step2.bind(this)],app.voPlayer)},step2:function(){this.step=2;var a=ph.loader.get("sprites-game-ui"),b=new cjs.Sprite(a,"sample/solar").set({name:"sample-solar",regX:144,regY:140.5,x:-306,y:130,zIndex:1,alpha:0}),c=new cjs.Sprite(a,"sample/wind").set({name:"sample-wind",regX:149,regY:145.5,y:130,zIndex:1,alpha:0}),d=new cjs.Sprite(a,"sample/dam").set({name:"sample-dam",regX:152.5,regY:144,x:320,y:130,zIndex:1,alpha:0});cjs.Tween.get(ph.scene.addChild(b)).wait(2600).to({alpha:1},400),cjs.Tween.get(ph.scene.addChild(c)).wait(3500).to({alpha:1},400),cjs.Tween.get(ph.scene.addChild(d)).wait(4500).to({alpha:1},400),app.voPlayer.play("tutorial/step-2",this.step3.bind(this))},step3:function(){this.stopSteps(),this.step=3,cjs.Tween.get(this).wait(600).call(app.voPlayer.play,["tutorial/step-3",this.step4.bind(this)],app.voPlayer);var a=ph.scene.device.board.tilePiece[2][4];cjs.Tween.get(a.tag).wait(1200).to({alpha:1},600);var b=ph.scene.device.board.tilePiece[3][1];cjs.Tween.get(b.tag).wait(1200).to({alpha:1},600),cjs.Tween.get(this.arrowSpr1.set({x:114,y:260,rotation:-90})).wait(1200).to({y:180,alpha:1},600,cjs.Ease.circOut)},step4:function(){this.stopSteps(),this.step=4,app.voPlayer.play("tutorial/step-4"),cjs.Tween.get(this,{override:!0,loop:!0}).wait(400).call(function(){app.voPlayer.playing||ph.scene.device.board.wire||app.voPlayer.play("tutorial/step-5")}).wait(9e3),cjs.Tween.get(this.handSpr.set({x:80,y:80}),{loop:!0}).to({alpha:1},400).wait(200).to({scaleX:.9,scaleY:.9},200).wait(200).to({x:-280,y:200},2400,cjs.Ease.sineInOut).wait(200).to({scaleX:1,scaleY:1},200).wait(200).to({alpha:0},400).wait(1200)},step5:function(){this.stopSteps(),this.step=5,cjs.Tween.get(this,{override:!0,loop:!0}).wait(400).call(function(){ph.scene.device.board.wire||app.voPlayer.play("tutorial/step-5")}).wait(9e3)},step6:function(){this.stopSteps(),this.step=6,app.voPlayer.play("tutorial/step-6",this.step6_1.bind(this))},step6_1:function(){cjs.Tween.get(this.mbSpr).to({y:-412},600,cjs.Ease.circIn).call(function(){ph.game.data.tutorialN++,ph.scene.device.complete(),ph.scene.setupLevelData(ph.game.data.tutorialN),ph.scene.device.board.buildLevel().call(ph.scene.device.reset,null,ph.scene.device).call(this.step7,null,this)},null,this)},step7:function(){this.step=7,cjs.Tween.get(this.mbSpr).to({y:100},600,cjs.Ease.circOut),cjs.Tween.get(this.arrowSpr1.set({rotation:0,x:-130,y:-50,alpha:0})).wait(600).to({x:-10,alpha:1},600,cjs.Ease.circOut).wait(1800).to({alpha:0},200).wait(5800).to({rotation:-180,x:310,y:-10}).to({x:190,alpha:1},600,cjs.Ease.circOut).wait(1800).to({alpha:0},200).wait(200).to({rotation:-90,x:-128,y:300},0).to({y:180,alpha:1},600,cjs.Ease.circOut).wait(1800).to({alpha:0},200),cjs.Tween.get(this.arrowSpr2.set({rotation:0,x:110,y:190,alpha:0})).wait(700).to({x:230,alpha:1},600,cjs.Ease.circOut).wait(1800).to({alpha:0},200).wait(5800).to({rotation:-180,x:550,y:230}).to({x:430,alpha:1},600,cjs.Ease.circOut).wait(1800).to({alpha:0},200),cjs.Tween.get(this.handSpr.set({x:330,y:200,scaleX:1,scaleY:1}),{loop:!0}).wait(4200).to({alpha:1},400).wait(200).to({scaleX:.9,scaleY:.9},200).wait(200).to({x:90,y:80},2e3,cjs.Ease.sineInOut).wait(1200).to({scaleX:1,scaleY:1},200).wait(200).to({alpha:0},400).wait(1200);var a=ph.loader.get("sprites-game-art"),b=new cjs.Sprite(a,"tiles/energy/wind/wind").set({name:"sample-wind",x:250,y:130,framerate:24,zIndex:this.handSpr.zIndex-1,alpha:0});ph.scene.addChild(b),cjs.Tween.get(b,{loop:!0}).wait(5200).to({alpha:.7}).to({x:10,y:10},2e3,cjs.Ease.sineInOut).wait(1200).to({alpha:0},200).wait(200).wait(400).wait(1200),app.voPlayer.play("tutorial/step-7"),cjs.Tween.get(this,{loop:!0}).wait(400).call(function(){app.voPlayer.playing||ph.scene.device.board.item||app.voPlayer.play("tutorial/step-7-1")}).wait(9e3)},step8:function(){this.stopSteps(),this.step=8,app.voPlayer.play("tutorial/step-8")},step9:function(){this.stopSteps(),this.step=9,app.voPlayer.play("tutorial/step-9");for(var a=ph.scene.device.board.tilePiece,b=null,c=0;c<a.length;c++)for(var d=0;d<a[c].length;d++)if(a[c][d]&&"energy"===a[c][d].type){b=a[c][d];break}var e=b.parent.localToLocal(b.x,b.y,this.handSpr.parent);cjs.Tween.get(this.handSpr.set({x:-164,y:80,scaleX:1,scaleY:1,alpha:0}),{loop:!0}).wait(2600).to({alpha:1},400).to({scaleX:.9,scaleY:.9},200).wait(200).to({x:e.x+60,y:e.y-60},Math.distance(this.handSpr,b,!0)/1.1,cjs.Ease.sineInOut).wait(200).to({scaleX:1,scaleY:1},200).wait(200).to({alpha:0},400).wait(1200)},step10:function(){this.stopSteps(),this.step=10,app.voPlayer.play("tutorial/step-10",this.step11.bind(this))},step11:function(){this.step=11,cjs.Tween.get(this.arrowSpr1.set({rotation:-90,x:220,y:-200,alpha:0})).wait(800).to({alpha:1,y:-220},600,cjs.Ease.sineOut).wait(400).to({x:-190},3600,cjs.Ease.sineInOut).wait(400).to({alpha:0},600,cjs.Ease.sineIn),app.voPlayer.play("tutorial/step-starbar",this.step12.bind(this))},step12:function(){this.step=12,app.voPlayer.play("tutorial/step-12",this.step13.bind(this)),ph.scene.hackerShow()},step13:function(){this.step=13,cjs.Tween.get(ph.scene.hacker).to({y:ph.scene.hacker.y+512},600,cjs.Ease.circIn),cjs.Tween.get(this.mbSpr).to({y:-412},600,cjs.Ease.circIn).wait(200).call(this.close,null,this)},stepComplete:function(){this.step<=5?this.step6():this.step<=8?this.step9():this.step<=9&&this.step10()},stopSteps:function(){var a;if(this.step<=1&&cjs.Tween.removeTweens(this.mbSpr),this.step<=2){var b=ph.scene.getChildByName("sample-solar");a=ph.scene.getChildByName("sample-wind");var c=ph.scene.getChildByName("sample-dam");b&&(cjs.Tween.get(b).to({alpha:0},200).call(ph.scene.removeChild,[b],ph.scene),cjs.Tween.get(a).wait(100).to({alpha:0},200).call(ph.scene.removeChild,[a],ph.scene),cjs.Tween.get(c).wait(200).to({alpha:0},200).call(ph.scene.removeChild,[c],ph.scene))}this.step<=3&&cjs.Tween.get(this.arrowSpr1,{override:!0}).to({alpha:0},200),this.step<=4&&cjs.Tween.get(this.handSpr,{override:!0}).to({alpha:0},200),this.step<=5&&cjs.Tween.removeTweens(this),this.step<=7&&(a=ph.scene.getChildByName("sample-wind"),a&&cjs.Tween.get(a,{override:!0}).to({alpha:0},200).call(a.parent.removeChild,[a],a.parent),cjs.Tween.get(this.arrowSpr1,{override:!0}).to({alpha:0},200),cjs.Tween.get(this.arrowSpr2,{override:!0}).to({alpha:0},200),cjs.Tween.get(this.handSpr,{override:!0}).to({alpha:0},200),cjs.Tween.removeTweens(this)),this.step<=9&&cjs.Tween.get(this.handSpr,{override:!0}).to({alpha:0},200)}})}(),function(){function a(){this.Container_constructor(),this.alpha=0,this.mouseEnabled=!1,this.name="wire",this.zIndex=-1,this.connected=!1,this.path=[],this.pathPos=[],this.startX=-1,this.startY=-1,this.startTile=null,this._mouseX=0,this._mouseY=0,this.mouseX=0,this.mouseY=0;ph.loader.get("sprites-game-art");this.wire=new cjs.Shape,this.ball=new cjs.Shape((new cjs.Graphics).f("#fff").dc(0,0,8)).set({alpha:0}),this.ball.shadow=new cjs.Shadow("#fff",0,0,12),this.addChild(this.wire,this.ball),this.poles=[],this.poleTops=[],a.buildPoles(),this.on("removed",this.removed,this)}var b=[],c=[];a.buildPoles=function(){if(!b.length)for(var a=ph.loader.get("sprites-game-art"),d=0;64>d;d++)b.push(new cjs.Sprite(a,"tiles/obstacle/1").set({alpha:0,zIndex:-1})),c.push(new cjs.Sprite(a,"tiles/obstacle/1-top").set({alpha:0,zIndex:1}))},a.getPoleIndex=function(){for(var a=b.length-1;a>=0;a--)if(!b[a].alpha)return a;return null};var d=cjs.extend(a,cjs.Container);d.removed=function(){cjs.Tween.removeTweens(this.ball),this.wire=null,this.ball=null,this.startTile=null,this.path.length=0,this.pathPos.length=0,this.poles.length=0,this.poleTops.length=0,this.removeAllChildren(!0),this.removeAllEventListeners()},d.clear=function(){this.wire.graphics.c();for(var a=0;a<this.poles.length;a++)this.poles[a].alpha=0,this.poleTops[a].alpha=0;this.poles.length=0,this.poleTops.length=0},d.getConnections=function(){for(var a=ph.scene.device.board.tilePiece,b=[],c=0;c<a.length;c++)for(var d=0;d<a[c].length;d++){var e=a[c][d];e&&e.wireId===this.id&&"ride"!==e.type&&b.push(e)}return b},d.fadeOut=function(a){cjs.Tween.get(this,{override:!0}).to({alpha:0},a?10:400).call(this.clear,null,this),cjs.Tween.get(this.ball,{override:!0}).to({alpha:0},a?10:400),cjs.Tween.get(this.wire,{override:!0}).wait(a?10:400).set({shadow:null});var b=ph.scene.device?ph.scene.device.board:null;if(b){for(var c=b.tileWire,d=0;d<this.path.length;d++)c[this.path[d].y][this.path[d].x]===this.id&&(c[this.path[d].y][this.path[d].x]=0);var e=b.tilePiece;for(d=0;d<e.length;d++)for(var f=0;f<e[d].length;f++)e[d][f]&&e[d][f].wireId===this.id&&e[d][f].brokenWire()}this.startX=-1,this.startY=-1,this.startTile=null,this._mouseX=0,this._mouseY=0,this.path.length=0,this.pathPos.length=0},d.setPath=function(a){this.path=a,this.pathPos.length=0;var b,c,d=window.app.config.tiles,e=d.width,f=d.height;for(b=0;b<this.path.length;b++)a=this.path[b],this.pathPos.push({x:a.x*e+.5*e,y:a.y*f+.5*f});var g=ph.scene.device.board.tileWire,h=ph.scene.device.board.tilePiece;for(b=0;b<g.length;b++)for(c=0;c<g[b].length;c++)g[b][c]===this.id&&(g[b][c]=0),h[b][c]&&h[b][c].wireId===this.id&&(h[b][c].wireId=this.id);for(b=0;b<this.path.length;b++)a=this.path[b],g[a.y][a.x]||(g[a.y][a.x]=this.id),h[a.y][a.x]&&!h[a.y][a.x].wireId&&(h[a.y][a.x].wireId=this.id)},d.drawPath=function(d,e){function f(a,b){return a.y!==b.y?b.y>a.y?1:3:a.x!==b.x?b.x>a.x?0:2:void 0}if(!this.pathPos||this.pathPos.length<2)return void this.clear();this.connected=d;var g,h,i,j=window.app.config.tiles,k=j.width,l=j.height,m=this.path,n=this.pathPos,o=-1,p=0,q=[],r=ph.scene.device.board;o=f(m[0],m[1]);for(var s=0;s<this.poles.length;s++)this.poles[s].alpha=0,this.poleTops[s].alpha=0;for(this.poles.length=0,this.poleTops.length=0,s=0;s<n.length;s++){h=n[s],i=n[s+1];var t=o;if(i&&(o=f(h,i)),g=r.tilePiece[m[s].y][m[s].x],t!==o)if(g)q.push({dir:o,x:h.x,y:h.y,pole:!1,dam:"water"===g.tileType});else if(g=r.tilePiece[m[s].y][m[s].x+1],g&&"ride"===g.type&&"coaster"===g.rideType)q.push({dir:o,x:h.x,y:h.y-12,pole:!1,dam:!1});else{q.push({dir:o,x:h.x,y:h.y,pole:!0,dam:!1});var u=a.getPoleIndex();this.poles.push(this.addChild(b[u])),this.poleTops.push(this.addChild(c[u])),b[u].set({x:h.x-.5*k,y:h.y-.5*l,alpha:1}),c[u].set({x:h.x-.5*k,y:h.y-.5*l,alpha:1}),p++}else g&&q.push({dir:o,x:h.x,y:h.y,pole:!1,dam:"water"===g.tileType})}var v="#ccc";for(this.connected&&(v=this.stat>0?"#f00":this.stat<0?"#ff0":"#0f0"),this.wire.graphics.c().ss(6,1,1).s(v).mt(n[0].x+(q[0].dam?-42:0),n[0].y),this.ball.graphics.c().f(v).dc(0,0,8),this.ball.shadow.color=v,s=1;s<q.length;s++)h=q[s],i=q[s-1],0===i.dir||2===i.dir?this.wire.graphics.qt(h.x+1+.5*(i.x+1-h.x+1),h.y+12,h.x+(h.dam?-42:1),h.y-(h.pole?42:0)):this.wire.graphics.qt(h.x+1,h.y-42+.5*(i.y+42-h.y+42),h.x+(h.dam?-42:1),h.y-(h.pole?42:0));h=n.last(),i=q.last();var w,x;if(e?(Math.distance(this._mouseX,this._mouseY,this.mouseX,this.mouseY)>576&&(this._mouseX=this.mouseX,this._mouseY=this.mouseY),w=this._mouseX=Math.lerp(this._mouseX,this.mouseX,.12),x=this._mouseY=Math.lerp(this._mouseY,this.mouseY,.12)):(w=h.x,x=h.y),n.length!==q.length&&(0===i.dir||2===i.dir?this.wire.graphics.qt(h.x+1+.5*(i.x+1-h.x+1),h.y+12,w,x):this.wire.graphics.qt(h.x+1,h.y-42+.5*(i.y+42-h.y+42),w,x)),d){this.wire.shadow=new cjs.Shadow(v,0,0,12);var y=this.wire.graphics._activeInstructions,z={path:[y[0].x,y[0].y]},A=0;for(s=1;s<y.length;s++)instruction=y[s],A+=Math.distance(instruction.cpx,instruction.cpy,instruction.x,instruction.y,!0),z.path.push(instruction.cpx,instruction.cpy,instruction.x,instruction.y);this.ball.alpha=1,cjs.Tween.get(this.ball,{override:!0,loop:!0}).to({guide:z},2.5*A)}else this.ball.alpha=0,cjs.Tween.removeTweens(this.ball)},cjs.GameWire=cjs.promote(a,"Container")}(),function(){function a(a){this.Sprite_constructor(ph.loader.get("sprites-gallery"),"character/"+a),this.name="board-"+a,this.character=a,this.wasHit=!1,this.layer=-1,this.position=0,this.positionTarget=null,this.direction=0,this.speedX=0,this.cursor="pointer",this.regX=159,this.regY=250+("hacker"===this.character?0:32)}a.layer={0:{startX:-850,startY:-100,endX:850,endY:-140},1:{startX:-850,startY:20,endX:850,endY:60},2:{startX:-850,startY:200,endX:850,endY:150}};var b=cjs.extend(a,cjs.Sprite);b._tick=function(b){if(!ph.scene.isPaused&&!this.wasHit&&!cjs.Tween.hasActiveTweens(this)){var c=a.layer[this.layer];this.position+=this.speedX*this.direction*ph.timer.delta*ph.game.data.galleryN,this.x=Math.lerp(c.startX,c.endX,this.position),this.y=Math.lerp(c.startY,c.endY,this.position),this.positionTarget&&(this.position<this.positionTarget&&this.direction<0||this.position>this.positionTarget&&this.direction>0)&&cjs.Tween.get(this).wait(100*Math.rand(2,4)).to({scaleX:this.direction<0?1:-1},200,cjs.Ease.sineInOut).set({positionTarget:null,direction:this.direction<0?1:-1}),(this.position<-.2&&this.direction<0||this.position>1.2&&this.direction>0)&&ph.scene.removeBoard(this)}this.Sprite__tick(b)},b.hit=function(){if(!this.wasHit){app.sound.play("target-correct"),this.wasHit=!0,this.speedX=this.speedY=0;var a,b=cjs.Tween.get(this,{override:!0});switch(Math.rand(0,3)){case 0:for(a=0;4>a;a++)b.to({x:this.x-8},80),b.to({x:this.x+8},160);b.to({x:this.x},80).to({y:this.y+512},240,cjs.Ease.quadIn);break;case 1:for(a=0;4>a;a++)b.to({x:this.x-8},80),b.to({x:this.x+8},160);b.to({x:this.x},80),cjs.Tween.get(this).to({y:this.y+512},1200,cjs.Ease.quadIn);break;case 2:b.to({rotation:-135,x:this.x-128,y:this.y+256},800,cjs.Ease.quadIn);break;case 3:b.to({rotation:135,x:this.x+128,y:this.y+256},800,cjs.Ease.quadIn)}b.call(ph.scene.removeBoard,[this],ph.scene)}},b.spawn=function(a){switch(this.layer=a,this.layer){case 0:this.zIndex=5;break;case 1:this.zIndex=15;break;case 2:this.zIndex=25}var b=Math.rand(.08,.16);switch(Math.rand(0,2)){case 0:this.position=-.2,this.direction=1,this.speedX=b,Math.rand()<.3&&(this.positionTarget=Math.rand(.5,.7));break;case 1:this.position=1.2,this.direction=-1,this.speedX=b,Math.rand()<.3&&(this.positionTarget=Math.rand(.3,.5));break;case 2:this.position=Math.rand(.4,.6),this.direction=[-1,1].random(),this._tick(),this.y+=512,cjs.Tween.get(this).to({y:this.y-512},600,cjs.Ease.quadOut).wait(100*Math.rand(2,3)).set({speedX:1.2*b})}return this.scaleX=this.direction>0?1:-1,this},cjs.GalleryBoard=cjs.promote(a,"Sprite")}(),function(){function a(a,b){this.Sprite_constructor(a,b),this.mouseEnabled=!1,this.angle=Math.rand(0,10),this.speed=Math.rand(1.1,3.1),this.tilt=0}var b=cjs.extend(a,cjs.Sprite);b._tick=function(a){this.angle+=this.speed*ph.timer.delta,this.rotation=this.tilt+Math.cos(this.angle),this.Sprite__tick(a)},cjs.GalleryBalloon=cjs.promote(a,"Sprite")}(),function(){function a(a,b,c){this.Container_constructor(),this.mouseChildren=!1,this.cursor="pointer",a="string"==typeof a?ph.loader.get(a):a;var d=new cjs.Sprite(a,b),e=d.getBounds();if(d.regX=.5*e.width,d.regY=.5*e.height,this.addChild(d),c){var f=new cjs.Sprite(a,c).set({zIndex:1});f.regX=.5*e.width,f.regY=.5*e.height,this.addChild(f)}this.on("click",this.interaction,this),this.on("removed",this.removed,this)}var b=cjs.extend(a,cjs.Container);b.removed=function(){this.removeAllChildren(!0),this.removeAllEventListeners()},b.pulse=function(){return this.snapToPixel=!1,cjs.Tween.get(this.children.last(),{loop:!0}).to({scaleX:1.15,scaleY:1.15},600,cjs.Ease.sineOut).to({scaleX:1,scaleY:1},600,cjs.Ease.sineIn),this},b.interaction=function(a){"click"===a.type&&(app.sound.play("click"),cjs.Tween.get(a.target.children.last(),{override:!0}).to({scaleX:.8,scaleY:.8},180,cjs.Ease.sineIn).to({scaleX:1,scaleY:1},240,cjs.Ease.backOut))},cjs.Button=cjs.promote(a,"Container")}(),function(){function a(a,b,c){this.Container_constructor();var d=isNaN(c);a="string"==typeof a?ph.loader.get(a):a;var e,f=new cjs.Sprite(a,b).set({zIndex:-10,regX:72,regY:83}),g=ph.session.get("level-"+c);if(d)e=new cjs.Sprite(a,"btn/level/bonus-"+(null===g?"0":"1")).set({zIndex:10,regX:72,regY:83}),null!==g&&e.set({y:-16,scaleX:1.1,scaleY:1.1}),this.addChild(e,f),null===g&&this.addChild(new cjs.Sprite(a,"btn/level/lock")).set({regX:72,regY:83});else{e=new cjs.Sprite(a,"btn/level/"+(null===g?"lock":"stars-"+g)).set({regX:72,regY:83});var h=new cjs.Text(c,"74px russo-one",null===g?"#005153":"#fae339").set({textAlign:"center",textBaseline:"middle"}),i=new cjs.Text(c,"74px russo-one","#004441").set({outline:6,textAlign:"center",textBaseline:"middle",zIndex:-1}),j=(new cjs.Container).set({y:10,zIndex:10});j.addChild(h,i),this.addChild(j,e,f)}this.name="btn-level-"+c,this.mouseChildren=!1,this.levelAvailable=null!==g,this.cursor="pointer",this.on("click",this.interaction,this),this.on("removed",this.removed,this)}var b=cjs.extend(a,cjs.Container);b.removed=function(){this.removeAllChildren(!0),this.removeAllEventListeners()},b.sparkle=function(){this.zIndex=1;var a=new cjs.Sprite(ph.loader.get("sprites-menu"),"spark/spark").set({name:"sparks",x:-8,y:-8,zIndex:-100,regX:75,regY:75,scaleX:0,scaleY:0,mouseEnabled:!1,framerate:24});this.addChild(a),cjs.Tween.get(a).to({scaleX:3.6,scaleY:3.6},800,cjs.Ease.backOut).wait(1800).to({scaleX:0,scaleY:0},800,cjs.Ease.backIn)},b.interaction=function(a){"click"===a.type&&(this.levelAvailable?app.sound.play("click"):app.sound.play("energy-move-wrong"),cjs.Tween.get(a.target.children.last(),{override:!0}).to({scaleX:.8,scaleY:.8},180,cjs.Ease.sineIn).to({scaleX:1,scaleY:1},240,cjs.Ease.backOut))},cjs.ButtonLevel=cjs.promote(a,"Container")}(),function(){function a(){this.Container_constructor(),this.name="curtain",this.screenX=this.screenY=.5,this.mouseEnabled=!1,this.zIndex=1/0,this.visible=!1,this.isLoading=!1,this.isComplete=!1,this.sceneObj=null;var a=ph.loader.get("sprites-curtain"),b=new cjs.Sprite(a,"bottom").set({name:"bottom",y:768,regX:713,regY:384,zIndex:-10}),c=new cjs.Sprite(a,"top").set({regX:713,regY:384,zIndex:-9}),d=new cjs.Text("Loading","64px russo-one","#fff").set({y:-110,textAlign:"center",textBaseline:"middle"});d.shadow=new cjs.Shadow("rgba(0, 0, 0, 0.5)",0,4,0);var e=new cjs.Sprite(a,"bar").set({y:20,regX:175.5,regY:35.5}),f=new cjs.Sprite(a,"cover").set({y:20,regX:218,regY:67,zIndex:10}),g=(new cjs.Container).set({name:"top",y:-768});g.addChild(c,d,e,f),e.mask=new cjs.Shape((new cjs.Graphics).f("#fff").dr(0,0,400,90)).set({x:-215,y:-28}),this.bar=e,this.lastStatus=0,this.addChild(g,b)}var b=cjs.extend(a,cjs.Container);b._tick=function(a){this.visible&&(this.lastStatus=Math.lerp(this.lastStatus,ph.loader.status,.12),this.isLoading&&!this.isComplete&&this.lastStatus>=.98&&(this.lastStatus=1,this.loadingComplete()),this.bar.x=Math.lerp(-350,-3,Math.limit(this.lastStatus,0,1)),this.Container__tick(a))},b.show=function(a,b){window.app.voPlayer.stop(),this.visible=!0,this.isComplete=!1,this.sceneObj=a,this.lastStatus=0,this.bar.x=-350,ph.loader.status=0;var c=this.getChildByName("top"),d=this.getChildByName("bottom");ph.scene?(app.sound.play("loading-close"),ph.scene.mouseEnabled=!1,ph.scene.end(),cjs.Tween.get(c).to({y:0},600,cjs.Ease.quadOut).wait(200).call(this.loadingStart,[b],this),cjs.Tween.get(d).to({y:0},600,cjs.Ease.quadOut).wait(200)):(c.y=d.y=0,this.loadingStart(b))},b.loadingStart=function(a){this.isLoading=!0,ph.loader.load(a)},b.loadingComplete=function(){this.isLoading=!1,this.isComplete=!0;var a=this.sceneObj;new a;var b=this.getChildByName("top"),c=this.getChildByName("bottom");cjs.Tween.get(b).wait(200).to({y:-768},600,cjs.Ease.quadIn),cjs.Tween.get(c).wait(200).to({y:768},600,cjs.Ease.quadIn).call(this.set,[{visible:!1}],this).call(ph.scene.start,null,ph.scene),app.sound.play("loading-open")},cjs.Curtain=cjs.promote(a,"Container")}(),function(){function a(){this.Scene_constructor(),ph.music.play("music-menu");var a=new cjs.Bitmap(ph.loader.get("bg-game")).set({regX:713,regY:384,mouseEnabled:!1,zIndex:-(1/0)}),b=ph.loader.get("sprites-cutscene");this.completed=ph.game.data.completed,ph.game.data.completed=!1,this.completed?(this.p1=new cjs.Sprite(b,"panel/4").set({
y:-1024,regX:471,regY:329.5}),this.t1=(new cjs.Container).set({name:"textbox-1",y:308,alpha:0,mouseEnabled:!1}),this.t1.addChild(new cjs.Sprite(b,"textbox/4").set({regX:284,regY:50,zIndex:-1})),this.t1.addChild(new cjs.Text("You did it! You powered up all the rides. R-Fair City is back in business!","24px russo-one","#000").set({y:-12,textAlign:"center",textBaseline:"middle",lineWidth:520,lineHeight:32})),this.addChild(a,this.p1,this.t1)):(this.p1=new cjs.Sprite(b,ph.game.data.isOctober?"panel/1-costume":"panel/1").set({name:"p1",x:-736,y:28,regX:255.5,regY:340,zIndex:-1,alpha:0,mouseEnabled:!1}),this.p2=new cjs.Sprite(b,"panel/2").set({name:"p2",x:746,y:-138,regX:238.5,regY:175,zIndex:-1,alpha:0,mouseEnabled:!1}),this.p3=new cjs.Sprite(b,"panel/3").set({name:"p3",x:200,y:712,regX:269,regY:166.5,zIndex:-1,alpha:0,mouseEnabled:!1}),this.t1=(new cjs.Container).set({name:"textbox-1",x:-230,y:-270,alpha:0,mouseEnabled:!1}),this.t1.addChild(new cjs.Sprite(b,"textbox/1").set({regX:257,regY:90.5,zIndex:-1})),this.t1.addChild(new cjs.Text("Hacker Alert!","24px russo-one","#000").set({x:-129,y:-48,textAlign:"center",textBaseline:"middle",maxWidth:240})),this.t1.addChild(new cjs.Text("Chaos in R-Fair City!","24px russo-one","#000").set({x:66,y:49,textAlign:"center",textBaseline:"middle",maxWidth:330})),this.t2=(new cjs.Container).set({name:"textbox-2",x:294,y:10,alpha:0,mouseEnabled:!1}),this.t2.addChild(new cjs.Sprite(b,"textbox/2").set({regX:201.5,regY:42,zIndex:-1})),this.t2.addChild(new cjs.Text("Power drained from all rides.","24px russo-one","#000").set({textAlign:"center",textBaseline:"middle",maxWidth:360})),this.t3=(new cjs.Container).set({name:"textbox-3",x:96,y:320,alpha:0,mouseEnabled:!1}),this.t3.addChild(new cjs.Sprite(b,"textbox/3").set({regX:284,regY:50,zIndex:-1})),this.t3.addChild(new cjs.Text("Must use renewable sources to power up rides and keep R-Fair City running!","24px russo-one","#000").set({y:-12,textAlign:"center",textBaseline:"middle",lineWidth:520,lineHeight:32})),this.addChild(a,this.p1,this.p2,this.p3,this.t1,this.t2,this.t3)),this.btnNext=new cjs.Button(b,"btn/next/bg","btn/next/icon").set({name:"btn-next",y:-896}),this.addChild(this.btnNext),this.on("click",this.interaction,this)}var b=cjs.extend(a,ph.Scene);b.start=function(){cjs.Tween.get(this.btnNext).wait(600).to({y:-313.5},800,cjs.Ease.circOut),this.completed?(cjs.Tween.get(this.p1).wait(800).call(app.voPlayer.play,["040_MotherBoard_CYB-WOT_02a_SELECT",this.pulseBtn],app.voPlayer).to({y:0,alpha:1},600,cjs.Ease.circOut),cjs.Tween.get(this.t1).wait(800).to({alpha:1},400)):(cjs.Tween.get(this.p1).wait(800).call(app.voPlayer.play,["002_MotherBoard_CYB-WOT_03_SELECT",this.pulseBtn],app.voPlayer).to({x:-224,alpha:1},600,cjs.Ease.circOut),cjs.Tween.get(this.t1).wait(800).to({alpha:1},400),cjs.Tween.get(this.p2).wait(4e3).to({x:234,alpha:1},600,cjs.Ease.circOut),cjs.Tween.get(this.t2).wait(4e3).to({alpha:1},400),cjs.Tween.get(this.p3).wait(6200).to({y:200,alpha:1},600,cjs.Ease.circOut),cjs.Tween.get(this.t3).wait(6200).to({alpha:1},400))},b._tick=function(a){this.btnNext&&(this.btnNext.x=.5*ph.system.width-256),this.Scene__tick(a)},b.pulseBtn=function(){ph.scene.btnNext.pulse()},b.interaction=function(a){if("click"===a.type&&"btn-next"===a.target.name){this.mouseEnabled=!1;var b=ph.Scene.Game;0===ph.session.get("level-1")?(ph.game.data.instructions=!0,ph.game.data.tutorialN=0):b=ph.Scene.Menu,cjs.Tween.get(this).wait(400).call(ph.game.switchScene,[b],ph.game)}},ph.Scene.Cutscene=cjs.promote(a,"Scene")}(),function(){function a(){this.Scene_constructor(),ph.music.play("music-gallery"),this.name="gallery",this.waterSplashes=[],this.waterJets=[],this.shooter=null,this.isShooting=!1,this.boards=[],this.spawnTimer=new ph.Timer(Math.rand(.5,1.5)).pause(),this.timer=new ph.Timer(30).pause(),this.isPaused=!0,this.points=0,this.sfxTimer=null;var a=ph.loader.get("sprites-gallery");this.pointTexts=[];for(var b=0;6>b;b++){var c=new cjs.Text("+1","80px russo-one","#fae339").set({textAlign:"center",textBaseline:"middle",zIndex:1}),d=new cjs.Text("+1","80px russo-one","#000").set({textAlign:"center",textBaseline:"middle",outline:6}),e=(new cjs.Container).set({alpha:0,mouseEnabled:!1,zIndex:500});e.addChild(c,d);var f=e.getBounds();e.cache(f.x,f.y,f.width,f.height),this.pointTexts.push(this.addChild(e))}var g=new cjs.Sprite(a,"layer/0").set({name:"bg-0",regX:713,regY:384,zIndex:0}),h=g.clone().set({name:"bg-1",zIndex:10}).gotoAndStop("layer/1"),i=h.clone().set({name:"bg-2",zIndex:20}).gotoAndStop("layer/2"),j=i.clone().set({name:"bg-3",zIndex:30}).gotoAndStop("layer/3"),k=j.clone().set({zIndex:100,mouseEnabled:!1}).gotoAndStop("frame/left"),l=k.clone().set({zIndex:100,mouseEnabled:!1}).gotoAndStop("frame/bottom"),m=l.clone().set({zIndex:100,mouseEnabled:!1}).gotoAndStop("frame/right"),n=m.clone().set({zIndex:101,mouseEnabled:!1}).gotoAndStop("awning");this.shooter=new cjs.Sprite(a,"shooter").set({name:"shooter",y:384,regX:230.5,regY:135.5,zIndex:101,mouseEnabled:!1,rotation:-90});var o=new cjs.GalleryBalloon(a,"balloon/green").set({name:"balloon-green",x:600,y:480,regX:59,regY:703,zIndex:101}),p=new cjs.GalleryBalloon(a,"balloon/orange").set({name:"balloon-orange",x:600,y:480,regX:62.5,regY:426,zIndex:102,tilt:10}),q=new cjs.GalleryBalloon(a,"balloon/yellow").set({name:"balloon-yellow",x:600,y:540,regX:54.5,regY:478,zIndex:103,tilt:-10}),r=new cjs.GalleryBalloon(a,"balloon/purple").set({name:"balloon-purple",x:-600,y:480,regX:59,regY:719,zIndex:99}),s=new cjs.GalleryBalloon(a,"balloon/orange").set({name:"balloon-orange",x:-600,y:480,regX:62.5,regY:426,zIndex:98,tilt:-10}),t=new cjs.GalleryBalloon(a,"balloon/yellow").set({name:"balloon-yellow",x:-600,y:540,regX:54.5,regY:478,zIndex:97,tilt:10});for(this.addChild(g,h,i,j,k,l,m,n,this.shooter,o,p,q,r,s,t),b=0;8>b;b++){var u=new cjs.Sprite(a,"water/splash").set({name:"water-splash-"+b,regX:112.5,regY:91.5,scaleX:2,scaleY:2,framerate:24,alpha:0,zIndex:49,mouseEnabled:!1});this.waterSplashes.push(this.addChild(u));var v=new cjs.Sprite(a,"water/jet").set({name:"water-jet-"+b,regX:8,regY:22,framerate:18,alpha:0,zIndex:50,mouseEnabled:!1});this.waterJets.push(this.addChild(v))}this.btnHome=new cjs.Button(a,"btn/home/bg","btn/home/icon").set({name:"btn-home",y:-256});var w=new cjs.Sprite(a,"timer").set({name:"bg",regX:71,zIndex:-100}),x=(new cjs.Shape).set({name:"timer",x:5,y:74,rotation:-90});this.conTimer=(new cjs.Container).set({name:"con-timer"}),this.conTimer.addChild(w,x);var y=(new cjs.Container).set({name:"con-ui",y:-896,zIndex:1e3});y.addChild(this.btnHome,this.conTimer),this.addChild(y),this.updateTimer(!0),a._data["water/jet"].next=!1,a._data["water/splash"].next=!1,this.on("click",this.interaction,this),this.on("mousedown",this.interaction,this)}var b=cjs.extend(a,ph.Scene);b._tick=function(a){this.btnHome&&(this.btnHome.x=.5*-ph.system.width+80),this.conTimer&&(this.conTimer.x=.5*-ph.system.width+256),this.updateTimer(),this.updatePointTexts(),this.isPaused||(this.isPaused||this.isShooting||!this.shooter||(this.shooter.rotation=Math.lerp(this.shooter.rotation,this.getShootAngle(),.12)),this.spawnBoards()),this.Scene__tick(a)},b.start=function(){cjs.Tween.get(this.getChildByName("con-ui")).wait(200).to({y:-384},800,cjs.Ease.circOut),cjs.Tween.get(this.btnHome).wait(1e3).to({y:71.5},800,cjs.Ease.circOut),cjs.Tween.get(this.conTimer).wait(800).to({y:0},800,cjs.Ease.circOut);var a=new cjs.Sprite(ph.loader.get("sprites-gallery"),"motherboard").set({name:"mb",y:-1024,regX:85.5,regY:87,zIndex:1e3});cjs.Tween.get(this.addChild(a)).wait(400).to({y:-280},600,cjs.Ease.circOut).wait(200).call(app.voPlayer.play,["041_MotherBoard_CYB-WOT_04b_SELECT",this.start2.bind(this)],app.voPlayer)},b.start2=function(){var a=this.getChildByName("mb");cjs.Tween.get(a).to({y:-1024},600,cjs.Ease.circIn).call(this.removeChild,[a],this),this.pauseTimers(!1)},b.end=function(){this.waterSplashes.length=0,this.waterJets.length=0,this.shooter=null,this.btnHome=null,this.removeAllEventListeners()},b.updateTimer=function(a){if(a||!this.isPaused){var b=this.timer.delta(),c=Math.abs(b),d=Math.limit(1-c/this.timer.target,1e-4,1);this.conTimer.getChildByName("timer").graphics.c().f("#9d80f5").mt(0,0).a(0,0,48,0,Math.toRad(360*d),1),b>0&&this.complete(),b>-5&&!this.sfxTimer&&(this.sfxTimer=app.sound.play("timer"))}},b.complete=function(){this.isPaused=!0,app.voPlayer.play("042_MotherBoard_CYB-WOT_01b_SELECT");var a=ph.loader.get("sprites-gallery"),b=new cjs.Shape((new cjs.Graphics).f("#000").dr(0,0,1426,768)).set({name:"bg",regX:713,regY:384,alpha:0,zIndex:-(1/0)}),c=new cjs.Sprite(a,"panel").set({name:"panel",regX:269.5,regY:193.5,zIndex:-1e3}),d=new cjs.Text(this.points?"You did it!":"Try better next time!","48px russo-one","#fff").set({y:-132,maxWidth:400,textAlign:"center",textBaseline:"middle",mouseEnabled:!1});d.shadow=new cjs.Shadow("rgba(0, 0, 0, 0.5)",0,4,0);var e=new cjs.Text("0","150px russo-one","#fae339").set({name:"score-text",y:42,textAlign:"center",textBaseline:"center",zIndex:1}),f=e.clone().set({name:"score-outline",color:"#004441",outline:8}),g=new cjs.Button(a,"btn/next/bg","btn/next/icon").set({name:"btn-next",y:154}).pulse(),h=(new cjs.Container).set({name:"box",y:-1024});h.addChild(c,g,d,e,f);var i=(new cjs.Container).set({name:"con-complete",zIndex:10001});i.addChild(b,h),this.addChild(i),cjs.Tween.get(b).wait(200).to({alpha:.5},400),cjs.Tween.get(h).wait(800).to({y:0},600,cjs.Ease.quadOut),cjs.Tween.get(this.getChildByName("con-ui")).to({y:-1024},600,cjs.Ease.circIn);var j={points:0};if(cjs.Tween.get(j,{onChange:this.completeUpdate}).wait(2400).to({points:this.points},800,cjs.Ease.quadOut),this.points){var k=new cjs.Sprite(a,"spark/spark").set({regX:75,regY:75,scaleX:0,scaleY:0,framerate:24,alpha:0,zIndex:-10});h.addChild(k),cjs.Tween.get(k).wait(3200).to({scaleX:2.4,scaleY:2.4,alpha:2},600,cjs.Ease.backOut)}},b.completeUpdate=function(a){var b=ph.scene.getChildByName("con-complete").getChildByName("box");b.getChildByName("score-text").text=~~a.target.target.points,b.getChildByName("score-outline").text=~~a.target.target.points},b.pauseTimers=function(a){this.isPaused=a,a?(this.timer.pause(),this.spawnTimer.pause()):(this.timer.resume(),this.spawnTimer.resume());for(var b=0;b<cjs.Tween._tweens.length;b++)for(var c=0;c<this.boards.length;c++)this.boards[c]===cjs.Tween._tweens[b]._target&&(cjs.Tween._tweens[b]._paused=a)},b.spawnBoards=function(){if(!(this.spawnTimer.delta()<0)){for(var a=[0,1,2],b=0;b<this.boards.length;b++)a.erase(this.boards[b].layer);if(a.length){var c,d=ph.game.data.galleryN;for(ph.game.data.isOctober?(c=["cat","ghost"],d>=1.3&&c.push("pumpkin","skeleton"),d>=1.6&&c.push("spider")):(c=["duck","target"],d>=1.3&&c.push("bottle","balloon"),d>=1.6&&c.push("pin")),b=0;b<this.boards.length;b++)c.erase(this.boards[b].character);if(c.length){var e=new cjs.GalleryBoard(c.random()).spawn(a.random());this.boards.push(e),this.addChild(e),this.spawnTimer.reset(),this.spawnTimer.target=Math.rand(.2,.8)}}}},b.removeBoard=function(a){this.boards.erase(a),this.removeChild(a)},b.shootBlaster=function(a){this.isShooting=!0,app.sound.play("shoot");for(var b,c=this.getShootAngle(),d=Math.toRad(c),e=240,f=0;f<this.waterJets.length;f++)!b&&(this.waterJets[f].alpha<=0||this.waterJets[f].paused)&&(b=this.waterJets[f]);var g=Math.cos(d)*e,h=Math.sin(d)*e,i=ph.system.stage,j=Math.distance(713+g,768+h,i.mouseX,i.mouseY,!0),k=Math.limit(j/200,.5,10);cjs.Tween.get(this.shooter).to({scaleX:.9,rotation:c},100).call(b.set,[{x:g,y:384+h,rotation:c,scaleX:k,alpha:1}],b).call(b.gotoAndPlay,["water/jet"],b).to({scaleX:1},200,cjs.Ease.backOut).call(this.checkBlast,[i.mouseX-713,i.mouseY-384],this).call(this.set,[{isShooting:!1}],this)},b.checkBlast=function(a,b){for(var c=[],d=0;d<this.boards.length;d++){var e=this.boards[d];if(!e.wasHit)for(var f=e.parent.localToLocal(a,b,e),g=0;360>g;g+=45){var h=12,i=f.x+Math.cos(Math.toRad(g))*h,j=f.y+Math.sin(Math.toRad(g))*h;if(e.hitTest(i,j)){c.push(e);break}}}if(c.sort(function(a,b){return b.layer-a.layer}),c.length)for(c[0].hit(),this.hitTarget(a,b),d=0;d<this.waterSplashes.length;d++){var k=this.waterSplashes[d];if(k.alpha<=0||k.paused){k.x=a,k.y=b,k.alpha=1,k.rotation=Math.rand(-45,45),k.gotoAndPlay("water/splash");break}}},b.updatePointTexts=function(){for(var a=this.pointTexts.length-1;a>=0;a--){var b=this.pointTexts[a];b.alpha&&(b.y-=20*ph.timer.delta)}},b.hitTarget=function(a,b){this.points++;for(var c=this.pointTexts.length-1;c>=0;c--){var d=this.pointTexts[c];if(!d.alpha){d.x=a,d.y=b,d.scaleX=d.scaleY=0,cjs.Tween.get(d).to({alpha:1,scaleX:1,scaleY:1},200,cjs.Ease.backOut).wait(600).to({alpha:0,scaleX:1.4,scaleY:1.4},600);break}}},b.getShootAngle=function(){var a=ph.system.stage,b=Math.angle(713,768,a.mouseX,a.mouseY,!0);return Math.limit(b,-150,-30)},b.interaction=function(a){var b=a.target.name||"";"mousedown"===a.type?this.isShooting||this.isPaused||a.stageX<160&&a.stageY<160||this.shootBlaster(a):"click"===a.type&&("btn-pause"===b?(this.isPaused=!this.isPaused,this.isPaused&&this.pauseTimers(!0),this.isPaused||this.pauseTimers(!1),this.isPaused&&this.sfxTimer?this.sfxTimer.pause():!this.isPaused&&this.sfxTimer&&this.sfxTimer.resume()):("btn-home"===b||"btn-next"===b)&&(this.mouseEnabled=!1,this.isPaused=!0,cjs.Tween.get(this).wait(400).call(ph.game.switchScene,[ph.Scene.Menu],ph.game)))},ph.Scene.Gallery=cjs.promote(a,"Scene")}(),function(){function a(){this.Scene_constructor(),this.mouseEnabled=!1,this.isPaused=!1,this.tileData=window.app.config.tiles,this.timer=(new ph.Timer).pause(),this.gameTutorial=ph.game.data.instructions&&0===ph.game.data.tutorialN,this.hackerTimer=new ph.Timer(999).pause(),this.sfxTimer=null,this.goodVOIndex=0,this.goodVO=["025_MotherBoard_CYB-WOT_01b_SELECT","026_MotherBoard_CYB-WOT_02a_SELECT","027_MotherBoard_CYB-WOT_01d_SELECT","Good-Excellent","Good-Good-Work","Good-Nice-Job","Good-Powered-Up","Good-Powerful-Work","Good-You-Did-It"].shuffle(),this.levelDataObjects=null,this.levelDataTiles=null,this.setupLevelData(this.gameTutorial?ph.game.data.tutorialN:ph.game.data.levelN);var a=ph.loader.get("sprites-game-ui"),b=new cjs.Bitmap(ph.loader.get("bg-game")).set({regX:713,regY:384,zIndex:-(1/0),mouseEnabled:!1}),c=new cjs.Sprite(a,"ui-meter/bg").set({name:"bg",regX:234,zIndex:-100}),d=new cjs.Sprite(a,"ui-meter/meter").set({name:"meter",x:13,y:114,regX:210,regY:15});d.mask=new cjs.Shape((new cjs.Graphics).f("#fff").dr(0,0,420,30)).set({x:-197,y:99,scaleX:1});var e=new cjs.Sprite(a,"ui-meter/fg").set({name:"fg",regX:234,zIndex:100}),f=new cjs.Sprite(a,"ui-meter/star-1").set({name:"star-1",regX:234,zIndex:101}),g=new cjs.Sprite(a,"ui-meter/star-2").set({name:"star-2",regX:234,zIndex:101}),h=new cjs.Sprite(a,"ui-meter/star-3").set({name:"star-3",regX:234,zIndex:101}),i=(new cjs.Container).set({name:"con-meter",y:-256,mouseEnabled:!1});i.addChild(c,d,e,f,g,h),this.conMeter=i,this.btnPause=new cjs.Button(a,"btn/pause/bg","btn/pause/icon").set({name:"btn-pause",y:-256,visible:!this.gameTutorial});var j=new cjs.Sprite(a,"top").set({name:"top",regX:713,zIndex:-(1/0),mouseEnabled:!1}),k=(new cjs.Container).set({name:"con-ui",y:-896,zIndex:100});k.addChild(j,i,this.btnPause),this.hacker=new cjs.Sprite(a,"hacker"+(ph.game.data.isOctober?"-costume":"")).set({name:"hacker",y:1024,regX:369,regY:448,zIndex:150,mouseEnabled:!1}),this.device=(new cjs.GameDevice).set({x:-468,y:538}),this.addChild(b,k,this.device,this.hacker),this.gameTutorial?ph.music.stop(600):ph.music.play("music-game"),this.on("click",this.interaction,this),this.on("removed",this.removed,this)}var b=cjs.extend(a,ph.Scene);b._tick=function(a){this.btnPause.x=.5*-ph.system.width+80,this.hacker.x=.5*ph.system.width,this.updateTimer(),this.hackerTimer.delta()>0&&this.hackerShow(),this.Scene__tick(a)},b.removed=function(){this.removeChild(this.device),this.device=null,this.btnPause=null,this.conMeter=null,this.hacker=null,this.removeAllChildren(!0),this.timer=null,this.tileData=null,this.levelDataObjects=null,this.levelDataTiles=null,this.removeAllEventListeners()},b.start=function(){this.device.board.buildLevel(),this.gameTutorial&&(this.gameTutorial=new ph.GameTutorial,ph.game.trackEvent("WOT","Level Tutorial","Tutorial"));var a=this.getChildByName("con-ui");cjs.Tween.get(a).wait(200).to({y:-384},800,cjs.Ease.circOut),cjs.Tween.get(this.conMeter).wait(800).to({y:0},600,cjs.Ease.circOut),cjs.Tween.get(this.btnPause).wait(1e3).to({y:71.5},800,cjs.Ease.circOut),cjs.Tween.get(this.device).to({y:-230},1800,cjs.Ease.quartOut).call(this.device.popup.showLevel,null,this.device.popup)},b.start2=function(){this.isPaused=!1,this.mouseEnabled=!0,this.btnPause.mouseEnabled=!0,this.device.mouseEnabled=!0,this.reset(),this.timer.resume(),this.hackerTimer.resume()},b.reset=function(){this.device.reset(),this.timer.reset().pause(),this.hackerRateSet(),this.sfxTimer=null;for(var a=1;3>=a;a++)cjs.Tween.get(this.conMeter.getChildByName("star-"+a).set({y:0})).to({alpha:1},400)},b.complete=function(){if(!this.isPaused){this.isPaused=!0,this.sfxTimer&&this.sfxTimer.pause(),this.device.complete(),cjs.Tween.get(this.hacker,{override:!0}).to({y:1024},600,cjs.Ease.circIn),this.timer.pause(),this.hackerTimer.pause(),this.btnPause.mouseEnabled=!1;var a=0;if(this.timer.delta()<0&&(1===this.conMeter.getChildByName("star-3").alpha?a=3:1===this.conMeter.getChildByName("star-2").alpha?a=2:1===this.conMeter.getChildByName("star-1").alpha&&(a=1)),a){var b=ph.game.data.levelN,c=ph.session.get("level-"+b);(null===c||a>c)&&ph.session.set("level-"+b,a);var d=ph.session.get("level-"+(b+1));(null===d||0===d)&&(ph.game.data.nextLevel=b+1),ph.session.set("level-"+(b+1),d||0),5===b?ph.session.set("level-bonus-1",1):10===b?ph.session.set("level-bonus-2",1):15===b&&(ph.game.data.completed=!0,ph.session.set("level-bonus-3",1))}cjs.Tween.get(this).wait(1400).call(this.device.popup.showResults,[a],this.device.popup)}},b.setupLevelData=function(a){var b;this.gameTutorial?b=window.app.config.tutorials.layers[a||ph.game.data.tutorialN]:(b=window.app.config.levels.layers[a||ph.game.data.levelN],this.hackerRateSet());for(var c=0;c<b.layers.length;c++){var d=b.layers[c];"objectgroup"===d.type?this.levelDataObjects=d.objects:"tilelayer"===d.type&&(this.levelDataTiles=d.data)}this.timer.set(parseInt(b.properties.time||1)).pause()},b.nextLevel=function(){this.gameTutorial=null,ph.game.data.instructions=!1,ph.game.data.levelN++,ph.game.data.levelN>window.app.config.levels.layers.length-1?ph.game.switchScene(ph.Scene.Gallery):(this.setupLevelData(),this.device.board.buildLevel().call(this.device.reset,null,this.device).call(this.device.popup.showLevel,null,this.device.popup))},b.updateTimer=function(){if(!this.isPaused){var a=this.timer.delta(),b=Math.abs(a),c=b/this.timer.target;this.conMeter.getChildByName("meter").mask.scaleX=0>a?Math.limit(c,0,1):0,a>=0&&this.conMeter.getChildByName("star-1").alpha>=1?(cjs.Tween.get(this.conMeter.getChildByName("star-1")).to({y:128,alpha:0},400,cjs.Ease.quadIn),app.sound.play("star-fall"),this.complete()):.334>c&&this.conMeter.getChildByName("star-2").alpha>=1?(cjs.Tween.get(this.conMeter.getChildByName("star-2")).to({y:128,alpha:0},400,cjs.Ease.quadIn),app.sound.play("star-fall"),app.voPlayer.play("017_MotherBoard_CYB-WOT_01a_SELECT")):.667>c&&this.conMeter.getChildByName("star-3").alpha>=1&&(cjs.Tween.get(this.conMeter.getChildByName("star-3")).to({y:128,alpha:0},400,cjs.Ease.quadIn),app.sound.play("star-fall")),a>-5&&!this.sfxTimer&&(this.sfxTimer=app.sound.play("timer"))}},b.hackerShow=function(a){var b=!1;if(!this.gameTutorial){if(cjs.Tween.hasActiveTweens(this.hacker))return;b=!0}var c=cjs.Tween.get(this.hacker).to({y:384},600,cjs.Ease.circOut).wait(600);(b||a)&&(app.sound.play("evil-laugh"),this.hackerTimer.set(999).reset().pause(),a||c.call(app.voPlayer.play,["033_MotherBoard_CYB-WOT_03b_SELECT"],app.voPlayer),c.call(this.device.board.shuffleRideWatts,null,this.device.board).wait(600).to({y:1024},600,cjs.Ease.circIn))},b.hackerRateSet=function(){var a=ph.game.data.levelN;a>3&&8>=a?this.hackerTimer.set(Math.rand(0,1)?9999:Math.rand(5,7)):a>=9&&(this.hackerTimer.set(Math.rand(0,1)?9999:Math.rand(7,12)),9===a&&this.hackerTimer.set(9999)),this.hackerTimer.reset().pause()},b.checkComplete=function(a,b){if(a){var c,d,e,f=this.device.board.tilePiece,g=null;for(c=0;c<f.length;c++)for(d=0;d<f[0].length;d++)if(e=f[c][d],e&&"ride"===e.type&&e.wireId===a){g=e;break}if(g){var h=this.device.board.getWire(g.wireId),i=h.getConnections(),j=0,k=!0,l=0;for(c=0;c<i.length;c++)j+=i[c].props.watts;j<g.props.watts?(k=!1,l=-1,this.gameTutorial||b||app.voPlayer.play(["018_MotherBoard_CYB-WOT_01b_SELECT","019_MotherBoard_CYB-WOT_01a_SELECT","020_MotherBoard_CYB-WOT_02_SELECT"].random())):j>g.props.watts&&(k=!1,l=1,this.gameTutorial||b||app.voPlayer.play(["021_MotherBoard_CYB-WOT_01b_SELECT","022_MotherBoard_CYB-WOT_01_SELECT","023_MotherBoard_CYB-WOT_01c_SELECT"].random())),k?(this.gameTutorial||b||app.voPlayer.play(this.goodVO[++this.goodVOIndex%this.goodVO.length]),g.hasPower(!0)):g.hasPower(!1),h.stat=l,h.drawPath(h.connected)}this.checkComplete2()}},b.checkComplete2=function(){var a,b,c,d,e=!0,f=this.device.board.tilePiece,g=[];for(a=0;a<f.length;a++)for(b=0;b<f[0].length;b++)c=f[a][b],c&&"ride"===c.type&&g.indexOf(c)<0&&g.push(c);for(a=0;a<g.length;a++)if(d=g[a],d.wireId){var h=this.device.board.getWire(d.wireId),i=h.getConnections(),j=0;for(b=0;b<i.length;b++)j+=i[b].props.watts;j!==d.props.watts&&(e=!1)}else e=!1;e&&(this.gameTutorial?this.gameTutorial.stepComplete():this.complete())},b.interaction=function(a){var b=a.target.name||"";if("click"===a.type&&"btn-pause"===b){this.isPaused=!this.isPaused,this.isPaused&&(this.timer.pause(),this.hackerTimer.pause());var c=cjs.Tween.get(this.device.pause,{override:!0}).to({alpha:this.isPaused?1:0},400).set({mouseEnabled:this.isPaused});this.isPaused||c.call(this.timer.resume,null,this.timer).call(this.hackerTimer.resume,null,this.hackerTimer),this.isPaused&&this.sfxTimer?this.sfxTimer.pause():!this.isPaused&&this.sfxTimer&&this.sfxTimer.resume()}},ph.Scene.Game=cjs.promote(a,"Scene")}(),function(){function a(){this.Scene_constructor(),ph.music.play("music-menu");var a=new cjs.Bitmap(ph.loader.get("bg-title")).set({name:"bg",regX:713,regY:384,mouseEnabled:!1,zIndex:-100}),b=ph.loader.get("sprites-title"),c=new cjs.Button(b,"btn/play/bg","btn/play/icon").set({name:"btn-play",y:768,zIndex:1e3}),d=new cjs.Sprite(b,"gradient").set({name:"gradient",y:-50,regX:551,regY:384,scaleX:.1,scaleY:.1,mouseEnabled:!1}),e=new cjs.Sprite(b,"title").set({name:"title",y:-50,scaleX:0,scaleY:0,alpha:0,regX:301.5,regY:173,zIndex:10,mouseEnabled:!1}),f=new cjs.Sprite(b,"hacker"+(ph.game.data.isOctober?"-costume":"")).set({name:"hacker",x:-413,y:832,regX:184.5,regY:448,mouseEnabled:!1,zIndex:10}),g=new cjs.Sprite(b,"cyberchase").set({name:"cyberchase",y:-300,regX:180,regY:50,mouseEnabled:!1,zIndex:100}),h=ph.loader.get("anim-title");h=(new h.anim).set({name:"sparks",regX:713,regY:384,scaleX:0,scaleY:0,mouseEnabled:!1,framerate:24}),this.addChild(a,c,d,e,f,g,h),this.on("click",this.interaction,this)}var b=cjs.extend(a,ph.Scene);b._tick=function(a){this.Scene__tick(a)},b.start=function(){var a=this.getChildByName("sparks");cjs.Tween.get(a).wait(600).call(app.sound.play,["title-spark"],app.sound).to({scaleX:1,scaleY:1},600,cjs.Ease.sineOut);var b=this.getChildByName("title");cjs.Tween.get(b).wait(600).to({alpha:1},400),cjs.Tween.get(b).wait(600).to({scaleX:1},400,cjs.Ease.backOut),cjs.Tween.get(b).wait(700).to({scaleY:1},400,cjs.Ease.backOut).call(app.voPlayer.play,["001_MotherBoard_CYB-WOT_03dSELECT"],app.voPlayer),cjs.Tween.get(this.getChildByName("gradient")).wait(800).to({scaleX:1,scaleY:1},200);var c=this.getChildByName("btn-play");cjs.Tween.get(c).wait(1200).to({y:250},600,cjs.Ease.quadOut).wait(1200).call(c.pulse,null,c);cjs.Tween.get(this.getChildByName("hacker")).wait(600).to({y:384},200,cjs.Ease.quadOut)},b.end=function(){},b.interaction=function(a){var b=a.target.name||"";"click"===a.type&&"btn-play"===b&&(this.mouseEnabled=!1,cjs.Tween.get(this).wait(400).call(ph.game.switchScene,[ph.Scene.Cutscene],ph.game))},ph.Scene.Title=cjs.promote(a,"Scene")}(),function(){function a(){this.Scene_constructor(),ph.music.play("music-menu");var a=ph.loader.get("sprites-menu"),b=new cjs.Bitmap(ph.loader.get("bg-game")).set({regX:713,regY:384,mouseEnabled:!1,zIndex:-(1/0)}),c=new cjs.Sprite(a,"top").set({name:"top",y:-896,regX:713,zIndex:-100,mouseEnabled:!1}),d=new cjs.Sprite(a,"header").set({name:"header",regX:184.5,zIndex:-1}),e=new cjs.Text("Choose a Level","44px russo-one","#fff").set({x:5,y:74,textAlign:"center",textBaseline:"middle",maxWidth:310});e.shadow=new cjs.Shadow("rgba(0, 0, 0, 0.5)",0,4,0);var f=(new cjs.Container).set({name:"con-header",y:-896,mouseEnabled:!1});f.addChild(d,e),this.btnHome=new cjs.Button(a,"btn/home/bg","btn/home/icon").set({name:"btn-home",y:-896}),this.btnHelp=new cjs.Button(a,"btn/help/bg","btn/help/icon").set({name:"btn-help",y:-320,scaleX:0,scaleY:0}),this.buttons=[new cjs.ButtonLevel(a,"btn/level/bg",1).set({x:0,y:768,targetY:0}),new cjs.ButtonLevel(a,"btn/level/bg",2).set({x:170,y:768,targetY:0}),new cjs.ButtonLevel(a,"btn/level/bg",3).set({x:340,y:768,targetY:0}),new cjs.ButtonLevel(a,"btn/level/bg",4).set({x:510,y:768,targetY:0}),new cjs.ButtonLevel(a,"btn/level/bg",5).set({x:680,y:768,targetY:0}),new cjs.ButtonLevel(a,"btn/level/bg","bonus-1").set({x:850,y:768,targetY:0}),new cjs.ButtonLevel(a,"btn/level/bg",6).set({x:0,y:968,targetY:200}),new cjs.ButtonLevel(a,"btn/level/bg",7).set({x:170,y:968,targetY:200}),new cjs.ButtonLevel(a,"btn/level/bg",8).set({x:340,y:968,targetY:200}),new cjs.ButtonLevel(a,"btn/level/bg",9).set({x:510,y:968,targetY:200}),new cjs.ButtonLevel(a,"btn/level/bg",10).set({x:680,y:968,targetY:200}),new cjs.ButtonLevel(a,"btn/level/bg","bonus-2").set({x:850,y:968,targetY:200}),new cjs.ButtonLevel(a,"btn/level/bg",11).set({x:0,y:1168,targetY:400}),new cjs.ButtonLevel(a,"btn/level/bg",12).set({x:170,y:1168,targetY:400}),new cjs.ButtonLevel(a,"btn/level/bg",13).set({x:340,y:1168,targetY:400}),new cjs.ButtonLevel(a,"btn/level/bg",14).set({x:510,y:1168,targetY:400}),new cjs.ButtonLevel(a,"btn/level/bg",15).set({x:680,y:1168,targetY:400}),new cjs.ButtonLevel(a,"btn/level/bg","bonus-3").set({x:850,y:1168,targetY:400})];for(var g=(new cjs.Container).set({name:"con-buttons",y:100,regX:425,regY:217}),h=0;h<this.buttons.length;h++)g.addChild(this.buttons[h]);this.addChild(b,c,f,this.btnHome,this.btnHelp,g),this.on("click",this.interaction,this)}var b=cjs.extend(a,ph.Scene);b._tick=function(a){this.btnHome&&(this.btnHome.x=.5*-ph.system.width+80),this.btnHelp&&(this.btnHelp.x=.5*ph.system.width-256),this.Scene__tick(a)},b.start=function(){cjs.Tween.get(this.getChildByName("top")).to({y:-384},800,cjs.Ease.circOut),cjs.Tween.get(this.getChildByName("con-header")).wait(800).to({y:-384},600,cjs.Ease.circOut),cjs.Tween.get(this.btnHome).wait(1e3).to({y:-313.5},800,cjs.Ease.circOut),cjs.Tween.get(this.btnHelp).wait(1200).to({scaleX:1,scaleY:1},600,cjs.Ease.backOut);for(var a,b=0;b<this.buttons.length;b++)a=cjs.Tween.get(this.buttons[b]).wait(40*b).to({y:this.buttons[b].targetY},400,cjs.Ease.circOut);var c=ph.game.data.nextLevel;if(c){for(b=0;b<this.buttons.length;b++)if(this.buttons[b].name==="btn-level-"+c){a.call(this.buttons[b].sparkle,null,this.buttons[b]),(6===c||11===c||16===c)&&(a.call(this.buttons[b-1].sparkle,null,this.buttons[b-1]),a.call(app.sound.play,["bonus-unlock"],app.sound));break}16===c&&0===ph.session.get("level-16")&&(ph.session.set("level-16",1),a.call(this.buttons.last().sparkle,null,this.buttons.last()),a.call(app.sound.play,["bonus-unlock"],app.sound))}ph.game.data.nextLevel=0,this.buttons.length=0},b.end=function(){this.btnHome=null},b.interaction=function(a){var b=a.target.name||"";if("click"===a.type){this.mouseEnabled=!1;var c,d=400;if("btn-home"===b)c=ph.Scene.Title;else if(b.indexOf("btn-level-")>-1){if(!a.target.levelAvailable)return void(this.mouseEnabled=!0);c=ph.Scene.Game,d=1800,ph.game.data.instructions=!1;var e=parseInt(b.split("-").pop());b.indexOf("-bonus-")>-1?(ph.game.data.galleryN=1+.33*e-.33,c=ph.Scene.Gallery,app.voPlayer.play("Bonus-Game")):(ph.game.data.levelN=e,app.voPlayer.play("Level-"+e))}else"btn-help"===b&&(c=ph.Scene.Game,ph.game.data.instructions=!0,ph.game.data.tutorialN=0);cjs.Tween.get(this).wait(d).call(ph.game.switchScene,[c],ph.game)}},ph.Scene.Menu=cjs.promote(a,"Scene")}(),function(){var a=include("springroll.Application"),b=include("springroll.easeljs.EaselJSDisplay"),c=new a({name:"Watts of Trouble",canvasId:"stage",display:b,configPath:"assets/config/config.json",captionsPath:"assets/config/captions.json",displayOptions:{clearView:!1},resizeElement:window,maxWidth:1426,maxHeight:768});c.on("init",function(){ph.loader.load(ph.assets("prereq"),function(){new ph.System(ph.Game),c.triggerResize()})}),c.on("resize",function(a,b){ph.system&&ph.system.resize(a,b)}),c.on("update",function(a){ph.system&&ph.system.update(a)}),window.app=c}();