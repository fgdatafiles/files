var frameworkOld,__extends=this&&this.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(frameworkOld){function FixtureCircleData(){}frameworkOld.FixtureCircleData=FixtureCircleData;function BodyRenderTransform(){}frameworkOld.BodyRenderTransform=BodyRenderTransform;var PhysicsEditorUtils=function(){function PhysicsEditorUtils(){}return PhysicsEditorUtils.createBody=function(x,y,data,options,correctPosition){if(!data)return null;correctPosition=!isDefined(correctPosition)||correctPosition;var finalData=Object.clone(data);finalData=Object.extend(finalData,options);var parts=PhysicsEditorUtils.createPartsFromFixtures(finalData.fixtures);if(!parts.hasItems)return null;var body=Matter.Body.create({parts:parts});Matter.Body.set(body,finalData);var currentAnchor=Matter.Vector.create(body.position.x/finalData.transform.width,body.position.y/finalData.transform.height),translation=Matter.Vector.create(x,y);return correctPosition?Matter.Body.translate(body,translation):Matter.Body.setPosition(body,translation),body.render.sprite.xOffset=currentAnchor.x+finalData.transform.anchor.x,body.render.sprite.yOffset=currentAnchor.y+finalData.transform.anchor.y,body},PhysicsEditorUtils.createPartsFromFixtures=function(fixtures){var parts=[];return fixtures.forEach(function(fixtureData){if(fixtureData.circle){var circlePart=PhysicsEditorUtils.createCirclePart(fixtureData.circle,fixtureData);circlePart&&parts.push(circlePart)}else fixtureData.vertexLists&&fixtureData.vertexLists.map(function(vertexList){return PhysicsEditorUtils.createPolygonPart(vertexList,fixtureData)}).forEach(function(polygonPart){polygonPart&&parts.push(polygonPart)})}),parts},PhysicsEditorUtils.createCirclePart=function(circleData,fixtureData){return circleData?Matter.Bodies.circle(circleData.x,circleData.y,circleData.radius,fixtureData):null},PhysicsEditorUtils.createPolygonPart=function(vertexList,fixtureData){var centre=Matter.Vertices.centre(vertexList);return Matter.Bodies.fromVertices(centre.x,centre.y,[vertexList],fixtureData)},PhysicsEditorUtils}();frameworkOld.PhysicsEditorUtils=PhysicsEditorUtils}(frameworkOld||(frameworkOld={}));var LocationID,LevelType,LevelProgressStateID,ShapeType,ShapeCategory,ShapeID,View=framework.View,ViewConfig=framework.ViewConfig,Mediator=framework.Mediator,PhysicsEngine=framework.PhysicsEngine,PhysicsDebugMediator=framework.PhysicsDebugMediator,PhysicsDebugView=framework.PhysicsDebugView,PhysicsEditorUtils=frameworkOld.PhysicsEditorUtils,DragConstraint=framework.DragConstraint,ActionInstance=framework.ActionInstance,ActionManager=framework.ActionManager,Actions=framework.Actions,AnimateSpriteAction=framework.AnimateSpriteAction,BlockingAction=framework.BlockingAction,BlockingFuncAction=framework.BlockingFuncAction,DelayAction=framework.DelayAction,FuncAction=framework.FuncAction,ParallelAction=framework.ParallelAction,RandomVOAction=framework.RandomVOAction,RepeatAction=framework.RepeatAction,SequenceAction=framework.SequenceAction,TweenAction=framework.TweenAction,VOAction=framework.VOAction,AppHelper=framework.AppHelper,BaseApp=framework.BaseApp,PreloadService=framework.PreloadService,SizeManager=framework.SizeManager,BezierCurve=framework.BezierCurve,BezierCurveApprox=framework.BezierCurveApprox,LinearCurve=framework.LinearCurve,MinMax=framework.MinMax,Vector=framework.Vector,ViewTransformer=framework.ViewTransformer,PositionViewTransformer=framework.PositionViewTransformer,RotationViewTransformer=framework.RotationViewTransformer,Alignment=framework.AlignViewScript.Alignment,UpdateFrequency=framework.AlignViewScript.UpdateFrequency,AlignViewScript=framework.AlignViewScript,ClickScript=framework.ClickScript,DragViewScript=framework.DragViewScript,StickyDragViewScript=framework.StickyDragViewScript,StickyAndDragViewScript=framework.StickyAndDragViewScript,ButtonPressScript=framework.ButtonPressScript,HoverScript=framework.HoverScript,ViewScript=framework.ViewScript,Script=framework.Script,BaseFactory=framework.BaseFactory,ColourUtils=framework.ColourUtils,DeviceUtils=framework.DeviceUtils,GeneralUtils=framework.GeneralUtils,WindowUtils=framework.WindowUtils,ViewFactory=framework.ViewFactory,TransparencyHitArea=framework.TransparencyHitArea,AnimatedSpriteView=framework.AnimatedSpriteView,BinarySpriteView=framework.BinarySpriteView,ButtonView=framework.ButtonView,CircleView=framework.CircleView,ContainerView=framework.ContainerView,CurveView=framework.CurveView,DualSpriteView=framework.DualSpriteView,GraphicsView=framework.GraphicsView,KeyboardKeyView=framework.KeyboardKeyView,LineView=framework.LineView,ParticlesView=framework.ParticlesView,PieView=framework.PieView,PrimitiveView=framework.PrimitiveView,RectangleView=framework.RectangleView,ScreenshotView=framework.ScreenshotView,SpriteSheetView=framework.SpriteSheetView,SpineView=framework.SpineView,SpriteView=framework.SpriteView,TextView=framework.TextView,TileSpriteView=framework.TileSpriteView,ViewUtils=framework.ViewUtils,StorageService=framework.tpt.StorageService,LocalStorageService=framework.tpt.LocalStorageService,RTLStorageService=framework.tpt.RTLStorageService,TPTAnalyticsService=framework.tpt.TPTAnalyticsService,EventEmitter=PIXI.utils.EventEmitter,Rectangle=PIXI.Rectangle,Spine=PIXI.spine.Spine,BehaviorSubject=rxjs.BehaviorSubject,Unsubscribable=rxjs.Unsubscribable,Tween=TWEEN.Tween,Easing=TWEEN.Easing,Interpolation=TWEEN.Interpolation,SavedData=springroll.SavedData,DelayedCall=springroll.DelayedCall,CombinedCallback=springroll.CombinedCallback,Bellhop=springroll.Bellhop;!function(LocationID){LocationID.HERO_ELEMENTARY="heroElementary",LocationID.DOWN_TOWN="downTown",LocationID.CITY_TOWN_PARK="cityTownPark"}(LocationID||(LocationID={})),function(LevelType){LevelType.BUILD_BLOCKS="BUILD_BLOCKS",LevelType.REMOVE_BLOCKS="REMOVE_BLOCKS"}(LevelType||(LevelType={})),function(LevelProgressStateID){LevelProgressStateID.LOCKED="LOCKED",LevelProgressStateID.UNLOCKED_NEW="UNLOCKED_NEW",LevelProgressStateID.UNLOCKED="UNLOCKED",LevelProgressStateID.COMPLETE="COMPLETE"}(LevelProgressStateID||(LevelProgressStateID={})),function(ShapeType){ShapeType.TRIANGLE="TRIANGLE",ShapeType.RECTANGLE="RECTANGLE",ShapeType.SQUARE="SQUARE",ShapeType.V="V",ShapeType.W="W",ShapeType.TRAPEZIUM="TRAPEZIUM",ShapeType.CROSS="CROSS",ShapeType.PLATFORM="PLATFORM",ShapeType.ROOF="ROOF"}(ShapeType||(ShapeType={})),function(ShapeCategory){ShapeCategory.SHELF="SHELF",ShapeCategory.DYNAMIC="DYNAMIC",ShapeCategory.STATIC="STATIC",ShapeCategory.DESTINATION="DESTINATION"}(ShapeCategory||(ShapeCategory={})),function(ShapeID){ShapeID.DEST_SHAPE_1="DEST_SHAPE_1",ShapeID.DEST_SHAPE_2="DEST_SHAPE_2",ShapeID.ROOF="ROOF"}(ShapeID||(ShapeID={}));var MediatorID,MediatorEvent,LevelButtonStateID,GravityButtonStateID,TimerButtonState,GameState,TelemetryEventType,ButtonID,INVALID_SLOT_ID=-1,INVALID_STEP_INDEX=-1,ROTATION_RANGE_MIN=-Math.PI,ROTATION_RANGE_MAX=Math.PI;!function(MediatorID){MediatorID.ROOT="ROOT",MediatorID.SPLASH="SPLASH",MediatorID.INTRO="INTRO",MediatorID.LOADING="LOADING",MediatorID.LOCATION_SELECT="LOCATION_SELECT",MediatorID.LEVEL_SELECT="LEVEL_SELECT",MediatorID.LOCATION_BUTTON="LOCATION_BUTTON",MediatorID.LEVEL_BUTTON="LEVEL_BUTTON",MediatorID.LEVEL_PATH="LEVEL_PATH",MediatorID.TUTORIAL_HAND="TUTORIAL_HAND",MediatorID.BUILD_BLOCKS_GAME="BUILD_BLOCKS_GAME",MediatorID.REMOVE_BLOCKS_GAME="REMOVE_BLOCKS_GAME",MediatorID.TUTORIAL_BUILD_BLOCKS_GAME="TUTORIAL_BUILD_BLOCKS_GAME",MediatorID.TUTORIAL_REMOVE_BLOCKS_GAME="TUTORIAL_REMOVE_BLOCKS_GAME",MediatorID.PHYSICS_DEBUG="PHYSICS_DEBUG",MediatorID.DEBUG_LEVEL_SELECT_CHEATS="DEBUG_LEVEL_SELECT_CHEATS",MediatorID.DEBUG_GAME_CHEATS="DEBUG_GAME_CHEATS",MediatorID.WORKSPACE="WORKSPACE",MediatorID.SHAPE="SHAPE",MediatorID.BUILD_SHAPE="BUILD_SHAPE",MediatorID.REMOVE_SHAPE="REMOVE_SHAPE",MediatorID.DESTINATION_SHAPE="DESTINATION_SHAPE",MediatorID.SHELF="SHELF",MediatorID.SHELF_SLOT="SHELF_SLOT",MediatorID.TIMER_BUTTON="TIMER_BUTTON",MediatorID.GRAVITY_BUTTON="GRAVITY_BUTTON",MediatorID.CHUTE="CHUTE",MediatorID.CHUTE_PROGRESS_BAR="CHUTE_PROGRESS_BAR",MediatorID.ROOF_RELEASE="ROOF_RELEASE",MediatorID.FUR_BLUR="FUR_BLUR",MediatorID.TESTING_INDICATOR="TESTING_INDICATOR",MediatorID.DIALOG_HOLDER="DIALOG_HOLDER",MediatorID.RESULTS_DIALOG="RESULTS_DIALOG",MediatorID.TIMEOUT_DIALOG="TIMEOUT_DIALOG",MediatorID.LAST_LEVEL_COMPLETE_DIALOG="LAST_LEVEL_COMPLETE_DIALOG",MediatorID.GAME_COMPLETE_DIALOG="GAME_COMPLETE_DIALOG",MediatorID.RESTART_LEVEL_DIALOG="RESTART_LEVEL_DIALOG",MediatorID.LEAVE_LEVEL_DIALOG="LEAVE_LEVEL_DIALOG"}(MediatorID||(MediatorID={})),function(MediatorEvent){MediatorEvent.INTRO_COMPLETE="INTRO_COMPLETE",MediatorEvent.CHANGE_MEDIATOR="CHANGE_MEDIATOR",MediatorEvent.LEVEL_SELECTED="LEVEL_SELECTED",MediatorEvent.TUTORIAL_VO_COMPLETE="TUTORIAL_VO_COMPLETE",MediatorEvent.SLOT_SHAPE_DRAG_STARTED="SLOT_SHAPE_DRAG_STARTED",MediatorEvent.SHAPE_DRAG_STARTED="SHAPE_DRAG_STARTED",MediatorEvent.SHAPE_DRAG_ENDED="SHAPE_DRAG_ENDED",MediatorEvent.SHAPE_ROTATED="SHAPE_ROTATED",MediatorEvent.SHAPE_ADDED="SHAPE_ADDED",MediatorEvent.SHAPE_REMOVED="SHAPE_REMOVED",MediatorEvent.SHAPE_CLICKED="SHAPE_CLICKED",MediatorEvent.SHAPES_COLLIDING_CHANGED="SHAPES_COLLIDING_CHANGED",MediatorEvent.SHAPE_IN_CHUTE_CHANGED="SHAPE_IN_CHUTE_CHANGED",MediatorEvent.ACTIVATE_GRAVITY="ACTIVATE_GRAVITY",MediatorEvent.UNDO_GRAVITY="UNDO_GRAVITY",MediatorEvent.ROOF_PRESSED="ROOF_PRESSED",MediatorEvent.SHAPE_OUT_OF_BOUNDS="SHAPE_OUT_OF_BOUNDS",MediatorEvent.BACKGROUND_PRESSED="BACKGROUND_PRESSED",MediatorEvent.ROOF_BELOW_BOUNDS="ROOF_BELOW_BOUNDS",MediatorEvent.RESTART_BUTTON_PRESSED="RESTART_BUTTON_PRESSED",MediatorEvent.MAP_BUTTON_PRESSED="MAP_BUTTON_PRESSED",MediatorEvent.ROOF_UNLOCKED="ROOF_UNLOCKED",MediatorEvent.LOCATION_BUTTON_PRESSED="LOCATION_BUTTON_PRESSED",MediatorEvent.SHOW_DIALOG="SHOW_DIALOG",MediatorEvent.HIDE_DIALOG="HIDE_DIALOG",MediatorEvent.RESET_GAME="RESET_GAME",MediatorEvent.ON_TRANSITIONED_IN="ON_TRANSITIONED_IN",MediatorEvent.SIMULATION_SUCCESS="SIMULATION_SUCCESS",MediatorEvent.SIMULATION_FAIL="SIMULATION_FAIL",MediatorEvent.LEVEL_COMPLETE="LEVEL_COMPLETE",MediatorEvent.SHAPE_DRAGGED_IN_DESTINATION="SHAPE_DRAGGED_IN_DESTINATION",MediatorEvent.SHAPE_ROTATED_IN_DESTINATION="SHAPE_ROTATED_IN_DESTINATION"}(MediatorEvent||(MediatorEvent={})),function(LevelButtonStateID){LevelButtonStateID.LOCKED="LOCKED",LevelButtonStateID.UNLOCKED="UNLOCKED",LevelButtonStateID.COMPLETE="COMPLETE"}(LevelButtonStateID||(LevelButtonStateID={})),function(GravityButtonStateID){GravityButtonStateID.GRAVITY="GRAVITY",GravityButtonStateID.UNDO="UNDO",GravityButtonStateID.UNDO_SHAKE="UNDO_SHAKE"}(GravityButtonStateID||(GravityButtonStateID={})),function(TimerButtonState){TimerButtonState.TIMER="TIMER",TimerButtonState.SUCCESS="SUCCESS",TimerButtonState.FAIL="FAIL",TimerButtonState.HIDDEN="HIDDEN"}(TimerButtonState||(TimerButtonState={})),function(GameState){GameState.LEVEL_SELECT="LEVEL_SELECT",GameState.EDITING="EDITING",GameState.EDITING_SHAPES_OVERLAPPING="EDITING_SHAPES_OVERLAPPING",GameState.DRAGGING="DRAGGING",GameState.SIMULATION_RUNNING="SIMULATION_RUNNING",GameState.SIMULATION_FAIL="SIMULATION_FAIL",GameState.SIMULATION_SUCCESS="SIMULATION_SUCCESS",GameState.READY_TO_DROP_ROOF="READY_TO_DROP_ROOF",GameState.LEVEL_COMPLETED="LEVEL_COMPLETED"}(GameState||(GameState={})),function(TelemetryEventType){TelemetryEventType.START_GAME="startGame",TelemetryEventType.LOAD_WORLD="loadWorld",TelemetryEventType.START_STAGE="startStage",TelemetryEventType.QUIT_STAGE="quitStage",TelemetryEventType.STAGE_RESET="stageReset",TelemetryEventType.STAGE_PASS="stagePass",TelemetryEventType.STAGE_FAIL="stageFail",TelemetryEventType.STAGE_UNLOCK="stageUnlock",TelemetryEventType.WORLD_UNLOCK="worldUnlock",TelemetryEventType.WORLD_COMPLETE="worldComplete",TelemetryEventType.GAME_COMPLETE="gameComplete",TelemetryEventType.ALL_LEVELS_COMPLETE="allLevelsComplete",TelemetryEventType.BUTTON_CLICK="buttonClick",TelemetryEventType.PLACED_OBJECT="placedObject",TelemetryEventType.RETURNED_OBJECT="returnedObject",TelemetryEventType.REMOVED_OBJECT="removedObject",TelemetryEventType.ROTATED_OBJECT="rotatedObject",TelemetryEventType.ROOF_DROPPED="roofDropped"}(TelemetryEventType||(TelemetryEventType={})),function(ButtonID){ButtonID.SPLASH_ENTER="splashEnter",ButtonID.TUTORIAL_NEXT="tutorialNext",ButtonID.GRAVITY="gravity",ButtonID.UNDO="undo",ButtonID.RESULT_MAP="resultMap",ButtonID.GAME_BACK="gameBack",ButtonID.STAGE="stage",ButtonID.WORLD="world",ButtonID.RESTART_YES="restartYes",ButtonID.RESTART_NO="restartNo"}(ButtonID||(ButtonID={}));var GameView=function(_super){function GameView(config){var _this=_super.call(this,config)||this;return _this.actionFactory=_this.createActionFactory(config.actionData),_this.background=_this.getChildByName("background"),_this.backgroundLayer=_this.getChildByName("backgroundLayer"),_this.foregroundHolder=_this.getChildByName("foregroundHolder"),_this.workspaceHolder=_this.getChildByName("workspaceHolder"),_this.uiLayer=_this.getChildByName("uiLayer"),_this.debugLayer=_this.getChildByName("debugLayer"),_this.gameModeLabel=_this.getChildByName("gameModeLabel"),_this.timerButtonContainer=_this.getChildByName("timerButtonContainer"),_this.gravityButtonContainer=_this.getChildByName("gravityButtonContainer"),_this.tutorialLayer=_this.getChildByName("tutorialLayer"),_this.tutorialBoxHolder=_this.getChildByName("tutorialBoxHolder"),_this.levelIDLabel=_this.getChildByName("levelID"),_this.testingIndicatorContainer=_this.getChildByName("testingIndicatorContainer"),_this.backButton=_this.getChildByName("backButton"),_this.restartButton=_this.getChildByName("restartButton"),_this.configureComponents(),_this.addScripts(),_this}return __extends(GameView,_super),GameView.prototype.getTimerButtonParent=function(){return this.timerButtonContainer},GameView.prototype.getGravityButtonContainer=function(){return this.gravityButtonContainer},GameView.prototype.destroy=function(){_super.prototype.destroy.call(this)},GameView.prototype.getBackgroundLayer=function(){return this.backgroundLayer},GameView.prototype.getRoofParent=function(){return this.foregroundHolder},GameView.prototype.getFurBlurParent=function(){return this.foregroundHolder},GameView.prototype.getWorkspaceParent=function(){return this.workspaceHolder},GameView.prototype.getDebugLayer=function(){return this.debugLayer},GameView.prototype.getTutorialHandParent=function(){return this.tutorialLayer},GameView.prototype.getTestingIndicatorParent=function(){return this.testingIndicatorContainer},GameView.prototype.bringWorkspaceToFront=function(isInFront){isInFront!=this.getChildIndex(this.workspaceHolder)>this.getChildIndex(this.uiLayer)&&this.swapChildren(this.workspaceHolder,this.uiLayer)},GameView.prototype.show=function(finishedCallback){var showAction=this.actionFactory.createShowAction();this.runAction(showAction,finishedCallback)},GameView.prototype.hide=function(finishedCallback){var hideAction=this.actionFactory.createHideAction();this.runAction(hideAction,finishedCallback)},GameView.prototype.setBackgroundTextureName=function(textureName){this.background.updateTexture(textureName)},GameView.prototype.setGameModeTextureName=function(textureName){this.gameModeLabel.updateTexture(textureName)},GameView.prototype.setLevelID=function(levelID){this.levelIDLabel.text=levelID},GameView.prototype.showDialogBackground=function(finishedCallback){var showDialogBackgroundAction=this.actionFactory.createShowDialogBackgroundAction();this.runAction(showDialogBackgroundAction,finishedCallback)},GameView.prototype.playIntroAudio=function(introVOName){this.playVO(introVOName)},GameView.prototype.playWinAudio=function(winVOName){this.playVO(winVOName)},GameView.prototype.playLoseAudio=function(loseVOName){app.sound.play("gameLoss"),this.playVO(loseVOName)},GameView.prototype.enableBackButton=function(enable){this.backButton.enabled=enable},GameView.prototype.enableRestartButton=function(enable){this.restartButton.enabled=enable},GameView.prototype.createActionFactory=function(actionData){return null},GameView.prototype.configureComponents=function(){this.background.position.set(app.size.min.x,app.size.min.y)},GameView.prototype.addScripts=function(){var _this=this;({backButtonPressed:new ButtonPressScript({view:this.backButton,buttonPressedCallback:function(event){app.sound.play("clickGeneric"),_this.emit(GameView.BACK_BUTTON_PRESSED,event)}}),restartButtonPressed:new ButtonPressScript({view:this.restartButton,buttonPressedCallback:function(event){app.sound.play("clickGeneric"),_this.emit(GameView.RESTART_BUTTON_PRESSED,event)}}),alignSideBar:new AlignViewScript({view:this.getChildByName("sideBar"),horizontalAlignment:Alignment.RIGHT})}).forIn(function(script){_this.scripts.addScript(script)})},GameView.BACK_BUTTON_PRESSED="BACK_BUTTON_PRESSED",GameView.RESTART_BUTTON_PRESSED="RESTART_BUTTON_PRESSED",GameView}(View),ShapeMediator=function(_super){function ShapeMediator(config){var _this=_super.call(this,config.view)||this;return _this.positionChanged=function(position){_this.view.setPosition(position)},_this.rotationChanged=function(rotation){_this.view.setRotation(rotation)},_this.enabledChanged=function(enabled){_this.onEnabledChanged(enabled)},_this.editableChanged=function(editable){_this.onEditableChanged(editable)},_this.showChanged=function(show){_this.onShowChanged(show)},_this.validChanged=function(valid){_this.onValidChanged(valid)},_this.shape=config.shape,_this.textureName=config.textureName,_this.invalidTextureName=config.invalidTextureName,_this.rotationStep=MathExt.toRadians(config.rotationStepDegrees),_this.view.init(_this.rotationStep),_this.view.setTextureName(config.textureName),_this.view.setAnchor(_this.shape.getAnchor()),_this.view.setRotationCircleVisible(!1),_this.subscriptions=[_this.shape.onPositionChanged(_this.positionChanged),_this.shape.onRotationChanged(_this.rotationChanged),_this.shape.onEnabledChanged(_this.enabledChanged),_this.shape.onEditableChanged(_this.editableChanged),_this.shape.onValidChanged(_this.validChanged),_this.shape.onShowChanged(_this.showChanged)],_this}return __extends(ShapeMediator,_super),ShapeMediator.prototype.getShape=function(){return this.shape},ShapeMediator.prototype.destroy=function(){this.subscriptions.forEach(function(unsubscribable){unsubscribable.unsubscribe()}),this.shape=null,_super.prototype.destroy.call(this)},ShapeMediator.prototype.setPosition=function(worldPosition,time,finishedCallback){var _this=this;void 0===time&&(time=0),void 0===finishedCallback&&(finishedCallback=null);var position=this.convertWorldToLocalPosition(worldPosition);this.shape.enableBody(!1),this.view.setPosition(position,time,function(){_this.shape.enableBody(!0),finishedCallback&&finishedCallback()})},ShapeMediator.prototype.setRotation=function(rotation,time,finishedCallback){var _this=this;void 0===time&&(time=0),void 0===finishedCallback&&(finishedCallback=null),this.shape.enableBody(!1),this.view.setRotation(rotation,time,function(){_this.shape.enableBody(!0),finishedCallback&&finishedCallback()})},ShapeMediator.prototype.isBeingDragged=function(){return!1},ShapeMediator.prototype.getRotateCCWButtonView=function(){return this.view.getRotateCCWButtonView()},ShapeMediator.prototype.getRotateCWButtonView=function(){return this.view.getRotateCWButtonView()},ShapeMediator.prototype.onEnabledChanged=function(enabled){},ShapeMediator.prototype.onEditableChanged=function(editable){},ShapeMediator.prototype.onShowChanged=function(show){},ShapeMediator.prototype.onValidChanged=function(valid){},ShapeMediator.prototype.setValidTexture=function(valid){var textureName=valid?this.textureName:this.invalidTextureName;this.view.setTextureName(textureName)},ShapeMediator.prototype.convertWorldToLocalPosition=function(worldPosition){var position=Vector.transformGlobalToChild(worldPosition,this.view.parent),bodyOffset=this.shape.getBodyOffset();return Vector.add(position,bodyOffset)},ShapeMediator}(Mediator),TutorialStepHandler=function(){function TutorialStepHandler(config){this.workspaceMediator=config.workspaceMediator,this.gravityButtonMediator=config.gravityButtonMediator,this.furBlurMediator=config.furBlurMediator,this.tutorialHandMediator=config.tutorialHandMediator,this.sendTutorialHandlerEvent=config.sendTutorialHandlerEvent,this.sendToParentMediator=config.sendToParentMediator}return TutorialStepHandler.prototype.destroy=function(){this.workspaceMediator=null,this.gravityButtonMediator=null,this.furBlurMediator=null,this.tutorialHandMediator=null,this.sendTutorialHandlerEvent=null,this.sendToParentMediator=null},TutorialStepHandler.prototype.enter=function(args){},TutorialStepHandler.prototype.exit=function(){},TutorialStepHandler.prototype.handleEvent=function(eventName,args){},TutorialStepHandler}(),BuildTutorialStepHandler=function(_super){function BuildTutorialStepHandler(config){var _this=_super.call(this,config)||this;return _this.slotDatas=config.slotDatas,_this.shelfMediator=config.shelfMediator,_this.roofReleaseMediator=config.roofReleaseMediator,_this.returnShapeToShelf=config.returnShapeToShelf,_this}return __extends(BuildTutorialStepHandler,_super),BuildTutorialStepHandler.prototype.destroy=function(){this.shelfMediator=null,this.roofReleaseMediator=null,this.returnShapeToShelf=null,_super.prototype.destroy.call(this)},BuildTutorialStepHandler}(TutorialStepHandler),RemoveTutorialStepHandler=function(_super){function RemoveTutorialStepHandler(config){var _this=_super.call(this,config)||this;return _this.progressBarMediator=config.progressBarMediator,_this}return __extends(RemoveTutorialStepHandler,_super),RemoveTutorialStepHandler.prototype.destroy=function(){this.progressBarMediator=null,_super.prototype.destroy.call(this)},RemoveTutorialStepHandler}(TutorialStepHandler),GameMediator=function(_super){function GameMediator(view){var _this=_super.call(this,view)||this;return _this.backButtonPressed=function(clickEvent){_this.sendToParent(TelemetryEventType.QUIT_STAGE,{levelID:_this.levelID}),_this.sendToParent(TelemetryEventType.BUTTON_CLICK,{buttonID:ButtonID.GAME_BACK,clickEvent:clickEvent}),_this.transitionOut(function(){_this.goToPreviousScreen()})},_this.restartButtonPressed=function(){_this.restartLevel()},_this.restartWithConfirmation=function(){_this.sendToParent(MediatorEvent.SHOW_DIALOG,{mediatorID:MediatorID.RESTART_LEVEL_DIALOG,args:{yesButtonPressed:_this.restartButtonPressed}})},_this.mapButtonPressed=function(){_this.goToPreviousScreen()},_this.mapButtonWithConfirmation=function(){_this.sendToParent(MediatorEvent.SHOW_DIALOG,{mediatorID:MediatorID.LEAVE_LEVEL_DIALOG,args:{yesButtonPressed:_this.mapButtonPressed}})},_this}return __extends(GameMediator,_super),GameMediator.prototype.init=function(config){this.gameState=null,this.subscriptions=[],this.parseConfig(config),this.initServices(config),this.initChildMediators(config.levelContentData),this.tutorialHandler=this.createTutorialHandler(config.tutorialHandlerConfig,config.tutorialStepDatas),this.registerEventHandlers(),this.start()},GameMediator.prototype.destroy=function(){this.deregisterEventHandlers(),this.tutorialHandler&&(this.tutorialHandler.destroy(),this.tutorialHandler=null),this.workspaceMediator=null,this.timerButtonMediator=null,this.gravityButtonMediator=null,this.tutorialHandMediator=null,this.physicsDebugMediator=null,this.debugCheatsMediator=null,this.mediatorFactory=null,this.gameVOData=null,this.levelID=null,this.timeoutVOStateMachine&&(this.timeoutVOStateMachine.destroy(),this.timeoutVOStateMachine=null),this.simulationProgress&&(this.simulationProgress.destroy(),this.simulationProgress=null),this.physicsEngine&&(this.physicsEngine.destroy(),this.physicsEngine=null),_super.prototype.destroy.call(this)},GameMediator.prototype.update=function(frameTime){_super.prototype.update.call(this,frameTime),this.physicsEngine&&this.physicsEngine.update(frameTime),this.simulationProgress&&this.simulationProgress.update(frameTime),this.tutorialHandler&&this.tutorialHandler.update(frameTime)},GameMediator.prototype.handleChildMessage=function(messageID,args,child){if(messageID==MediatorEvent.SHAPE_ADDED){var shape=args.shape;this.shapeAdded(shape)}else if(messageID==MediatorEvent.SHAPE_REMOVED){shape=args.shape;this.shapeRemoved(shape)}else if(messageID==MediatorEvent.ACTIVATE_GRAVITY)this.gravityButtonPressed();else if(messageID==MediatorEvent.UNDO_GRAVITY)this.undoButtonPressed();else if(messageID==MediatorEvent.SHAPES_COLLIDING_CHANGED){var shapesAreColliding=args.areColliding;this.shapesAreColliding(shapesAreColliding)}else if(messageID==MediatorEvent.SHAPE_OUT_OF_BOUNDS)this.shapeOutOfBounds();else if(messageID==MediatorEvent.ROOF_BELOW_BOUNDS){var roofShape=args.roofShape;this.roofBelowBounds(roofShape)}else messageID==MediatorEvent.RESTART_BUTTON_PRESSED?this.restartButtonPressed():messageID==MediatorEvent.MAP_BUTTON_PRESSED&&this.mapButtonPressed();this.tutorialHandler&&this.tutorialHandler.handleEvent(messageID,args),this.sendToParent(messageID,args,child)},GameMediator.prototype.getCreateWorkspaceMediatorArgs=function(levelContentData){return null},GameMediator.prototype.createTutorialStepHandlerConfig=function(){return null},GameMediator.prototype.shapeAdded=function(shape){},GameMediator.prototype.shapeRemoved=function(shape){},GameMediator.prototype.shapesAreColliding=function(areColliding){},GameMediator.prototype.tutorialFinished=function(){},GameMediator.prototype.parseConfig=function(config){this.locationID=config.locationID,this.currentMediatorID=config.currentMediatorID,this.currentMediatorArgs=config.currentMediatorArgs,this.previousMediatorID=config.previousMediatorID,this.mediatorFactory=config.mediatorFactory,this.levelProgress=config.levelProgress,this.timeoutVOStateMachine=config.timeoutVOStateMachine,this.gameVOData=config.gameVOData,this.levelID=config.levelID,this.view.setBackgroundTextureName(config.backgroundTextureName),this.view.setGameModeTextureName(config.gameModeTextureName),app.options.debug&&this.view.setLevelID(this.levelID)},GameMediator.prototype.initServices=function(config){this.physicsEngine=this.createPhysicsEngine(),this.simulationProgress=this.createSimulationProgress(config.maxSimulationTimeout)},GameMediator.prototype.initChildMediators=function(levelContentData){if(app.options.debug){this.physicsDebugMediator=this.mediatorFactory.createMediator(MediatorID.PHYSICS_DEBUG,{viewConfig:{alpha:.6,isVisible:!1},compositeBody:this.physicsEngine.getEngine().world});var physicsDebugParent=this.view.getDebugLayer();this.addChild(this.physicsDebugMediator,physicsDebugParent)}var createWorkspaceMediatorArgs=this.getCreateWorkspaceMediatorArgs(levelContentData);this.workspaceMediator=this.mediatorFactory.createMediator(MediatorID.WORKSPACE,createWorkspaceMediatorArgs);var workspaceParent=this.view.getWorkspaceParent();if(this.addChild(this.workspaceMediator,workspaceParent),app.options.debug){this.debugCheatsMediator=this.mediatorFactory.createMediator(MediatorID.DEBUG_GAME_CHEATS,{physicsDebugView:this.physicsDebugMediator.view});var debugCheatsParent=this.view.getDebugLayer();this.addChild(this.debugCheatsMediator,debugCheatsParent)}this.timerButtonMediator=this.mediatorFactory.createMediator(MediatorID.TIMER_BUTTON);var timerButtonParent=this.view.getTimerButtonParent();this.addChild(this.timerButtonMediator,timerButtonParent),this.gravityButtonMediator=this.mediatorFactory.createMediator(MediatorID.GRAVITY_BUTTON);var gravityButtonParent=this.view.getGravityButtonContainer();this.addChild(this.gravityButtonMediator,gravityButtonParent),this.tutorialHandMediator=this.mediatorFactory.createMediator(MediatorID.TUTORIAL_HAND);var tutorialHandParent=this.view.getTutorialHandParent();this.addChild(this.tutorialHandMediator,tutorialHandParent),this.furBlurMediator=this.mediatorFactory.createMediator(MediatorID.FUR_BLUR);var furBlurParent=this.view.getFurBlurParent();this.addChild(this.furBlurMediator,furBlurParent),this.testingIndicatorMediator=this.mediatorFactory.createMediator(MediatorID.TESTING_INDICATOR);var testingIndicatorParent=this.view.getTestingIndicatorParent();this.addChild(this.testingIndicatorMediator,testingIndicatorParent)},GameMediator.prototype.start=function(){var _this=this;this.enableSimulation(!1),this.setSubState(GameState.EDITING),this.transitionIn(function(){_this.onTransitionedIn()}),app.music="gameMusic"},GameMediator.prototype.registerEventHandlers=function(){this.view.on(BuildBlocksGameView.BACK_BUTTON_PRESSED,this.mapButtonWithConfirmation),this.view.on(GameView.RESTART_BUTTON_PRESSED,this.restartWithConfirmation)},GameMediator.prototype.deregisterEventHandlers=function(){this.subscriptions.forEach(function(unsubscribable){unsubscribable.unsubscribe()}),this.subscriptions=[],this.view.off(BuildBlocksGameView.BACK_BUTTON_PRESSED,this.mapButtonWithConfirmation),this.view.off(GameView.RESTART_BUTTON_PRESSED,this.restartWithConfirmation)},GameMediator.prototype.handleMessage=function(messageID,args){this.tutorialHandler&&this.tutorialHandler.handleEvent(messageID,args),this.sendToParent(messageID,args)},GameMediator.prototype.addSubscriptions=function(unsubscribables){this.subscriptions.append(unsubscribables)},GameMediator.prototype.enableSimulation=function(enable){this.physicsEngine.getEngine().enableSleeping=enable,this.workspaceMediator.setShapesAsSleeping(!enable);var workspace=this.workspaceMediator.getWorkspace();workspace.setGravityOn(enable),workspace.setShapeCollisionsOn(enable),workspace.setEnabled(!enable),this.testingIndicatorMediator.setRunning(enable),this.view.bringWorkspaceToFront(!enable),this.workspaceMediator.setShapesToUneditable()},GameMediator.prototype.simulationIsRunning=function(){return this.simulationProgress&&this.simulationProgress.isRunning()},GameMediator.prototype.continuePlaying=function(){this.gravityButtonMediator.setState(GravityButtonStateID.GRAVITY),this.timerButtonMediator.hide()},GameMediator.prototype.gravityButtonPressed=function(){this.workspaceMediator.saveShapes(),this.enableSimulation(!0),this.setSubState(GameState.SIMULATION_RUNNING);var shapes=this.workspaceMediator.getWorkspace().getShapes();this.simulationProgress.start(shapes),this.timerButtonMediator.showAndStart(),this.gravityButtonMediator.setState(GravityButtonStateID.UNDO)},GameMediator.prototype.undoButtonPressed=function(){this.simulationProgress.cancel(),this.enableSimulation(!1),this.continuePlaying(),this.setSubState(GameState.EDITING),this.workspaceMediator.restoreSavedShapes(),this.gravityButtonMediator.setState(GravityButtonStateID.GRAVITY),this.furBlurMediator.hide()},GameMediator.prototype.shapeOutOfBounds=function(){this.simulationIsRunning()&&this.simulationFail()},GameMediator.prototype.roofBelowBounds=function(roofShape){var roofXPos=roofShape.getPosition().x;this.furBlurMediator.showAtX(roofXPos)},GameMediator.prototype.enableGravityButton=function(enable){this.gravityButtonMediator.enable(enable)},GameMediator.prototype.simulationSuccess=function(){app.sound.play("gameWin"),this.enableSimulation(!1),this.setSubState(GameState.SIMULATION_SUCCESS),this.timerButtonMediator.showSuccess(),this.handleMessage(MediatorEvent.SIMULATION_SUCCESS)},GameMediator.prototype.simulationFail=function(){if(this.gameVOData){var loseVOName=this.gameVOData.lose.random();this.view.playLoseAudio(loseVOName)}this.setSubState(GameState.SIMULATION_FAIL),this.simulationProgress.cancel(),this.testingIndicatorMediator.setRunning(!1),this.timerButtonMediator.showFailure(),this.gravityButtonMediator.setState(GravityButtonStateID.UNDO_SHAKE),this.handleMessage(MediatorEvent.SIMULATION_FAIL,{levelID:this.levelID})},GameMediator.prototype.levelComplete=function(){if(this.physicsEngine&&(this.physicsEngine.destroy(),this.physicsEngine=null),this.levelProgress.setCompleted(),this.levelProgress.save(),this.gameVOData){var winVOName=this.gameVOData.win.random();this.view.playWinAudio(winVOName)}app.music=null,this.setSubState(GameState.LEVEL_COMPLETED),this.sendToParent(MediatorEvent.SHOW_DIALOG,{mediatorID:MediatorID.RESULTS_DIALOG,args:{onClosed:this.mapButtonPressed}}),this.tutorialHandler&&this.tutorialHandler.handleEvent(MediatorEvent.LEVEL_COMPLETE)},GameMediator.prototype.setSubState=function(state){this.gameState=state,this.timeoutVOStateMachine&&this.timeoutVOStateMachine.setState(state)},GameMediator.prototype.enableBackAndRestartButtons=function(enable){this.view.enableBackButton(enable),this.view.enableRestartButton(enable)},GameMediator.prototype.createPhysicsEngine=function(){return new PhysicsEngine({engineOptions:{enableSleeping:!1}})},GameMediator.prototype.createSimulationProgress=function(maxSimulationTimeout){var _this=this;return new SimulationProgress({onEndCallback:function(){_this.simulationSuccess()},maxTimeout:maxSimulationTimeout})},GameMediator.prototype.createTutorialHandler=function(config,tutorialStepDatas){var _this=this,tutorialHandler=null;return config&&(config.stepHandlerFactory=this.createTutorialStepHandlerFactory(tutorialStepDatas),config.onFinished=function(){_this.tutorialFinished()},tutorialHandler=new TutorialHandler(config)),tutorialHandler},GameMediator.prototype.createTutorialStepHandlerFactory=function(tutorialStepDatas){var stepHandlerConfig=this.createTutorialStepHandlerConfig();return new TutorialStepHandlerFactory({stepHandlerConfig:stepHandlerConfig,stepDatas:tutorialStepDatas})},GameMediator.prototype.transitionIn=function(finishedCallback){app.enableUserInput(!1),this.view.show(function(){app.enableUserInput(!0),finishedCallback&&finishedCallback()})},GameMediator.prototype.transitionOut=function(finishedCallback){app.enableUserInput(!1),this.view.hide(function(){app.enableUserInput(!0),finishedCallback&&finishedCallback()})},GameMediator.prototype.onTransitionedIn=function(){this.tutorialHandler&&this.tutorialHandler.start(),this.gameVOData&&this.view.playIntroAudio(this.gameVOData.intro),this.handleMessage(MediatorEvent.ON_TRANSITIONED_IN)},GameMediator.prototype.goToPreviousScreen=function(){this.sendToParent(MediatorEvent.CHANGE_MEDIATOR,{mediatorID:this.previousMediatorID,args:{locationID:this.locationID}})},GameMediator.prototype.restartLevel=function(){this.sendToParent(TelemetryEventType.STAGE_RESET,{levelID:this.levelID}),this.sendToParent(MediatorEvent.CHANGE_MEDIATOR,{mediatorID:this.currentMediatorID,args:this.currentMediatorArgs})},GameMediator}(Mediator),AssetServiceConfig=function(){},MediatorFactoryConfig=function(){},RootMediatorConfig=function(){},TelemetryHandlerConfig=function(){},TelemetryEventsConfig=function(){},SplashMediatorConfig=function(){},LoadingMediatorConfig=function(){},LocationSelectMediatorConfig=function(){},LevelSelectMediatorConfig=function(){},LocationButtonMediatorConfig=function(){},LevelButtonMediatorConfig=function(){},LevelPathMediatorConfig=function(){},GameMediatorConfig=function(){},DebugLevelSelectCheatsMediatorConfig=function(){},DebugGameCheatsMediatorConfig=function(){},ShapeMediatorConfig=function(){},BuildShapeMediatorConfig=function(_super){function BuildShapeMediatorConfig(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(BuildShapeMediatorConfig,_super),BuildShapeMediatorConfig}(ShapeMediatorConfig),WorkspaceMediatorConfig=function(){},GravityButtonMediatorConfig=function(){},ShelfSlotMediatorConfig=function(){},ShelfMediatorConfig=function(){},ChuteMediatorConfig=function(){},ChuteProgressBarMediatorConfig=function(){},RoofReleaseMediatorConfig=function(){},FurBlurMediatorConfig=function(){},ResultsDialogMediatorConfig=function(){},YesNoDialogMediatorConfig=function(){},TimeoutDialogMediatorConfig=function(){},TutorialHandlerConfig=function(){},TutorialStepHandlerConfig=function(){},BuildTutorialStepHandlerConfig=function(_super){function BuildTutorialStepHandlerConfig(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(BuildTutorialStepHandlerConfig,_super),BuildTutorialStepHandlerConfig}(TutorialStepHandlerConfig),RemoveTutorialStepHandlerConfig=function(_super){function RemoveTutorialStepHandlerConfig(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(RemoveTutorialStepHandlerConfig,_super),RemoveTutorialStepHandlerConfig}(TutorialStepHandlerConfig),TutorialStepHandlerFactoryConfig=function(){},TimeoutVOStateMachineConfig=function(){},IntroMediatorConfig=function(){},VOData=function(){},GravityButtonStateData=function(){},LevelProgressData=function(){},MilestoneProgressData=function(){},PlayerProgressData=function(){},LevelProgressConfig=function(){},PlayerProgressConfig=function(){},LevelGraphNodeData=function(){},LevelGraphConnection=function(){},LevelGraphData=function(){},NeighbourLocationData=function(){},NeighbourLocationGroupData=function(){},LocationData=function(){},LevelData=function(){},LevelContentData=function(){},BuildBlocksLevelContentData=function(_super){function BuildBlocksLevelContentData(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(BuildBlocksLevelContentData,_super),BuildBlocksLevelContentData}(LevelContentData),RemoveBlocksLevelContentData=function(_super){function RemoveBlocksLevelContentData(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(RemoveBlocksLevelContentData,_super),RemoveBlocksLevelContentData}(LevelContentData),TutorialBuildBlocksLevelContentData=function(_super){function TutorialBuildBlocksLevelContentData(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(TutorialBuildBlocksLevelContentData,_super),TutorialBuildBlocksLevelContentData}(BuildBlocksLevelContentData),RemoveBlocksLevelScoreConfig=function(){},TutorialStepData=function(){},TutorialConfig=function(){},WorkspaceData=function(){},ShapeData=function(){},ShapeConfig=function(){},ShelfSlotData=function(){},WorkspaceConfig=function(){},ShapeFactoryConfig=function(){},CreateShapeConfig=function(){},SimulationProgressConfig=function(){},ShapeTextureNames=function(){},GameViewActionData=function(){},FanfareActionsConfig=function(){},ResultsDialogViewConfig=function(_super){function ResultsDialogViewConfig(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(ResultsDialogViewConfig,_super),ResultsDialogViewConfig}(ViewConfig),TimeoutDialogViewConfig=function(_super){function TimeoutDialogViewConfig(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(TimeoutDialogViewConfig,_super),TimeoutDialogViewConfig}(ViewConfig),GameViewConfig=function(_super){function GameViewConfig(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(GameViewConfig,_super),GameViewConfig}(ViewConfig),OutlineViewConfig=function(_super){function OutlineViewConfig(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(OutlineViewConfig,_super),OutlineViewConfig}(ViewConfig),GravityButtonAnimationNames=function(){},GravityButtonAnimationData=function(){},ChuteViewConfig=function(_super){function ChuteViewConfig(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(ChuteViewConfig,_super),ChuteViewConfig}(ViewConfig),DroneAnimationNames=function(){},FanfareAnimationNames=function(){},GameVOData=function(){},Game=function(_super){function Game(options){var _this=_super.call(this,options)||this;return _this.assetService=null,_this.mediatorFactory=null,_this.rootMediator=null,_this}return __extends(Game,_super),Game.prototype.isInPbsContainer=function(){return/packageName=org\.pbskids\.gamesapp/.test(window.location.search)},Game.prototype.isInRTLContainer=function(){return/rtl/.test(window.location.hostname)},Game.prototype.useRtlStorage=function(){return this.isInRTLContainer()},Game.prototype.useRtlAnalytics=function(){return this.isInRTLContainer()},Game.prototype._onConfigLoaded=function(config,assets){this.assetService=new AssetService({preloadService:this.preloadService,assetConfigs:{preload:config.load.preloadAssets,persistent:config.load.persistentAssets,intro:config.load.introAssets,locationSelect:config.load.levelSelectAssets,commonGame:config.load.commonGameAssets,buildGameTutorial:config.load.buildGameTutorialAssets,removeGameTutorial:config.load.removeGameTutorialAssets,buildGame:config.load.buildGameAssets,removeGame:config.load.removeGameAssets}}),this.assetService.createAssetGroup("PRELOAD",["preload","persistent"]),this.assetService.createAssetGroup(MediatorID.INTRO,["intro"]),this.assetService.createAssetGroup(MediatorID.LOCATION_SELECT,["locationSelect"]),this.assetService.createAssetGroup(MediatorID.TUTORIAL_BUILD_BLOCKS_GAME,["commonGame","buildGameTutorial","buildGame"]),this.assetService.createAssetGroup(MediatorID.TUTORIAL_REMOVE_BLOCKS_GAME,["commonGame","removeGameTutorial","removeGame"]),this.assetService.createAssetGroup(MediatorID.BUILD_BLOCKS_GAME,["commonGame","buildGame"]),this.assetService.createAssetGroup(MediatorID.REMOVE_BLOCKS_GAME,["commonGame","removeGame"]);var preloadAssets=this.assetService.getAssetGroup("PRELOAD");Array.prototype.push.apply(assets,preloadAssets)},Game.prototype._onInit=function(){var preloadAssets=this.assetService.getAssetGroup("PRELOAD");this.preloadService.addLoadedAssets(preloadAssets),this.captions.data=this.createCaptionDatas(),this.mediatorFactory=this.createMediatorFactory(),this.rootMediator=this.mediatorFactory.createMediator(MediatorID.ROOT,{parentView:this.display.stage,container:this.container})},Game.prototype._onUpdate=function(frameTime){this.rootMediator&&this.rootMediator.update(frameTime)},Game.prototype._onDestroy=function(){this.rootMediator&&(this.rootMediator.destroy(),this.rootMediator=null),this.mediatorFactory&&(this.mediatorFactory.destroy(),this.mediatorFactory=null),this.assetService&&(this.assetService.destroy(),this.assetService=null),this.preloadService.unload(this.preloadService.loadedAssets)},Game.prototype.createMediatorFactory=function(){return new MediatorFactory({assetService:this.assetService,preloadService:this.preloadService,sizeManager:this.size,loadConfig:this.config.load,layoutsConfig:this.config.layouts,dataConfig:this.config.data,springrollConfig:this.config.springroll})},Game.prototype.createCaptionDatas=function(){var captionDatas=this.config.data.mediator.captions,assetLoadDatas=this.config.load.arrayify(),voDatas=AssetLoadUtils.extractAllVODatas(assetLoadDatas);return CaptionUtils.convertCaptionIDs(captionDatas,voDatas)},Game}(BaseApp);app=AppHelper.createAndRun({class:Game,options:{name:"TPT - Motion",configPath:"assets/config/config.json",captions:document.getElementById("captions"),enableHiDPI:!0,audioTypes:["ogg","mp3"],displayOptions:{}}});var MediatorFactory=function(){function MediatorFactory(config){var _this=this;this.createRootMediator=function(args){var parentView=args.parentView,container=args.container,layoutConfig=_this.layoutsConfig.root,appVersion=_this.springrollConfig.version,playerProgressData=_this.dataConfig.sim.playerProgress,levelGraphData=_this.dataConfig.sim.levelGraph,maxLoadTimeout=_this.dataConfig.mediator.mediatorData.maxLoadTimeout,view=new RootView({parent:parentView,layoutConfig:layoutConfig});return new RootMediator({view:view,mediatorFactory:_this,container:container,appVersion:appVersion,playerProgressData:playerProgressData,levelGraphData:levelGraphData,maxLoadTimeout:maxLoadTimeout})},this.createSplashMediator=function(args){var view=new SplashView({layoutConfig:_this.layoutsConfig.splash});return new SplashMediator({view:view,playerProgress:_this.playerProgress})},this.createIntroMediator=function(args){var view=new IntroView({layoutConfig:_this.layoutsConfig.intro});return new IntroMediator({view:view,mediatorFactory:_this})},this.createLoadingMediator=function(args){var unloadAssetGroup=args.unloadAssetGroup,loadAssetGroup=args.loadAssetGroup,view=new LoadingView({layoutConfig:_this.layoutsConfig.common.loading});return new LoadingMediator({view:view,assetService:_this.assetService,preloadService:_this.preloadService,unloadAssetGroup:unloadAssetGroup,loadAssetGroup:loadAssetGroup})},this.createLocationSelectMediator=function(args){var layoutConfig=_this.layoutsConfig.locationSelect,locationDatas=_this.dataConfig.sim.levels,neighbourLocationGroupDatas=_this.dataConfig.sim.levelGraph.neighbourLocationGroups,view=new LocationSelectView({layoutConfig:layoutConfig});return new LocationSelectMediator({view:view,mediatorArgs:args,mediatorFactory:_this,locationDatas:locationDatas,neighbourLocationGroupDatas:neighbourLocationGroupDatas,playerProgress:_this.playerProgress,levelGraph:_this.levelGraph})},this.createLevelSelectMediator=function(args){var locationID=args.locationID,neighbourLocationGroupData=args.neighbourLocationGroupData,levelDatas=args.levelDatas,playerProgress=args.playerProgress,levelGraphNodes=args.levelGraphNodes,layoutConfig=_this.layoutsConfig.levelSelect,locationViewData=_this.dataConfig.view.locations[locationID],backgroundTextureName=locationViewData.backgroundTextureNames.levelSelect,enterVOName=_this.playerProgress.isNewGame()?"mapWelcome":locationViewData.enterVOName,view=new LevelSelectView({layoutConfig:layoutConfig}),timeoutVODelay=_this.dataConfig.view.viewData.levelSelectTimeoutVODelay,timeoutVOStateMachine=_this.createTimeoutVOStateMachine(view,null,timeoutVODelay);return new LevelSelectMediator({view:view,locationID:locationID,neighbourLocationGroupData:neighbourLocationGroupData,levelDatas:levelDatas,playerProgress:playerProgress,levelGraphNodes:levelGraphNodes,mediatorFactory:_this,backgroundTextureName:backgroundTextureName,enterVOName:enterVOName,timeoutVOStateMachine:timeoutVOStateMachine,getLevelObjectiveCompleteText:function(levelID){var levelData=_this.findLevelData(levelID);return levelData?levelData.objectiveCompleteText:null}})},this.createLocationButtonMediator=function(args){var targetLocationID=args.targetLocationID,position=args.position,isNextButton=args.isNextButton,locationViewData=_this.dataConfig.view.locations[targetLocationID],unlockLocationVOName=locationViewData.unlockLocationVOName,buttonConfigs=locationViewData.locationButtons,buttonConfig=isNextButton?buttonConfigs.next:buttonConfigs.previous;if(!buttonConfig)return null;var layoutConfig=_this.layoutsConfig.locationButton,view=new LocationButtonView({layoutConfig:layoutConfig});return new LocationButtonMediator({view:view,targetLocationID:targetLocationID,position:position,buttonConfig:buttonConfig,unlockLocationVOName:unlockLocationVOName})},this.createLevelButtonMediator=function(args){var levelType=args.levelType,state=args.state,levelNodeID=args.levelNodeID,position=args.position,layoutConfig=_this.layoutsConfig.levelButton,buttonState=_this.dataConfig.view.viewData.levelButtonStates[state],buttonViewConfigs=_this.dataConfig.view.gameModes[levelType].levelButton,view=new LevelButtonView({layoutConfig:layoutConfig});return new LevelButtonMediator({view:view,state:buttonState,buttonViewConfigs:buttonViewConfigs,levelNodeID:levelNodeID,position:position})},this.createLevelPathMediator=function(args){var layoutConfig=_this.layoutsConfig.levelPath,view=new LevelPathView({layoutConfig:layoutConfig});return new LevelPathMediator({view:view,texture:args.texture,points:args.points,position:args.position,sourceLevelNodeID:args.sourceLevelNodeID,targetLevelNodeID:args.targetLevelNodeID})},this.createTutorialHandMediator=function(args){var layoutConfig=_this.layoutsConfig.common.tutorialHand,view=new TutorialHandView({layoutConfig:layoutConfig});return new TutorialHandMediator(view)},this.createBuildBlocksGameMediator=function(args){var viewConfig=_this.createGameViewConfig(),view=new BuildBlocksGameView(viewConfig),mediatorConfig=_this.createGameMediatorConfig(MediatorID.BUILD_BLOCKS_GAME,view,args),gameMediator=new BuildBlocksGameMediator(view);return gameMediator.init(mediatorConfig),gameMediator},this.createRemoveBlocksGameMediator=function(args){var viewConfig=_this.createGameViewConfig(),view=new RemoveBlocksGameView(viewConfig),mediatorConfig=_this.createGameMediatorConfig(MediatorID.REMOVE_BLOCKS_GAME,view,args),gameMediator=new RemoveBlocksGameMediator(view);return gameMediator.init(mediatorConfig),gameMediator},this.createTutorialBuildBlocksGameMediator=function(args){var viewConfig=_this.createGameViewConfig(),view=new BuildBlocksGameView(viewConfig),mediatorConfig=_this.createGameMediatorConfig(MediatorID.TUTORIAL_BUILD_BLOCKS_GAME,view,args),gameMediator=new TutorialBuildBlocksGameMediator(view);return gameMediator.init(mediatorConfig),gameMediator},this.createTutorialRemoveBlocksGameMediator=function(args){var viewConfig=_this.createGameViewConfig(),view=new RemoveBlocksGameView(viewConfig),mediatorConfig=_this.createGameMediatorConfig(MediatorID.TUTORIAL_REMOVE_BLOCKS_GAME,view,args),gameMediator=new TutorialRemoveBlocksGameMediator(view);return gameMediator.init(mediatorConfig),gameMediator},this.createPhysicsDebugMediator=function(args){var viewConfig=args.viewConfig,compositeBody=args.compositeBody,view=new PhysicsDebugView(viewConfig);return new PhysicsDebugMediator({view:view,compositeBody:compositeBody})},this.createDebugLevelSelectCheatsMediator=function(args){var levelGraphNodes=args.levelGraphNodes,view=new View;return new DebugLevelSelectCheatsMediator({view:view,playerProgress:_this.playerProgress,levelGraphNodes:levelGraphNodes})},this.createDebugGameCheatsMediator=function(args){var physicsDebugView=args.physicsDebugView,shelf=args.shelf,view=new View;return new DebugGameCheatsMediator({view:view,physicsDebugView:physicsDebugView,shelf:shelf})},this.createWorkspaceMediator=function(args){var shapeDatas=args.shapeDatas,staticShapeDatas=args.staticShapeDatas,dynamicShapeDatas=args.dynamicShapeDatas,destinationShapeDatas=args.destinationShapeDatas,shapeMediatorID=args.shapeMediatorID,matterEngine=args.matterEngine,workspaceData=_this.dataConfig.sim.game.workspace,compositeBody=matterEngine.world,layoutConfig=_this.layoutsConfig.gameViews.workspace,bodyDatas=_this.dataConfig.sim.physicsShapes,workspace=new Workspace({data:workspaceData,matterEngine:matterEngine,parentComposite:compositeBody}),view=new WorkspaceView({layoutConfig:layoutConfig}),shapeFactory=new ShapeFactory({bodyDatas:bodyDatas});return new WorkspaceMediator({view:view,workspace:workspace,mediatorFactory:_this,shapeFactory:shapeFactory,shapeDatas:shapeDatas,staticShapeDatas:staticShapeDatas,dynamicShapeDatas:dynamicShapeDatas,destinationShapeDatas:destinationShapeDatas,shapeMediatorID:shapeMediatorID})},this.createShapeMediator=function(args){var shape=args.shape,parentView=args.parentView,shapeTextureNames=_this.dataConfig.view.shapeTextureNames[shape.getType()],textureName=shapeTextureNames?shapeTextureNames.static:null,invalidTextureName=shapeTextureNames?shapeTextureNames.overlap:null,rotationStepDegrees=_this.dataConfig.view.viewData.shapeRotationStepDegrees,layoutConfig=_this.layoutsConfig.gameViews.shape,shapeView=new ShapeView({parent:parentView,layoutConfig:layoutConfig});return new ShapeMediator({view:shapeView,shape:shape,textureName:textureName,invalidTextureName:invalidTextureName,rotationStepDegrees:rotationStepDegrees})},this.createBuildShapeMediator=function(args){var shape=args.shape,parentView=args.parentView,parentComposite=args.parentComposite,dragEvent=args.dragEvent,shapeTextureNames=_this.dataConfig.view.shapeTextureNames[shape.getType()],textureName=shapeTextureNames?shapeTextureNames.shelf:null,invalidTextureName=shapeTextureNames?shapeTextureNames.overlap:null,rotationStepDegrees=_this.dataConfig.view.viewData.shapeRotationStepDegrees,layoutConfig=_this.layoutsConfig.gameViews.shape,shapeView=new ShapeView({parent:parentView,layoutConfig:layoutConfig});return new BuildShapeMediator({view:shapeView,shape:shape,parentComposite:parentComposite,textureName:textureName,invalidTextureName:invalidTextureName,rotationStepDegrees:rotationStepDegrees,dragEvent:dragEvent})},this.createRemoveShapeMediator=function(args){var shape=args.shape,parentView=args.parentView,shapeTextureNames=_this.dataConfig.view.shapeTextureNames[shape.getType()],textureName=shapeTextureNames?shapeTextureNames.shelf:null,invalidTextureName=shapeTextureNames?shapeTextureNames.overlap:null,rotationStepDegrees=_this.dataConfig.view.viewData.shapeRotationStepDegrees,layoutConfig=_this.layoutsConfig.gameViews.shape,shapeView=new ShapeView({parent:parentView,layoutConfig:layoutConfig});return new RemoveShapeMediator({view:shapeView,shape:shape,textureName:textureName,invalidTextureName:invalidTextureName,rotationStepDegrees:rotationStepDegrees})},this.createDestinationShapeMediator=function(args){var shape=args.shape,parentView=args.parentView,shapeTextureNames=_this.dataConfig.view.shapeTextureNames[shape.getType()],textureName=shapeTextureNames?shapeTextureNames.outline:null,rotationStepDegrees=_this.dataConfig.view.viewData.shapeRotationStepDegrees,layoutConfig=_this.layoutsConfig.gameViews.shape,shapeView=new ShapeView({parent:parentView,layoutConfig:layoutConfig});return new DestinationShapeMediator({view:shapeView,shape:shape,textureName:textureName,invalidTextureName:null,rotationStepDegrees:rotationStepDegrees})},this.createShelfMediator=function(args){var slotDatas=args.slotDatas,layoutConfig=_this.layoutsConfig.gameViews.shelf,shelf=new Shelf(slotDatas),view=new ShelfView({layoutConfig:layoutConfig});return new ShelfMediator({view:view,shelf:shelf,mediatorFactory:_this})},this.createShelfSlotMediator=function(args){var slot=args.slot,layoutConfig=_this.layoutsConfig.gameViews.shelfSlot,slotPosition=_this.dataConfig.view.viewData.slotPositions[slot.getID()],shapeType=slot.getShapeType(),shapeTextureNames=_this.dataConfig.view.shapeTextureNames[shapeType],shapeTextureName=shapeTextureNames?shapeTextureNames.shelf:null,shapeBodyData=_this.dataConfig.sim.physicsShapes[shapeType],shapeAnchor=shapeBodyData?shapeBodyData.transform.anchor:null,slotView=new ShelfSlotView({layoutConfig:layoutConfig});return new ShelfSlotMediator({view:slotView,slot:slot,position:slotPosition,shapeTextureName:shapeTextureName,shapeAnchor:shapeAnchor})},this.createTimerButtonMediator=function(args){var view=new TimerButtonView;return new TimerButtonMediator(view)},this.createGravityButtonMediator=function(args){var view=new GravityButtonView,animationData=_this.dataConfig.view.gravityButton.animationData,stateData=_this.dataConfig.mediator.gravityButton.stateData;return new GravityButtonMediator({view:view,animationData:animationData,stateData:stateData})},this.createChuteMediator=function(args){var numberOfShapesToWin=args.numberOfShapesToWin,layoutConfig=_this.layoutsConfig.gameViews.chute,shapeTextureNames=_this.dataConfig.view.shapeTextureNames,particlesConfig=_this.dataConfig.view.particles.chuteShred,chuteTextureNameIndex=numberOfShapesToWin-1,progressBarFrontTextureName=_this.dataConfig.view.viewData.chuteProgressFrontTextureNames[chuteTextureNameIndex],progressBarMediator=_this.createMediator(MediatorID.CHUTE_PROGRESS_BAR,{progressBarFrontTextureName:progressBarFrontTextureName}),view=new ChuteView({layoutConfig:layoutConfig,shredParticleConfig:particlesConfig});return new ChuteMediator({view:view,shapeTextureNames:shapeTextureNames,progressBarMediator:progressBarMediator})},this.createChuteProgressBarMediator=function(args){var progressBarFrontTextureName=args.progressBarFrontTextureName,layoutConfig=_this.layoutsConfig.gameViews.chuteProgressBar,view=new ChuteProgressBarView({layoutConfig:layoutConfig});return new ChuteProgressBarMediator({view:view,progressBarFrontTextureName:progressBarFrontTextureName})},this.createRoofReleaseMediator=function(args){var layoutConfig=_this.layoutsConfig.gameViews.roofRelease,roofShape=args.roofShape,droneAnimationNames=_this.dataConfig.view.viewData.droneAnimationNames,view=new RoofReleaseView({layoutConfig:layoutConfig});return new RoofReleaseMediator({view:view,roofShape:roofShape,droneAnimationNames:droneAnimationNames})},this.createTestingIndicatorMediator=function(args){var layoutConfig=_this.layoutsConfig.gameViews.testingIndicator,view=new TestingIndicatorView({layoutConfig:layoutConfig});return new TestingIndicatorMediator(view)},this.createFurBlurMediator=function(args){var layoutConfig=_this.layoutsConfig.gameViews.furBlur,yPos=_this.sizeManager.maxHeight+10,xPosRange=MinMax.from(_this.dataConfig.view.viewData.furBlurXPosRange),view=new FurBlurView({layoutConfig:layoutConfig});return new FurBlurMediator({view:view,yPos:yPos,xPosRange:xPosRange})},this.createDialogHolderMediator=function(args){var layoutConfig=_this.layoutsConfig.dialogViews.dialogHolder,view=new DialogHolderView({layoutConfig:layoutConfig});return new DialogHolderMediator(view)},this.createResultsDialogMediator=function(args){var onClosed=args.onClosed,layoutConfig=_this.layoutsConfig.dialogViews.resultsDialog,animNames=_this.dataConfig.view.viewData.resultsDialogAnimationNames,view=new ResultsDialogView({layoutConfig:layoutConfig,soundName:"Fanfare"});return new ResultsDialogMediator({view:view,animNames:animNames,onClosed:onClosed})},this.createLastLevelCompleteDialogMediator=function(args){var promptTextureName=_this.dataConfig.view.viewData.timeoutDialogPromptTextureNames[MediatorID.LAST_LEVEL_COMPLETE_DIALOG],animNames=_this.dataConfig.view.viewData.timeoutDialogAnimationNames[MediatorID.LAST_LEVEL_COMPLETE_DIALOG],finalArgs=Object.extend({promptTextureName:promptTextureName,animNames:animNames,soundName:"Fanfare"},args);return _this.createTimeoutDialogMediator(finalArgs)},this.createGameCompleteDialogMediator=function(args){var promptTextureName=_this.dataConfig.view.viewData.timeoutDialogPromptTextureNames[MediatorID.GAME_COMPLETE_DIALOG],animNames=_this.dataConfig.view.viewData.timeoutDialogAnimationNames[MediatorID.GAME_COMPLETE_DIALOG],particlesConfig=_this.dataConfig.view.particles.allLevelsComplete,shapeTextureNames=_this.dataConfig.view.shapeTextureNames,particleTextureNames=Object.keys(shapeTextureNames).map(function(element){return shapeTextureNames[element].shredParticle}).filter(function(textureName){return!!textureName}),finalArgs=Object.extend({promptTextureName:promptTextureName,animNames:animNames,particlesConfig:particlesConfig,particleTextureNames:particleTextureNames,soundName:"gameFinished"},args);return _this.createTimeoutDialogMediator(finalArgs)},this.createTimeoutDialogMediator=function(args){var promptTextureName=args.promptTextureName,soundName=args.soundName,animNames=args.animNames,particlesConfig=args.particlesConfig,particleTextureNames=args.particleTextureNames||[],layoutConfig=_this.layoutsConfig.dialogViews.timeoutDialog,view=new TimeoutDialogView({layoutConfig:layoutConfig,soundName:soundName});return new TimeoutDialogMediator({view:view,animNames:animNames,promptTextureName:promptTextureName,particlesConfig:particlesConfig,particleTextureNames:particleTextureNames})},this.createYesNoDialogMediator=function(args){var yesButtonPressed=args.yesButtonPressed,layoutConfig=_this.layoutsConfig.dialogViews.yesNoDialog,promptTextureName=args.promptTextureName,view=new YesNoDialogView({layoutConfig:layoutConfig});return new YesNoDialogMediator({view:view,yesButtonPressed:yesButtonPressed,promptTextureName:promptTextureName})},this.createRestartLevelDialogMediator=function(args){var promptTextureName=_this.dataConfig.view.viewData.yesNoDialogPromptTextureNames[MediatorID.RESTART_LEVEL_DIALOG],extendedArgs=Object.extend(args,{promptTextureName:promptTextureName});return _this.createYesNoDialogMediator(extendedArgs)},this.createLeaveLevelDialogMediator=function(args){var promptTextureName=_this.dataConfig.view.viewData.yesNoDialogPromptTextureNames[MediatorID.LEAVE_LEVEL_DIALOG],extendedArgs=Object.extend(args,{promptTextureName:promptTextureName});return _this.createYesNoDialogMediator(extendedArgs)},this.assetService=config.assetService,this.preloadService=config.preloadService,this.sizeManager=config.sizeManager,this.loadConfig=config.loadConfig,this.layoutsConfig=config.layoutsConfig,this.dataConfig=config.dataConfig,this.springrollConfig=config.springrollConfig,this.playerProgress=null,this.levelGraph=null,this.creators={},this.creators[MediatorID.ROOT]=this.createRootMediator,this.creators[MediatorID.SPLASH]=this.createSplashMediator,this.creators[MediatorID.INTRO]=this.createIntroMediator,this.creators[MediatorID.LOADING]=this.createLoadingMediator,this.creators[MediatorID.LOCATION_SELECT]=this.createLocationSelectMediator,this.creators[MediatorID.LEVEL_SELECT]=this.createLevelSelectMediator,this.creators[MediatorID.LOCATION_BUTTON]=this.createLocationButtonMediator,this.creators[MediatorID.LEVEL_BUTTON]=this.createLevelButtonMediator,this.creators[MediatorID.LEVEL_PATH]=this.createLevelPathMediator,this.creators[MediatorID.TUTORIAL_HAND]=this.createTutorialHandMediator,this.creators[MediatorID.BUILD_BLOCKS_GAME]=this.createBuildBlocksGameMediator,this.creators[MediatorID.REMOVE_BLOCKS_GAME]=this.createRemoveBlocksGameMediator,this.creators[MediatorID.TUTORIAL_BUILD_BLOCKS_GAME]=this.createTutorialBuildBlocksGameMediator,this.creators[MediatorID.TUTORIAL_REMOVE_BLOCKS_GAME]=this.createTutorialRemoveBlocksGameMediator,this.creators[MediatorID.PHYSICS_DEBUG]=this.createPhysicsDebugMediator,this.creators[MediatorID.DEBUG_LEVEL_SELECT_CHEATS]=this.createDebugLevelSelectCheatsMediator,this.creators[MediatorID.DEBUG_GAME_CHEATS]=this.createDebugGameCheatsMediator,this.creators[MediatorID.WORKSPACE]=this.createWorkspaceMediator,this.creators[MediatorID.SHAPE]=this.createShapeMediator,this.creators[MediatorID.BUILD_SHAPE]=this.createBuildShapeMediator,this.creators[MediatorID.REMOVE_SHAPE]=this.createRemoveShapeMediator,this.creators[MediatorID.DESTINATION_SHAPE]=this.createDestinationShapeMediator,this.creators[MediatorID.SHELF]=this.createShelfMediator,this.creators[MediatorID.SHELF_SLOT]=this.createShelfSlotMediator,this.creators[MediatorID.TIMER_BUTTON]=this.createTimerButtonMediator,this.creators[MediatorID.GRAVITY_BUTTON]=this.createGravityButtonMediator,this.creators[MediatorID.CHUTE]=this.createChuteMediator,this.creators[MediatorID.CHUTE_PROGRESS_BAR]=this.createChuteProgressBarMediator,this.creators[MediatorID.ROOF_RELEASE]=this.createRoofReleaseMediator,this.creators[MediatorID.FUR_BLUR]=this.createFurBlurMediator,this.creators[MediatorID.TESTING_INDICATOR]=this.createTestingIndicatorMediator,this.creators[MediatorID.DIALOG_HOLDER]=this.createDialogHolderMediator,this.creators[MediatorID.RESULTS_DIALOG]=this.createResultsDialogMediator,this.creators[MediatorID.TIMEOUT_DIALOG]=this.createTimeoutDialogMediator,this.creators[MediatorID.LAST_LEVEL_COMPLETE_DIALOG]=this.createLastLevelCompleteDialogMediator,this.creators[MediatorID.GAME_COMPLETE_DIALOG]=this.createGameCompleteDialogMediator,this.creators[MediatorID.RESTART_LEVEL_DIALOG]=this.createRestartLevelDialogMediator,this.creators[MediatorID.LEAVE_LEVEL_DIALOG]=this.createLeaveLevelDialogMediator}return MediatorFactory.prototype.destroy=function(){this.springrollConfig=null,this.dataConfig=null,this.layoutsConfig=null,this.loadConfig=null,this.sizeManager=null,this.preloadService=null,this.assetService=null,this.playerProgress=null,this.levelGraph=null,this.creators=null},MediatorFactory.prototype.setPlayerProgress=function(playerProgress){this.playerProgress=playerProgress},MediatorFactory.prototype.setLevelGraph=function(levelGraph){this.levelGraph=levelGraph},MediatorFactory.prototype.createMediator=function(mediatorID,args){args=args||{};var mediatorCreator=this.creators[mediatorID];return mediatorCreator?mediatorCreator(args):null},MediatorFactory.prototype.createMediatorAsDialog=function(mediatorID,args){return this.createMediator(mediatorID,args)},MediatorFactory.prototype.createLevelButtonCreatorConfig=function(levelGraphNode,levelDatas,levelProgresses){return{levelNodeID:levelGraphNode.getID(),levelType:levelDatas[levelGraphNode.getLevelID()].type,state:levelProgresses.find(function(levelProgress){return levelProgress.getNodeID()==levelGraphNode.getID()}).getState(),position:levelGraphNode.getPosition()}},MediatorFactory.prototype.createGameViewConfig=function(){return{layoutConfig:this.layoutsConfig.game,actionData:this.dataConfig.view.viewData.gameActions}},MediatorFactory.prototype.createGameMediatorConfig=function(mediatorID,view,args){var locationID=args.locationID,levelID=args.levelID,levelData=args.levelData,previousMediatorID=args.previousMediatorID,levelProgress=args.levelProgress,levelContentData=levelData.content,levelTutorialStepIDs=levelData.tutorialStepIDs,tutorialHandlerConfig=this.createTutorialHandlerConfig(levelTutorialStepIDs),tutorialStepDatas=this.dataConfig.sim.tutorialSteps,backgroundTextureName=this.dataConfig.view.locations[locationID].backgroundTextureNames.game,gameModeTextureName=this.dataConfig.view.gameModes[levelData.type].labelTextureName,maxSimulationTimeout=levelData.maxSimulationTimeout||this.dataConfig.sim.game.maxSimulationTimeout,returnShapeToSlotTime=this.dataConfig.view.viewData.returnShapeToSlotTime,maxRemoveShapes=this.dataConfig.sim.game.maxRemoveShapes,hasTutorial=!!levelTutorialStepIDs,timeoutVODelay=this.dataConfig.view.viewData.gameTimeoutVODelay,timeoutVOStateMachine=hasTutorial?null:this.createTimeoutVOStateMachine(view,levelData.type,timeoutVODelay);return{currentMediatorID:mediatorID,currentMediatorArgs:args,previousMediatorID:previousMediatorID,mediatorFactory:this,levelProgress:levelProgress,locationID:locationID,levelID:levelID,levelContentData:levelContentData,tutorialHandlerConfig:tutorialHandlerConfig,tutorialStepDatas:tutorialStepDatas,timeoutVOStateMachine:timeoutVOStateMachine,backgroundTextureName:backgroundTextureName,gameModeTextureName:gameModeTextureName,maxSimulationTimeout:maxSimulationTimeout,returnShapeToSlotTime:returnShapeToSlotTime,maxRemoveShapes:maxRemoveShapes,gameVOData:hasTutorial?null:this.dataConfig.view.gameModes[levelData.type].voNames}},MediatorFactory.prototype.createTutorialHandlerConfig=function(levelStepIDs){var config=null;if(levelStepIDs){var stepDatas=this.dataConfig.sim.tutorialSteps;config={tutorial:new Tutorial({stepDatas:stepDatas,levelStepIDs:levelStepIDs}),betweenVODelay:this.dataConfig.view.viewData.betweenVODelay,timeoutVODelay:this.dataConfig.view.viewData.gameTimeoutVODelay,stepHandlerFactory:null,tutorialBoxMediator:null,onFinished:null}}return config},MediatorFactory.prototype.createTimeoutVOStateMachine=function(view,levelType,timeoutVODelay){var editingVONames=levelType?this.dataConfig.view.gameModes[levelType].voNames.editing:null;return new TimeoutVOStateMachine({view:view,timeoutVODelay:timeoutVODelay,editingVONames:editingVONames})},MediatorFactory.prototype.findLevelData=function(levelID){var levels=this.dataConfig.sim.levels,locationID=Object.keys(levels).find(function(locationID){return!!levels[locationID][levelID]});return locationID?levels[locationID][levelID]:null},MediatorFactory}(),LoadingMediator=function(_super){function LoadingMediator(config){var _this=_super.call(this,config.view)||this;return _this.loadProgressChanged=function(progress){console.log("Loading game assets: "+100*progress+"%"),_this.view.updateProgress(progress)},_this.assetService=config.assetService,_this.preloadService=config.preloadService,_this}return __extends(LoadingMediator,_super),LoadingMediator.prototype.destroy=function(){this.assetService=null,this.preloadService=null,_super.prototype.destroy.call(this)},LoadingMediator.prototype.startLoading=function(unloadMediatorID,loadMediatorID,finishedCallback){if(this.assetService.hasAssetGroup(unloadMediatorID)){var assetToUnload=this.assetService.getAssetGroup(unloadMediatorID);this.preloadService.unload(assetToUnload)}if(this.assetService.hasAssetGroup(loadMediatorID)){this.view.show();var loadAssets=this.assetService.getAssetGroup(loadMediatorID);this.preloadService.load(loadAssets,{progress:this.loadProgressChanged,complete:finishedCallback})}else finishedCallback()},LoadingMediator.prototype.hide=function(){this.view.hide()},LoadingMediator}(Mediator),AssetService=function(){function AssetService(config){this.assetLists=this.createAssetListsFromConfigs(config.assetConfigs,config.preloadService),this.assetGroups={}}return AssetService.prototype.destroy=function(){this.assetLists=null,this.assetGroups=null},AssetService.prototype.getAssetList=function(listName){return this.assetLists[listName]||[]},AssetService.prototype.createAssetGroup=function(groupName,assetListNames){var _this=this,assetLists=assetListNames.map(function(assetListName){return _this.getAssetList(assetListName)}),assetGroup=Array.prototype.concat.apply([],assetLists);return this.assetGroups[groupName]=assetGroup},AssetService.prototype.getAssetGroup=function(groupName){return this.assetGroups[groupName]||[]},AssetService.prototype.hasAssetGroup=function(groupName){return!!this.assetGroups[groupName]},AssetService.prototype.removeAssetGroup=function(groupName){this.hasAssetGroup(groupName)&&delete this.assetGroups[groupName]},AssetService.prototype.createAssetListsFromConfigs=function(loadConfigs,preloadService){var _this=this;return loadConfigs.map(function(loadConfig){return _this.createAssetList(loadConfig,preloadService)})},AssetService.prototype.createAssetList=function(loadConfig,preloadService){return preloadService.concat([],loadConfig.assets,loadConfig.sounds)},AssetService}(),LoopedSound=function(){function LoopedSound(){this.soundInstance=null,this.muteTimeout=null}return LoopedSound.prototype.destroy=function(){this.muteTimeout&&(this.muteTimeout.destroy(),this.muteTimeout=null),this.stop()},LoopedSound.prototype.start=function(soundName){this.stop(),this.soundInstance=app.sound.play(soundName,{loop:!0})},LoopedSound.prototype.stop=function(){this.soundInstance&&(this.soundInstance.stop(),this.soundInstance=null)},LoopedSound.prototype.resetVolume=function(){var _this=this;this.muteTimeout||(this.muteTimeout=this.createTimeout(function(){_this.setSoundVolume(0)})),this.muteTimeout.restart(),this.setSoundVolume(1)},LoopedSound.prototype.setSoundVolume=function(volume){this.soundInstance&&(this.soundInstance.volume=volume)},LoopedSound.prototype.createTimeout=function(finishedCallback){return new DelayedCall(finishedCallback,50,!1,!1)},LoopedSound}(),TimeoutVOStateMachine=function(){function TimeoutVOStateMachine(config){var _this=this;this.getLevelSelectVOName=function(){return"chooseLevel"},this.getEditingVOName=function(){return _this.editingVONames.random()},this.getEditingShapesOverlappingVOName=function(){return"shapesOverlapping"},this.getDraggingVOName=function(){return null},this.getSimulationRunningVOName=function(){return null},this.getSimulationFailVOName=function(){return"onboardingUndoRepeat"},this.getSimulationSuccessVOName=function(){return null},this.getReadyToDropRoofVOName=function(){return"onboardingRoofRepeat"},this.getLevelCompletedVOName=function(){return null},this.view=config.view,this.timeoutVODelay=config.timeoutVODelay,this.editingVONames=config.editingVONames,this.timeoutVOAction=null,this.stateVOName={},this.stateVOName[GameState.LEVEL_SELECT]=this.getLevelSelectVOName,this.stateVOName[GameState.EDITING]=this.getEditingVOName,this.stateVOName[GameState.EDITING_SHAPES_OVERLAPPING]=this.getEditingShapesOverlappingVOName,this.stateVOName[GameState.DRAGGING]=this.getDraggingVOName,this.stateVOName[GameState.SIMULATION_RUNNING]=this.getSimulationRunningVOName,this.stateVOName[GameState.SIMULATION_FAIL]=this.getSimulationFailVOName,this.stateVOName[GameState.SIMULATION_SUCCESS]=this.getSimulationSuccessVOName,this.stateVOName[GameState.READY_TO_DROP_ROOF]=this.getReadyToDropRoofVOName,this.stateVOName[GameState.LEVEL_COMPLETED]=this.getLevelCompletedVOName}return TimeoutVOStateMachine.prototype.destroy=function(){this.view=null,this.editingVONames=null,this.timeoutVOAction=null,this.stateVOName=null},TimeoutVOStateMachine.prototype.setState=function(state){this.stopTimeoutVO();var voName=this.getStateVOName(state);voName&&this.startTimeoutVO(voName)},TimeoutVOStateMachine.prototype.getStateVOName=function(state){var voNameFunc=this.stateVOName[state];return voNameFunc?voNameFunc():null},TimeoutVOStateMachine.prototype.startTimeoutVO=function(voName){var _this=this;this.timeoutVOAction=this.createTimeoutVOAction(voName),this.view.runAction(this.timeoutVOAction,function(){_this.timeoutVOAction=null})},TimeoutVOStateMachine.prototype.stopTimeoutVO=function(){this.timeoutVOAction&&this.view.cancelAction(this.timeoutVOAction)},TimeoutVOStateMachine.prototype.createTimeoutVOAction=function(voName){return Actions.Repeat(Actions.Sequence([Actions.Delay(this.timeoutVODelay),Actions.VO(voName)]))},TimeoutVOStateMachine}(),TutorialStepHandlerFactory=function(_super){function TutorialStepHandlerFactory(config){var _this=_super.call(this)||this;return _this.stepHandlerConfig=config.stepHandlerConfig,_this.addCreatorFuncs(config.stepDatas),_this}return __extends(TutorialStepHandlerFactory,_super),TutorialStepHandlerFactory.prototype.destroy=function(){this.stepHandlerConfig=null},TutorialStepHandlerFactory.prototype.createStepHandler=function(stepID){var stepHandlerCreator=this._creators[stepID];return stepHandlerCreator?stepHandlerCreator(this.stepHandlerConfig):null},TutorialStepHandlerFactory.prototype.addCreatorFuncs=function(stepDatas){var _this=this;stepDatas.forEach(function(stepData){var creatorFunc=_this.createHandlerCreatorFunc(stepData.handlerClassName);creatorFunc&&_this.registerCreator(stepData.id,creatorFunc)})},TutorialStepHandlerFactory.prototype.createHandlerCreatorFunc=function(className){return className?this.defaultCreator(include(className)):null},TutorialStepHandlerFactory}(BaseFactory),OnboardingBuildShelfStepHandler=function(_super){function OnboardingBuildShelfStepHandler(config){return _super.call(this,config)||this}return __extends(OnboardingBuildShelfStepHandler,_super),OnboardingBuildShelfStepHandler.prototype.destroy=function(){_super.prototype.destroy.call(this)},OnboardingBuildShelfStepHandler.prototype.enter=function(args){this.shelfMediator.createSlots(this.slotDatas),this.shelfMediator.showOutline(),this.shelfMediator.getShelf().setEnabled(!1)},OnboardingBuildShelfStepHandler.prototype.exit=function(){this.shelfMediator.getShelf().setEnabled(!0),this.shelfMediator.hideOutline(),this.slotDatas=null},OnboardingBuildShelfStepHandler}(BuildTutorialStepHandler),OnboardingDragBlockStepHandler=function(_super){function OnboardingDragBlockStepHandler(config){var _this=_super.call(this,config)||this;return _this.shapeDragStarted=function(args){_this.stopHandAnimation(),_this.gravityButtonMediator.enable(!1)},_this.shapeDragEnded=function(args){var draggedShape=args.shape;_this.shelfMediator.setEnabled(!0);var shapeIsInSlot=_this.shapeIsInSlot(draggedShape);if(_this.sendToParentMediator(TelemetryEventType.PLACED_OBJECT,{shapeType:draggedShape.getType(),position:draggedShape.getPosition(),isValid:shapeIsInSlot}),shapeIsInSlot){draggedShape.setID(_this.newShapeID);var destinationShape=_this.destShapeMediator.getShape();_this.placeShapeAtDestination(draggedShape,destinationShape),_this.sendTutorialHandlerEvent(MediatorEvent.SHAPE_DRAGGED_IN_DESTINATION)}else _this.returnShapeToShelf(draggedShape,function(){_this.start()})},_this.shapeCollidingChanged=function(args){_this.gravityButtonMediator.enable(!1)},_this.eventHandlers={},_this.eventHandlers[MediatorEvent.SLOT_SHAPE_DRAG_STARTED]=_this.shapeDragStarted,_this.eventHandlers[MediatorEvent.SHAPE_DRAG_STARTED]=_this.shapeDragStarted,_this.eventHandlers[MediatorEvent.SHAPE_DRAG_ENDED]=_this.shapeDragEnded,_this.eventHandlers[MediatorEvent.SHAPES_COLLIDING_CHANGED]=_this.shapeCollidingChanged,_this}return __extends(OnboardingDragBlockStepHandler,_super),OnboardingDragBlockStepHandler.prototype.destroy=function(){this.eventHandlers={},_super.prototype.destroy.call(this)},OnboardingDragBlockStepHandler.prototype.enter=function(args){var destinationShapeID=args.destinationShapeID,newShapeID=args.newShapeID,shapePositionThreshold=args.shapePositionThreshold,shapeRotationThreshold=args.shapeRotationThreshold;this.destShapeMediator=this.workspaceMediator.getShapeMediatorByID(destinationShapeID),this.newShapeID=newShapeID,this.shapePositionThreshold=shapePositionThreshold,this.shapeRotationThreshold=shapeRotationThreshold;var destinationShape=this.destShapeMediator.getShape();this.slotMediator=this.shelfMediator.getSlotMediatorForShapeType(destinationShape.getType()),destinationShape.setShow(!0),this.start()},OnboardingDragBlockStepHandler.prototype.exit=function(){this.stop(),this.destShapeMediator.getShape().setShow(!1),this.slotMediator=null,this.destShapeMediator=null},OnboardingDragBlockStepHandler.prototype.handleEvent=function(eventName,args){var eventHandler=this.eventHandlers[eventName];eventHandler&&eventHandler(args)},OnboardingDragBlockStepHandler.prototype.start=function(){var destinationShape=this.destShapeMediator.getShape();this.shelfMediator.enableSlotsWithShapeTypes([destinationShape.getType()]),this.gravityButtonMediator.enable(!1),this.startHandAnimation()},OnboardingDragBlockStepHandler.prototype.stop=function(){this.shelfMediator.getShelf().setEnabled(!1),this.gravityButtonMediator.enable(!0),this.stopHandAnimation()},OnboardingDragBlockStepHandler.prototype.startHandAnimation=function(){var dragStartTarget=this.slotMediator.view,dragEndTarget=this.destShapeMediator.view;this.tutorialHandMediator.showAtTarget(dragStartTarget,0),this.tutorialHandMediator.dragToTarget(dragEndTarget,0),this.tutorialHandMediator.wait(1)},OnboardingDragBlockStepHandler.prototype.stopHandAnimation=function(){this.tutorialHandMediator.hide()},OnboardingDragBlockStepHandler.prototype.shapeIsInSlot=function(shape){var destinationShape=this.destShapeMediator.getShape(),shapePlacedAtDestination=destinationShape.matchesTransform(shape,this.shapePositionThreshold,this.shapeRotationThreshold),isCorrectShapeType=shape.getType()==destinationShape.getType();return shapePlacedAtDestination&&isCorrectShapeType},OnboardingDragBlockStepHandler.prototype.placeShapeAtDestination=function(shape,destinationShape){shape.copyTransform(destinationShape),shape.setEnabled(!1),shape.setEditable(!1)},OnboardingDragBlockStepHandler}(BuildTutorialStepHandler),OnboardingHelpStepHandler=function(_super){function OnboardingHelpStepHandler(config){return _super.call(this,config)||this}return __extends(OnboardingHelpStepHandler,_super),OnboardingHelpStepHandler.prototype.destroy=function(){_super.prototype.destroy.call(this)},OnboardingHelpStepHandler.prototype.enter=function(args){this.gravityButtonMediator.enable(!1)},OnboardingHelpStepHandler.prototype.exit=function(){this.gravityButtonMediator.enable(!0),this.furBlurMediator.hide()},OnboardingHelpStepHandler}(TutorialStepHandler),OnboardingLastBlockStepHandler=function(_super){function OnboardingLastBlockStepHandler(config){return _super.call(this,config)||this}return __extends(OnboardingLastBlockStepHandler,_super),OnboardingLastBlockStepHandler.prototype.destroy=function(){_super.prototype.destroy.call(this)},OnboardingLastBlockStepHandler.prototype.enter=function(args){this.shelfMediator.getShelf().setEnabled(!1),this.gravityButtonMediator.enable(!1)},OnboardingLastBlockStepHandler.prototype.exit=function(){this.gravityButtonMediator.enable(!0),this.shelfMediator.getShelf().setEnabled(!0)},OnboardingLastBlockStepHandler}(BuildTutorialStepHandler),OnboardingMulcherStepHandler=function(_super){function OnboardingMulcherStepHandler(config){return _super.call(this,config)||this}return __extends(OnboardingMulcherStepHandler,_super),OnboardingMulcherStepHandler.prototype.destroy=function(){_super.prototype.destroy.call(this)},OnboardingMulcherStepHandler.prototype.enter=function(args){this.gravityButtonMediator.enable(!1),this.startHandAnimation()},OnboardingMulcherStepHandler.prototype.exit=function(){this.stopHandAnimation()},OnboardingMulcherStepHandler.prototype.startHandAnimation=function(){var target=this.progressBarMediator.view,yOffset=this.getPointAtYOffset(),targetOffset=Vector.create(0,yOffset);this.tutorialHandMediator.showAtTarget(target,-2.5,targetOffset),this.tutorialHandMediator.pointAtTarget(target,-2.5,targetOffset)},OnboardingMulcherStepHandler.prototype.stopHandAnimation=function(){this.tutorialHandMediator.hide()},OnboardingMulcherStepHandler.prototype.getPointAtYOffset=function(){return-(this.progressBarMediator.getHeight()+15)},OnboardingMulcherStepHandler}(RemoveTutorialStepHandler),OnboardingRemoveStepHandler=function(_super){function OnboardingRemoveStepHandler(config){return _super.call(this,config)||this}return __extends(OnboardingRemoveStepHandler,_super),OnboardingRemoveStepHandler.prototype.destroy=function(){_super.prototype.destroy.call(this)},OnboardingRemoveStepHandler.prototype.enter=function(args){var targetShapeID=args.shapeID,destinationShapeMediator=this.workspaceMediator.getShapeMediatorByID(targetShapeID);destinationShapeMediator.getShape().setEnabled(!0);var target=destinationShapeMediator.view;this.tutorialHandMediator.showAtTarget(target,0,Vector.create(50,-20)),this.tutorialHandMediator.moveToTarget(target,0,1),this.tutorialHandMediator.tap(),this.tutorialHandMediator.wait(1)},OnboardingRemoveStepHandler.prototype.exit=function(){this.tutorialHandMediator.hide()},OnboardingRemoveStepHandler}(TutorialStepHandler),OnboardingRoofStepHandler=function(_super){function OnboardingRoofStepHandler(config){return _super.call(this,config)||this}return __extends(OnboardingRoofStepHandler,_super),OnboardingRoofStepHandler.prototype.destroy=function(){_super.prototype.destroy.call(this)},OnboardingRoofStepHandler.prototype.enter=function(args){this.roofReleaseMediator.activateRoof(!0);var target=this.workspaceMediator.getShapeMediatorByID(ShapeID.ROOF).view;this.tutorialHandMediator.showAtTarget(target,0,Vector.create(90,80)),this.tutorialHandMediator.moveToTarget(target,0,1),this.tutorialHandMediator.tap(),this.tutorialHandMediator.wait(1),this.gravityButtonMediator.enable(!1)},OnboardingRoofStepHandler.prototype.exit=function(){this.tutorialHandMediator.hide()},OnboardingRoofStepHandler}(BuildTutorialStepHandler),OnboardingRotateBlockStepHandler=function(_super){function OnboardingRotateBlockStepHandler(config){var _this=_super.call(this,config)||this;return _this.shapeRotated=function(args){var rotatedShape=args.shape;if(_this.stopHandAnimation(),_this.shapeIsInSlot(rotatedShape)){var destinationShape=_this.destShapeMediator.getShape();_this.placeShapeAtDestination(rotatedShape,destinationShape),_this.sendTutorialHandlerEvent(MediatorEvent.SHAPE_ROTATED_IN_DESTINATION)}else _this.startHandAnimation()},_this.backgroundPressed=function(args){_this.currentShapeMediator.getShape().setEditable(!0)},_this.eventHandlers={},_this.eventHandlers[MediatorEvent.SHAPE_ROTATED]=_this.shapeRotated,_this.eventHandlers[MediatorEvent.BACKGROUND_PRESSED]=_this.backgroundPressed,_this}return __extends(OnboardingRotateBlockStepHandler,_super),OnboardingRotateBlockStepHandler.prototype.destroy=function(){this.eventHandlers={},_super.prototype.destroy.call(this)},OnboardingRotateBlockStepHandler.prototype.enter=function(args){var currentShapeID=args.currentShapeID,destinationShapeID=args.destinationShapeID,shapeRotationThreshold=args.shapeRotationThreshold,otherAcceptedRotations=args.otherAcceptedRotations;this.currentShapeMediator=this.workspaceMediator.getShapeMediatorByID(currentShapeID),this.destShapeMediator=this.workspaceMediator.getShapeMediatorByID(destinationShapeID),this.shapeRotationThreshold=shapeRotationThreshold;var destRotation=this.destShapeMediator.getShape().getRotation();this.acceptedRotations=this.transformAcceptedRotations(otherAcceptedRotations,destRotation),this.gravityButtonMediator.enable(!1),this.shelfMediator.setEnabled(!1),this.currentShapeMediator.getShape().setEditable(!0),this.destShapeMediator.getShape().setShow(!0),this.startHandAnimation()},OnboardingRotateBlockStepHandler.prototype.exit=function(){this.gravityButtonMediator.enable(!0),this.shelfMediator.setEnabled(!0),this.currentShapeMediator.getShape().setEditable(!1),this.destShapeMediator.getShape().setShow(!1),this.stopHandAnimation(),this.currentShapeMediator=null,this.destShapeMediator=null,this.acceptedRotations=null},OnboardingRotateBlockStepHandler.prototype.handleEvent=function(eventName,args){var eventHandler=this.eventHandlers[eventName];eventHandler&&eventHandler(args)},OnboardingRotateBlockStepHandler.prototype.transformAcceptedRotations=function(otherAcceptedRotations,targetRotation){return[0].concat(otherAcceptedRotations=otherAcceptedRotations||[]).map(function(rotation){var transformedRotation=targetRotation+rotation;return MathExt.wrap(transformedRotation,ROTATION_RANGE_MIN,ROTATION_RANGE_MAX)})},OnboardingRotateBlockStepHandler.prototype.startHandAnimation=function(){var target=0<=this.getShortestRotation()?this.currentShapeMediator.getRotateCWButtonView():this.currentShapeMediator.getRotateCCWButtonView();this.tutorialHandMediator.showAtTarget(target,0,Vector.create(50,-20)),this.tutorialHandMediator.moveToTarget(target,0,1),this.tutorialHandMediator.tap(),this.tutorialHandMediator.wait(1)},OnboardingRotateBlockStepHandler.prototype.stopHandAnimation=function(){this.tutorialHandMediator.hide()},OnboardingRotateBlockStepHandler.prototype.shapeIsInSlot=function(shape){var rotationMatchesTarget=this.rotationMatchesTarget(shape.getRotation()),destinationShape=this.destShapeMediator.getShape(),isCorrectShapeType=shape.getType()==destinationShape.getType();return rotationMatchesTarget&&isCorrectShapeType},OnboardingRotateBlockStepHandler.prototype.rotationMatchesTarget=function(rotation){var _this=this;return this.acceptedRotations.some(function(acceptedRotation){return Number.equals(rotation,acceptedRotation,_this.shapeRotationThreshold)})},OnboardingRotateBlockStepHandler.prototype.placeShapeAtDestination=function(shape,destinationShape){shape.copyTransform(destinationShape),shape.setEnabled(!1),shape.setEditable(!1)},OnboardingRotateBlockStepHandler.prototype.getShortestRotation=function(){var currentShapeRotation=this.currentShapeMediator.getShape().getRotation();return this.acceptedRotations.reduce(function(shortestRotation,acceptedRotation){var rotationDiff=MathExt.wrap(acceptedRotation-currentShapeRotation,ROTATION_RANGE_MIN,ROTATION_RANGE_MAX);return Math.abs(rotationDiff)<Math.abs(shortestRotation)?rotationDiff:shortestRotation},1/0)},OnboardingRotateBlockStepHandler}(BuildTutorialStepHandler),OnboardingSimulateUndoStepHandler=function(_super){function OnboardingSimulateUndoStepHandler(config){return _super.call(this,config)||this}return __extends(OnboardingSimulateUndoStepHandler,_super),OnboardingSimulateUndoStepHandler.prototype.destroy=function(){_super.prototype.destroy.call(this)},OnboardingSimulateUndoStepHandler.prototype.enter=function(args){var target=this.gravityButtonMediator.view;this.tutorialHandMediator.showAtTarget(target,-1.5,Vector.create(0,-100)),this.tutorialHandMediator.moveToTarget(target,-1.5,1,Vector.create(0,-50)),this.tutorialHandMediator.tap(),this.tutorialHandMediator.wait(1)},OnboardingSimulateUndoStepHandler.prototype.exit=function(){this.tutorialHandMediator.hide(),this.roofReleaseMediator&&this.roofReleaseMediator.activateRoof(!1)},OnboardingSimulateUndoStepHandler}(BuildTutorialStepHandler),OnboardingSuccessStepHandler=function(_super){function OnboardingSuccessStepHandler(config){return _super.call(this,config)||this}return __extends(OnboardingSuccessStepHandler,_super),OnboardingSuccessStepHandler.prototype.destroy=function(){_super.prototype.destroy.call(this)},OnboardingSuccessStepHandler.prototype.enter=function(args){this.gravityButtonMediator.enable(!1)},OnboardingSuccessStepHandler.prototype.exit=function(){},OnboardingSuccessStepHandler}(TutorialStepHandler),OnboardingWelcomeStepHandler=function(_super){function OnboardingWelcomeStepHandler(config){return _super.call(this,config)||this}return __extends(OnboardingWelcomeStepHandler,_super),OnboardingWelcomeStepHandler.prototype.destroy=function(){_super.prototype.destroy.call(this)},OnboardingWelcomeStepHandler.prototype.enter=function(args){this.workspaceMediator.getWorkspace().setEnabled(!1)},OnboardingWelcomeStepHandler.prototype.exit=function(){},OnboardingWelcomeStepHandler}(TutorialStepHandler),TutorialHandler=function(){function TutorialHandler(config){var _this=this;this.stepActivated=function(stepData){if(stepData&&!_this.currentStepHandler){var action=_this.createStepActivatedActions(stepData);_this.currentStepActionInstance=_this.actionManager.runAction(action),_this.createCurrentStepHandler(stepData.id,stepData.enterArgs)}},this.stepDeactivated=function(stepData){stepData&&(_this.actionManager.cancelAction(_this.currentStepActionInstance),_this.destroyCurrentStepHandler())},this.finished=function(finished){finished&&_this.onFinished&&_this.onFinished()},this.tutorial=config.tutorial,this.stepHandlerFactory=config.stepHandlerFactory,this.betweenVODelay=config.betweenVODelay,this.timeoutVODelay=config.timeoutVODelay,this.onFinished=config.onFinished,this.actionManager=new ActionManager,this.currentStepHandler=null,this.currentStepActionInstance=null,this.subscriptions=[this.tutorial.onStepActivated(this.stepActivated),this.tutorial.onStepDeactivated(this.stepDeactivated),this.tutorial.onFinished(this.finished)]}return TutorialHandler.prototype.getTutorial=function(){return this.tutorial},TutorialHandler.prototype.destroy=function(){this.subscriptions.forEach(function(unsubscribable){unsubscribable.unsubscribe()}),this.destroyCurrentStepHandler(),this.tutorial&&(this.tutorial.destroy(),this.tutorial=null),this.stepHandlerFactory&&(this.stepHandlerFactory.destroy(),this.stepHandlerFactory=null),this.actionManager=null,this.onFinished=null},TutorialHandler.prototype.update=function(frameTime){this.actionManager.update(frameTime)},TutorialHandler.prototype.start=function(){this.tutorial.start()},TutorialHandler.prototype.handleEvent=function(eventName,args){this.tutorial.handleEvent(eventName),this.currentStepHandler&&this.currentStepHandler.handleEvent(eventName,args)},TutorialHandler.prototype.createStepActivatedActions=function(stepData){var _this=this,actions=[],voName=stepData.id;actions.append([Actions.VO(voName),Actions.Delay(this.betweenVODelay),Actions.Func(function(){_this.handleEvent(MediatorEvent.TUTORIAL_VO_COMPLETE)})]);var timeoutStepID=stepData.timeoutStepID;if(timeoutStepID){var timeoutVOName=timeoutStepID;actions.append(Actions.Repeat(Actions.Sequence([Actions.Delay(this.timeoutVODelay),Actions.VO(timeoutVOName)])))}return Actions.Sequence(actions)},TutorialHandler.prototype.createCurrentStepHandler=function(stepID,eventArgs){this.currentStepHandler=this.stepHandlerFactory.createStepHandler(stepID),this.currentStepHandler&&this.currentStepHandler.enter(eventArgs)},TutorialHandler.prototype.destroyCurrentStepHandler=function(){this.currentStepHandler&&(this.currentStepHandler.exit(),this.currentStepHandler.destroy(),this.currentStepHandler=null)},TutorialHandler}(),TutorialHandMediator=function(_super){function TutorialHandMediator(view){var _this=_super.call(this,view)||this;return _this.hideImmediately(),_this}return __extends(TutorialHandMediator,_super),TutorialHandMediator.prototype.destroy=function(){_super.prototype.destroy.call(this)},TutorialHandMediator.prototype.showAt=function(position,rotation){this.view.showAt(position,rotation)},TutorialHandMediator.prototype.showAtTarget=function(view,rotation,offset){var transformedPosition=this.transformTarget(view,offset);this.view.showAt(transformedPosition,rotation)},TutorialHandMediator.prototype.hide=function(){this.view.hide()},TutorialHandMediator.prototype.hideImmediately=function(){this.view.hideImmediately()},TutorialHandMediator.prototype.moveTo=function(position,rotation,animateTime){this.view.moveTo(position,rotation,animateTime)},TutorialHandMediator.prototype.moveToTarget=function(view,rotation,animateTime,offset){var transformedPosition=this.transformTarget(view,offset);this.view.moveTo(transformedPosition,rotation,animateTime)},TutorialHandMediator.prototype.pressDown=function(){this.view.pressDown()},TutorialHandMediator.prototype.pressUp=function(){this.view.pressUp()},TutorialHandMediator.prototype.tap=function(){this.view.tap()},TutorialHandMediator.prototype.dragTo=function(position,rotation,animateTime){this.view.dragTo(position,rotation,animateTime)},TutorialHandMediator.prototype.dragToTarget=function(view,rotation,animateTime,offset){var transformedPosition=this.transformTarget(view,offset);this.view.dragTo(transformedPosition,rotation,animateTime)},TutorialHandMediator.prototype.pointAt=function(position,rotation){this.view.pointAt(position,rotation)},TutorialHandMediator.prototype.pointAtTarget=function(view,rotation,offset){var transformedPosition=this.transformTarget(view,offset);this.view.pointAt(transformedPosition,rotation)},TutorialHandMediator.prototype.wait=function(time){this.view.wait(time)},TutorialHandMediator.prototype.transformTarget=function(view,offset){offset=offset||Vector.create(0,0);var transformedPosition=Vector.transformTo(view,this.view.parent);return Vector.add(transformedPosition,offset)},TutorialHandMediator}(Mediator),AssetLoadUtils=function(){function AssetLoadUtils(){}return AssetLoadUtils.extractAllVODatas=function(assetLoadDatas){var voDataList=[];return assetLoadDatas.forEach(function(assetLoadData){var voDatas=getProperty(assetLoadData,"sounds.vo.sounds");voDataList.append(voDatas)}),voDataList},AssetLoadUtils}(),CaptionUtils=function(){function CaptionUtils(){}return CaptionUtils.convertCaptionIDs=function(captionDatas,voDatas){var outputCaptionDatas={};return voDatas.forEach(function(voData){var currentID=voData.id,newID=CaptionUtils.extractIDFromFilepath(voData.src),captionData=captionDatas[newID];captionData&&(outputCaptionDatas[currentID]=captionData.clone(!0))}),outputCaptionDatas},CaptionUtils.extractIDFromFilepath=function(filepath){return filepath.split("/").pop()},CaptionUtils}(),MediatorUtils=function(){function MediatorUtils(){}return MediatorUtils.getLevelMediatorID=function(levelType,isTutorial){var mediatorID=null;return levelType==LevelType.BUILD_BLOCKS?mediatorID=isTutorial?MediatorID.TUTORIAL_BUILD_BLOCKS_GAME:MediatorID.BUILD_BLOCKS_GAME:levelType==LevelType.REMOVE_BLOCKS&&(mediatorID=isTutorial?MediatorID.TUTORIAL_REMOVE_BLOCKS_GAME:MediatorID.REMOVE_BLOCKS_GAME),mediatorID},MediatorUtils}(),DebugGameCheatsMediator=function(_super){function DebugGameCheatsMediator(config){var _this=_super.call(this,config.view)||this;return _this.addToSlot1=function(){var slot=_this.shelf.getSlots()[0];_this.incrementCountForSlot(slot)},_this.addToSlot2=function(){var slot=_this.shelf.getSlots()[1];_this.incrementCountForSlot(slot)},_this.addToSlot3=function(){var slot=_this.shelf.getSlots()[2];_this.incrementCountForSlot(slot)},_this.addToSlot4=function(){var slot=_this.shelf.getSlots()[3];_this.incrementCountForSlot(slot)},_this.addToSlot5=function(){var slot=_this.shelf.getSlots()[4];_this.incrementCountForSlot(slot)},_this.togglePhysicsDebugVisibility=function(){_this.physicsDebugView.visible=!_this.physicsDebugView.visible},_this.physicsDebugView=config.physicsDebugView,_this.shelf=config.shelf,_this.registerKeyboardEvents(),_this}return __extends(DebugGameCheatsMediator,_super),DebugGameCheatsMediator.prototype.destroy=function(){this.deregisterKeyboardEvents(),this.shelf=null,this.physicsDebugView=null,_super.prototype.destroy.call(this)},DebugGameCheatsMediator.prototype.update=function(frameTime){_super.prototype.update.call(this,frameTime)},DebugGameCheatsMediator.prototype.setShelf=function(shelf){this.shelf&&this.deregisterShelfKeyboardEvents(),this.shelf=shelf,this.shelf&&this.registerShelfKeyboardEvents()},DebugGameCheatsMediator.prototype.registerKeyboardEvents=function(){this.registerShelfKeyboardEvents(),this.physicsDebugView&&app.keyboard.addKeyUp("d",this.togglePhysicsDebugVisibility)},DebugGameCheatsMediator.prototype.deregisterKeyboardEvents=function(){this.physicsDebugView&&app.keyboard.removeKeyUp("d",this.togglePhysicsDebugVisibility),this.deregisterShelfKeyboardEvents()},DebugGameCheatsMediator.prototype.registerShelfKeyboardEvents=function(){this.shelf&&(app.keyboard.addKeyUp("1",this.addToSlot1),app.keyboard.addKeyUp("2",this.addToSlot2),app.keyboard.addKeyUp("3",this.addToSlot3),app.keyboard.addKeyUp("4",this.addToSlot4),app.keyboard.addKeyUp("5",this.addToSlot5))},DebugGameCheatsMediator.prototype.deregisterShelfKeyboardEvents=function(){this.shelf&&(app.keyboard.removeKeyUp("5",this.addToSlot5),app.keyboard.removeKeyUp("4",this.addToSlot4),app.keyboard.removeKeyUp("3",this.addToSlot3),app.keyboard.removeKeyUp("2",this.addToSlot2),app.keyboard.removeKeyUp("1",this.addToSlot1))},DebugGameCheatsMediator.prototype.incrementCountForSlot=function(slot){slot&&slot.setCount(slot.getCount()+1)},DebugGameCheatsMediator}(Mediator),DebugLevelSelectCheatsMediator=function(_super){function DebugLevelSelectCheatsMediator(config){var _this=_super.call(this,config.view)||this;return _this.resetGameButtonPressed=function(){app.music=null,_this.sendToParent(MediatorEvent.RESET_GAME)},_this.unlockNextLevelButtonPressed=function(){_this.playerProgress.unlockSomeLevels()},_this.completeNextLevelButtonPressed=function(){_this.playerProgress.completeNextLevel()},_this.toggleLevelGraphVisibility=function(){_this.levelGraphMediator.toggleVisibility()},_this.playerProgress=config.playerProgress,_this.addLevelGraphMediator(config.levelGraphNodes),_this.addButtons(),_this.registerKeyboardEvents(),_this}return __extends(DebugLevelSelectCheatsMediator,_super),DebugLevelSelectCheatsMediator.prototype.destroy=function(){this.removeButtons(),this.deregisterKeyboardEvents(),this.levelGraphMediator=null,_super.prototype.destroy.call(this)},DebugLevelSelectCheatsMediator.prototype.addLevelGraphMediator=function(levelGraphNodes){this.levelGraphMediator=new LevelGraphMediator(levelGraphNodes,!1),this.addChild(this.levelGraphMediator)},DebugLevelSelectCheatsMediator.prototype.addButtons=function(){this.addButton(Vector.create(300,40),"RESET GAME",this.resetGameButtonPressed),this.addButton(Vector.create(525,40),"UNLOCK NEXT LEVELS",this.unlockNextLevelButtonPressed),this.addButton(Vector.create(750,40),"COMPLETE NEXT LEVEL",this.completeNextLevelButtonPressed)},DebugLevelSelectCheatsMediator.prototype.removeButtons=function(){this.view.scripts.removeScripts()},DebugLevelSelectCheatsMediator.prototype.registerKeyboardEvents=function(){app.keyboard.addKeyUp("p",this.toggleLevelGraphVisibility)},DebugLevelSelectCheatsMediator.prototype.deregisterKeyboardEvents=function(){app.keyboard.removeKeyUp("p",this.toggleLevelGraphVisibility)},DebugLevelSelectCheatsMediator.prototype.addButton=function(position,text,clickedCallback){var button=this.createButton(position,text);this.view.addChild(button),this.view.scripts.addScript(new ClickScript({view:button,clickEndCallback:clickedCallback}))},DebugLevelSelectCheatsMediator.prototype.createButton=function(position,text){return app.viewFactory.create({type:"container",position:position,children:[{type:"rectangle",anchor:Vector.create(.5,.5),width:200,height:60},{type:"text",anchor:Vector.create(.5,.5),initialText:text,style:{fontSize:20,align:"center",fill:"#000000",wordWrap:!0,wordWrapWidth:200}}]})},DebugLevelSelectCheatsMediator}(Mediator),LevelGraphMediator=function(_super){function LevelGraphMediator(levelGraphNodes,show){var _this=_super.call(this,new View)||this;return _this.buildViews(levelGraphNodes),_this.view.visible=show,_this}return __extends(LevelGraphMediator,_super),LevelGraphMediator.prototype.destroy=function(){_super.prototype.destroy.call(this)},LevelGraphMediator.prototype.toggleVisibility=function(){this.view.visible=!this.view.visible},LevelGraphMediator.prototype.buildViews=function(levelGraphNodes){var _this=this;levelGraphNodes.forEach(function(node){node.getNeighbourNodes().filter(function(neighbourNode){return neighbourNode.getLocationID()==node.getLocationID()}).forEach(function(neighbourNode){var lineView=_this.createLine(node.getPosition(),neighbourNode.getPosition());_this.view.addChild(lineView)})})},LevelGraphMediator.prototype.createLine=function(startPosition,endPosition){return new LineView({lineColour:"#ff0000",lineWidth:15,pointsColour:"#00ff00",pointsRadius:25,pointsAreVisible:!0,vertexList:[startPosition,endPosition]})},LevelGraphMediator}(Mediator),DialogHolderMediator=function(_super){function DialogHolderMediator(view){var _this=_super.call(this,view)||this;return _this.dialogQueue=[],_this.currentDialog=null,_this.fadedBackgroundVisible=!1,_this}return __extends(DialogHolderMediator,_super),DialogHolderMediator.prototype.destroy=function(){this.dialogQueue=null,this.currentDialog=null,_super.prototype.destroy.call(this)},DialogHolderMediator.prototype.show=function(dialog){dialog&&(this.dialogQueue.push(dialog),1==this.dialogQueue.length&&this.showNextDialog())},DialogHolderMediator.prototype.hide=function(){var _this=this;this.hideDialog(function(){_this.showNextDialog()})},DialogHolderMediator.prototype.showNextDialog=function(){if(this.dialogQueue.hasItems){var nextDialog=this.dialogQueue[0];this.showDialog(nextDialog),this.showFadedBackground()}else this.hideFadedBackground()},DialogHolderMediator.prototype.showFadedBackground=function(){this.fadedBackgroundVisible||(this.fadedBackgroundVisible=!0,this.view.showFadedBackground())},DialogHolderMediator.prototype.hideFadedBackground=function(){this.fadedBackgroundVisible&&(this.fadedBackgroundVisible=!1,this.view.hideFadedBackground())},DialogHolderMediator.prototype.showDialog=function(dialog,finishedCallback){finishedCallback=finishedCallback||EmptyFunction,this.setCurrentDialog(dialog),app.enableUserInput(!1),this.view.showDialog(dialog,function(){app.enableUserInput(!0),finishedCallback()})},DialogHolderMediator.prototype.hideDialog=function(finishedCallback){var _this=this;finishedCallback=finishedCallback||EmptyFunction,this.currentDialog?(app.enableUserInput(!1),this.view.hideDialog(this.currentDialog,function(){app.enableUserInput(!0),_this.removeCurrentDialog(),finishedCallback()})):finishedCallback()},DialogHolderMediator.prototype.setCurrentDialog=function(dialog){this.currentDialog&&this.removeCurrentDialog(),this.currentDialog=dialog;var parentView=this.view.getDialogParent();this.addChild(this.currentDialog.getMediator(),parentView)},DialogHolderMediator.prototype.removeCurrentDialog=function(){this.currentDialog&&(this.destroyChild(this.currentDialog.getMediator()),this.dialogQueue.remove(this.currentDialog),this.currentDialog=null)},DialogHolderMediator}(Mediator),ResultsDialogMediator=function(_super){function ResultsDialogMediator(config){var _this=_super.call(this,config.view)||this;return _this.checkButtonPressed=function(clickEvent){_this.sendToParent(TelemetryEventType.BUTTON_CLICK,{buttonID:ButtonID.RESULT_MAP,clickEvent:clickEvent}),_this.sendToParent(MediatorEvent.HIDE_DIALOG)},_this.animNames=config.animNames,_this.onClosed=config.onClosed,_this.view.on(ResultsDialogView.CHECK_BUTTON_PRESSED,_this.checkButtonPressed),_this}return __extends(ResultsDialogMediator,_super),ResultsDialogMediator.prototype.destroy=function(){this.view.off(ResultsDialogView.CHECK_BUTTON_PRESSED,this.checkButtonPressed),this.animNames=null,this.onClosed=null,_super.prototype.destroy.call(this)},ResultsDialogMediator.prototype.show=function(){return this.view.getShowAction(this.animNames.show)},ResultsDialogMediator.prototype.hide=function(){return this.view.getHideAction(this.animNames.hide,this.onClosed)},ResultsDialogMediator.prototype.getMediator=function(){return this},ResultsDialogMediator}(Mediator),TimeoutDialogMediator=function(_super){function TimeoutDialogMediator(config){var _this=_super.call(this,config.view)||this;return _this.hideSelf=function(){_this.sendToParent(MediatorEvent.HIDE_DIALOG)},_this.animNames=config.animNames,_this.view.setPromptTextureName(config.promptTextureName),_this.view.setBackgroundParticles(config.particlesConfig,config.particleTextureNames),_this.view.on(TimeoutDialogView.HIDE,_this.hideSelf),_this}return __extends(TimeoutDialogMediator,_super),TimeoutDialogMediator.prototype.destroy=function(){this.view.off(TimeoutDialogView.HIDE,this.hideSelf),this.animNames=null,_super.prototype.destroy.call(this)},TimeoutDialogMediator.prototype.show=function(){return this.view.getShowWithTimeoutAction(this.animNames.show)},TimeoutDialogMediator.prototype.hide=function(){return this.view.getHideAction(this.animNames.hide)},TimeoutDialogMediator.prototype.getMediator=function(){return this},TimeoutDialogMediator}(Mediator),YesNoDialogMediator=function(_super){function YesNoDialogMediator(config){var _this=_super.call(this,config.view)||this;return _this.noButtonClicked=function(clickEvent){_this.sendToParent(TelemetryEventType.BUTTON_CLICK,{buttonID:ButtonID.RESTART_NO,clickEvent:clickEvent}),_this.sendToParent(MediatorEvent.HIDE_DIALOG)},_this.yesButtonClicked=function(clickEvent){_this.sendToParent(TelemetryEventType.BUTTON_CLICK,{buttonID:ButtonID.RESTART_YES,clickEvent:clickEvent}),_this.afterHide=_this.onYesButtonPressed,_this.sendToParent(MediatorEvent.HIDE_DIALOG)},_this.onYesButtonPressed=config.yesButtonPressed,_this.afterHide=EmptyFunction,_this.view.on(YesNoDialogView.NO_BUTTON_CLICKED,_this.noButtonClicked),_this.view.on(YesNoDialogView.YES_BUTTON_CLICKED,_this.yesButtonClicked),_this.view.setPromptTextureName(config.promptTextureName),_this}return __extends(YesNoDialogMediator,_super),YesNoDialogMediator.prototype.destroy=function(){this.view.off(YesNoDialogView.NO_BUTTON_CLICKED,this.noButtonClicked),this.view.off(YesNoDialogView.YES_BUTTON_CLICKED,this.yesButtonClicked),_super.prototype.destroy.call(this)},YesNoDialogMediator.prototype.show=function(){return null},YesNoDialogMediator.prototype.hide=function(){return Actions.Sequence([this.view.getHideAction(),Actions.Func(this.afterHide)])},YesNoDialogMediator.prototype.getMediator=function(){return this},YesNoDialogMediator}(Mediator),BuildBlocksGameMediator=function(_super){function BuildBlocksGameMediator(view){var _this=_super.call(this,view)||this;return _this.backgroundPressed=function(){_this.workspaceMediator.setShapesToUneditable(),_this.handleMessage(MediatorEvent.BACKGROUND_PRESSED)},_this}return __extends(BuildBlocksGameMediator,_super),BuildBlocksGameMediator.prototype.destroy=function(){this.slotDatas=null,this.shelfMediator=null,this.roofReleaseMediator=null,_super.prototype.destroy.call(this)},BuildBlocksGameMediator.prototype.handleChildMessage=function(messageID,args,child){if(messageID==MediatorEvent.SLOT_SHAPE_DRAG_STARTED)this.slotShapeDragStarted(messageID,args,child);else if(messageID==MediatorEvent.SHAPE_DRAG_STARTED){var shape=args.shape;this.shapeDragStarted(shape)}else if(messageID==MediatorEvent.SHAPE_DRAG_ENDED){shape=args.shape;this.shapeDragEnded(shape)}else messageID==MediatorEvent.ROOF_PRESSED&&this.roofButtonPressed();_super.prototype.handleChildMessage.call(this,messageID,args,child)},BuildBlocksGameMediator.prototype.getCreateWorkspaceMediatorArgs=function(levelContentData){return{staticShapeDatas:levelContentData.staticShapes,dynamicShapeDatas:levelContentData.dynamicShapes,shapeMediatorID:MediatorID.BUILD_SHAPE,matterEngine:this.physicsEngine.getEngine()}},BuildBlocksGameMediator.prototype.createTutorialStepHandlerConfig=function(){var _this=this;return{workspaceMediator:this.workspaceMediator,gravityButtonMediator:this.gravityButtonMediator,furBlurMediator:this.furBlurMediator,tutorialHandMediator:this.tutorialHandMediator,sendTutorialHandlerEvent:function(eventName,args){_this.tutorialHandler.handleEvent(eventName,args)},sendToParentMediator:function(messageID,args,child){_this.sendToParent(messageID,args,child)},slotDatas:this.slotDatas,shelfMediator:this.shelfMediator,roofReleaseMediator:this.roofReleaseMediator,returnShapeToShelf:function(shape,finishedCallback){_this.returnShapeToShelf(shape,finishedCallback)}}},BuildBlocksGameMediator.prototype.parseConfig=function(config){_super.prototype.parseConfig.call(this,config),this.slotDatas=config.levelContentData.slots,this.returnShapeToSlotTime=config.returnShapeToSlotTime},BuildBlocksGameMediator.prototype.initChildMediators=function(levelContentData){_super.prototype.initChildMediators.call(this,levelContentData),this.shelfMediator=this.createShelfMediator(levelContentData);var shelfParent=this.view.getBackgroundLayer();this.addChild(this.shelfMediator,shelfParent),this.roofReleaseMediator=this.mediatorFactory.createMediator(MediatorID.ROOF_RELEASE),this.updateRoofReleaseShape();var roofParent=this.view.getRoofParent();if(this.addChild(this.roofReleaseMediator,roofParent),app.options.debug){var shelf=this.shelfMediator.getShelf();this.debugCheatsMediator.setShelf(shelf)}},BuildBlocksGameMediator.prototype.start=function(){_super.prototype.start.call(this),this.enableGravityButton(!1)},BuildBlocksGameMediator.prototype.registerEventHandlers=function(){_super.prototype.registerEventHandlers.call(this),this.view.on(BuildBlocksGameView.BACKGROUND_PRESSED,this.backgroundPressed)},BuildBlocksGameMediator.prototype.deregisterEventHandlers=function(){this.view.off(BuildBlocksGameView.BACKGROUND_PRESSED,this.backgroundPressed),_super.prototype.deregisterEventHandlers.call(this)},BuildBlocksGameMediator.prototype.gravityButtonPressed=function(){_super.prototype.gravityButtonPressed.call(this),this.roofReleaseMediator.getActive()&&(this.enableGravityButton(!0),this.roofReleaseMediator.getDropped()||this.roofReleaseMediator.activateRoof(!1))},BuildBlocksGameMediator.prototype.undoButtonPressed=function(){if(_super.prototype.undoButtonPressed.call(this),this.updateRoofReleaseShape(),this.roofReleaseMediator.getActive()){var gravityButtonEnabled=!this.roofReleaseMediator.getDropped();this.enableGravityButton(gravityButtonEnabled),this.roofReleaseMediator.activateRoof(!1),this.setSubState(GameState.READY_TO_DROP_ROOF)}},BuildBlocksGameMediator.prototype.simulationSuccess=function(){_super.prototype.simulationSuccess.call(this),this.roofReleaseMediator.getDropped()?this.levelComplete():this.shelfMediator.hasShapes()||(this.roofReleaseMediator.hasRoofShape()?(this.roofReleaseMediator.activateRoof(!0),this.setSubState(GameState.READY_TO_DROP_ROOF)):this.levelComplete())},BuildBlocksGameMediator.prototype.enableSimulation=function(enable){_super.prototype.enableSimulation.call(this,enable),this.roofReleaseMediator.enableSimulation(enable),this.shelfMediator.setEnabled(!enable)},BuildBlocksGameMediator.prototype.shapesAreColliding=function(areColliding){_super.prototype.shapesAreColliding.call(this,areColliding),this.gameState!=GameState.DRAGGING&&this.enableGravityButton(!areColliding)},BuildBlocksGameMediator.prototype.slotShapeDragStarted=function(messageID,args,child){this.workspaceMediator.setEnabled(!1),this.shapeDragStarted(),this.workspaceMediator.handleMessage(messageID,args,child)},BuildBlocksGameMediator.prototype.shapeDragStarted=function(shape){this.enableBackAndRestartButtons(!1),this.workspaceMediator.disableShapesNotBeingDragged(shape),this.workspaceMediator.setShapesToUneditable(),this.roofReleaseMediator.activateRoof(!1),this.isInSimulationSuccessState()&&this.continuePlaying(),this.enableGravityButton(!1),this.shelfMediator.setEnabled(!1),this.setSubState(GameState.DRAGGING)},BuildBlocksGameMediator.prototype.shapeDragEnded=function(shape){this.enableBackAndRestartButtons(!0),this.workspaceMediator.setEnabled(!0),this.shelfMediator.setEnabled(!0);var shapesAreColliding=this.workspaceMediator.getWorkspace().getShapesAreColliding(),subState=shapesAreColliding?GameState.EDITING_SHAPES_OVERLAPPING:GameState.EDITING;this.setSubState(subState);var shapesBeingDragged=this.workspaceMediator.hasShapesBeingDragged();shapesAreColliding||shapesBeingDragged||this.enableGravityButton(!0);var isValid=!0,telemetryEventType=null;this.workspaceMediator.pointInsideBounds(shape.getPosition())?(isValid=shape.isValid(),telemetryEventType=TelemetryEventType.PLACED_OBJECT):(telemetryEventType=TelemetryEventType.RETURNED_OBJECT,this.returnShapeToShelf(shape)),this.sendToParent(telemetryEventType,{shapeType:shape.getType(),position:shape.getPosition(),isValid:isValid})},BuildBlocksGameMediator.prototype.returnShapeToShelf=function(shape,finishedCallback){var _this=this;shape.setEnabled(!1),shape.setEditable(!1),this.enableGravityButton(!1),this.shelfMediator.setEnabled(!1);var slotMediator=this.shelfMediator.getSlotMediatorForShapeType(shape.getType()),globalSlotPosition=slotMediator.getGlobalPosition(),shapeMediator=this.workspaceMediator.getShapeMediator(shape);shapeMediator.setPosition(globalSlotPosition,this.returnShapeToSlotTime),shapeMediator.setRotation(0,this.returnShapeToSlotTime,function(){var slot=slotMediator.getSlot();slot.setCount(slot.getCount()+1),_this.workspaceMediator.hasOnlyOneShape()||_this.workspaceMediator.getWorkspace().getShapesAreColliding()||_this.enableGravityButton(!0),_this.workspaceMediator.removeShape(shape),_this.shelfMediator.setEnabled(!0),finishedCallback&&finishedCallback(shape)})},BuildBlocksGameMediator.prototype.createShelfMediator=function(levelContentData){return this.mediatorFactory.createMediator(MediatorID.SHELF,{slotDatas:levelContentData.slots})},BuildBlocksGameMediator.prototype.roofButtonPressed=function(){this.gravityButtonPressed(),this.sendToParent(TelemetryEventType.ROOF_DROPPED)},BuildBlocksGameMediator.prototype.updateRoofReleaseShape=function(){var roofShape=this.workspaceMediator.findMatchingShape(ShapeType.ROOF);roofShape?(this.roofReleaseMediator.show(),this.roofReleaseMediator.setRoofShape(roofShape)):this.roofReleaseMediator.hide()},BuildBlocksGameMediator.prototype.isInSimulationSuccessState=function(){return this.gameState==GameState.SIMULATION_SUCCESS||this.gameState==GameState.READY_TO_DROP_ROOF},BuildBlocksGameMediator}(GameMediator),RoofReleaseMediator=function(_super){function RoofReleaseMediator(config){var _this=_super.call(this,config.view)||this;return _this.pressed=function(){_this.view.enableHighlight(!1),_this.dropped=!0,_this.sendToParent(MediatorEvent.ROOF_PRESSED)},_this.roofShape=null,_this.active=!1,_this.dropped=!1,_this.droneAnimationNames=config.droneAnimationNames,_this.view.on(RoofReleaseView.PRESSED,_this.pressed),_this.setRoofShape(config.roofShape),_this}return __extends(RoofReleaseMediator,_super),RoofReleaseMediator.prototype.getActive=function(){return this.active},RoofReleaseMediator.prototype.getDropped=function(){return this.dropped},RoofReleaseMediator.prototype.destroy=function(){this.view.off(RoofReleaseView.PRESSED,this.pressed),this.roofShape=null,_super.prototype.destroy.call(this)},RoofReleaseMediator.prototype.show=function(){this.view.show(!0)},RoofReleaseMediator.prototype.hide=function(){this.view.show(!1)},RoofReleaseMediator.prototype.setRoofShape=function(roofShape){if(this.roofShape=roofShape){var position=roofShape.getPosition();this.view.setPosition(position);var anchor=roofShape.getAnchor();this.view.setAnchor(anchor),roofShape.setImmovable(!0),roofShape.setEnabled(!1)}},RoofReleaseMediator.prototype.hasRoofShape=function(){return!!this.roofShape},RoofReleaseMediator.prototype.activateRoof=function(active){this.dropped&&(active=!(this.dropped=!1));var animationName=(this.active=active)?this.droneAnimationNames.open:this.droneAnimationNames.close;this.view.playDroneAnimation(animationName),this.view.enableHighlight(active),this.roofShape&&this.roofShape.setImmovable(!active),active&&(app.sound.play("gameRoofActivate"),this.sendToParent(MediatorEvent.ROOF_UNLOCKED))},RoofReleaseMediator.prototype.enableSimulation=function(enable){this.roofShape&&(this.roofShape.setGravityOn(enable&&this.active),this.roofShape.setCollidable(enable),this.roofShape.setSleeping(!enable))},RoofReleaseMediator}(Mediator),ShelfMediator=function(_super){function ShelfMediator(config){var _this=_super.call(this,config.view)||this;return _this.slotAdded=function(slot){if(slot){var slotMediator=_this.mediatorFactory.createMediator(MediatorID.SHELF_SLOT,{slot:slot}),parentView=_this.view.getShelfSlotParent();_this.addChild(slotMediator,parentView),_this.slotMediators.push(slotMediator)}},_this.slotRemoved=function(slot){if(slot){var mediator=_this.slotMediators.find(function(slotMediator){return slotMediator.getSlot()==slot});mediator&&(_this.slotMediators.remove(mediator),_this.destroyChild(mediator))}},_this.shelf=config.shelf,_this.mediatorFactory=config.mediatorFactory,_this.slotMediators=[],_this.subscriptions=[_this.shelf.onSlotAdded(_this.slotAdded),_this.shelf.onSlotRemoved(_this.slotRemoved)],_this.shelf.createSlots(),_this.view.setOutlineVisible(!1),_this}return __extends(ShelfMediator,_super),ShelfMediator.prototype.getShelf=function(){return this.shelf},ShelfMediator.prototype.destroy=function(){this.subscriptions.forEach(function(unsubscribable){unsubscribable.unsubscribe()}),this.slotMediators=[],this.mediatorFactory&&(this.mediatorFactory=null),this.shelf&&(this.shelf.destroy(),this.shelf=null),_super.prototype.destroy.call(this)},ShelfMediator.prototype.showOutline=function(){this.view.showOutline()},ShelfMediator.prototype.hideOutline=function(){this.view.hideOutline()},ShelfMediator.prototype.createSlots=function(slotDatas){this.shelf.createSlots(slotDatas)},ShelfMediator.prototype.getSlotMediatorForShapeType=function(shapeType){return this.slotMediators.find(function(slotMediator){return slotMediator.getSlot().getShapeType()==shapeType})},ShelfMediator.prototype.setEnabled=function(enabled){this.shelf.setEnabled(enabled)},ShelfMediator.prototype.enableSlotsWithShapeTypes=function(shapeTypes){this.shelf.enableSlotsWithShapeTypes(shapeTypes)},ShelfMediator.prototype.hasShapes=function(){return this.shelf.hasShapes()},ShelfMediator}(Mediator),ShelfSlotMediator=function(_super){function ShelfSlotMediator(config){var _this=_super.call(this,config.view)||this;_this.enabledChanged=function(enabled){_this.view.setClickable(enabled),_this.view.setTintOn(!enabled)},_this.countChanged=function(count){var countText=0<count?count.toString():"";_this.view.setCountText(countText),_this.view.showShape(0<count)},_this.slotClickStarted=function(event,globalSlotPosition){var newCount=_this.slot.getCount()-1;newCount=Math.max(newCount,0),_this.slot.setCount(newCount),_this.sendToParent(MediatorEvent.SLOT_SHAPE_DRAG_STARTED,{shapeType:_this.slot.getShapeType(),dragEvent:event,globalSlotPosition:globalSlotPosition})},_this.slot=config.slot;var shapeAnchor=config.shapeAnchor||Vector.create(.5,.5);return _this.view.setPosition(config.position),_this.view.setShapeTextureName(config.shapeTextureName),_this.view.setShapeAnchor(shapeAnchor),_this.subscriptions=[_this.slot.onEnabledChanged(_this.enabledChanged),_this.slot.onCountChanged(_this.countChanged)],_this.view.on(ShelfSlotView.CLICK_STARTED,_this.slotClickStarted),_this}return __extends(ShelfSlotMediator,_super),ShelfSlotMediator.prototype.getSlot=function(){return this.slot},ShelfSlotMediator.prototype.destroy=function(){this.view.off(ShelfSlotView.CLICK_STARTED,this.slotClickStarted),this.subscriptions.forEach(function(unsubscribable){unsubscribable.unsubscribe()}),this.slot&&(this.slot.destroy(),this.slot=null),_super.prototype.destroy.call(this)},ShelfSlotMediator.prototype.getGlobalPosition=function(){return Vector.getGlobalPos(this.view)},ShelfSlotMediator}(Mediator),TutorialBuildBlocksGameMediator=function(_super){function TutorialBuildBlocksGameMediator(view){return _super.call(this,view)||this}return __extends(TutorialBuildBlocksGameMediator,_super),TutorialBuildBlocksGameMediator.prototype.destroy=function(){_super.prototype.destroy.call(this)},TutorialBuildBlocksGameMediator.prototype.getCreateWorkspaceMediatorArgs=function(levelContentData){return{staticShapeDatas:levelContentData.staticShapes,dynamicShapeDatas:levelContentData.dynamicShapes,destinationShapeDatas:levelContentData.destinationShapes,shapeMediatorID:MediatorID.BUILD_SHAPE,matterEngine:this.physicsEngine.getEngine()}},TutorialBuildBlocksGameMediator.prototype.tutorialFinished=function(){_super.prototype.levelComplete.call(this)},TutorialBuildBlocksGameMediator.prototype.enableSimulation=function(enable){_super.prototype.enableSimulation.call(this,enable),this.workspaceMediator.setEnabled(!1),this.shelfMediator.setEnabled(!1)},TutorialBuildBlocksGameMediator.prototype.levelComplete=function(){this.physicsEngine&&(this.physicsEngine.destroy(),this.physicsEngine=null),this.handleMessage(MediatorEvent.LEVEL_COMPLETE)},TutorialBuildBlocksGameMediator.prototype.shapeDragEnded=function(shape){this.shelfMediator.setEnabled(!0)},TutorialBuildBlocksGameMediator.prototype.createShelfMediator=function(levelContentData){return this.mediatorFactory.createMediator(MediatorID.SHELF,{slotDatas:null})},TutorialBuildBlocksGameMediator}(BuildBlocksGameMediator),FurBlurMediator=function(_super){function FurBlurMediator(config){var _this=_super.call(this,config.view)||this;return _this.xPosRange=config.xPosRange,_this.view.setY(config.yPos),_this.hide(),_this}return __extends(FurBlurMediator,_super),FurBlurMediator.prototype.destroy=function(){_super.prototype.destroy.call(this)},FurBlurMediator.prototype.showAtX=function(xPos){xPos=this.validateXPos(xPos),this.view.setX(xPos),this.view.show()},FurBlurMediator.prototype.hide=function(){this.view.hide()},FurBlurMediator.prototype.validateXPos=function(xPos){return this.xPosRange.clamp(xPos)},FurBlurMediator}(Mediator),GravityButtonMediator=function(_super){function GravityButtonMediator(config){var _this=_super.call(this,config.view)||this;return _this.stateData={},_this.buttonPressStarted=function(clickEvent){var animName=_this.getAnimationNames().press;_this.setAnimation(animName);var buttonID=_this.stateData[_this.currentStateID].telemetryButtonID;_this.sendToParent(TelemetryEventType.BUTTON_CLICK,{buttonID:buttonID,clickEvent:clickEvent})},_this.buttonPressEnded=function(){var stateData=_this.stateData[_this.currentStateID];app.sound.play(stateData.soundName),_this.sendToParent(stateData.mediatorEvent)},_this.buttonHoverStarted=function(){var animName=_this.getAnimationNames().hover;_this.setAnimation(animName)},_this.buttonHoverEnded=function(){var animName=_this.getAnimationNames().idle;_this.setAnimation(animName)},_this.animationData=config.animationData,_this.stateData=config.stateData,_this.currentStateID=GravityButtonStateID.GRAVITY,_this.view.on(GravityButtonView.BUTTON_PRESS_STARTED,_this.buttonPressStarted),_this.view.on(GravityButtonView.BUTTON_PRESS_ENDED,_this.buttonPressEnded),_this.view.on(GravityButtonView.BUTTON_HOVER_STARTED,_this.buttonHoverStarted),_this.view.on(GravityButtonView.BUTTON_HOVER_ENDED,_this.buttonHoverEnded),_this.view.enableInteraction(!0),_this}return __extends(GravityButtonMediator,_super),GravityButtonMediator.prototype.destroy=function(){this.view.off(GravityButtonView.BUTTON_PRESS_STARTED,this.buttonPressStarted),this.view.off(GravityButtonView.BUTTON_PRESS_ENDED,this.buttonPressEnded),this.view.off(GravityButtonView.BUTTON_HOVER_STARTED,this.buttonHoverStarted),this.view.off(GravityButtonView.BUTTON_HOVER_ENDED,this.buttonHoverEnded),this.animationData=null,this.stateData=null,_super.prototype.destroy.call(this)},GravityButtonMediator.prototype.update=function(frameTime){_super.prototype.update.call(this,frameTime)},GravityButtonMediator.prototype.setState=function(stateID){if(this.currentStateID!=stateID){this.currentStateID=stateID;var animName=this.getAnimationNames().transition;this.setAnimation(animName)}},GravityButtonMediator.prototype.enable=function(enable){var animNames=this.getAnimationNames(),animName=enable?animNames.idle:animNames.disabled;this.setAnimation(animName),this.view.enableInteraction(enable)},GravityButtonMediator.prototype.setAnimation=function(animationName){var looped=this.isLoopedAnimation(animationName);this.view.setAnimation(animationName,looped)},GravityButtonMediator.prototype.getAnimationNames=function(){return this.animationData.stateAnimationNames[this.currentStateID]},GravityButtonMediator.prototype.isLoopedAnimation=function(animationName){return this.animationData.loopedAnimationNames.contains(animationName)},GravityButtonMediator}(Mediator),ChuteMediator=function(_super){function ChuteMediator(config){var _this=_super.call(this,config.view)||this;return _this.shapeTextureNames=config.shapeTextureNames,_this.shapeType=null,_this.shrededShapeType=null,_this.progressBar=null,_this.setProgressBar(config.progressBarMediator),_this}return __extends(ChuteMediator,_super),ChuteMediator.prototype.getProgressBar=function(){return this.progressBar},ChuteMediator.prototype.destroy=function(){this.progressBar=null,_super.prototype.destroy.call(this)},ChuteMediator.prototype.setShape=function(nextShapeType){if(nextShapeType){var shapeTextureName=this.shapeTextureNames[nextShapeType].shelf,shredParticleTextureName=this.shapeTextureNames[nextShapeType].shredParticle;this.shapeType?this.view.replaceShape(shapeTextureName,shredParticleTextureName):this.view.addShape(shapeTextureName,shredParticleTextureName)}this.shapeType=nextShapeType,this.sendToParent(MediatorEvent.SHAPE_IN_CHUTE_CHANGED,nextShapeType)},ChuteMediator.prototype.shredShape=function(){this.shapeType&&(this.view.shredShape(),this.shrededShapeType=this.shapeType,this.shapeType=null)},ChuteMediator.prototype.restoreShreddedShape=function(){this.shrededShapeType&&(this.setShape(this.shrededShapeType),this.shrededShapeType=null)},ChuteMediator.prototype.setProgressBar=function(mediator){this.progressBar=mediator;var parentView=this.view.getProgressBarParent();this.addChild(mediator,parentView)},ChuteMediator}(Mediator),ChuteProgressBarMediator=function(_super){function ChuteProgressBarMediator(config){var _this=_super.call(this,config.view)||this;return _this.currentProgress=0,_this.view.setBarFrontTextureName(config.progressBarFrontTextureName),_this}return __extends(ChuteProgressBarMediator,_super),ChuteProgressBarMediator.prototype.destroy=function(){_super.prototype.destroy.call(this)},ChuteProgressBarMediator.prototype.setProgress=function(progress){progress=MathExt.saturate(progress),this.view.setProgress(progress),progress>this.currentProgress&&app.sound.play("meterIncrease"),this.currentProgress=progress},ChuteProgressBarMediator.prototype.getHeight=function(){return this.view.height},ChuteProgressBarMediator}(Mediator),RemoveBlocksGameMediator=function(_super){function RemoveBlocksGameMediator(view){var _this=_super.call(this,view)||this;return _this.shapesRemovedChanged=function(shapesRemoved){var progress=_this.levelScore.getProgress();_this.progressBarMediator.setProgress(progress)},_this}return __extends(RemoveBlocksGameMediator,_super),RemoveBlocksGameMediator.prototype.destroy=function(){this.levelScore&&(this.levelScore.destroy(),this.levelScore=null),this.progressBarMediator=null,this.chuteMediator=null,_super.prototype.destroy.call(this)},RemoveBlocksGameMediator.prototype.handleChildMessage=function(messageID,args,child){if(messageID==MediatorEvent.SHAPE_CLICKED)this.shapeClicked(messageID,args,child);else if(messageID==MediatorEvent.SHAPE_IN_CHUTE_CHANGED){var newShapeType=args;this.shapeInChuteChanged(newShapeType)}_super.prototype.handleChildMessage.call(this,messageID,args,child)},RemoveBlocksGameMediator.prototype.getCreateWorkspaceMediatorArgs=function(levelContentData){return{shapeDatas:levelContentData.shapes,staticShapeDatas:levelContentData.staticShapes,dynamicShapeDatas:levelContentData.dynamicShapes,shapeMediatorID:MediatorID.REMOVE_SHAPE,matterEngine:this.physicsEngine.getEngine()}},RemoveBlocksGameMediator.prototype.createTutorialStepHandlerConfig=function(){var _this=this;return{workspaceMediator:this.workspaceMediator,gravityButtonMediator:this.gravityButtonMediator,furBlurMediator:this.furBlurMediator,tutorialHandMediator:this.tutorialHandMediator,sendTutorialHandlerEvent:function(eventName,args){_this.tutorialHandler.handleEvent(eventName,args)},sendToParentMediator:function(messageID,args,child){_this.sendToParent(messageID,args,child)},progressBarMediator:this.chuteMediator.getProgressBar()}},RemoveBlocksGameMediator.prototype.initServices=function(config){_super.prototype.initServices.call(this,config),this.levelScore=new RemoveBlocksLevelScore({levelContentData:config.levelContentData,maxRemoveShapes:config.maxRemoveShapes})},RemoveBlocksGameMediator.prototype.initChildMediators=function(levelContentData){_super.prototype.initChildMediators.call(this,levelContentData),this.chuteMediator=this.mediatorFactory.createMediator(MediatorID.CHUTE,{numberOfShapesToWin:this.levelScore.getNumShapesToWin()});var chuteParent=this.view.getBackgroundLayer();this.addChild(this.chuteMediator,chuteParent),this.progressBarMediator=this.chuteMediator.getProgressBar()},RemoveBlocksGameMediator.prototype.start=function(){_super.prototype.start.call(this),this.chuteMediator.setShape(null)},RemoveBlocksGameMediator.prototype.registerEventHandlers=function(){_super.prototype.registerEventHandlers.call(this),this.addSubscriptions([this.levelScore.onShapesRemovedChanged(this.shapesRemovedChanged)])},RemoveBlocksGameMediator.prototype.deregisterEventHandlers=function(){_super.prototype.deregisterEventHandlers.call(this)},RemoveBlocksGameMediator.prototype.simulationSuccess=function(){_super.prototype.simulationSuccess.call(this),this.levelScore.isComplete()&&this.levelComplete()},RemoveBlocksGameMediator.prototype.shapeAdded=function(shape){_super.prototype.shapeAdded.call(this,shape),this.levelScore.shapeAdded()},RemoveBlocksGameMediator.prototype.shapeRemoved=function(shape){_super.prototype.shapeRemoved.call(this,shape),this.levelScore.shapeRemoved(),this.sendToParent(TelemetryEventType.REMOVED_OBJECT,{shapeType:shape.getType(),position:shape.getPosition()})},RemoveBlocksGameMediator.prototype.gravityButtonPressed=function(){_super.prototype.gravityButtonPressed.call(this),this.chuteMediator.shredShape(),this.workspaceMediator.removeLastRemovedShape()},RemoveBlocksGameMediator.prototype.undoButtonPressed=function(){_super.prototype.undoButtonPressed.call(this),this.chuteMediator.restoreShreddedShape(),this.workspaceMediator.restoreLastRemovedShape()},RemoveBlocksGameMediator.prototype.shapeClicked=function(messageID,args,child){this.chuteMediator.setShape(args.shape.getType()),this.workspaceMediator.handleMessage(messageID,args,child),this.gameState==GameState.SIMULATION_SUCCESS&&this.continuePlaying(),this.setSubState(GameState.EDITING),this.preventShapesOverlapping()},RemoveBlocksGameMediator.prototype.shapeInChuteChanged=function(newShapeType){this.gravityButtonMediator.enable(!!newShapeType)},RemoveBlocksGameMediator.prototype.preventShapesOverlapping=function(){this.workspaceMediator.setShapesAsSleeping(!0)},RemoveBlocksGameMediator}(GameMediator),TutorialRemoveBlocksGameMediator=function(_super){function TutorialRemoveBlocksGameMediator(view){return _super.call(this,view)||this}return __extends(TutorialRemoveBlocksGameMediator,_super),TutorialRemoveBlocksGameMediator.prototype.destroy=function(){_super.prototype.destroy.call(this)},TutorialRemoveBlocksGameMediator.prototype.tutorialFinished=function(){_super.prototype.levelComplete.call(this)},TutorialRemoveBlocksGameMediator.prototype.enableSimulation=function(enable){_super.prototype.enableSimulation.call(this,enable),this.workspaceMediator.getWorkspace().setEnabled(!1),enable&&this.gravityButtonMediator.enable(!1)},TutorialRemoveBlocksGameMediator.prototype.levelComplete=function(){this.physicsEngine&&(this.physicsEngine.destroy(),this.physicsEngine=null),this.handleMessage(MediatorEvent.LEVEL_COMPLETE)},TutorialRemoveBlocksGameMediator}(RemoveBlocksGameMediator),BuildShapeMediator=function(_super){function BuildShapeMediator(config){var _this=_super.call(this,config)||this;return _this.dragStarted=function(position){app.sound.play("BlockSelect"),_this.shape.setSleeping(!1),_this.dragConstraint.start(position),_this.view.bringToFront(),_this.sendToParent(MediatorEvent.SHAPE_DRAG_STARTED,{shape:_this.shape})},_this.dragMoved=function(position){_this.dragConstraint.update(position)},_this.dragEnded=function(){app.sound.play("BlockRelease"),_this.shape.setEditable(!0),_this.dragConstraint.end(),_this.sendToParent(MediatorEvent.SHAPE_DRAG_ENDED,{shape:_this.shape})},_this.rotationStarted=function(){_this.loopedSound.start("rotateTurn"),_this.loopedSound.resetVolume()},_this.rotationMoved=function(rotation){_this.setRotationWithEvent(rotation),_this.shape.setSleeping(!1),_this.loopedSound.resetVolume()},_this.rotationEnded=function(rotation){_this.loopedSound.stop(),_this.sendToParent(TelemetryEventType.ROTATED_OBJECT,{shapeType:_this.shape.getType(),rotation:rotation})},_this.rotateCWButtonPressed=function(){_this.setRotationWithEvent(_this.shape.getRotation()+_this.rotationStep)},_this.rotateCCWButtonPressed=function(){_this.setRotationWithEvent(_this.shape.getRotation()-_this.rotationStep)},_this.dragConstraint=new DragConstraint({body:_this.shape.getBody(),parent:config.parentComposite,angularStiffness:1,allowThrowing:!1}),_this.loopedSound=new LoopedSound,_this.view.on(ShapeView.DRAG_STARTED,_this.dragStarted),_this.view.on(ShapeView.DRAG_MOVED,_this.dragMoved),_this.view.on(ShapeView.DRAG_ENDED,_this.dragEnded),_this.view.on(ShapeView.ROTATION_STARTED,_this.rotationStarted),_this.view.on(ShapeView.ROTATION_MOVED,_this.rotationMoved),_this.view.on(ShapeView.ROTATION_ENDED,_this.rotationEnded),_this.view.on(ShapeView.ROTATE_CW_BUTTON_PRESSED,_this.rotateCWButtonPressed),_this.view.on(ShapeView.ROTATE_CCW_BUTTON_PRESSED,_this.rotateCCWButtonPressed),_this.view.startDrag(config.dragEvent),_this}return __extends(BuildShapeMediator,_super),BuildShapeMediator.prototype.destroy=function(){this.view.off(ShapeView.DRAG_ENDED,this.dragEnded),this.view.off(ShapeView.DRAG_MOVED,this.dragMoved),this.view.off(ShapeView.DRAG_STARTED,this.dragStarted),this.view.off(ShapeView.ROTATION_STARTED,this.rotationStarted),this.view.off(ShapeView.ROTATION_MOVED,this.rotationMoved),this.view.off(ShapeView.ROTATION_ENDED,this.rotationEnded),this.loopedSound&&(this.loopedSound.destroy(),this.loopedSound=null),this.dragConstraint&&(this.dragConstraint.destroy(),this.dragConstraint=null),_super.prototype.destroy.call(this)},BuildShapeMediator.prototype.isBeingDragged=function(){return this.dragConstraint.isActive()},BuildShapeMediator.prototype.onEnabledChanged=function(enabled){this.view.setDraggable(enabled)},BuildShapeMediator.prototype.onEditableChanged=function(editable){this.view.setRotationCircleVisible(editable)},BuildShapeMediator.prototype.onShowChanged=function(show){this.view.show(show)},BuildShapeMediator.prototype.onValidChanged=function(valid){this.setValidTexture(valid)},BuildShapeMediator.prototype.setRotationWithEvent=function(rotation){this.shape.setRotation(rotation),this.sendToParent(MediatorEvent.SHAPE_ROTATED,{shape:this.shape});var adjustedRotation=this.shape.getRotation();this.sendToParent(TelemetryEventType.ROTATED_OBJECT,{shapeType:this.shape.getType(),rotation:adjustedRotation})},BuildShapeMediator}(ShapeMediator),DestinationShapeMediator=function(_super){function DestinationShapeMediator(config){var _this=_super.call(this,config)||this;return _this.shape.setShow(!1),_this}return __extends(DestinationShapeMediator,_super),DestinationShapeMediator.prototype.destroy=function(){_super.prototype.destroy.call(this)},DestinationShapeMediator.prototype.onShowChanged=function(show){this.view.visible=show},DestinationShapeMediator}(ShapeMediator),RemoveShapeMediator=function(_super){function RemoveShapeMediator(config){var _this=_super.call(this,config)||this;return _this.clickStarted=function(){_this.view.bringToFront(),app.sound.play("BlockSelect"),_this.sendToParent(MediatorEvent.SHAPE_CLICKED,{shape:_this.shape})},_this.view.setRotationCircleVisible(!1),_this.view.on(ShapeView.CLICK_STARTED,_this.clickStarted),_this}return __extends(RemoveShapeMediator,_super),RemoveShapeMediator.prototype.destroy=function(){this.view.off(ShapeView.CLICK_STARTED,this.clickStarted),_super.prototype.destroy.call(this)},RemoveShapeMediator.prototype.onEnabledChanged=function(enabled){this.view.setClickable(enabled)},RemoveShapeMediator.prototype.onShowChanged=function(show){var _this=this;this.shape.setEnabled(!1),this.view.show(show,function(){_this.shape&&_this.shape.setEnabled(!0)})},RemoveShapeMediator.prototype.onValidChanged=function(valid){this.setValidTexture(valid)},RemoveShapeMediator}(ShapeMediator),TestingIndicatorMediator=function(_super){function TestingIndicatorMediator(view){return _super.call(this,view)||this}return __extends(TestingIndicatorMediator,_super),TestingIndicatorMediator.prototype.destroy=function(){_super.prototype.destroy.call(this)},TestingIndicatorMediator.prototype.setRunning=function(running){running?this.view.show():this.view.hide()},TestingIndicatorMediator}(Mediator),TimerButtonMediator=function(_super){function TimerButtonMediator(view){var _this=_super.call(this,view)||this;return _this.state=TimerButtonState.HIDDEN,_this.initHideAnimNames(),_this.hide(),_this}return __extends(TimerButtonMediator,_super),TimerButtonMediator.prototype.destroy=function(){_super.prototype.destroy.call(this)},TimerButtonMediator.prototype.showAndStart=function(){var _this=this;this.state=TimerButtonState.TIMER,this.view.playAnim("TimerInAnim",function(){_this.view.playLoopedAnim("TimerAnim")})},TimerButtonMediator.prototype.showSuccess=function(){this.state=TimerButtonState.SUCCESS,this.view.playAnim("WinInAnim")},TimerButtonMediator.prototype.showFailure=function(){this.state=TimerButtonState.FAIL,this.view.playAnim("FailInAnim")},TimerButtonMediator.prototype.hide=function(){var animName=this.hideAnimNames[this.state];animName&&this.view.playHideAnim(animName)},TimerButtonMediator.prototype.initHideAnimNames=function(){this.hideAnimNames={},this.hideAnimNames[TimerButtonState.TIMER]="TimerCloseAnim",this.hideAnimNames[TimerButtonState.SUCCESS]="WinOutAnim",this.hideAnimNames[TimerButtonState.FAIL]="FailOutAnim",this.hideAnimNames[TimerButtonState.HIDDEN]="TimerOffScreenAnim"},TimerButtonMediator}(Mediator),WorkspaceMediator=function(_super){function WorkspaceMediator(config){var _this=_super.call(this,config.view)||this;return _this.shapeAdded=function(shape){if(shape){var initialDragEvent=_this.initialDragEvent;_this.initialDragEvent=null;var shapeMediatorID=_this.getShapeMediatorID(shape.getCategory()),parentView=_this.view.getShapeParent(),shapeMediator=_this.mediatorFactory.createMediator(shapeMediatorID,{shape:shape,parentView:parentView,parentComposite:_this.workspace.getParentComposite(),dragEvent:initialDragEvent});_this.addChild(shapeMediator,parentView),_this.shapeMediators.push(shapeMediator),_this.sendToParent(MediatorEvent.SHAPE_ADDED,{shape:shape})}},_this.shapeRemoved=function(shape){var mediator=_this.shapeMediators.find(function(shapeMediator){return shapeMediator.getShape()==shape});mediator&&(_this.sendToParent(MediatorEvent.SHAPE_REMOVED,{shape:shape}),_this.shapeMediators.remove(mediator),_this.destroyChild(mediator))},_this.shapesAreCollidingChanged=function(areColliding){_this.sendToParent(MediatorEvent.SHAPES_COLLIDING_CHANGED,{areColliding:areColliding})},_this.shapesCollided=function(overlapDist){var collideSoundVolume=_this.getSoundVolumeFromCollisionOverlap(overlapDist);_this.playShapeCollideSound(collideSoundVolume)},_this.shapeOutOfBounds=function(outOfBounds){outOfBounds&&_this.sendToParent(MediatorEvent.SHAPE_OUT_OF_BOUNDS)},_this.roofBelowBounds=function(roofShape){roofShape&&_this.sendToParent(MediatorEvent.ROOF_BELOW_BOUNDS,{roofShape:roofShape})},_this.workspace=config.workspace,_this.mediatorFactory=config.mediatorFactory,_this.shapeFactory=config.shapeFactory,_this.shapeMediatorID=config.shapeMediatorID,_this.shapeMediators=[],_this.initialDragEvent=null,_this.lastRemovedShape=null,_this.savedShapeDatas=[],_this.shapeCollideSoundInstance=null,_this.subscriptions=[_this.workspace.onShapeAdded(_this.shapeAdded),_this.workspace.onShapeRemoved(_this.shapeRemoved),_this.workspace.onStaticShapeAdded(_this.shapeAdded),_this.workspace.onStaticShapeRemoved(_this.shapeRemoved),_this.workspace.onDestinationShapeAdded(_this.shapeAdded),_this.workspace.onDestinationShapeRemoved(_this.shapeRemoved),_this.workspace.onShapesAreCollidingChanged(_this.shapesAreCollidingChanged),_this.workspace.onShapesCollided(_this.shapesCollided),_this.workspace.onShapeOutOfBounds(_this.shapeOutOfBounds),_this.workspace.onRoofBelowBounds(_this.roofBelowBounds)],_this.addShapes(config.shapeDatas),_this.addStaticShapes(config.staticShapeDatas),_this.addDynamicShapes(config.dynamicShapeDatas),_this.addDestinationShapes(config.destinationShapeDatas),_this}return __extends(WorkspaceMediator,_super),WorkspaceMediator.prototype.getWorkspace=function(){return this.workspace},WorkspaceMediator.prototype.destroy=function(){this.subscriptions.forEach(function(unsubscribable){unsubscribable.unsubscribe()}),this.shapeMediators=[],this.initialDragEvent&&(this.initialDragEvent=null),this.mediatorFactory&&(this.mediatorFactory=null),this.shapeFactory&&(this.shapeFactory.destroy(),this.shapeFactory=null),this.workspace&&(this.workspace.destroy(),this.workspace=null),this.lastRemovedShape=null,this.savedShapeDatas=null,this.shapeCollideSoundInstance=null,_super.prototype.destroy.call(this)},WorkspaceMediator.prototype.update=function(frameTime){_super.prototype.update.call(this,frameTime),this.workspace.update(frameTime)},WorkspaceMediator.prototype.handleMessage=function(messageID,args,sender){if(messageID==MediatorEvent.SLOT_SHAPE_DRAG_STARTED){var shapeType=args.shapeType,dragEvent=args.dragEvent,globalSlotPosition=args.globalSlotPosition;this.addShapeFromDrag(shapeType,dragEvent,globalSlotPosition)}else messageID==MediatorEvent.SHAPE_CLICKED&&this.swapShape(args.shape)},WorkspaceMediator.prototype.pointInsideBounds=function(position){return this.workspace.contains(position)},WorkspaceMediator.prototype.removeShape=function(shape){this.workspace.removeShape(shape)},WorkspaceMediator.prototype.getShapeMediator=function(shape){return this.shapeMediators.find(function(shapeMediator){return shapeMediator.getShape()==shape})},WorkspaceMediator.prototype.getShapeMediatorByID=function(id){return this.shapeMediators.find(function(shapeMediator){return shapeMediator.getShape().getId()==id})},WorkspaceMediator.prototype.setEnabled=function(enabled){this.workspace.setEnabled(enabled)},WorkspaceMediator.prototype.disableShapesNotBeingDragged=function(dragShape){dragShape&&this.workspace.getShapes().forEach(function(shape){shape!==dragShape&&shape.setEnabled(!1)})},WorkspaceMediator.prototype.setShapesToUneditable=function(){this.workspace.getShapes().forEach(function(shape){shape.setEditable(!1)})},WorkspaceMediator.prototype.setShapesAsSleeping=function(sleeping){this.workspace.getShapes().forEach(function(shape){shape.setSleeping(sleeping)})},WorkspaceMediator.prototype.removeLastRemovedShape=function(){this.workspace.removeShape(this.lastRemovedShape),this.lastRemovedShapeConfig=this.shapeFactory.createShapeConfig(this.lastRemovedShape,!1),this.lastRemovedShape=null},WorkspaceMediator.prototype.restoreLastRemovedShape=function(){var lastRemovedShape=this.shapeFactory.createShape(this.lastRemovedShapeConfig);this.lastRemovedShapeConfig=null,this.workspace.addShape(lastRemovedShape),this.swapShape(lastRemovedShape)},WorkspaceMediator.prototype.saveShapes=function(){this.savedShapeDatas=this.workspace.getShapeDatas()},WorkspaceMediator.prototype.restoreSavedShapes=function(){this.workspace.restoreFromShapeDatas(this.savedShapeDatas)},WorkspaceMediator.prototype.findShapes=function(shapeType){return this.workspace.getShapes().filter(function(shape){return shape.getType()==shapeType})},WorkspaceMediator.prototype.findMatchingShape=function(shapeType){var matchingShapes=this.findShapes(shapeType);return matchingShapes.hasItems?matchingShapes[0]:null},WorkspaceMediator.prototype.hasOnlyOneShape=function(){return 1==this.workspace.getShapeCount()},WorkspaceMediator.prototype.hasShapesBeingDragged=function(){return this.shapeMediators.some(function(shapeMediator){return shapeMediator.isBeingDragged()})},WorkspaceMediator.prototype.addShapes=function(shapeDatas){var _this=this;(shapeDatas=shapeDatas||[]).forEach(function(shapeData){_this.addShape({type:shapeData.type,category:ShapeCategory.SHELF,enable:!0,shapeData:shapeData})})},WorkspaceMediator.prototype.addStaticShapes=function(shapeDatas){var _this=this;(shapeDatas=shapeDatas||[]).forEach(function(shapeData){_this.addStaticShape({type:shapeData.type,category:ShapeCategory.STATIC,enable:!1,shapeData:shapeData,bodyOptions:{isStatic:!0}})})},WorkspaceMediator.prototype.addDynamicShapes=function(shapeDatas){var _this=this;(shapeDatas=shapeDatas||[]).forEach(function(shapeData){_this.addShape({type:shapeData.type,category:ShapeCategory.DYNAMIC,enable:!1,shapeData:shapeData})})},WorkspaceMediator.prototype.addDestinationShapes=function(shapeDatas){var _this=this;(shapeDatas=shapeDatas||[]).forEach(function(shapeData){_this.addDestinationShape({type:shapeData.type,category:ShapeCategory.DESTINATION,enable:!1,shapeData:shapeData,bodyOptions:{isStatic:!0}})})},WorkspaceMediator.prototype.addShape=function(createShapeConfig){var shape=this.shapeFactory.createShape(createShapeConfig);this.workspace.addShape(shape)},WorkspaceMediator.prototype.addStaticShape=function(createShapeConfig){var shape=this.shapeFactory.createShape(createShapeConfig);this.workspace.addStaticShape(shape)},WorkspaceMediator.prototype.addDestinationShape=function(createShapeConfig){var shape=this.shapeFactory.createShape(createShapeConfig);this.workspace.addDestinationShape(shape)},WorkspaceMediator.prototype.addShapeFromDrag=function(type,dragEvent,globalSlotPosition){this.initialDragEvent=dragEvent;var slotPosition=Vector.transformGlobalToChild(globalSlotPosition,this.view.getShapeParent());this.addShape({type:type,category:ShapeCategory.SHELF,enable:!0,position:slotPosition})},WorkspaceMediator.prototype.getShapeMediatorID=function(shapeCategory){return shapeCategory==ShapeCategory.SHELF?this.shapeMediatorID:shapeCategory==ShapeCategory.DESTINATION?MediatorID.DESTINATION_SHAPE:MediatorID.SHAPE},WorkspaceMediator.prototype.swapShape=function(nextRemovedShape){this.lastRemovedShape&&(this.lastRemovedShape.setShow(!0),this.workspace.registerBody(this.lastRemovedShape.getBody())),nextRemovedShape.setShow(!1),this.workspace.deregisterBody(nextRemovedShape.getBody()),this.lastRemovedShape=nextRemovedShape},WorkspaceMediator.prototype.getSoundVolumeFromCollisionOverlap=function(overlapDist){return(overlapDist=MathExt.clamp(overlapDist,0,3))/3},WorkspaceMediator.prototype.playShapeCollideSound=function(soundVolume){var _this=this,newSoundLoudEnough=(this.shapeCollideSoundInstance?this.shapeCollideSoundInstance.volume+.1:0)<soundVolume;this.shapeCollideSoundInstance&&!newSoundLoudEnough||(this.shapeCollideSoundInstance=app.sound.play("blockCollide",{volume:soundVolume,complete:function(){_this.shapeCollideSoundInstance=null}}))},WorkspaceMediator}(Mediator),IntroMediator=function(_super){function IntroMediator(config){var _this=_super.call(this,config.view)||this;return _this.introComplete=function(){_this.sendToParent(MediatorEvent.INTRO_COMPLETE),_this.sendToParent(MediatorEvent.CHANGE_MEDIATOR,{mediatorID:MediatorID.LOCATION_SELECT})},_this.view.on(IntroView.INTRO_COMPLETE,_this.introComplete),_this.view.on(IntroView.SKIP_BUTTON_PRESSED,_this.introComplete),_this.view.show(),_this}return __extends(IntroMediator,_super),IntroMediator.prototype.destroy=function(){this.view.off(IntroView.INTRO_COMPLETE,this.introComplete),this.view.off(IntroView.SKIP_BUTTON_PRESSED,this.introComplete),_super.prototype.destroy.call(this)},IntroMediator}(Mediator),LevelButtonMediator=function(_super){function LevelButtonMediator(config){var _this=_super.call(this,config.view)||this;return _this.buttonPressed=function(clickEvent){_this.sendToParent(TelemetryEventType.BUTTON_CLICK,{buttonID:ButtonID.STAGE,clickEvent:clickEvent}),_this.sendToParent(MediatorEvent.LEVEL_SELECTED,{levelNodeID:_this.levelNodeID})},_this.buttonViewConfigs=config.buttonViewConfigs,_this.levelNodeID=config.levelNodeID,_this.state=null,_this.setState(config.state),_this.view.setPosition(config.position),_this.view.on(LevelButtonView.BUTTON_PRESSED,_this.buttonPressed),_this}return __extends(LevelButtonMediator,_super),LevelButtonMediator.prototype.getLevelNodeID=function(){return this.levelNodeID},LevelButtonMediator.prototype.destroy=function(){this.view.off(LevelButtonView.BUTTON_PRESSED,this.buttonPressed),_super.prototype.destroy.call(this)},LevelButtonMediator.prototype.unlock=function(){this.setState(LevelButtonStateID.UNLOCKED),this.view.showUnlockParticles()},LevelButtonMediator.prototype.setComplete=function(){this.setState(LevelButtonStateID.COMPLETE)},LevelButtonMediator.prototype.setState=function(state){this.state=state;var buttonViewConfig=this.buttonViewConfigs[this.state];this.view.configureButton(buttonViewConfig);var interactive=this.isStateInteractive(this.state);this.view.setInteractive(interactive),this.view.hideUnlockParticles()},LevelButtonMediator.prototype.isStateInteractive=function(state){return state!=LevelButtonStateID.LOCKED},LevelButtonMediator}(Mediator),LevelPathMediator=function(_super){function LevelPathMediator(config){var _this=_super.call(this,config.view)||this;return _this.view.setTexture(config.texture),_this.view.setPosition(config.position),_this.view.setPoints(config.points),_this.sourceLevelNodeID=config.sourceLevelNodeID,_this.targetLevelNodeID=config.targetLevelNodeID,_this.setSourceComplete(!1),_this.setTargetComplete(!1),_this}return __extends(LevelPathMediator,_super),LevelPathMediator.prototype.getSourceLevelNodeID=function(){return this.sourceLevelNodeID},LevelPathMediator.prototype.getTargetLevelNodeID=function(){return this.targetLevelNodeID},LevelPathMediator.prototype.destroy=function(){_super.prototype.destroy.call(this)},LevelPathMediator.prototype.setSourceComplete=function(isComplete){this.sourceComplete=isComplete,this.updateView()},LevelPathMediator.prototype.setTargetComplete=function(isComplete){this.targetComplete=isComplete,this.updateView()},LevelPathMediator.prototype.updateView=function(){this.view.visible=this.sourceComplete,this.view.setAnimated(this.sourceComplete&&!this.targetComplete)},LevelPathMediator}(Mediator),LevelSelectMediator=function(_super){function LevelSelectMediator(config){var _this=_super.call(this,config.view)||this;return _this.levelComplete=function(level){if(level){var levelButtonMediator=_this.findLevelButtonByNodeID(level.getNodeID());levelButtonMediator&&levelButtonMediator.setComplete(),_this.levelPathMediators.filter(function(path){return path.getSourceLevelNodeID()==level.getNodeID()}).forEach(function(path){return path.setSourceComplete(!0)}),_this.levelPathMediators.filter(function(path){return path.getTargetLevelNodeID()==level.getNodeID()}).forEach(function(path){return path.setTargetComplete(!0)});var levelID=_this.playerProgress.getNodeLevelID(level.getNodeID());_this.sendMessageToParent(TelemetryEventType.STAGE_PASS,{levelID:levelID,levelObjectiveCompleteText:_this.getLevelObjectiveCompleteText(levelID)})}},_this.levelsUnlocked=function(levels){levels&&levels.forEach(function(level){var levelButtonMediator=_this.findLevelButtonByNodeID(level.getNodeID());levelButtonMediator&&levelButtonMediator.unlock();var levelID=_this.playerProgress.getNodeLevelID(level.getNodeID());_this.sendMessageToParent(TelemetryEventType.STAGE_UNLOCK,{levelID:levelID})})},_this.locationUnlocked=function(locationID){locationID&&(_this.unlockLocationButtons(locationID),_this.sendMessageToParent(TelemetryEventType.WORLD_UNLOCK,{locationID:locationID}))},_this.unlockedLocationsChanged=function(locationIDs){_this.enableLocationButtons(locationIDs)},_this.lastLevelComplete=function(complete){complete&&(_this.sendMessageToParent(MediatorEvent.SHOW_DIALOG,{mediatorID:MediatorID.LAST_LEVEL_COMPLETE_DIALOG}),_this.sendMessageToParent(TelemetryEventType.GAME_COMPLETE,{allLevelsComplete:!1}),_this.playerProgress.handledLastLevelComplete())},_this.locationComplete=function(locationID){locationID&&(_this.playerProgress.handledLocationComplete(),_this.sendMessageToParent(TelemetryEventType.WORLD_COMPLETE,{locationID:locationID}))},_this.gameComplete=function(complete){complete&&(_this.sendMessageToParent(MediatorEvent.SHOW_DIALOG,{mediatorID:MediatorID.GAME_COMPLETE_DIALOG}),_this.sendMessageToParent(TelemetryEventType.GAME_COMPLETE,{allLevelsComplete:!0}),_this.playerProgress.handledGameComplete())},_this.locationID=config.locationID,_this.playerProgress=config.playerProgress,_this.mediatorFactory=config.mediatorFactory,_this.timeoutVOStateMachine=config.timeoutVOStateMachine,_this.getLevelObjectiveCompleteText=config.getLevelObjectiveCompleteText,_this.levelButtonMediators=[],_this.levelPathMediators=[],_this.locationButtonMediators=[],_this.view.setBackground(config.backgroundTextureName),_this.addLevelButtons(config),_this.addLevelPaths(config),_this.addLocationButtons(config.neighbourLocationGroupData),app.options.debug&&_this.addDebugCheatsMediator(config.levelGraphNodes),_this.subscriptions=[_this.playerProgress.onLevelComplete(_this.levelComplete),_this.playerProgress.onLevelsUnlocked(_this.levelsUnlocked),_this.playerProgress.onLocationUnlocked(_this.locationUnlocked),_this.playerProgress.onUnlockedLocationsChanged(_this.unlockedLocationsChanged),_this.playerProgress.onLastLevelComplete(_this.lastLevelComplete),_this.playerProgress.onLocationComplete(_this.locationComplete),_this.playerProgress.onGameComplete(_this.gameComplete)],_this.view.playVO(config.enterVOName),_this.timeoutVOStateMachine.setState(GameState.LEVEL_SELECT),_this}return __extends(LevelSelectMediator,_super),LevelSelectMediator.prototype.destroy=function(){this.subscriptions.forEach(function(unsubscribable){unsubscribable.unsubscribe()}),this.subscriptions=null,this.timeoutVOStateMachine&&(this.timeoutVOStateMachine.destroy(),this.timeoutVOStateMachine=null),this.levelButtonMediators=null,this.levelPathMediators=null,this.locationButtonMediators=null,this.playerProgress=null,this.mediatorFactory=null,this.getLevelObjectiveCompleteText=null,_super.prototype.destroy.call(this)},LevelSelectMediator.prototype.sendMessageToParent=function(messageID,args,child){var _this=this;setTimeout(function(){_this.sendToParent(messageID,args,child)},0)},LevelSelectMediator.prototype.addLevelButtons=function(config){var _this=this,levelProgresses=config.levelGraphNodes.map(function(levelGraphNode){return _this.playerProgress.getLevelByNodeID(levelGraphNode.getID())});config.levelGraphNodes.map(function(levelGraphNode){return _this.mediatorFactory.createLevelButtonCreatorConfig(levelGraphNode,config.levelDatas,levelProgresses)}).map(function(buttonConfig){return _this.mediatorFactory.createMediator(MediatorID.LEVEL_BUTTON,buttonConfig)}).forEach(function(levelButtonMediator){var levelButtonParent=_this.view.getLevelButtonParent();_this.addChild(levelButtonMediator,levelButtonParent),_this.levelButtonMediators.push(levelButtonMediator)})},LevelSelectMediator.prototype.addLevelPaths=function(config){for(var parent=this.view.getLevelPathsParent(),_i=0,_a=config.levelGraphNodes;_i<_a.length;_i++)for(var node=_a[_i],_b=0,_c=node.getNeighbourPaths();_b<_c.length;_b++){var neighbour=_c[_b],neighbourNodeLocation=neighbour.node.getLocationID(),hasNextLocation=!!config.neighbourLocationGroupData.next,neighbourNodeInThisLocation=neighbourNodeLocation==config.locationID,neighbourNodeInNextLocation=hasNextLocation&&neighbourNodeLocation==config.neighbourLocationGroupData.next.locationID;if(neighbourNodeInThisLocation||neighbourNodeInNextLocation){var pathConfig={texture:neighbour.texture,points:neighbour.points,position:neighbour.position,sourceLevelNodeID:node.getID(),targetLevelNodeID:neighbour.node.getID()},pathMediator=this.mediatorFactory.createMediator(MediatorID.LEVEL_PATH,pathConfig);pathMediator.setSourceComplete(this.playerProgress.getLevelByNodeID(node.getID()).isComplete()),pathMediator.setTargetComplete(this.playerProgress.getLevelByNodeID(neighbour.node.getID()).isComplete()),this.addChild(pathMediator,parent),this.levelPathMediators.append(pathMediator)}}},LevelSelectMediator.prototype.addLocationButtons=function(neighbourLocationGroupData){var previousLocationButtonMediator=this.createLocationButtonMediator(neighbourLocationGroupData.previous,!1),nextLocationButtonMediator=this.createLocationButtonMediator(neighbourLocationGroupData.next,!0);this.locationButtonMediators=[previousLocationButtonMediator,nextLocationButtonMediator].filterOutNulls();var locationButtonParent=this.view.getLocationButtonParent();this.addChildren(this.locationButtonMediators,locationButtonParent)},LevelSelectMediator.prototype.addDebugCheatsMediator=function(levelGraphNodes){var debugCheatsMediator=this.mediatorFactory.createMediator(MediatorID.DEBUG_LEVEL_SELECT_CHEATS,{levelGraphNodes:levelGraphNodes}),debugCheatsParent=this.view.getDebugLayer();this.addChild(debugCheatsMediator,debugCheatsParent)},LevelSelectMediator.prototype.findLevelButtonByNodeID=function(nodeID){return this.levelButtonMediators.find(function(levelButtonMediator){return levelButtonMediator.getLevelNodeID()==nodeID})},LevelSelectMediator.prototype.unlockLocationButtons=function(locationID){this.locationButtonMediators.filter(function(locationButtonMediator){return locationButtonMediator.getTargetLocationID()==locationID}).forEach(function(locationButtonMediator){locationButtonMediator.unlock()})},LevelSelectMediator.prototype.enableLocationButtons=function(locationIDs){this.locationButtonMediators.filter(function(locationButtonMediator){return locationIDs.contains(locationButtonMediator.getTargetLocationID())}).forEach(function(locationButtonMediator){locationButtonMediator.setEnabled(!0)})},LevelSelectMediator.prototype.createLocationButtonMediator=function(neighbourLocationData,isNextButton){var locationButtonMediator=null;return neighbourLocationData&&(locationButtonMediator=this.mediatorFactory.createMediator(MediatorID.LOCATION_BUTTON,{targetLocationID:neighbourLocationData.locationID,position:neighbourLocationData.buttonPosition,isNextButton:isNextButton})),locationButtonMediator},LevelSelectMediator}(Mediator),LocationButtonMediator=function(_super){function LocationButtonMediator(config){var _this=_super.call(this,config.view)||this;return _this.clicked=function(clickEvent){_this.sendToParent(TelemetryEventType.BUTTON_CLICK,{buttonID:ButtonID.WORLD,clickEvent:clickEvent}),_this.sendToParent(MediatorEvent.LOCATION_BUTTON_PRESSED,{locationID:_this.targetLocationID})},_this.targetLocationID=config.targetLocationID,_this.unlockLocationVOName=config.unlockLocationVOName,_this.view.setPosition(config.position),_this.view.configureButton(config.buttonConfig),_this.view.on(LocationButtonView.CLICKED,_this.clicked),_this.setEnabled(!1),_this}return __extends(LocationButtonMediator,_super),LocationButtonMediator.prototype.getTargetLocationID=function(){return this.targetLocationID},LocationButtonMediator.prototype.destroy=function(){this.view.off(LocationButtonView.CLICKED,this.clicked),_super.prototype.destroy.call(this)},LocationButtonMediator.prototype.setEnabled=function(enabled){this.view.setEnabled(enabled)},LocationButtonMediator.prototype.unlock=function(){app.sound.play("mapUnlock"),this.view.playVO(this.unlockLocationVOName),this.view.showUnlockGlow()},LocationButtonMediator}(Mediator),LocationSelectMediator=function(_super){function LocationSelectMediator(config){var _this=_super.call(this,config.view)||this;_this.mediatorArgs=config.mediatorArgs,_this.mediatorFactory=config.mediatorFactory,_this.locationDatas=config.locationDatas,_this.neighbourLocationGroupDatas=config.neighbourLocationGroupDatas,_this.playerProgress=config.playerProgress,_this.levelGraph=config.levelGraph,_this.currentLocationID=null,_this.currentLevelSelectMediator=null;var initialLocationID=_this.getInitialLocationID();return _this.goToLocation(initialLocationID),app.music="levelSelectMusic",_this}return __extends(LocationSelectMediator,_super),LocationSelectMediator.prototype.destroy=function(){this.currentLocationID=null,this.currentLevelSelectMediator=null,this.currentLevelSelectMediator=null,this.mediatorFactory=null,this.locationDatas=null,this.neighbourLocationGroupDatas=null,this.playerProgress=null,this.levelGraph=null,_super.prototype.destroy.call(this)},LocationSelectMediator.prototype.handleChildMessage=function(messageID,args,child){if(messageID==MediatorEvent.LEVEL_SELECTED){var levelNodeID=args.levelNodeID;this.openGameLevel(levelNodeID)}else if(messageID==MediatorEvent.LOCATION_BUTTON_PRESSED){var locationID=args.locationID;this.transitionToLocation(locationID)}this.sendToParent(messageID,args,child)},LocationSelectMediator.prototype.getInitialLocationID=function(){return this.mediatorArgs.locationID||this.getLocationOfLastUnlockedLevel()},LocationSelectMediator.prototype.getLocationOfLastUnlockedLevel=function(){var lastUnlockedLevelProgress=this.playerProgress.findLastUnlockedLevel();return this.levelGraph.getNode(lastUnlockedLevelProgress.getNodeID()).getLocationID()},LocationSelectMediator.prototype.transitionToLocation=function(locationID){var _this=this;this.handledNewlyUnlockedLevels(),app.enableUserInput(!1),this.view.showMapTransition(function(){_this.goToLocation(locationID)},function(){app.enableUserInput(!0)})},LocationSelectMediator.prototype.goToLocation=function(locationID){var _this=this,levelSelectMediator=this.createLevelSelectMediator(locationID),parentView=this.view.getLevelSelectParent();this.destroyChild(this.currentLevelSelectMediator),this.addChild(levelSelectMediator,parentView),this.currentLevelSelectMediator=levelSelectMediator,this.currentLocationID=locationID,setTimeout(function(){_this.sendToParent(TelemetryEventType.LOAD_WORLD,{locationID:locationID})},0)},LocationSelectMediator.prototype.openGameLevel=function(levelNodeID){if(this.currentLocationID){this.handledNewlyUnlockedLevels();var levelID=this.levelGraph.getNode(levelNodeID).getLevelID(),levelData=this.locationDatas[this.currentLocationID][levelID],isTutorial=!!levelData.tutorialStepIDs,levelProgress=this.playerProgress.getLevelByNodeID(levelNodeID),mediatorID=MediatorUtils.getLevelMediatorID(levelData.type,isTutorial);this.sendToParent(TelemetryEventType.START_STAGE,{levelID:levelID,levelType:levelData.type}),this.sendToParent(MediatorEvent.CHANGE_MEDIATOR,{mediatorID:mediatorID,args:{locationID:this.currentLocationID,levelID:levelID,levelData:levelData,levelProgress:levelProgress,previousMediatorID:MediatorID.LOCATION_SELECT}})}},LocationSelectMediator.prototype.createLevelSelectMediator=function(locationID){var levelDatas=this.locationDatas[locationID],levelGraphNodes=this.levelGraph.getNodesForLocation(locationID),neighbourLocationGroupData=this.neighbourLocationGroupDatas[locationID];return this.mediatorFactory.createMediator(MediatorID.LEVEL_SELECT,{locationID:locationID,neighbourLocationGroupData:neighbourLocationGroupData,levelDatas:levelDatas,levelGraphNodes:levelGraphNodes,playerProgress:this.playerProgress})},LocationSelectMediator.prototype.handledNewlyUnlockedLevels=function(){if(this.playerProgress){var localNodeIDs=this.levelGraph.getNodeIDsForLocation(this.currentLocationID);this.playerProgress.handledNewlyUnlockedLevels(localNodeIDs)}},LocationSelectMediator}(Mediator),RootMediator=function(_super){function RootMediator(config){var _this=_super.call(this,config.view)||this;return _this.mediatorFactory=config.mediatorFactory,_this.container=config.container,_this.levelGraph=new LevelGraph(config.levelGraphData),_this.storageService=_this.createStorageService(config.maxLoadTimeout),_this.playerProgress=_this.createPlayerProgress(config.playerProgressData),_this.telemetryHandler=_this.createTelemetryHandler(config.appVersion),_this.mediatorFactory.setLevelGraph(_this.levelGraph),_this.mediatorFactory.setPlayerProgress(_this.playerProgress),_this.currentChild=null,_this.currentChildMediatorID=null,_this.dialogHolderMediator=null,_this.loadingMediator=null,_this.initChildMediators(),_this.playerProgress.load(function(){_this.setChild(MediatorID.SPLASH),_this.telemetryHandler.handleEvent(TelemetryEventType.START_GAME)}),_this}return __extends(RootMediator,_super),RootMediator.prototype.destroy=function(){this.mediatorFactory&&(this.mediatorFactory.setPlayerProgress(null),this.mediatorFactory=null),this.currentChild&&(this.destroyChild(this.currentChild),this.currentChild=null),this.currentChildMediatorID=null,this.dialogHolderMediator=null,this.loadingMediator=null,this.playerProgress&&(this.playerProgress.save(),this.playerProgress.destroy(),this.playerProgress=null),this.levelGraph&&this.levelGraph.destroy(),this.storageService=null,this.telemetryHandler=null,_super.prototype.destroy.call(this)},RootMediator.prototype.handleChildMessage=function(messageID,args,child){messageID==MediatorEvent.CHANGE_MEDIATOR?this.setChild(args.mediatorID,args.args):messageID==MediatorEvent.SHOW_DIALOG?this.showDialog(args.mediatorID,args.args):messageID==MediatorEvent.INTRO_COMPLETE?this.introComplete():messageID==MediatorEvent.HIDE_DIALOG?this.hideDialog():messageID==MediatorEvent.RESET_GAME?this.resetGame():_super.prototype.handleChildMessage.call(this,messageID,args,child),this.telemetryHandler&&this.telemetryHandler.handleEvent(messageID,args)},RootMediator.prototype.createStorageService=function(maxLoadTimeout){return app.useRtlStorage()?new RTLStorageService({container:this.container,maxLoadTimeout:maxLoadTimeout}):new LocalStorageService},RootMediator.prototype.createPlayerProgress=function(playerProgressData){var _this=this;return new PlayerProgress({data:playerProgressData,storageService:this.storageService,getNeighbourNodeIDs:function(nodeID){return _this.levelGraph.getNodeNeighbourIDs(nodeID)},getNodeLocationID:function(nodeID){return _this.levelGraph.getNode(nodeID).getLocationID()},getNodeLevelID:function(nodeID){return _this.levelGraph.getNode(nodeID).getLevelID()},lastLevelNodeID:this.levelGraph.getLastLevelNodeID()})},RootMediator.prototype.createTelemetryHandler=function(appVersion){var analyticsService=new TPTAnalyticsService({container:this.container,appVersion:appVersion,enabled:app.useRtlAnalytics()}),telemetryEvents=new TelemetryEvents({analyticsService:analyticsService,container:this.container,clickParentView:this.view});return new TelemetryHandler({telemetryEvents:telemetryEvents})},RootMediator.prototype.initChildMediators=function(){this.dialogHolderMediator=this.mediatorFactory.createMediator(MediatorID.DIALOG_HOLDER);var dialogHolderParent=this.view.getDialogHolderParent();this.addChild(this.dialogHolderMediator,dialogHolderParent),this.loadingMediator=this.mediatorFactory.createMediator(MediatorID.LOADING);var loadingHolderParent=this.view.getLoadingHolderParent();this.addChild(this.loadingMediator,loadingHolderParent)},RootMediator.prototype.setChild=function(mediatorID,mediatorArgs){var _this=this;this.destroyChild(this.currentChild),this.loadingMediator.startLoading(this.currentChildMediatorID,mediatorID,function(){var mediator=_this.mediatorFactory.createMediator(mediatorID,mediatorArgs);if(mediator){var parentView=_this.view.getContentHolder();_this.addChild(mediator,parentView),_this.currentChild=mediator,_this.currentChildMediatorID=mediatorID}_this.loadingMediator.hide()})},RootMediator.prototype.introComplete=function(){this.playerProgress.setIntroWatched()},RootMediator.prototype.showDialog=function(mediatorID,mediatorArgs){var dialog=this.mediatorFactory.createMediatorAsDialog(mediatorID,mediatorArgs);this.dialogHolderMediator.show(dialog)},RootMediator.prototype.hideDialog=function(){this.dialogHolderMediator.hide()},RootMediator.prototype.resetGame=function(){this.playerProgress.reset(),this.setChild(MediatorID.INTRO)},RootMediator}(Mediator),SplashMediator=function(_super){function SplashMediator(config){var _this=_super.call(this,config.view)||this;return _this.playButtonClicked=function(clickEvent){_this.sendToParent(TelemetryEventType.BUTTON_CLICK,{buttonID:ButtonID.SPLASH_ENTER,clickEvent:clickEvent});var nextMediator=MediatorID.INTRO;_this.playerProgress.hasWatchedIntro()&&(nextMediator=MediatorID.LOCATION_SELECT),_this.sendToParent(MediatorEvent.CHANGE_MEDIATOR,{mediatorID:nextMediator})},_this.playerProgress=config.playerProgress,_this.view.on(SplashView.PLAY_BUTTON_CLICKED,_this.playButtonClicked),_this}return __extends(SplashMediator,_super),SplashMediator.prototype.destroy=function(){this.view.off(SplashView.PLAY_BUTTON_CLICKED,this.playButtonClicked),this.playerProgress=null,_super.prototype.destroy.call(this)},SplashMediator}(Mediator),TelemetryEvents=function(){function TelemetryEvents(config){if(!config.analyticsService)throw"TelemetryEvents: analyticsService is null.";if(!config.container)throw"TelemetryEvents: container is null.";this.analyticsService=config.analyticsService,this.container=config.container,this.clickParentView=config.clickParentView}return TelemetryEvents.prototype.sendStartGame=function(){this.sendEvent(TelemetryEventType.START_GAME)},TelemetryEvents.prototype.sendButtonClick=function(buttonID,clickEvent){var eventData={buttonName:this.stringifyButtonID(buttonID),coordinates:null};if(this.canSendClickCoords(clickEvent)){var clickPos=Vector.transformGlobalToChild(clickEvent.data.global,this.clickParentView),clickCoords=this.stringifyVector(clickPos);eventData.coordinates=clickCoords}this.sendEvent(TelemetryEventType.BUTTON_CLICK,eventData)},TelemetryEvents.prototype.sendPlacedObject=function(shapeType,position,isValid){this.sendObjectEventWithValid(TelemetryEventType.PLACED_OBJECT,shapeType,position,isValid)},TelemetryEvents.prototype.sendRotatedObject=function(shapeType,rotation){this.sendEvent(TelemetryEventType.ROTATED_OBJECT,{objectName:shapeType.toString(),rotation:rotation.toFixed(2)})},TelemetryEvents.prototype.sendReturnedObject=function(shapeType,position){this.sendObjectEvent(TelemetryEventType.RETURNED_OBJECT,shapeType,position)},TelemetryEvents.prototype.sendRemovedObject=function(shapeType,position){this.sendObjectEvent(TelemetryEventType.REMOVED_OBJECT,shapeType,position)},TelemetryEvents.prototype.sendRoofDropped=function(){this.sendEvent(TelemetryEventType.ROOF_DROPPED)},TelemetryEvents.prototype.sendStartStage=function(levelID,levelType){this.sendStageEvent(TelemetryEventType.START_STAGE,levelID,levelType)},TelemetryEvents.prototype.sendQuitStage=function(levelID){this.sendStageEvent(TelemetryEventType.QUIT_STAGE,levelID)},TelemetryEvents.prototype.sendStageReset=function(levelID){this.sendStageEvent(TelemetryEventType.STAGE_RESET,levelID)},TelemetryEvents.prototype.sendStageFail=function(levelID){this.sendStageEvent(TelemetryEventType.STAGE_FAIL,levelID)},TelemetryEvents.prototype.sendStagePass=function(levelID,levelObjectiveCompleteText){this.sendStageEvent(TelemetryEventType.STAGE_PASS,levelID);var stageNameCompleteText=this.buildStageNameCompleteText(levelID);this.sendObjectiveCompleteEvent(stageNameCompleteText),levelObjectiveCompleteText&&this.sendObjectiveCompleteEvent(levelObjectiveCompleteText)},TelemetryEvents.prototype.sendStageUnlock=function(levelID){this.sendStageEvent(TelemetryEventType.STAGE_UNLOCK,levelID)},TelemetryEvents.prototype.sendLoadWorld=function(locationID){this.sendWorldEvent(TelemetryEventType.LOAD_WORLD,locationID)},TelemetryEvents.prototype.sendWorldUnlock=function(locationID){this.sendWorldEvent(TelemetryEventType.WORLD_UNLOCK,locationID)},TelemetryEvents.prototype.sendWorldComplete=function(locationID){this.sendWorldEvent(TelemetryEventType.WORLD_COMPLETE,locationID);var worldNameCompleteText=this.buildWorldNameCompleteText(locationID);this.sendObjectiveCompleteEvent(worldNameCompleteText)},TelemetryEvents.prototype.sendGameComplete=function(allLevelsComplete){this.sendEvent(TelemetryEventType.GAME_COMPLETE,{allLevelsComplete:allLevelsComplete});var objectiveEvent=allLevelsComplete?TelemetryEventType.ALL_LEVELS_COMPLETE:TelemetryEventType.GAME_COMPLETE;this.sendObjectiveCompleteEvent(objectiveEvent)},TelemetryEvents.prototype.sendEvent=function(eventType,eventData){var eventName=eventType;this.analyticsService.send(eventName,eventData)},TelemetryEvents.prototype.sendObjectiveCompleteEvent=function(objectiveProgressLabel){this.analyticsService.enabled&&(this.container.send("objective_complete",{op_label:objectiveProgressLabel,success:!0,is_second_player:!1}),console.log("SENT OBJECTIVE COMPLETE:",objectiveProgressLabel))},TelemetryEvents.prototype.sendWorldEvent=function(eventType,worldName){this.sendEvent(eventType,{worldName:worldName.toString()})},TelemetryEvents.prototype.sendStageEvent=function(eventType,stageName,levelType){this.sendEvent(eventType,{stageName:stageName,levelType:levelType})},TelemetryEvents.prototype.sendObjectEvent=function(eventType,objectName,coordinates){this.sendEvent(eventType,{objectName:objectName.toString(),coordinates:this.stringifyVector(coordinates)})},TelemetryEvents.prototype.sendObjectEventWithValid=function(eventType,objectName,coordinates,valid){this.sendEvent(eventType,{objectName:objectName.toString(),coordinates:this.stringifyVector(coordinates),valid:valid})},TelemetryEvents.prototype.stringifyVector=function(vector){return vector.x.toFixed(2)+","+vector.y.toFixed(2)},TelemetryEvents.prototype.stringifyButtonID=function(buttonID){return buttonID},TelemetryEvents.prototype.canSendClickCoords=function(event){return this.clickParentView&&event&&!!event.data},TelemetryEvents.prototype.buildStageNameCompleteText=function(levelID){return levelID+"Complete"},TelemetryEvents.prototype.buildWorldNameCompleteText=function(locationID){return locationID.toString()+"Complete"},TelemetryEvents}(),TelemetryHandler=function(){function TelemetryHandler(config){this.telemetryEvents=config.telemetryEvents}return TelemetryHandler.prototype.destroy=function(){this.telemetryEvents=null},TelemetryHandler.prototype.handleEvent=function(eventName,args){if(eventName==TelemetryEventType.START_GAME)this.telemetryEvents.sendStartGame();else if(eventName==TelemetryEventType.LOAD_WORLD){var locationID=args.locationID;this.telemetryEvents.sendLoadWorld(locationID)}else if(eventName==TelemetryEventType.START_STAGE){var levelID=args.levelID,levelType=args.levelType;this.telemetryEvents.sendStartStage(levelID,levelType)}else if(eventName==TelemetryEventType.QUIT_STAGE){levelID=args.levelID;this.telemetryEvents.sendQuitStage(levelID)}else if(eventName==TelemetryEventType.STAGE_RESET){levelID=args.levelID;this.telemetryEvents.sendStageReset(levelID)}else if(eventName==TelemetryEventType.BUTTON_CLICK){var buttonID=args.buttonID,clickEvent=args.clickEvent;this.telemetryEvents.sendButtonClick(buttonID,clickEvent)}else if(eventName==TelemetryEventType.PLACED_OBJECT){var shapeType=args.shapeType,position=args.position,isValid=args.isValid;this.telemetryEvents.sendPlacedObject(shapeType,position,isValid)}else if(eventName==TelemetryEventType.ROTATED_OBJECT){var objectName=args.shapeType,rotation=args.rotation;this.telemetryEvents.sendRotatedObject(objectName,rotation)}else if(eventName==TelemetryEventType.RETURNED_OBJECT){shapeType=args.shapeType,position=args.position;this.telemetryEvents.sendReturnedObject(shapeType,position)}else if(eventName==TelemetryEventType.REMOVED_OBJECT){shapeType=args.shapeType,position=args.position;this.telemetryEvents.sendRemovedObject(shapeType,position)}else if(eventName==TelemetryEventType.ROOF_DROPPED)this.telemetryEvents.sendRoofDropped();else if(eventName==MediatorEvent.SIMULATION_FAIL){levelID=args.levelID;this.telemetryEvents.sendStageFail(levelID)}else if(eventName==TelemetryEventType.STAGE_PASS){levelID=args.levelID;var levelObjectiveCompleteText=args.levelObjectiveCompleteText;this.telemetryEvents.sendStagePass(levelID,levelObjectiveCompleteText)}else if(eventName==TelemetryEventType.STAGE_UNLOCK){levelID=args.levelID;this.telemetryEvents.sendStageUnlock(levelID)}else if(eventName==TelemetryEventType.WORLD_UNLOCK){locationID=args.locationID;this.telemetryEvents.sendWorldUnlock(locationID)}else if(eventName==TelemetryEventType.WORLD_COMPLETE){locationID=args.locationID;this.telemetryEvents.sendWorldComplete(locationID)}else if(eventName==TelemetryEventType.GAME_COMPLETE){var allLevelsComplete=args.allLevelsComplete;this.telemetryEvents.sendGameComplete(allLevelsComplete)}},TelemetryHandler}(),ShapeFactory=function(){function ShapeFactory(config){this.bodyDatas=config.bodyDatas}return ShapeFactory.prototype.destroy=function(){this.bodyDatas=null},ShapeFactory.prototype.createShape=function(config){var shapeData=this.extendShapeData(config),position=config.position||shapeData.position||Vector.create(),rotation=isDefined(shapeData.rotation)?shapeData.rotation:0,bodyData=this.bodyDatas[config.type],correctPosition=config.correctPosition,bodyOptions=Object.extend({angle:rotation},config.bodyOptions),body=PhysicsEditorUtils.createBody(position.x,position.y,bodyData,bodyOptions,correctPosition);return new Shape({data:shapeData,body:body,bodyData:bodyData})},ShapeFactory.prototype.createShapeConfig=function(shape,correctPosition,bodyOptions){return{type:shape.getType(),category:shape.getCategory(),enable:shape.getEnabled(),position:shape.getPosition(),shapeData:shape.getData(),bodyOptions:bodyOptions,correctPosition:correctPosition}},ShapeFactory.prototype.extendShapeData=function(config){return Object.extend({type:config.type,category:config.category,enabled:config.enable},config.shapeData)},ShapeFactory}(),LevelGraph=function(){function LevelGraph(data){this.nodes=this.createNodes(data),this.endNode=this.findNode(data.endNodeID)}return LevelGraph.prototype.destroy=function(){this.endNode=null,this.destroyNodes()},LevelGraph.prototype.getNodesForLocation=function(locationID){return this.nodes.filter(function(node){return node.getLocationID()==locationID})},LevelGraph.prototype.getNodeIDsForLocation=function(locationID){return this.getNodesForLocation(locationID).map(function(node){return node.getID()})},LevelGraph.prototype.getNode=function(id){return this.findNode(id)},LevelGraph.prototype.getNodeNeighbours=function(id){var neighbourNodes=[],node=this.getNode(id);return node&&(neighbourNodes=node.getNeighbourNodes()),neighbourNodes},LevelGraph.prototype.getNodeNeighbourIDs=function(id){return this.getNodeNeighbours(id).map(function(neighbourNode){return neighbourNode.getID()})},LevelGraph.prototype.getLastLevelNodeID=function(){return this.endNode.getID()},LevelGraph.prototype.createNodes=function(data){var _this=this,nodes=data.nodes.map(function(nodeData){return new LevelGraphNode(nodeData)});return data.connections.forEach(function(connection){_this.connectNodes(connection.startNodeID,connection.endNodeID,connection.pathPosition,connection.path,nodes)}),nodes},LevelGraph.prototype.destroyNodes=function(){this.nodes&&(this.nodes.forEach(function(node){node.destroy()}),this.nodes=null)},LevelGraph.prototype.connectNodes=function(startNodeID,endNodeID,pathPosition,path,nodes){var startNode=this.findNode(startNodeID,nodes),endNode=this.findNode(endNodeID,nodes),pathTexture=startNodeID+"_"+endNodeID;if(startNode&&endNode){startNode.addNeighbourPath({node:endNode,texture:pathTexture,position:pathPosition,points:path});var reversePath=path.clone().reverse();endNode.addNeighbourPath({node:startNode,texture:pathTexture,position:pathPosition,points:reversePath})}},LevelGraph.prototype.findNode=function(id,nodes){return(nodes=nodes||this.nodes).find(function(node){return node.getID()==id})},LevelGraph}(),LevelGraphPath=function(){},LevelGraphNode=function(){function LevelGraphNode(data){if(!data)throw"LevelGraphNode: data is null.";this.data=data,this.neighbourPaths=[]}return LevelGraphNode.prototype.getID=function(){return this.data.id},LevelGraphNode.prototype.getLevelID=function(){return this.data.levelID},LevelGraphNode.prototype.getLocationID=function(){return this.data.locationID},LevelGraphNode.prototype.getPosition=function(){return this.data.position},LevelGraphNode.prototype.getNeighbourNodes=function(){return this.neighbourPaths.map(function(x){return x.node})},LevelGraphNode.prototype.getNeighbourPaths=function(){return this.neighbourPaths},LevelGraphNode.prototype.destroy=function(){this.neighbourPaths=null,this.data=null},LevelGraphNode.prototype.containsPath=function(path){var pathNode=path?path.node:null;return this.getNeighbourNodes().contains(pathNode)},LevelGraphNode.prototype.addNeighbourPath=function(path){this.containsPath(path)||this.neighbourPaths.push(path)},LevelGraphNode}(),LevelProgress=function(){function LevelProgress(config){if(!config.data)throw"LevelProgress: data is null.";this.nodeID=config.data.nodeID,this.state=config.data.state,this.onCompleted=config.onCompleted,this.onSave=config.onSave}return LevelProgress.prototype.getNodeID=function(){return this.nodeID},LevelProgress.prototype.getState=function(){return this.state},LevelProgress.prototype.destroy=function(){this.onCompleted=null,this.onSave=null},LevelProgress.prototype.asData=function(){return{nodeID:this.getNodeID(),state:this.getState()}},LevelProgress.prototype.setUnlocked=function(){this.state=LevelProgressStateID.UNLOCKED_NEW},LevelProgress.prototype.setCompleted=function(){var hasChanged=this.state!=LevelProgressStateID.COMPLETE;this.state=LevelProgressStateID.COMPLETE,hasChanged&&this.onCompleted&&this.onCompleted(this.getNodeID())},LevelProgress.prototype.save=function(){this.onSave&&this.onSave()},LevelProgress.prototype.isLocked=function(){return this.state==LevelProgressStateID.LOCKED},LevelProgress.prototype.isUnlockedAndIncomplete=function(){return this.isNewlyUnlocked()||this.state==LevelProgressStateID.UNLOCKED},LevelProgress.prototype.isNewlyUnlocked=function(){return this.state==LevelProgressStateID.UNLOCKED_NEW},LevelProgress.prototype.isComplete=function(){return this.state==LevelProgressStateID.COMPLETE},LevelProgress.prototype.handledNewlyUnlocked=function(){this.state==LevelProgressStateID.UNLOCKED_NEW&&(this.state=LevelProgressStateID.UNLOCKED)},LevelProgress}(),MilestoneProgress=function(){function MilestoneProgress(data){this.locationComplete=Object.clone(data.locationComplete,!0),this.lastLevelComplete=data.lastLevelComplete,this.gameComplete=data.gameComplete,this.introWatched=data.introWatched}return MilestoneProgress.prototype.locationIsComplete=function(locationID){return this.locationComplete[locationID]},MilestoneProgress.prototype.lastLevelIsComplete=function(){return this.lastLevelComplete},MilestoneProgress.prototype.gameIsComplete=function(){return this.gameComplete},MilestoneProgress.prototype.hasWatchedIntro=function(){return this.introWatched},MilestoneProgress.prototype.destroy=function(){this.locationComplete=null},MilestoneProgress.prototype.asData=function(){return{locationComplete:Object.clone(this.locationComplete,!0),lastLevelComplete:this.lastLevelComplete,gameComplete:this.gameComplete,introWatched:this.introWatched}},MilestoneProgress.prototype.triggerLastLevelComplete=function(triggeredCallback){this.lastLevelComplete||(this.lastLevelComplete=!0,triggeredCallback&&triggeredCallback())},MilestoneProgress.prototype.triggerLocationComplete=function(locationID,triggeredCallback){this.locationComplete[locationID]||(this.locationComplete[locationID]=!0,triggeredCallback&&triggeredCallback())},MilestoneProgress.prototype.triggerGameComplete=function(triggeredCallback){this.gameComplete||(this.gameComplete=!0,triggeredCallback&&triggeredCallback())},MilestoneProgress.prototype.triggerIntroWatched=function(triggeredCallback){this.introWatched||(this.introWatched=!0,triggeredCallback&&triggeredCallback())},MilestoneProgress}(),PlayerProgress=function(){function PlayerProgress(config){var _this=this;if(this.onLevelCompleted=function(nodeID){var level=_this.getLevelByNodeID(nodeID);_this.levelComplete.next(level),_this.unlockNeighboursOfNode(nodeID),_this.lastLevelIsComplete()&&_this.setLastLevelComplete();var locationID=_this.getNodeLocationID(nodeID);_this.locationIsComplete(locationID)&&_this.setLocationComplete(locationID),_this.allLevelsComplete()&&_this.setGameComplete()},this.onSave=function(){_this.save()},!config.data)throw"PlayerProgress: data is null.";if(!config.getNeighbourNodeIDs)throw"PlayerProgress: getNeighbourNodeIDs is null.";this.defaultData=config.data,this.storageService=config.storageService,this.getNeighbourNodeIDs=config.getNeighbourNodeIDs,this.getNodeLocationID=config.getNodeLocationID,this.getNodeLevelID=config.getNodeLevelID,this.lastLevelNodeID=config.lastLevelNodeID,this.levels=[],this.milestones=null,this.levelComplete=new BehaviorSubject(null),this.levelsUnlocked=new BehaviorSubject(null),this.locationUnlocked=new BehaviorSubject(null),this.unlockedLocations=new BehaviorSubject([]),this.lastLevelComplete=new BehaviorSubject(!1),this.locationComplete=new BehaviorSubject(null),this.gameComplete=new BehaviorSubject(!1),this.introWatched=new BehaviorSubject(!1),this.unpackData(this.defaultData)}return PlayerProgress.prototype.getLevels=function(){return this.levels},PlayerProgress.prototype.onLevelComplete=function(cb){return this.levelComplete.subscribe(cb)},PlayerProgress.prototype.onLevelsUnlocked=function(cb){return this.levelsUnlocked.subscribe(cb)},PlayerProgress.prototype.onLocationUnlocked=function(cb){return this.locationUnlocked.subscribe(cb)},PlayerProgress.prototype.onUnlockedLocationsChanged=function(cb){return this.unlockedLocations.subscribe(cb)},PlayerProgress.prototype.onLastLevelComplete=function(cb){return this.lastLevelComplete.subscribe(cb)},PlayerProgress.prototype.onLocationComplete=function(cb){return this.locationComplete.subscribe(cb)},PlayerProgress.prototype.getGameComplete=function(){return this.gameComplete.value},PlayerProgress.prototype.onGameComplete=function(cb){return this.gameComplete.subscribe(cb)},PlayerProgress.prototype.hasWatchedIntro=function(){return this.introWatched.value},PlayerProgress.prototype.onIntroWatched=function(cb){return this.introWatched.subscribe(cb)},PlayerProgress.prototype.destroy=function(){this.clearData(),this.storageService&&(this.storageService=null),this.getNeighbourNodeIDs=null,this.getNodeLocationID=null,this.getNodeLevelID=null},PlayerProgress.prototype.asData=function(){return{levels:this.getLevels().map(function(level){return level.asData()}),milestones:this.milestones.asData()}},PlayerProgress.prototype.load=function(finishedCallback){var _this=this;finishedCallback=finishedCallback||EmptyFunction,this.storageService?this.storageService.load(PlayerProgress.PLAYER_DATA,function(data,errorData){var errorMessage=null;errorData?errorMessage=errorData.message:(console.log("Loading saved game:",data),_this.unpackData(data)),finishedCallback(errorMessage)}):finishedCallback("No StorageService instance.")},PlayerProgress.prototype.save=function(){if(this.storageService){var data=this.asData();this.storageService.save(PlayerProgress.PLAYER_DATA,data),console.log("Saved game:",data)}},PlayerProgress.prototype.clearObservableHistory=function(){this.levelComplete.next(null),this.levelsUnlocked.next(null),this.locationUnlocked.next(null),this.unlockedLocations.next([]),this.lastLevelComplete.next(!1),this.locationComplete.next(null),this.gameComplete.next(!1),this.introWatched.next(!1)},PlayerProgress.prototype.reset=function(){this.clearObservableHistory(),this.unpackData(this.defaultData)},PlayerProgress.prototype.getLevelByNodeID=function(nodeID){return this.levels.find(function(level){return level.getNodeID()==nodeID})},PlayerProgress.prototype.isNewGame=function(){var numCompletedLevels=this.levels.count(function(level){return level.isComplete()}),numUnlockedLevels=this.levels.count(function(level){return level.isUnlockedAndIncomplete()});return 0==numCompletedLevels&&numUnlockedLevels<=1},PlayerProgress.prototype.unlockSomeLevels=function(){var unlockedLevel=this.findLastLevelWithUnlockableNeighbours();if(unlockedLevel){var nodeID=unlockedLevel.getNodeID();this.unlockNeighboursOfNode(nodeID)}},PlayerProgress.prototype.completeNextLevel=function(){var firstIncompleteLevel=this.levels.find(function(level){return level.isUnlockedAndIncomplete()});firstIncompleteLevel&&firstIncompleteLevel.setCompleted()},PlayerProgress.prototype.findLastUnlockedLevel=function(){var lastUnlockedLevel=this.getLevels().clone().reverse().find(function(level){return level.isUnlockedAndIncomplete()});return lastUnlockedLevel||(lastUnlockedLevel=this.levels.last()),lastUnlockedLevel},PlayerProgress.prototype.handledNewlyUnlockedLevels=function(nodeIDs){this.levels.filter(function(level){return nodeIDs.contains(level.getNodeID())}).forEach(function(level){level.handledNewlyUnlocked()});var newlyUnlockedLevels=this.getNewlyUnlockedLevels();this.setLevelsUnlocked(newlyUnlockedLevels)},PlayerProgress.prototype.handledLastLevelComplete=function(){this.lastLevelComplete.next(!1)},PlayerProgress.prototype.handledLocationComplete=function(){this.locationComplete.next(null)},PlayerProgress.prototype.handledGameComplete=function(){this.gameComplete.next(!1)},PlayerProgress.prototype.setIntroWatched=function(){var _this=this;this.milestones.triggerIntroWatched(function(){_this.introWatched.value=!0})},PlayerProgress.prototype.unpackData=function(data){var _this=this;this.clearData();try{this.levels=data.levels.map(function(levelProgressData){return new LevelProgress({data:levelProgressData,onCompleted:_this.onLevelCompleted,onSave:_this.onSave})}),this.milestones=new MilestoneProgress(data.milestones),this.unlockedLocations.next(this.getUnlockedLocationIDs());var newlyUnlockedLevels=this.getNewlyUnlockedLevels();this.setLevelsUnlocked(newlyUnlockedLevels),this.introWatched.next(this.milestones.hasWatchedIntro())}catch(e){console.log("PlayerProgress: error unpacking data, reverting to default data.",e.message),this.unpackData(this.defaultData)}},PlayerProgress.prototype.clearData=function(){this.levels&&(this.levels.forEach(function(level){level.destroy()}),this.levels=null),this.milestones&&(this.milestones.destroy(),this.milestones=null)},PlayerProgress.prototype.findLastLevelWithUnlockableNeighbours=function(){var _this=this;return this.getLevels().clone().reverse().find(function(level){var isUnlocked=level.isUnlockedAndIncomplete(),hasUnlockableNeighbours=_this.getLockedNeighbourLevels(level.getNodeID()).hasItems;return isUnlocked&&hasUnlockableNeighbours})},PlayerProgress.prototype.unlockNeighboursOfNode=function(nodeID){var lockedNeighbourLevels=this.getLockedNeighbourLevels(nodeID);lockedNeighbourLevels.forEach(function(lockedLevel){lockedLevel.setUnlocked()}),this.setLevelsUnlocked(lockedNeighbourLevels)},PlayerProgress.prototype.lastLevelIsComplete=function(){return!!this.milestones.lastLevelIsComplete()||this.levelIsComplete(this.lastLevelNodeID)},PlayerProgress.prototype.locationIsComplete=function(locationID){return!!this.milestones.locationIsComplete(locationID)||this.getLevelsForLocation(locationID).every(function(level){return level.isComplete()})},PlayerProgress.prototype.allLevelsComplete=function(){return!!this.milestones.gameIsComplete()||this.levels.every(function(level){return level.isComplete()})},PlayerProgress.prototype.levelIsComplete=function(nodeID){var level=this.getLevelByNodeID(nodeID);return level&&level.isComplete()},PlayerProgress.prototype.setLevelsUnlocked=function(unlockedLevels){this.levelsUnlocked.next(unlockedLevels);var unlockedLocationIDs=this.getUnlockedLocationIDs();this.setUnlockedLocations(unlockedLocationIDs)},PlayerProgress.prototype.setUnlockedLocations=function(unlockedLocationIDs){var _this=this,newLocationIDs=unlockedLocationIDs.filter(function(locationID){return!_this.unlockedLocations.value.contains(locationID)});newLocationIDs.hasItems&&(this.setNewLocationsUnlocked(newLocationIDs),this.unlockedLocations.next(unlockedLocationIDs))},PlayerProgress.prototype.setNewLocationsUnlocked=function(newLocationIDs){var _this=this;newLocationIDs.forEach(function(newLocationID){_this.locationUnlocked.next(newLocationID)}),this.locationUnlocked.next(null)},PlayerProgress.prototype.setLastLevelComplete=function(){var _this=this;this.milestones.triggerLastLevelComplete(function(){_this.lastLevelComplete.next(!0)})},PlayerProgress.prototype.setLocationComplete=function(locationID){var _this=this;this.milestones.triggerLocationComplete(locationID,function(){_this.locationComplete.next(locationID)})},PlayerProgress.prototype.setGameComplete=function(){var _this=this;this.milestones.triggerGameComplete(function(){_this.gameComplete.next(!0)})},PlayerProgress.prototype.getLevelsForLocation=function(locationID){var _this=this;return this.levels.filter(function(level){var nodeID=level.getNodeID();return _this.getNodeLocationID(nodeID)==locationID})},PlayerProgress.prototype.getUnlockedOrCompletedLevels=function(){return this.levels.filter(function(level){return!level.isLocked()})},PlayerProgress.prototype.getNewlyUnlockedLevels=function(){return this.levels.filter(function(level){return level.isNewlyUnlocked()})},PlayerProgress.prototype.getLockedNeighbourLevels=function(nodeID){var _this=this;return this.getNeighbourNodeIDs(nodeID).map(function(neighbourNodeID){return _this.getLevelByNodeID(neighbourNodeID)}).filter(function(neighbourLevel){return neighbourLevel.isLocked()})},PlayerProgress.prototype.getUnlockedLocationIDs=function(){var _this=this;return this.getUnlockedOrCompletedLevels().map(function(level){return _this.getNodeLocationID(level.getNodeID())}).filterOutDuplicates()},PlayerProgress.PLAYER_DATA="playerData",PlayerProgress}(),SimulationProgress=function(){function SimulationProgress(config){this.onEndCallback=config.onEndCallback,this.maxTimeout=1e3*config.maxTimeout,this.shapes=null,this.simulationTimeout=null}return SimulationProgress.prototype.destroy=function(){this.cancel(),this.onEndCallback=null,this.simulationTimeout=null,this.shapes=null},SimulationProgress.prototype.update=function(frameTime){this.isRunning()&&this.allShapesAreSleeping()&&this.end()},SimulationProgress.prototype.start=function(shapes){this.shapes=shapes,this.simulationTimeout=this.createSimulationTimeout()},SimulationProgress.prototype.cancel=function(){this.simulationTimeout&&(this.simulationTimeout.destroy(),this.simulationTimeout=null),this.shapes=null},SimulationProgress.prototype.isRunning=function(){return!!this.simulationTimeout},SimulationProgress.prototype.allShapesAreSleeping=function(){return this.shapes&&this.shapes.every(function(shape){return shape.getSleeping()})},SimulationProgress.prototype.end=function(){this.cancel(),this.onEndCallback&&this.onEndCallback()},SimulationProgress.prototype.createSimulationTimeout=function(){var _this=this;return new DelayedCall(function(){_this.end()},this.maxTimeout)},SimulationProgress}(),RemoveBlocksLevelScore=function(){function RemoveBlocksLevelScore(config){this.maxRemoveShapes=config.maxRemoveShapes,this.numShapesToWin=this.extractNumShapesToWin(config.levelContentData),this.shapesRemoved=new BehaviorSubject(0)}return RemoveBlocksLevelScore.prototype.getNumShapesToWin=function(){return this.numShapesToWin},RemoveBlocksLevelScore.prototype.getShapesRemoved=function(){return this.shapesRemoved.value},RemoveBlocksLevelScore.prototype.onShapesRemovedChanged=function(cb){return this.shapesRemoved.subscribe(cb)},RemoveBlocksLevelScore.prototype.destroy=function(){},RemoveBlocksLevelScore.prototype.reset=function(){this.setShapesRemoved(0)},RemoveBlocksLevelScore.prototype.shapeAdded=function(){this.setShapesRemoved(this.getShapesRemoved()-1)},RemoveBlocksLevelScore.prototype.shapeRemoved=function(){this.setShapesRemoved(this.getShapesRemoved()+1)},RemoveBlocksLevelScore.prototype.getProgress=function(){return this.getShapesRemoved()/this.numShapesToWin},RemoveBlocksLevelScore.prototype.isComplete=function(){return this.getShapesRemoved()>=this.numShapesToWin},RemoveBlocksLevelScore.prototype.extractNumShapesToWin=function(levelContentData){var numShapesToWin=Math.clamp(levelContentData.numShapesToWin,1,this.maxRemoveShapes),totalShapes=levelContentData.shapes.length;return Math.min(numShapesToWin,totalShapes)},RemoveBlocksLevelScore.prototype.setShapesRemoved=function(shapesRemoved){shapesRemoved=MathExt.clamp(shapesRemoved,0,this.numShapesToWin),this.shapesRemoved.next(shapesRemoved)},RemoveBlocksLevelScore}(),Shape=function(){function Shape(config){var enabled=!isDefined(config.data.enabled)||config.data.enabled,valid=!isDefined(config.data.valid)||config.data.valid,show=!isDefined(config.data.show)||config.data.show;this.type=config.data.type,this.category=config.data.category,this.id=config.data.id||GeneralUtils.generateGUIDString(),this.bodyData=config.bodyData,this.position=new BehaviorSubject(config.body.position),this.rotation=new BehaviorSubject(config.body.angle),this.enabled=new BehaviorSubject(enabled),this.editable=new BehaviorSubject(!!config.data.editable),this.valid=new BehaviorSubject(valid),this.show=new BehaviorSubject(show),this.body=config.body,this.gravityOn=!1,this.setGravityOn(!!config.data.gravityOn),this.setCollidable(!!config.data.collidable)}return Shape.prototype.getType=function(){return this.type},Shape.prototype.getCategory=function(){return this.category},Shape.prototype.setCategory=function(category){this.category=category},Shape.prototype.getId=function(){return this.id},Shape.prototype.getPosition=function(){return this.position.value},Shape.prototype.onPositionChanged=function(cb){return this.position.subscribe(cb)},Shape.prototype.getRotation=function(){return this.rotation.value},Shape.prototype.onRotationChanged=function(cb){return this.rotation.subscribe(cb)},Shape.prototype.getEnabled=function(){return this.enabled.value},Shape.prototype.setEnabled=function(enabled){this.enabled.next(enabled)},Shape.prototype.onEnabledChanged=function(cb){return this.enabled.subscribe(cb)},Shape.prototype.getEditable=function(){return this.editable.value},Shape.prototype.setEditable=function(editable){this.editable.next(editable)},Shape.prototype.onEditableChanged=function(cb){return this.editable.subscribe(cb)},Shape.prototype.isValid=function(){return this.valid.value},Shape.prototype.setValid=function(valid){this.valid.next(valid)},Shape.prototype.onValidChanged=function(cb){return this.valid.subscribe(cb)},Shape.prototype.getShow=function(){return this.show.value},Shape.prototype.onShowChanged=function(cb){return this.show.subscribe(cb)},Shape.prototype.getBody=function(){return this.body},Shape.prototype.getGravityOn=function(){return this.gravityOn},Shape.prototype.destroy=function(){this.body&&(this.body=null)},Shape.prototype.update=function(frameTime){this.setPosition(this.body.position),this.getGravityOn()&&this.setRotation(this.body.angle)},Shape.prototype.setID=function(id){id&&(this.id=id)},Shape.prototype.setPosition=function(position){Matter.Body.setPosition(this.body,position),this.position.next(position)},Shape.prototype.setRotation=function(rotation){rotation=MathExt.wrap(rotation,ROTATION_RANGE_MIN,ROTATION_RANGE_MAX),Matter.Body.setAngle(this.body,rotation),this.rotation.next(rotation)},Shape.prototype.setGravityOn=function(gravityOn){(this.gravityOn=gravityOn)||this.setStationary()},Shape.prototype.getCollidable=function(){return this.body&&!this.body.isSensor},Shape.prototype.setCollidable=function(isCollidable){var isSensor=!isCollidable;this.body.isSensor=isSensor,this.body.parts.forEach(function(part){part.isSensor=isSensor})},Shape.prototype.getSleeping=function(){return this.body&&this.body.isSleeping},Shape.prototype.setSleeping=function(sleeping){Matter.Sleeping.set(this.body,sleeping)},Shape.prototype.setImmovable=function(immovable){this.body.isStatic!=immovable&&Matter.Body.setStatic(this.body,immovable)},Shape.prototype.setShow=function(show){this.show.value!=show&&this.show.next(show)},Shape.prototype.getAnchor=function(){return Vector.create(this.body?this.body.render.sprite.xOffset:0,this.body?this.body.render.sprite.yOffset:0)},Shape.prototype.enableBody=function(enable){this.body.isSensor=!enable},Shape.prototype.hasBodyPart=function(bodyPart){return this.body&&this.body.parts.contains(bodyPart)},Shape.prototype.getData=function(){return{type:this.type,category:this.category,id:this.id,position:Vector.clone(this.getPosition()),rotation:this.getRotation(),enabled:this.getEnabled(),editable:this.getEditable(),valid:this.isValid(),gravityOn:this.getGravityOn(),collidable:this.getCollidable(),show:this.getShow()}},Shape.prototype.restoreFromData=function(data){this.type=data.type,this.category=data.category,this.id=data.id,this.setPosition(data.position),this.setRotation(data.rotation),this.setEnabled(data.enabled),this.setEditable(data.editable),this.setValid(data.valid),this.setGravityOn(data.gravityOn),this.setCollidable(data.collidable),this.setShow(data.show)},Shape.prototype.matchesPosition=function(shape,positionThreshold){return shape&&Vector.equalTo(this.getPosition(),shape.getPosition(),positionThreshold)},Shape.prototype.matchesRotation=function(shape,rotationThreshold){return shape&&Number.equals(this.getRotation(),shape.getRotation(),rotationThreshold)},Shape.prototype.matchesTransform=function(shape,positionThreshold,rotationThreshold){return this.matchesPosition(shape,positionThreshold)&&this.matchesRotation(shape,rotationThreshold)},Shape.prototype.copyTransform=function(shape){shape&&(this.setPosition(shape.getPosition()),this.setRotation(shape.getRotation()))},Shape.prototype.getBodyOffset=function(){var anchorDiff=this.getAnchorDiff();return Vector.create(anchorDiff.x*this.bodyData.transform.width,anchorDiff.y*this.bodyData.transform.height)},Shape.prototype.setStationary=function(){this.body.parts.forEach(function(part){Matter.Body.set(part,{positionPrev:Vector.clone(part.position),anglePrev:part.angle}),part.angularVelocity=0,part.speed=0,part.angularSpeed=0,part.motion=0})},Shape.prototype.getOriginalAnchor=function(){return Vector.clone(this.bodyData.transform.anchor)},Shape.prototype.getAnchorDiff=function(){return Vector.sub(this.getAnchor(),this.getOriginalAnchor())},Shape}(),Shelf=function(){function Shelf(slotDatas){this.slots=[],this.slotDatas=slotDatas,this.slotAdded=new BehaviorSubject(null),this.slotRemoved=new BehaviorSubject(null)}return Shelf.prototype.getSlots=function(){return this.slots},Shelf.prototype.onSlotAdded=function(cb){return this.slotAdded.subscribe(cb)},Shelf.prototype.onSlotRemoved=function(cb){return this.slotRemoved.subscribe(cb)},Shelf.prototype.destroy=function(){this.destroySlots()},Shelf.prototype.addSlot=function(slot){if(slot&&!this.slots.contains(slot)){var slotID=this.slots.length;slot.setID(slotID),this.slots.push(slot),this.slotAdded.next(slot)}},Shelf.prototype.removeSlot=function(slot){slot&&(slot.setID(INVALID_SLOT_ID),this.slots.remove(slot),this.slotRemoved.next(slot))},Shelf.prototype.createSlots=function(slotDatas){var _this=this;this.destroySlots(),slotDatas&&(this.slotDatas=slotDatas),this.slotDatas&&this.slotDatas.forEach(function(slotData){var slot=new ShelfSlot(slotData);_this.addSlot(slot)})},Shelf.prototype.getSlotAt=function(slotIndex){return this.slots.containsIndex(slotIndex)?this.slots[slotIndex]:null},Shelf.prototype.getShapeTypeForSlot=function(slotIndex){var slot=this.getSlotAt(slotIndex);return slot?slot.getShapeType():null},Shelf.prototype.setEnabled=function(enabled){this.slots.forEach(function(slot){slot.setEnabled(enabled)})},Shelf.prototype.enableSlotsWithShapeTypes=function(shapeTypes){this.slots.forEach(function(slot){var holdsAShapeType=slot.holdsAShapeType(shapeTypes);slot.setEnabled(holdsAShapeType)})},Shelf.prototype.hasShapes=function(){return 0<this.getTotalShapeCount()},Shelf.prototype.getTotalShapeCount=function(){return this.slots.reduce(function(total,slot){return total+slot.getCount()},0)},Shelf.prototype.destroySlots=function(){var _this=this;this.slots.forEach(function(slot){_this.removeSlot(slot),slot.destroy()}),this.slots=[]},Shelf}(),ShelfSlot=function(){function ShelfSlot(data){var count=isDefined(data.count)?data.count:1,enabled=!isDefined(data.enabled)||data.enabled;this.shapeType=data.shapeType,this.enabled=new BehaviorSubject(enabled),this.count=new BehaviorSubject(count),this.id=INVALID_SLOT_ID}return ShelfSlot.prototype.getShapeType=function(){return this.shapeType},ShelfSlot.prototype.getEnabled=function(){return this.enabled.value},ShelfSlot.prototype.setEnabled=function(enabled){this.enabled.next(enabled)},ShelfSlot.prototype.onEnabledChanged=function(cb){return this.enabled.subscribe(cb)},ShelfSlot.prototype.getCount=function(){return this.count.value},ShelfSlot.prototype.setCount=function(count){this.count.next(count)},ShelfSlot.prototype.onCountChanged=function(cb){return this.count.subscribe(cb)},ShelfSlot.prototype.getID=function(){return this.id},ShelfSlot.prototype.setID=function(id){this.id=id},ShelfSlot.prototype.destroy=function(){},ShelfSlot.prototype.holdsAShapeType=function(shapeTypes){var _this=this;return shapeTypes.some(function(shapeType){return _this.holdsShapeType(shapeType)})},ShelfSlot.prototype.holdsShapeType=function(shapeType){return this.shapeType==shapeType},ShelfSlot}(),Tutorial=function(){function Tutorial(config){this.stepDatas=config.stepDatas,this.levelStepIDs=config.levelStepIDs,this.currentStepIndex=INVALID_STEP_INDEX,this.currentTriggerToActivate=null,this.currentTriggerToDeactivate=null,this.stepActivated=new BehaviorSubject(null),this.stepDeactivated=new BehaviorSubject(null),this.finished=new BehaviorSubject(!1)}return Tutorial.prototype.onStepActivated=function(cb){return this.stepActivated.subscribe(cb)},Tutorial.prototype.onStepDeactivated=function(cb){return this.stepDeactivated.subscribe(cb)},Tutorial.prototype.getFinished=function(){return this.finished.value},Tutorial.prototype.onFinished=function(cb){return this.finished.subscribe(cb)},Tutorial.prototype.destroy=function(){this.stepDatas=null,this.levelStepIDs=null,this.currentStepIndex=INVALID_STEP_INDEX,this.currentTriggerToActivate=null,this.currentTriggerToDeactivate=null},Tutorial.prototype.start=function(){this.finished.next(!1),this.setCurrentStepIndex(0)},Tutorial.prototype.handleEvent=function(eventName){eventName==this.currentTriggerToActivate?this.activateCurrentStep():eventName==this.currentTriggerToDeactivate&&this.deactivateCurrentStep()},Tutorial.prototype.getCurrentStep=function(){return this.getStepAtIndex(this.currentStepIndex)},Tutorial.prototype.getStepAtIndex=function(stepIndex){var stepID=this.stepIndexIsValid(stepIndex)?this.levelStepIDs[stepIndex]:null;return this.getStepByID(stepID)},Tutorial.prototype.stepIndexIsValid=function(stepIndex){return MathExt.isInRange(stepIndex,0,this.getNumberOfSteps()-1)},Tutorial.prototype.getStepByID=function(stepID){return this.stepDatas.find(function(stepData){return stepData.id==stepID})},Tutorial.prototype.getNumberOfSteps=function(){return this.levelStepIDs.length},Tutorial.prototype.setCurrentStepIndex=function(currentStepIndex){if(this.currentStepIndex=currentStepIndex,this.isFinished())this.setFinished(!0);else{var currentStep=this.getCurrentStep();currentStep.triggerToActivate?this.currentTriggerToActivate=currentStep.triggerToActivate:this.activateCurrentStep()}},Tutorial.prototype.activateCurrentStep=function(){var currentStep=this.getCurrentStep();this.currentTriggerToActivate=null,this.currentTriggerToDeactivate=currentStep.triggerToDeactivate,this.stepActivated.next(currentStep)},Tutorial.prototype.deactivateCurrentStep=function(){this.currentTriggerToDeactivate=null;var currentStep=this.getCurrentStep();this.stepDeactivated.next(currentStep),this.goToNextStep()},Tutorial.prototype.goToNextStep=function(){var nextStepIndex=this.currentStepIndex+1;this.setCurrentStepIndex(nextStepIndex)},Tutorial.prototype.isFinished=function(){return this.currentStepIndex>=this.getNumberOfSteps()},Tutorial.prototype.setFinished=function(finished){finished!=this.getFinished()&&this.finished.next(finished)},Tutorial}(),Workspace=function(){function Workspace(config){var _this=this;this.onCollisionStart=function(event){var handleCollisionPairFunc=_this.gravityOn?_this.collisionStartGravityOn:_this.collisionStartGravityOff;event.pairs.forEach(handleCollisionPairFunc)},this.onCollisionEnd=function(event){_this.gravityOn||event.pairs.forEach(_this.collisionEndGravityOff)},this.collisionStartGravityOn=function(pair){var overlapDist=pair.collision.depth;_this.shapesCollided.next(overlapDist)},this.collisionStartGravityOff=function(pair){var shapeA=_this.getShapeWithMatchingBody(pair.bodyA),shapeB=_this.getShapeWithMatchingBody(pair.bodyB);shapeA&&!_this.collidingShapes.contains(shapeA)&&shapeA.setValid(!1),shapeB&&!_this.collidingShapes.contains(shapeB)&&shapeB.setValid(!1),_this.addCollidingShapes([shapeA,shapeB])},this.collisionEndGravityOff=function(pair){var shapeA=_this.getShapeWithMatchingBody(pair.bodyA),shapeB=_this.getShapeWithMatchingBody(pair.bodyB);_this.removeCollidingShapes([shapeA,shapeB]),shapeA&&!_this.collidingShapes.contains(shapeA)&&shapeA.setValid(!0),shapeB&&!_this.collidingShapes.contains(shapeB)&&shapeB.setValid(!0)},this.matterEngine=config.matterEngine,this.parentComposite=config.parentComposite,this.shapes=[],this.staticShapes=[],this.destinationShapes=[],this.collidingShapes=[],this.gravityOn=!1,this.shapeCollisionsOn=!1,this.shapeAdded=new BehaviorSubject(null),this.shapeRemoved=new BehaviorSubject(null),this.staticShapeAdded=new BehaviorSubject(null),this.staticShapeRemoved=new BehaviorSubject(null),this.destinationShapeAdded=new BehaviorSubject(null),this.destinationShapeRemoved=new BehaviorSubject(null),this.shapesAreColliding=new BehaviorSubject(!1),this.shapesCollided=new BehaviorSubject(-1),this.shapeOutOfBounds=new BehaviorSubject(!1),this.roofBelowBounds=new BehaviorSubject(null),this.setGravityOn(config.data.gravityOn),this.setShapeCollisionsOn(config.data.shapeCollisionsOn),this.bounds=this.createBounds(config.data.boundsMinX),this.startReceivingCollisionEvents()}return Workspace.prototype.getParentComposite=function(){return this.parentComposite},Workspace.prototype.getShapes=function(){return this.shapes},Workspace.prototype.getStaticShapes=function(){return this.staticShapes},Workspace.prototype.getGravityOn=function(){return this.gravityOn},Workspace.prototype.getShapeCollisionsOn=function(){return this.shapeCollisionsOn},Workspace.prototype.onShapeAdded=function(cb){return this.shapeAdded.subscribe(cb)},Workspace.prototype.onShapeRemoved=function(cb){return this.shapeRemoved.subscribe(cb)},Workspace.prototype.onStaticShapeAdded=function(cb){return this.staticShapeAdded.subscribe(cb)},Workspace.prototype.onStaticShapeRemoved=function(cb){return this.staticShapeRemoved.subscribe(cb)},Workspace.prototype.onDestinationShapeAdded=function(cb){return this.destinationShapeAdded.subscribe(cb)},Workspace.prototype.onDestinationShapeRemoved=function(cb){return this.destinationShapeRemoved.subscribe(cb)},Workspace.prototype.getShapesAreColliding=function(){return this.shapesAreColliding.value},Workspace.prototype.onShapesAreCollidingChanged=function(cb){return this.shapesAreColliding.subscribe(cb)},Workspace.prototype.onShapesCollided=function(cb){return this.shapesCollided.subscribe(cb)},Workspace.prototype.onShapeOutOfBounds=function(cb){return this.shapeOutOfBounds.subscribe(cb)},Workspace.prototype.onRoofBelowBounds=function(cb){return this.roofBelowBounds.subscribe(cb)},Workspace.prototype.getBounds=function(){return this.bounds},Workspace.prototype.destroy=function(){var _this=this;this.stopReceivingCollisionEvents(),this.removeCollidingShapes(this.collidingShapes.clone()),this.shapes.reverseForEach(function(shape){_this.removeShape(shape),shape.destroy()}),this.shapes=[],this.staticShapes.reverseForEach(function(staticShape){_this.removeStaticShape(staticShape),staticShape.destroy()}),this.staticShapes=[],this.destinationShapes.reverseForEach(function(destinationShape){_this.removeDestinationShape(destinationShape),destinationShape.destroy()}),this.destinationShapes=[],this.parentComposite=null,this.matterEngine=null},Workspace.prototype.update=function(frameTime){this.shapes.forEach(function(shape){shape.update(frameTime)}),this.gravityOn&&this.checkOutOfBoundsShapes()},Workspace.prototype.addShape=function(shape){shape&&!this.shapes.contains(shape)&&(this.shapes.push(shape),this.registerBody(shape.getBody()),this.shapeAdded.next(shape))},Workspace.prototype.removeShape=function(shape){shape&&(this.deregisterBody(shape.getBody()),this.shapes.remove(shape),this.removeCollidingShapes([shape]),this.shapeRemoved.next(shape))},Workspace.prototype.addStaticShape=function(shape){shape&&!this.staticShapes.contains(shape)&&(this.staticShapes.push(shape),this.registerBody(shape.getBody()),this.staticShapeAdded.next(shape))},Workspace.prototype.removeStaticShape=function(shape){shape&&(this.deregisterBody(shape.getBody()),this.staticShapes.remove(shape),this.removeCollidingShapes([shape]),this.staticShapeRemoved.next(shape))},Workspace.prototype.addDestinationShape=function(shape){shape&&!this.destinationShapes.contains(shape)&&(this.destinationShapes.push(shape),this.destinationShapeAdded.next(shape))},Workspace.prototype.removeDestinationShape=function(shape){shape&&(this.destinationShapes.remove(shape),this.destinationShapeRemoved.next(shape))},Workspace.prototype.getAllPhysicsShapes=function(){return this.shapes.concat(this.staticShapes)},Workspace.prototype.getAllShapes=function(){return this.getAllPhysicsShapes().concat(this.destinationShapes)},Workspace.prototype.getShapeByID=function(id){return this.getAllShapes().find(function(shape){return shape.getId()==id})},Workspace.prototype.registerBody=function(body){Matter.Composite.add(this.parentComposite,body)},Workspace.prototype.deregisterBody=function(body){Matter.Composite.remove(this.parentComposite,body)},Workspace.prototype.setEnabled=function(enabled){this.shapes.forEach(function(shape){shape.setEnabled(enabled)})},Workspace.prototype.setGravityOn=function(gravityOn){this.gravityOn=gravityOn,this.matterEngine.world.gravity.y=Boolean.toUnsignedInt(gravityOn),this.shapes.forEach(function(shape){shape.setGravityOn(gravityOn)}),gravityOn||(this.setShapeOutOfBounds(!1),this.setRoofBelowBounds(null))},Workspace.prototype.setShapeCollisionsOn=function(shapeCollisionsOn){this.shapeCollisionsOn=shapeCollisionsOn,this.getAllPhysicsShapes().forEach(function(shape){shape.setCollidable(shapeCollisionsOn)})},Workspace.prototype.contains=function(point){return Matter.Bounds.contains(this.getBounds(),point)},Workspace.prototype.getShapeDatas=function(){return this.shapes.map(function(shape){return shape.getData()})},Workspace.prototype.restoreFromShapeDatas=function(shapeDatas){this.shapes.forEach(function(shape){var savedShapeData=shapeDatas.find(function(shapeData){return shapeData.id==shape.getId()});shape.restoreFromData(savedShapeData)})},Workspace.prototype.getShapeCount=function(){return this.findCategoryShapes(ShapeCategory.SHELF).length},Workspace.prototype.setShapeOutOfBounds=function(shapeOutOfBounds){this.shapeOutOfBounds.value!=shapeOutOfBounds&&this.shapeOutOfBounds.next(shapeOutOfBounds)},Workspace.prototype.setRoofBelowBounds=function(roofShape){!!this.roofBelowBounds.value!=!!roofShape&&this.roofBelowBounds.next(roofShape)},Workspace.prototype.createBounds=function(boundsMinX){return Matter.Bounds.create([{x:boundsMinX,y:app.size.min.y},{x:app.size.max.x,y:app.size.min.y},{x:app.size.max.x,y:app.size.max.y},{x:boundsMinX,y:app.size.max.y}])},Workspace.prototype.checkOutOfBoundsShapes=function(){var outOfBoundsShapes=this.getOutOfBoundsShapes();this.setShapeOutOfBounds(outOfBoundsShapes.hasItems);var roof=this.getOutOfBoundsRoof(outOfBoundsShapes);this.setRoofBelowBounds(roof)},Workspace.prototype.getOutOfBoundsShapes=function(){var _this=this;return this.getShapes().filter(function(shape){return!_this.contains(shape.getPosition())})},Workspace.prototype.getOutOfBoundsRoof=function(outOfBoundsShapes){var _this=this;return(outOfBoundsShapes=outOfBoundsShapes||this.getOutOfBoundsShapes()).filter(function(shape){return shape.getType()==ShapeType.ROOF}).find(function(roofShape){return _this.isBelowBounds(roofShape)})},Workspace.prototype.isBelowBounds=function(shape){var yPos=shape.getPosition().y;return this.bounds.max.y<yPos},Workspace.prototype.startReceivingCollisionEvents=function(){Matter.Events.on(this.matterEngine,"collisionStart",this.onCollisionStart),Matter.Events.on(this.matterEngine,"collisionEnd",this.onCollisionEnd)},Workspace.prototype.stopReceivingCollisionEvents=function(){Matter.Events.off(this.matterEngine,"collisionEnd",this.onCollisionEnd),Matter.Events.off(this.matterEngine,"collisionStart",this.onCollisionStart)},Workspace.prototype.addCollidingShapes=function(shapes){this.collidingShapes.append(shapes),!this.shapesAreColliding.value&&this.collidingShapes.hasItems&&this.shapesAreColliding.next(!0)},Workspace.prototype.removeCollidingShapes=function(shapes){this.collidingShapes.remove(shapes),this.shapesAreColliding.value&&!this.collidingShapes.hasItems&&this.shapesAreColliding.next(!1)},Workspace.prototype.getShapeWithMatchingBody=function(body){return this.getAllShapes().find(function(shape){return shape.hasBodyPart(body)})},Workspace.prototype.findCategoryShapes=function(category){return this.shapes.filter(function(shape){return shape.getCategory()==category})},Workspace}(),ChuteViewActions=function(){function ChuteViewActions(view){this.shape=view.getChildByName("shape"),this.shredParticles=view.getChildByName("shredParticles")}return ChuteViewActions.prototype.createAddShapeAction=function(){return Actions.Tween(this.shape.scale,{from:Vector.create(0),to:Vector.create(1),duration:.4,easing:Easing.Back.Out})},ChuteViewActions.prototype.createRemoveShapeAction=function(){return Actions.Tween(this.shape.scale,{from:Vector.create(1),to:Vector.create(0),duration:0,easing:Easing.Linear.None})},ChuteViewActions.prototype.createShredShapeAction=function(){return Actions.Parallel([Actions.Func(function(){app.sound.play("mulch")}),Actions.Tween(this.shape.position,{to:Vector.create(150,326),duration:.6,easing:Easing.Linear.None}),Actions.Particles(this.shredParticles)])},ChuteViewActions}(),FanfareActions=function(){function FanfareActions(config){this.rootView=config.rootView,this.fanfareSpine=config.fanfareSpine,this.soundName=config.soundName}return FanfareActions.prototype.getShowAction=function(showAnimName,particles){var _this=this,actions=[];return this.soundName&&actions.append(Actions.BlockingFunc(function(parent){app.sound.play(_this.soundName,function(){parent.finish()})})),actions.append(Actions.Sequence([Actions.Tween(this.rootView.scale,{from:Vector.create(0),to:Vector.create(1),duration:.5,easing:TWEEN.Easing.Back.Out,onStart:function(){_this.rootView.visible=!0}}),Actions.Spine(this.fanfareSpine,showAnimName)])),particles&&actions.append(Actions.Particles(particles)),Actions.Parallel(actions)},FanfareActions.prototype.getHideAction=function(hideAnimName,finishedCallback){var _this=this;return Actions.Sequence([Actions.Parallel([Actions.Func(function(){app.sound.stop(_this.soundName)}),Actions.Tween(this.rootView.scale,{from:Vector.create(1),to:Vector.create(0),duration:.5,easing:TWEEN.Easing.Back.In,onStop:function(){_this.rootView.visible=!1}}),Actions.Spine(this.fanfareSpine,hideAnimName)]),Actions.Func(finishedCallback)])},FanfareActions.prototype.getFanfareSoundLength=function(){return.001*app.sound.getDuration(this.soundName)},FanfareActions}(),ResultsDialogViewActions=function(_super){function ResultsDialogViewActions(config){var _this=_super.call(this,config)||this;return _this.checkButton=config.rootView.getChildByName("checkButton"),_this}return __extends(ResultsDialogViewActions,_super),ResultsDialogViewActions.prototype.getShowAction=function(showAnimName){var _this=this;return Actions.Sequence([Actions.Func(function(){_this.checkButton.scale.set(0)}),Actions.Parallel([_super.prototype.getShowAction.call(this,showAnimName),this.getShowButtonAction()])])},ResultsDialogViewActions.prototype.getShowButtonAction=function(){return Actions.Sequence([Actions.Delay(1.5),this.createGrowAction(this.checkButton)])},ResultsDialogViewActions.prototype.createGrowAction=function(view){return Actions.Tween(view.scale,{from:Vector.create(0),to:Vector.create(1),duration:.5,easing:Easing.Back.Out,endOnCancel:!0})},ResultsDialogViewActions}(FanfareActions),TimeoutDialogViewActions=function(_super){function TimeoutDialogViewActions(config){return _super.call(this,config)||this}return __extends(TimeoutDialogViewActions,_super),TimeoutDialogViewActions.prototype.getShowWithTimeoutAction=function(showAnimName,particles,finishedCallback){return Actions.Sequence([Actions.Delay(.5),_super.prototype.getShowAction.call(this,showAnimName,particles),Actions.Delay(1),Actions.Func(finishedCallback)])},TimeoutDialogViewActions}(FanfareActions),DialogHolderViewActions=function(){function DialogHolderViewActions(view){this.fullscreenFade=view.getChildByName("fullscreenFade")}return DialogHolderViewActions.prototype.createShowFadedBackgroundAction=function(){var _this=this;return Actions.Tween(this.fullscreenFade,{to:{alpha:.7},duration:.5,easing:TWEEN.Easing.Cubic.Out,onStart:function(){_this.fullscreenFade.visible=!0},endOnCancel:!0})},DialogHolderViewActions.prototype.createHideFadedBackgroundAction=function(){var _this=this;return Actions.Tween(this.fullscreenFade,{to:{alpha:0},duration:.5,easing:TWEEN.Easing.Cubic.In,onStop:function(){_this.fullscreenFade.visible=!1},endOnCancel:!0})},DialogHolderViewActions.prototype.createShowDialogAction=function(dialog){var dialogView=dialog.getMediator().view;return dialog.show()||this.createDefaultShowAction(dialogView)},DialogHolderViewActions.prototype.createHideDialogAction=function(dialog){var dialogView=dialog.getMediator().view;return dialog.hide()||this.createDefaultHideAction(dialogView)},DialogHolderViewActions.prototype.createDefaultShowAction=function(view){return Actions.Tween(view.scale,{from:Vector.create(0),to:Vector.create(1),duration:.5,easing:TWEEN.Easing.Back.Out})},DialogHolderViewActions.prototype.createDefaultHideAction=function(view){return Actions.Tween(view.scale,{from:Vector.create(1),to:Vector.create(0),duration:.5,easing:TWEEN.Easing.Back.In})},DialogHolderViewActions}(),GameViewActions=function(){function GameViewActions(view,gameViewActionData){this.actionData=gameViewActionData,this.gravityButtonContainer=view.getChildByName("gravityButtonContainer"),this.timerButtonContainer=view.getChildByName("timerButtonContainer"),this.sideBarElements=view.getChildByName("sideBarElements"),this.dialogBackground=view.getChildByName("dialogBackground")}return GameViewActions.prototype.createShowDialogBackgroundAction=function(){var _this=this;return Actions.Sequence([Actions.Func(function(){_this.dialogBackground.interactive=!0}),Actions.Tween(this.dialogBackground,{to:{alpha:1},duration:.5,easing:TWEEN.Easing.Cubic.Out})])},GameViewActions.prototype.createShowAction=function(){return Actions.Parallel([this.createShowItemAction(this.gravityButtonContainer,this.actionData.gravityButtonOffset),this.createShowItemAction(this.timerButtonContainer,this.actionData.timerButtonOffset),this.createShowItemAction(this.sideBarElements,this.actionData.sideBarOffset)])},GameViewActions.prototype.createHideAction=function(){return Actions.Parallel([this.createHideItemAction(this.gravityButtonContainer,this.actionData.gravityButtonOffset),this.createHideItemAction(this.timerButtonContainer,this.actionData.timerButtonOffset),this.createHideItemAction(this.sideBarElements,this.actionData.sideBarOffset)])},GameViewActions.prototype.createShowItemAction=function(view,startOffset){var startPosition=Vector.add(view.position,startOffset);return Actions.Tween(view,{from:startPosition,to:Vector.clone(view.position),duration:.5,easing:Easing.Cubic.Out})},GameViewActions.prototype.createHideItemAction=function(view,endOffset){var endPosition=Vector.add(view.position,endOffset);return Actions.Tween(view,{from:view.position,to:endPosition,duration:.5,easing:Easing.Cubic.Out})},GameViewActions}(),TutorialHandViewActions=function(){function TutorialHandViewActions(view){this.view=view}return TutorialHandViewActions.prototype.createShowAtAction=function(position,rotation){var _this=this;return rotation=rotation||0,Actions.Parallel([Actions.Func(function(){_this.view.visible=!0,_this.view.scale.copy(Vector.create(1)),_this.view.position.copy(position),_this.view.rotation=rotation}),Actions.Tween(this.view,{from:{alpha:0},to:{alpha:1},duration:.25,easing:Easing.Quadratic.Out})])},TutorialHandViewActions.prototype.createHideAction=function(){var _this=this;return Actions.Tween(this.view,{to:{alpha:0},duration:.25,easing:Easing.Quadratic.In,onStart:function(){_this.view.visible=!0},onComplete:function(){_this.view.visible=!1}})},TutorialHandViewActions.prototype.createMoveToAction=function(position,rotation,animateTime){return rotation=rotation||0,animateTime=animateTime||1,Actions.Tween(this.view,{to:{x:position.x,y:position.y,rotation:rotation},duration:animateTime,easing:Easing.Cubic.InOut})},TutorialHandViewActions.prototype.createPressDownAction=function(){return Actions.Tween(this.view.scale,{to:Vector.create(.9,.8),duration:.4,easing:Easing.Cubic.Out})},TutorialHandViewActions.prototype.createPressUpAction=function(){return Actions.Tween(this.view.scale,{to:Vector.create(1),duration:.4,easing:Easing.Cubic.In})},TutorialHandViewActions.prototype.createTapAction=function(){return Actions.Sequence([this.createPressDownAction(),this.createPressUpAction()])},TutorialHandViewActions.prototype.createDragToAction=function(position,rotation,animateTime){return Actions.Sequence([this.createPressDownAction(),this.createMoveToAction(position,rotation,animateTime),this.createPressUpAction()])},TutorialHandViewActions.prototype.createPointAtAction=function(position,pointRetractPosition,rotation){return Actions.Repeat(Actions.Sequence([this.createMoveToAction(pointRetractPosition,rotation,.5),this.createMoveToAction(position,rotation,.5)]))},TutorialHandViewActions.prototype.createWaitAction=function(time){return Actions.Delay(time)},TutorialHandViewActions}(),LoadingView=function(_super){function LoadingView(config){var _this=_super.call(this,config)||this;return _this.configureComponents(),_this}return __extends(LoadingView,_super),LoadingView.prototype.destroy=function(){_super.prototype.destroy.call(this)},LoadingView.prototype.show=function(){this.runUniqueAction(this.createShowAction())},LoadingView.prototype.hide=function(finishedCallback){this.runUniqueAction(this.createHideAction(),finishedCallback)},LoadingView.prototype.updateProgress=function(progress){var progressWidth=progress*this.layoutConfig.loadingWidth;this.loadingIndicator.position.x=progressWidth,this.loadingBar.mask.scale.x=progressWidth},LoadingView.prototype.configureComponents=function(){this.loadingHolder=this.getChildByName("loadingHolder"),this.background=this.getChildByName("background"),this.loadingText=this.getChildByName("loadingText"),this.loadingBar=this.getChildByName("loadingBar"),this.loadingIndicator=this.getChildByName("loadingBarIndicator"),this.background.position.set(app.size.min.x,app.size.min.y),this.loadingText.position.set(app.size.centre.x-this.loadingText.width/2,app.size.centre.y)},LoadingView.prototype.createShowAction=function(){var _this=this;return Actions.Sequence([Actions.Func(function(){_this.loadingHolder.alpha=1}),Actions.Repeat(this.createLoadingTextAction())])},LoadingView.prototype.createHideAction=function(){return Actions.Tween(this.loadingHolder,{to:{alpha:0},duration:.3})},LoadingView.prototype.createLoadingTextAction=function(){var _this=this,tickFrequency=this.layoutConfig.loadingDots.tickFrequency,numDots=this.layoutConfig.loadingDots.numDots;return Actions.Sequence([Actions.Counter(0,numDots,numDots*tickFrequency,function(counter){_this.loadingText.text="loading "+".".repeat(counter)}),Actions.Delay(tickFrequency)])},LoadingView}(View),OutlineView=function(_super){function OutlineView(config){var _this=_super.call(this,config)||this;return _this.sprite=config.sprite,_this.showOutlineAction=null,_this}return __extends(OutlineView,_super),OutlineView.prototype.destroy=function(){this.showOutlineAction=null,_super.prototype.destroy.call(this)},OutlineView.prototype.setVisible=function(visible){this.sprite.visible=visible},OutlineView.prototype.updateTexture=function(textureName){this.sprite.updateTexture(textureName)},OutlineView.prototype.showOutline=function(){var _this=this;this.showOutlineAction||(this.showOutlineAction=Actions.Tween(this.sprite,{from:{alpha:-1.5},to:{alpha:2.5},duration:.5,easing:Easing.Sinusoidal.InOut,repeat:1/0,yoyo:!0,onStart:function(){_this.setVisible(!0)}}),this.runAction(this.showOutlineAction))},OutlineView.prototype.hideOutline=function(){this.showOutlineAction&&(this.cancelAction(this.showOutlineAction),this.showOutlineAction=null),this.setVisible(!1)},OutlineView}(View),TutorialHandView=function(_super){function TutorialHandView(config){var _this=_super.call(this,config)||this;return _this.actionFactory=new TutorialHandViewActions(_this),_this.actionQueue=null,_this}return __extends(TutorialHandView,_super),TutorialHandView.prototype.destroy=function(){this.actionQueue=null,this.actionFactory=null,_super.prototype.destroy.call(this)},TutorialHandView.prototype.showAt=function(position,rotation){var action=this.actionFactory.createShowAtAction(position,rotation);this.queueLoopedAction(action)},TutorialHandView.prototype.hide=function(){var action=this.actionFactory.createHideAction();this.setAction(action)},TutorialHandView.prototype.hideImmediately=function(){this.actionQueue&&this.cancelAction(this.actionQueue),this.visible=!1},TutorialHandView.prototype.moveTo=function(position,rotation,animateTime){var action=this.actionFactory.createMoveToAction(position,rotation,animateTime);this.queueLoopedAction(action)},TutorialHandView.prototype.pressDown=function(){var action=this.actionFactory.createPressDownAction();this.queueLoopedAction(action)},TutorialHandView.prototype.pressUp=function(){var action=this.actionFactory.createPressUpAction();this.queueLoopedAction(action)},TutorialHandView.prototype.tap=function(){var action=this.actionFactory.createTapAction();this.queueLoopedAction(action)},TutorialHandView.prototype.dragTo=function(position,rotation,animateTime){var action=this.actionFactory.createDragToAction(position,rotation,animateTime);this.queueLoopedAction(action)},TutorialHandView.prototype.pointAt=function(position,rotation){rotation=rotation||0;var pointRetractPosition=this.calculatePointRetractPosition(position,rotation),action=this.actionFactory.createPointAtAction(position,pointRetractPosition,rotation);this.queueLoopedAction(action)},TutorialHandView.prototype.wait=function(time){var action=this.actionFactory.createWaitAction(time);this.queueLoopedAction(action)},TutorialHandView.prototype.setAction=function(action){action&&(this.actionQueue&&this.cancelAction(this.actionQueue),this.queueAction(action))},TutorialHandView.prototype.queueAction=function(action){if(action){var actionQueue=this.actionQueue||Actions.Sequence([]);actionQueue.actions.push(action),this.actionQueue||(this.actionQueue=actionQueue,this.startQueue())}},TutorialHandView.prototype.queueLoopedAction=function(action){if(action){var loopedAction=this.loopedAction||Actions.Repeat(Actions.Sequence([]));loopedAction.action.actions.push(action),this.loopedAction||(this.loopedAction=loopedAction,this.queueAction(loopedAction))}},TutorialHandView.prototype.startQueue=function(){var _this=this;this.runAction(this.actionQueue,function(){_this.actionQueue=null,_this.loopedAction=null})},TutorialHandView.prototype.calculatePointRetractPosition=function(position,rotation){var baseDirection=Vector.normalise(Vector.create(-62,-93)),rotatedDirection=Vector.rotate(baseDirection,rotation);return Vector.sub(position,Vector.mult(rotatedDirection,40))},TutorialHandView}(View),DialogHolderView=function(_super){function DialogHolderView(config){var _this=_super.call(this,config)||this;return _this.actionFactory=new DialogHolderViewActions(_this),_this.fullscreenFade=_this.getChildByName("fullscreenFade"),_this.dialogParent=_this.getChildByName("dialogParent"),_this.dialogAction=null,_this.fadedBackgroundAction=null,_this.configureComponents(),_this.addScripts(),_this}return __extends(DialogHolderView,_super),DialogHolderView.prototype.destroy=function(){this.dialogAction=null,this.fadedBackgroundAction=null,_super.prototype.destroy.call(this)},DialogHolderView.prototype.getDialogParent=function(){return this.dialogParent},DialogHolderView.prototype.showDialog=function(dialog,finishedCallback){var showAction=this.actionFactory.createShowDialogAction(dialog);this.runDialogAction(dialog,showAction,finishedCallback)},DialogHolderView.prototype.hideDialog=function(dialog,finishedCallback){var hideAction=this.actionFactory.createHideDialogAction(dialog);this.runDialogAction(dialog,hideAction,finishedCallback)},DialogHolderView.prototype.showFadedBackground=function(){var showAction=this.actionFactory.createShowFadedBackgroundAction();this.runFadedBackgroundAction(showAction)},DialogHolderView.prototype.hideFadedBackground=function(){var hideAction=this.actionFactory.createHideFadedBackgroundAction();this.runFadedBackgroundAction(hideAction)},DialogHolderView.prototype.runDialogAction=function(dialog,action,finishedCallback){var _this=this;this.dialogAction&&this.cancelAction(this.dialogAction),this.dialogAction=action,this.runAction(this.dialogAction,function(){_this.dialogAction=null,finishedCallback&&finishedCallback()})},DialogHolderView.prototype.runFadedBackgroundAction=function(action){var _this=this;this.fadedBackgroundAction&&this.cancelAction(this.fadedBackgroundAction),this.fadedBackgroundAction=action,this.runAction(this.fadedBackgroundAction,function(){_this.fadedBackgroundAction=null})},DialogHolderView.prototype.configureComponents=function(){this.fullscreenFade.position.copy(app.size.min),this.dialogParent.position.copy(app.size.centre);var fullscreenFadeBounds=this.fullscreenFade.getLocalBounds(),fullscreenFadeScale=Vector.create(app.size.maxWidth/fullscreenFadeBounds.width,app.size.maxHeight/fullscreenFadeBounds.height);this.fullscreenFade.scale.copy(fullscreenFadeScale)},DialogHolderView.prototype.addScripts=function(){this.scripts.addScript(new ClickScript({view:this.fullscreenFade}))},DialogHolderView}(View),ResultsDialogView=function(_super){function ResultsDialogView(config){var _this=_super.call(this,config)||this;return _this.actions=new ResultsDialogViewActions({rootView:_this,fanfareSpine:_this.getChildByName("fanfare"),soundName:config.soundName}),_this.scale.set(0),_this.addScripts(),_this}return __extends(ResultsDialogView,_super),ResultsDialogView.prototype.destroy=function(){this.actions=null,_super.prototype.destroy.call(this)},ResultsDialogView.prototype.getShowAction=function(showAnimName){return this.actions.getShowAction(showAnimName)},ResultsDialogView.prototype.getHideAction=function(hideAnimName,finishedCallback){return this.actions.getHideAction(hideAnimName,finishedCallback)},ResultsDialogView.prototype.addScripts=function(){var _this=this;({checkButtonPressed:new ClickScript({view:this.getChildByName("checkButton"),clickEndCallback:function(event){_this.emit(ResultsDialogView.CHECK_BUTTON_PRESSED,event)},clickSoundName:"navigateSelect"})}).forIn(function(script){_this.scripts.addScript(script)})},ResultsDialogView.CHECK_BUTTON_PRESSED="CHECK_BUTTON_PRESSED",ResultsDialogView}(View),TimeoutDialogView=function(_super){function TimeoutDialogView(config){var _this=_super.call(this,config)||this;return _this.actions=new TimeoutDialogViewActions({rootView:_this,fanfareSpine:_this.getChildByName("fanfare"),soundName:config.soundName}),_this.prompt=_this.getChildByName("prompt"),_this.particlesHolder=_this.getChildByName("particlesHolder"),_this.visible=!1,_this}return __extends(TimeoutDialogView,_super),TimeoutDialogView.prototype.destroy=function(){this.actions=null,_super.prototype.destroy.call(this)},TimeoutDialogView.prototype.setPromptTextureName=function(textureName){this.prompt.updateTexture(textureName)},TimeoutDialogView.prototype.setBackgroundParticles=function(particlesConfig,textureNames){particlesConfig&&(this.particles=new ParticlesView({name:"particles",config:particlesConfig,initiallyEnabled:!1,textureNames:textureNames}),this.particlesHolder.addChild(this.particles))},TimeoutDialogView.prototype.getShowWithTimeoutAction=function(showAnimName){var _this=this;return this.actions.getShowWithTimeoutAction(showAnimName,this.particles,function(){_this.emit(TimeoutDialogView.HIDE)})},TimeoutDialogView.prototype.getHideAction=function(hideAnimName,finishedCallback){return this.actions.getHideAction(hideAnimName,finishedCallback)},TimeoutDialogView.HIDE="HIDE",TimeoutDialogView}(View),YesNoDialogView=function(_super){function YesNoDialogView(config){var _this=_super.call(this,config)||this;return _this.yesButton=_this.getChildByName("yesButton"),_this.noButton=_this.getChildByName("noButton"),_this.prompt=_this.getChildByName("prompt"),_this.addScripts(),_this}return __extends(YesNoDialogView,_super),YesNoDialogView.prototype.destroy=function(){this.yesButton=null,this.noButton=null,_super.prototype.destroy.call(this)},YesNoDialogView.prototype.setPromptTextureName=function(textureName){this.prompt.updateTexture(textureName)},YesNoDialogView.prototype.getHideAction=function(){return Actions.Tween(this.scale,{from:Vector.create(1),to:Vector.create(0),duration:.5,easing:TWEEN.Easing.Back.In})},YesNoDialogView.prototype.addScripts=function(){var _this=this;({noButtonClicked:new ClickScript({view:this.noButton,clickEndCallback:function(event){app.sound.play("clickGeneric"),_this.emit(YesNoDialogView.NO_BUTTON_CLICKED,event)}}),yesButtonPressed:new ClickScript({view:this.yesButton,clickEndCallback:function(event){app.sound.play("clickGeneric"),_this.emit(YesNoDialogView.YES_BUTTON_CLICKED,event)}})}).forIn(function(script){_this.scripts.addScript(script)})},YesNoDialogView.NO_BUTTON_CLICKED="NO_BUTTON_CLICKED",YesNoDialogView.YES_BUTTON_CLICKED="YES_BUTTON_CLICKED",YesNoDialogView}(View),BuildBlocksGameView=function(_super){function BuildBlocksGameView(config){return _super.call(this,config)||this}return __extends(BuildBlocksGameView,_super),BuildBlocksGameView.prototype.destroy=function(){_super.prototype.destroy.call(this)},BuildBlocksGameView.prototype.createActionFactory=function(actionData){return new GameViewActions(this,actionData)},BuildBlocksGameView.prototype.addScripts=function(){var _this=this;_super.prototype.addScripts.call(this),{backgroundPressed:new ClickScript({view:this.background,clickStartCallback:function(){_this.emit(BuildBlocksGameView.BACKGROUND_PRESSED)}})}.forIn(function(script){_this.scripts.addScript(script)})},BuildBlocksGameView.BACKGROUND_PRESSED="BACKGROUND_PRESSED",BuildBlocksGameView}(GameView),RoofReleaseView=function(_super){function RoofReleaseView(config){var _this=_super.call(this,config)||this;return _this.highlight=_this.getChildByName("highlight"),_this.drone=_this.getChildByName("drone"),_this.addScripts(),_this}return __extends(RoofReleaseView,_super),RoofReleaseView.prototype.destroy=function(){_super.prototype.destroy.call(this)},RoofReleaseView.prototype.show=function(show){this.visible=show},RoofReleaseView.prototype.setPosition=function(position){this.position.set(position.x,position.y)},RoofReleaseView.prototype.setAnchor=function(anchor){this.highlight.anchor.copy(anchor),this.drone.anchor.copy(anchor)},RoofReleaseView.prototype.playDroneAnimation=function(animationName){var action=Actions.AnimateSprite(this.drone,animationName);this.runUniqueAction(action)},RoofReleaseView.prototype.enableHighlight=function(enable){this.highlight.visible=enable},RoofReleaseView.prototype.addScripts=function(){var _this=this;({roofHighlightPressed:new ClickScript({view:this.highlight,clickEndCallback:function(){_this.emit(RoofReleaseView.PRESSED)}})}).forIn(function(script){_this.scripts.addScript(script)})},RoofReleaseView.PRESSED="PRESSED",RoofReleaseView}(View),ShelfSlotView=function(_super){function ShelfSlotView(config){var _this=_super.call(this,config)||this;return _this.shape=_this.getChildByName("shape"),_this.countText=_this.getChildByName("countText"),_this.clickScript=null,_this.addScripts(),_this}return __extends(ShelfSlotView,_super),ShelfSlotView.prototype.destroy=function(){_super.prototype.destroy.call(this)},ShelfSlotView.prototype.setCountText=function(text){this.countText.text=text},ShelfSlotView.prototype.setPosition=function(position){this.position.copy(position)},ShelfSlotView.prototype.setShapeTextureName=function(textureName){this.shape.updateTexture(textureName),this.shape.hitArea=textureName?new TransparencyHitArea(this.shape):null},ShelfSlotView.prototype.setShapeAnchor=function(anchor){this.shape.anchor.copy(anchor)},ShelfSlotView.prototype.setClickable=function(clickable){this.clickScript.isActive=clickable},ShelfSlotView.prototype.setTintOn=function(tintOn){var shapeDisabledTint=this.layoutConfig.shapeDisabledTint;this.shape.tint=tintOn?ColourUtils.colourToNumber(shapeDisabledTint):16777215},ShelfSlotView.prototype.showShape=function(show){show?this.revealShape():this.hideShape()},ShelfSlotView.prototype.addScripts=function(){var _this=this;this.clickScript=new ClickScript({view:this.shape,clickStartCallback:function(event){var globalSlotPosition=Vector.getGlobalPos(_this);_this.emit(ShelfSlotView.CLICK_STARTED,event,globalSlotPosition)},clickSoundName:"BlockSelect"}),this.scripts.addScript(this.clickScript)},ShelfSlotView.prototype.revealShape=function(){var _this=this;this.shape.visible||(this.shape.visible=!0,this.runAction(Actions.Tween(this.shape.scale,{to:Vector.create(1),duration:.4,easing:Easing.Back.Out,onStart:function(){_this.shape.interactive=!1},onComplete:function(){_this.shape.interactive=!0}})))},ShelfSlotView.prototype.hideShape=function(){this.shape.scale.set(0),this.shape.visible=!1},ShelfSlotView.CLICK_STARTED="CLICK_STARTED",ShelfSlotView}(View),ShelfView=function(_super){function ShelfView(config){var _this=_super.call(this,config)||this;return _this.slotHolder=_this.getChildByName("slotHolder"),_this.outline=new OutlineView({sprite:_this.getChildByName("outline")}),_this}return __extends(ShelfView,_super),ShelfView.prototype.destroy=function(){this.outline=null,_super.prototype.destroy.call(this)},ShelfView.prototype.update=function(frameTime){_super.prototype.update.call(this,frameTime),this.outline.update(frameTime)},ShelfView.prototype.getShelfSlotParent=function(){return this.slotHolder},ShelfView.prototype.setOutlineVisible=function(visible){this.outline.setVisible(visible)},ShelfView.prototype.showOutline=function(){this.outline.showOutline()},ShelfView.prototype.hideOutline=function(){this.outline.hideOutline()},ShelfView}(View),FurBlurView=function(_super){function FurBlurView(config){var _this=_super.call(this,config)||this;return _this.spine=_this.getChildByName("furBlur"),_this.showAction=null,_this}return __extends(FurBlurView,_super),FurBlurView.prototype.destroy=function(){this.showAction=null,_super.prototype.destroy.call(this)},FurBlurView.prototype.show=function(){this.showAction=this.createShowAction(),this.runUniqueAction(this.showAction)},FurBlurView.prototype.hide=function(){this.showAction&&this.cancelAction(this.showAction),this.visible=!1},FurBlurView.prototype.setX=function(x){this.position.x=x},FurBlurView.prototype.setY=function(y){this.position.y=y},FurBlurView.prototype.createShowAction=function(){var _this=this;return Actions.Sequence([Actions.Delay(.5),Actions.Parallel([Actions.Func(function(){_this.visible=!0}),Actions.Spine(this.spine,"ResultsAnim",{endOnCancel:!0})]),Actions.Func(function(){_this.visible=!1})])},FurBlurView}(View),GravityButtonView=function(_super){function GravityButtonView(config){var _this=_super.call(this,config)||this;return _this.gravityButton=_this.createGravityButton(),_this.addChild(_this.gravityButton),_this.allScripts=[],_this.createScripts(),_this}return __extends(GravityButtonView,_super),GravityButtonView.prototype.getGravityButton=function(){return this.gravityButton},GravityButtonView.prototype.destroy=function(){this.allScripts=[],_super.prototype.destroy.call(this)},GravityButtonView.prototype.setAnimation=function(animationName,looped){this.gravityButton.state.setAnimation(0,animationName,looped)},GravityButtonView.prototype.enableInteraction=function(enable){enable?this.scripts.addScripts(this.allScripts):this.scripts.removeScripts(this.allScripts)},GravityButtonView.prototype.createGravityButton=function(){return new SpineView({spineName:"gravityButtonSpine",autoUpdate:!0})},GravityButtonView.prototype.createScripts=function(){var _this=this;({gravityButtonPressed:new ClickScript({view:this.gravityButton,clickStartCallback:function(event){_this.emit(GravityButtonView.BUTTON_PRESS_STARTED,event)},clickEndCallback:function(event){_this.emit(GravityButtonView.BUTTON_PRESS_ENDED,event)}}),gravityButtonHover:new HoverScript({view:this.gravityButton,hoverStartCallback:function(event){_this.emit(GravityButtonView.BUTTON_HOVER_STARTED,event)},hoverEndCallback:function(event){_this.emit(GravityButtonView.BUTTON_HOVER_ENDED,event)}})}).forIn(function(script){_this.allScripts.push(script)})},GravityButtonView.BUTTON_PRESS_STARTED="BUTTON_PRESS_STARTED",GravityButtonView.BUTTON_PRESS_ENDED="BUTTON_PRESS_ENDED",GravityButtonView.BUTTON_HOVER_STARTED="BUTTON_HOVER_STARTED",GravityButtonView.BUTTON_HOVER_ENDED="BUTTON_HOVER_ENDED",GravityButtonView}(View),ChuteProgressBarView=function(_super){function ChuteProgressBarView(config){var _this=_super.call(this,config)||this;return _this.barMask=_this.getChildByName("progressBarMask"),_this.fullProgressScale=_this.calculateFullProgressScale(),_this.progressBarFront=_this.getChildByName("chuteProgressFront"),_this.progressAction=null,_this}return __extends(ChuteProgressBarView,_super),ChuteProgressBarView.prototype.destroy=function(){this.progressAction=null,_super.prototype.destroy.call(this)},ChuteProgressBarView.prototype.setBarFrontTextureName=function(textureName){this.progressBarFront.updateTexture(textureName)},ChuteProgressBarView.prototype.setProgress=function(progress,finishedCallback){this.progressAction&&this.cancelAction(this.progressAction),this.progressAction=this.createProgressAction(progress),this.runAction(this.progressAction,finishedCallback)},ChuteProgressBarView.prototype.calculateFullProgressScale=function(){return this.getChildByName("progressBarBack").getLocalBounds().height},ChuteProgressBarView.prototype.createProgressAction=function(progress){var targetScale=progress*this.fullProgressScale;return Actions.Tween(this.barMask.scale,{to:{y:targetScale},duration:.75,easing:Easing.Cubic.InOut,endOnCancel:!0})},ChuteProgressBarView}(View),ChuteView=function(_super){function ChuteView(config){var _this=_super.call(this,config)||this;return _this.shape=_this.getChildByName("shape"),_this.progressBarHolder=_this.getChildByName("progressBarHolder"),_this.particleHolder=_this.getChildByName("particleHolder"),_this.shredParticles=_this.createParticles(config.shredParticleConfig),_this.particleHolder.addChild(_this.shredParticles),_this.actionFactory=new ChuteViewActions(_this),_this}return __extends(ChuteView,_super),ChuteView.prototype.destroy=function(){_super.prototype.destroy.call(this)},ChuteView.prototype.getProgressBarParent=function(){return this.progressBarHolder},ChuteView.prototype.addShape=function(shapeTextureName,shredParticleTextureName,finishedCallback){this.shape.updateTexture(shapeTextureName),this.shape.position.copy(this.layoutConfig.chuteTexturePos),this.shredParticles.emitter.particleImages=[app.getCache(shredParticleTextureName)];var addShapeAction=this.actionFactory.createAddShapeAction();this.runUniqueAction(addShapeAction,finishedCallback)},ChuteView.prototype.replaceShape=function(shapeTextureName,shredParticleTextureName,finishedCallback){var _this=this,removeShapeAction=this.actionFactory.createRemoveShapeAction();this.runUniqueAction(removeShapeAction,function(){_this.addShape(shapeTextureName,shredParticleTextureName,finishedCallback)})},ChuteView.prototype.shredShape=function(finishedCallback){this.cancelAction(this.shredShapeAction),this.shredShapeAction=this.actionFactory.createShredShapeAction(),this.runUniqueAction(this.shredShapeAction,finishedCallback)},ChuteView.prototype.createParticles=function(particlesConfig){return new ParticlesView({name:"shredParticles",config:particlesConfig,initiallyEnabled:!1})},ChuteView}(View),RemoveBlocksGameView=function(_super){function RemoveBlocksGameView(config){return _super.call(this,config)||this}return __extends(RemoveBlocksGameView,_super),RemoveBlocksGameView.prototype.destroy=function(){_super.prototype.destroy.call(this)},RemoveBlocksGameView.prototype.createActionFactory=function(actionData){return new GameViewActions(this,actionData)},RemoveBlocksGameView}(GameView),ShapeView=function(_super){function ShapeView(config){var _this=_super.call(this,config)||this;return _this.tweenPositionAction=null,_this.tweenRotationAction=null,_this.sprite=_this.getChildByName("sprite"),_this.rotateCW=_this.getChildByName("rotateCW"),_this.rotateCCW=_this.getChildByName("rotateCCW"),_this.rotateContainer=_this.getChildByName("rotate"),_this.fixedContainer=_this.getChildByName("fixed"),_this.rotateRing=_this.getChildByName("rotateRing"),_this.dragScript=null,_this.rotateCWScript=null,_this.rotateCCWScript=null,_this.clickScript=null,_this.rotateRingScript=null,_this}return __extends(ShapeView,_super),ShapeView.prototype.init=function(rotationStep){this.configureComponents(),this.createScripts(rotationStep)},ShapeView.prototype.destroy=function(){this.tweenRotationAction=null,this.tweenPositionAction=null,this.dragScript=null,this.rotateCWScript=null,this.rotateCCWScript=null,this.clickScript=null,this.rotateRingScript=null,_super.prototype.destroy.call(this)},ShapeView.prototype.setPosition=function(position,time,finishedCallback){void 0===time&&(time=0),void 0===finishedCallback&&(finishedCallback=null),Number.equals(time,0)?this.updatePosition(position):this.animatePosition(position,time,finishedCallback)},ShapeView.prototype.setRotation=function(rotation,time,finishedCallback){void 0===time&&(time=0),void 0===finishedCallback&&(finishedCallback=null),Number.equals(time,0)?this.updateRotation(rotation):this.animateRotation(rotation,time,finishedCallback)},ShapeView.prototype.setTextureName=function(textureName){this.sprite.updateTexture(textureName),this.sprite.hitArea=textureName?new TransparencyHitArea(this.sprite):null},ShapeView.prototype.setAnchor=function(anchor){this.sprite.anchor.copy(anchor)},ShapeView.prototype.setDraggable=function(draggable){this.scripts.removeScript(this.clickScript),draggable?this.scripts.addScript(this.dragScript):this.scripts.removeScript(this.dragScript)},ShapeView.prototype.setClickable=function(clickable){this.scripts.removeScript(this.dragScript),clickable?this.scripts.addScript(this.clickScript):this.scripts.removeScript(this.clickScript)},ShapeView.prototype.setRotationCircleVisible=function(visible){this.fixedContainer.visible=visible,(this.rotateRing.visible=visible)?this.scripts.addScript([this.rotateCWScript,this.rotateCCWScript,this.rotateRingScript]):this.scripts.removeScript([this.rotateCWScript,this.rotateCCWScript,this.rotateRingScript])},ShapeView.prototype.startDrag=function(dragEvent){dragEvent&&this.dragScript.startDrag(dragEvent)},ShapeView.prototype.bringToFront=function(){if(this.parent){var parent_1=this.parent;parent_1.removeChild(this),parent_1.addChild(this)}},ShapeView.prototype.show=function(show,finishedCallback){var showHideAction=show?this.createShowAction():this.createHideAction();this.runAction(showHideAction,finishedCallback)},ShapeView.prototype.getRotateCCWButtonView=function(){return this.rotateCCW},ShapeView.prototype.getRotateCWButtonView=function(){return this.rotateCW},ShapeView.prototype.configureComponents=function(){this.rotateRing.hitArea=new TransparencyHitArea(this.rotateRing)},ShapeView.prototype.createScripts=function(rotationStep){var _this=this;this.dragScript=new StickyAndDragViewScript({view:this,sourceView:this.sprite,dragStartedCallback:function(event,view){var clickPosition=Vector.transformGlobalToChild(event.data.global,_this.parent);_this.emit(ShapeView.DRAG_STARTED,clickPosition)},dragMovedCallback:function(event,view){var clickPosition=Vector.transformGlobalToChild(event.data.global,_this.parent);_this.emit(ShapeView.DRAG_MOVED,clickPosition)},dragEndedCallback:function(event,view){_this.emit(ShapeView.DRAG_ENDED)}}),this.rotateCWScript=new ButtonPressScript({view:this.rotateCW,buttonPressedCallback:function(event){_this.emit(ShapeView.ROTATE_CW_BUTTON_PRESSED)}}),this.rotateCCWScript=new ButtonPressScript({view:this.rotateCCW,buttonPressedCallback:function(event){_this.emit(ShapeView.ROTATE_CCW_BUTTON_PRESSED)}}),this.rotateRingScript=new DragViewScript({view:this.rotateRing,viewTransformer:new RotationViewTransformer({view:this.rotateContainer,step:rotationStep}),dragStartedCallback:function(event,view){_this.emit(ShapeView.ROTATION_STARTED)},dragMovedCallback:function(event,view){_this.emit(ShapeView.ROTATION_MOVED,_this.rotateContainer.rotation)},dragEndedCallback:function(_vent,view){_this.emit(ShapeView.ROTATION_ENDED,_this.rotateContainer.rotation)}}),this.clickScript=new ClickScript({view:this,clickStartCallback:function(event,view){_this.emit(ShapeView.CLICK_STARTED)},clickSoundName:"BlockSelect",stopPropagation:!1})},ShapeView.prototype.updatePosition=function(position){this.tweenPositionAction||this.position.copy(position)},ShapeView.prototype.updateRotation=function(rotation){this.tweenRotationAction||(this.rotateContainer.rotation=rotation)},ShapeView.prototype.animatePosition=function(position,time,finishedCallback){var _this=this;this.cancelAction(this.tweenPositionAction),this.tweenPositionAction=Actions.Tween(this.position,{to:position,duration:time,easing:Easing.Cubic.Out}),this.runAction(this.tweenPositionAction,function(){_this.tweenPositionAction=null,finishedCallback&&finishedCallback()})},ShapeView.prototype.animateRotation=function(rotation,time,finishedCallback){var _this=this;this.cancelAction(this.tweenRotationAction),this.tweenRotationAction=Actions.Tween(this.rotateContainer,{to:{rotation:rotation},duration:time,easing:Easing.Cubic.Out}),this.runAction(this.tweenRotationAction,function(){_this.tweenRotationAction=null,finishedCallback&&finishedCallback()})},ShapeView.prototype.createHideAction=function(){return Actions.Tween(this.sprite.scale,{to:Vector.create(0),duration:.2,easing:Easing.Linear.None})},ShapeView.prototype.createShowAction=function(){return Actions.Tween(this.sprite.scale,{to:Vector.create(1),duration:.4,easing:Easing.Back.Out})},ShapeView.DRAG_STARTED="DRAG_STARTED",ShapeView.DRAG_MOVED="DRAG_MOVED",ShapeView.DRAG_ENDED="DRAG_ENDED",ShapeView.ROTATION_STARTED="ROTATION_STARTED",ShapeView.ROTATION_MOVED="ROTATION_MOVED",ShapeView.ROTATION_ENDED="ROTATION_ENDED",ShapeView.ROTATE_CW_BUTTON_PRESSED="ROTATE_CW_BUTTON_PRESSED",ShapeView.ROTATE_CCW_BUTTON_PRESSED="ROTATE_CCW_BUTTON_PRESSED",ShapeView.CLICK_STARTED="CLICK_STARTED",ShapeView}(View),TestingIndicatorView=function(_super){function TestingIndicatorView(config){var _this=_super.call(this,config)||this;return _this.sprite=_this.getChildByName("animatedSprite"),_this.alpha=0,_this.visible=!1,_this}return __extends(TestingIndicatorView,_super),TestingIndicatorView.prototype.destroy=function(){this.sprite=null,_super.prototype.destroy.call(this)},TestingIndicatorView.prototype.show=function(){var action=this.createShowAction();this.runUniqueAction(action)},TestingIndicatorView.prototype.hide=function(){var action=this.createHideAction();this.runUniqueAction(action)},TestingIndicatorView.prototype.createShowAction=function(){var _this=this;return Actions.Parallel([Actions.Tween(this,{to:{alpha:1},duration:.2,easing:TWEEN.Easing.Cubic.In,onStart:function(){_this.visible=!0},endOnCancel:!0}),Actions.AnimateSprite(this.sprite,"default")])},TestingIndicatorView.prototype.createHideAction=function(){var _this=this;return Actions.Tween(this,{to:{alpha:0},duration:.2,easing:TWEEN.Easing.Cubic.In,onStop:function(){_this.visible=!1},endOnCancel:!0})},TestingIndicatorView}(View),TimerButtonView=function(_super){function TimerButtonView(config){var _this=_super.call(this,config)||this;return _this.button=_this.createButton(),_this.addChild(_this.button),_this.visible=!1,_this}return __extends(TimerButtonView,_super),TimerButtonView.prototype.destroy=function(){_super.prototype.destroy.call(this)},TimerButtonView.prototype.playAnim=function(animName,finishedCallback){var action=this.createShowAnimAction(animName,!1);this.runUniqueAction(action,finishedCallback)},TimerButtonView.prototype.playLoopedAnim=function(animName){var action=this.createShowAnimAction(animName,!0);this.runUniqueAction(action)},TimerButtonView.prototype.playHideAnim=function(animName,finishedCallback){var _this=this,action=this.createAnimAction(animName);this.runUniqueAction(action,function(){_this.visible=!1,finishedCallback&&finishedCallback()})},TimerButtonView.prototype.createButton=function(){return new SpineView({spineName:"timerButton",autoUpdate:!0})},TimerButtonView.prototype.createShowAnimAction=function(animName,loop){var _this=this;return Actions.Parallel([Actions.Spine(this.button,animName,{loop:loop,trackIndex:0,endOnCancel:!0}),Actions.Func(function(){_this.visible=!0})])},TimerButtonView.prototype.createAnimAction=function(animName){return Actions.Spine(this.button,animName,{loop:!1,trackIndex:0,endOnCancel:!0})},TimerButtonView}(View),WorkspaceView=function(_super){function WorkspaceView(config){var _this=_super.call(this,config)||this;return _this.shapeHolder=_this.getChildByName("shapeHolder"),_this}return __extends(WorkspaceView,_super),WorkspaceView.prototype.destroy=function(){_super.prototype.destroy.call(this)},WorkspaceView.prototype.getShapeParent=function(){return this.shapeHolder},WorkspaceView}(View),IntroView=function(_super){function IntroView(config){var _this=_super.call(this,config)||this;return _this.introSpine=_this.getChildByName("introSpine"),_this.introSpine.position=app.size.centre,_this.addScripts(),_this}return __extends(IntroView,_super),IntroView.prototype.destroy=function(){_super.prototype.destroy.call(this)},IntroView.prototype.show=function(){var _this=this,showAction=this.createShowAction();this.runUniqueAction(showAction,function(){_this.emit(IntroView.INTRO_COMPLETE)})},IntroView.prototype.addScripts=function(){var _this=this;this.scripts.addScript(new ClickScript({view:this.getChildByName("skipButton"),clickEndCallback:function(event){_this.emit(IntroView.SKIP_BUTTON_PRESSED,event)}}))},IntroView.prototype.createShowAction=function(){return Actions.Parallel([Actions.Spine(this.introSpine,"IntroAnim"),Actions.VO("introVO")])},IntroView.INTRO_COMPLETE="INTRO_COMPLETE",IntroView.SKIP_BUTTON_PRESSED="SKIP_BUTTON_PRESSED",IntroView}(View),LevelButtonView=function(_super){function LevelButtonView(config){var _this=_super.call(this,config)||this;return _this.particlesList=[_this.getChildByName("pulseParticles"),_this.getChildByName("smallTwinkleParticles"),_this.getChildByName("twinkleParticles")],_this.button=null,_this.particlesAction=null,_this.addScripts(),_this}return __extends(LevelButtonView,_super),LevelButtonView.prototype.destroy=function(){this.particlesList=null,this.button=null,this.particlesAction=null,_super.prototype.destroy.call(this)},LevelButtonView.prototype.configureButton=function(buttonViewConfig){this.button&&(this.removeChild(this.button),this.button.destroy());var finalConfig=Object.extend(this.layoutConfig.button,buttonViewConfig);this.button=new ButtonView(finalConfig),this.addChild(this.button)},LevelButtonView.prototype.setPosition=function(position){this.position.set(position.x,position.y),this.zIndex=Math.floor(position.y)},LevelButtonView.prototype.setInteractive=function(interactive){this.interactive=interactive},LevelButtonView.prototype.showUnlockParticles=function(){var _this=this;this.hideUnlockParticles(),this.particlesAction=this.createParticlesAction(),this.runAction(this.particlesAction,function(){_this.particlesAction=null})},LevelButtonView.prototype.hideUnlockParticles=function(){this.particlesAction&&this.cancelAction(this.particlesAction)},LevelButtonView.prototype.addScripts=function(){var _this=this,buttonClicked=new ClickScript({view:this,clickEndCallback:function(event){_this.emit(LevelButtonView.BUTTON_PRESSED,event)},clickSoundName:"levelSelect"});this.scripts.addScript(buttonClicked)},LevelButtonView.prototype.createParticlesAction=function(){var particleActions=this.particlesList.map(function(particlesView){return Actions.Particles(particlesView)});return Actions.Parallel(particleActions)},LevelButtonView.BUTTON_PRESSED="BUTTON_PRESSED",LevelButtonView}(View),LevelPathView=function(_super){function LevelPathView(config){var _this=_super.call(this,config)||this;return _this.sprite=_this.getChildByName("pathSprite"),_this.spriteMask=_this.getChildByName("pathMask"),_this}return __extends(LevelPathView,_super),LevelPathView.prototype.destroy=function(){this.sprite=null,this.spriteMask=null,_super.prototype.destroy.call(this)},LevelPathView.prototype.setTexture=function(name){this.sprite.updateTexture(name)},LevelPathView.prototype.setPoints=function(points){this.pathPoints=points},LevelPathView.prototype.setPosition=function(position){this.sprite.position.x=position.x,this.sprite.position.y=position.y},LevelPathView.prototype.setAnimated=function(animate){animate?(this.spriteMask.visible=!0,this.sprite.mask=this.spriteMask,this.runUniqueAction(this.createAction())):(this.cancelUniqueAction(),this.sprite.mask=null,this.spriteMask.visible=!1)},Object.defineProperty(LevelPathView.prototype,"progress",{get:function(){return this._progress},set:function(value){if(this._progress=value,2<=this.pathPoints.length){var scaledProgress=this._progress*(this.pathPoints.length-1),wholeProgress=Math.floor(scaledProgress),fractionalProgress=scaledProgress-wholeProgress,progressPoints=this.pathPoints.slice(0,wholeProgress+1);if(0<fractionalProgress){var fractionalPoint=Vector.lerp(this.pathPoints[wholeProgress],this.pathPoints[wholeProgress+1],fractionalProgress);progressPoints.append(fractionalPoint)}this.spriteMask.vertexList=progressPoints}},enumerable:!0,configurable:!0}),LevelPathView.prototype.createAction=function(){return Actions.Repeat(Actions.Tween(this,{from:{progress:0},to:{progress:1},duration:1,easing:Easing.Linear.None}))},LevelPathView}(View),LevelSelectView=function(_super){function LevelSelectView(config){var _this=_super.call(this,config)||this;return _this.background=_this.getChildByName("background"),_this.levelButtonParent=_this.getChildByName("levelButtonParent"),_this.levelPathsParent=_this.getChildByName("levelPathParent"),_this.locationButtonParent=_this.getChildByName("locationButtonParent"),_this.debugLayer=_this.getChildByName("debugLayer"),_this.configureComponents(),_this}return __extends(LevelSelectView,_super),LevelSelectView.prototype.destroy=function(){_super.prototype.destroy.call(this)},LevelSelectView.prototype.getLevelButtonParent=function(){return this.levelButtonParent},LevelSelectView.prototype.getLevelPathsParent=function(){return this.levelPathsParent},LevelSelectView.prototype.getLocationButtonParent=function(){return this.locationButtonParent},LevelSelectView.prototype.getDebugLayer=function(){return this.debugLayer},LevelSelectView.prototype.setBackground=function(textureName){this.background.updateTexture(textureName)},LevelSelectView.prototype.configureComponents=function(){this.background.position.set(app.size.min.x,app.size.min.y),this.levelPathsParent.position.set(app.size.min.x,app.size.min.y),this.levelButtonParent.position.set(app.size.min.x,app.size.min.y)},LevelSelectView}(View),LocationButtonView=function(_super){function LocationButtonView(config){var _this=_super.call(this,config)||this;return _this.unlockGlow=_this.getChildByName("unlockGlow"),_this.button=null,_this.unlockGlowAction=null,_this}return __extends(LocationButtonView,_super),LocationButtonView.prototype.destroy=function(){_super.prototype.destroy.call(this),this.unlockGlow=null,this.button=null,this.unlockGlowAction=null},LocationButtonView.prototype.setPosition=function(position){this.position.copy(position)},LocationButtonView.prototype.configureButton=function(buttonViewConfig){this.button&&(this.removeChild(this.button),this.button.destroy());var finalConfig=Object.extend(this.layoutConfig.buttonPrefab,buttonViewConfig);this.button=new ButtonView(finalConfig),this.addChild(this.button),this.addScripts()},LocationButtonView.prototype.setEnabled=function(enabled){this.button&&(this.button.enabled=enabled)},LocationButtonView.prototype.showUnlockGlow=function(){var _this=this;this.hideUnlockGlow(),this.unlockGlowAction=this.createUnlockGlowAction(),this.runAction(this.unlockGlowAction,function(){_this.unlockGlowAction=null,_this.unlockGlow.visible=!1})},LocationButtonView.prototype.hideUnlockGlow=function(){this.unlockGlowAction&&this.cancelAction(this.unlockGlowAction)},LocationButtonView.prototype.addScripts=function(){var _this=this;this.scripts.removeScripts(),{buttonPressed:new ClickScript({view:this.button,clickEndCallback:function(event){_this.emit(LocationButtonView.CLICKED,event)},clickSoundName:"mapSelect"})}.forIn(function(script){_this.scripts.addScript(script)})},LocationButtonView.prototype.createUnlockGlowAction=function(){var _this=this;return Actions.Parallel([Actions.Func(function(){_this.unlockGlow.visible=!0}),Actions.Spine(this.unlockGlow,"animation",{loop:!0})])},LocationButtonView.CLICKED="CLICKED",LocationButtonView}(View),LocationSelectView=function(_super){function LocationSelectView(config){var _this=_super.call(this,config)||this;return _this.levelSelectHolder=_this.getChildByName("levelSelectHolder"),_this.mapTransitionSpine=_this.getChildByName("mapTransitionSpine"),_this.mapTransitionSpine.position=app.size.centre,_this}return __extends(LocationSelectView,_super),LocationSelectView.prototype.destroy=function(){_super.prototype.destroy.call(this)},LocationSelectView.prototype.getLevelSelectParent=function(){return this.levelSelectHolder},LocationSelectView.prototype.showMapTransition=function(screenHiddenCallback,finishedCallback){this.mapTransitionSpine.visible=!0;var shownAction=this.createShowTransitionAction(),hideAction=this.createHideTransitionAction(),transitionAction=Actions.Sequence([shownAction,Actions.Func(screenHiddenCallback),hideAction]);this.runUniqueAction(transitionAction,finishedCallback)},LocationSelectView.prototype.createShowTransitionAction=function(){var _this=this;return Actions.Parallel([Actions.Func(function(){_this.mapTransitionSpine.alpha=1}),Actions.Spine(this.mapTransitionSpine,"animation"),Actions.Sequence([Actions.Delay(1.15),Actions.Func(function(){app.sound.play("locationTransition")})])])},LocationSelectView.prototype.createHideTransitionAction=function(){return Actions.Tween(this.mapTransitionSpine,{to:{alpha:0},duration:1,easing:Easing.Cubic.Out})},LocationSelectView}(View),RootView=function(_super){function RootView(config){var _this=_super.call(this,config)||this;return _this.contentHolder=_this.getChildByName("contentHolder"),_this.dialogLayer=_this.getChildByName("dialogLayer"),_this.loadingLayer=_this.getChildByName("loadingLayer"),_this.addScripts(),_this}return __extends(RootView,_super),RootView.prototype.getContentHolder=function(){return this.contentHolder},RootView.prototype.getDialogHolderParent=function(){return this.dialogLayer},RootView.prototype.getLoadingHolderParent=function(){return this.loadingLayer},RootView.prototype.addScripts=function(){},RootView}(View),SplashView=function(_super){function SplashView(config){var _this=_super.call(this,config)||this;return _this.configureComponents(),_this.addScripts(),_this}return __extends(SplashView,_super),SplashView.prototype.destroy=function(){_super.prototype.destroy.call(this)},SplashView.prototype.configureComponents=function(){this.playButton=this.getChildByName("playButton"),this.getChildByName("background").position.copy(app.size.centre)},SplashView.prototype.addScripts=function(){var _this=this;this.scripts.addScript(new ClickScript({view:this.playButton,clickEndCallback:function(event){_this.emit(SplashView.PLAY_BUTTON_CLICKED,event)}}))},SplashView.PLAY_BUTTON_CLICKED="PLAY_BUTTON_CLICKED",SplashView}(View);