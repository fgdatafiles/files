function extend(a,b){for(var c in b)a[c]=b[c]}function isInstanceOf(a,b){for(;"object"==typeof a;){if(a.constructor===b)return!0;a=a._super}return!1}!function(a){var b={version:"0.4",modules:{},path:a.PlayhousePath||"js/",nocache:document.location.href.match(/(\?|\&)nocache/)?"?"+Date.now():"",_current:null,_moduleQueue:[],_waitForLoad:0,_loadComplete:!1,_domReady:!1,_ignoredObjects:[],ignoreObject:function(a){-1===this._ignoredObjects.indexOf(a)&&this._ignoredObjects.push(a)},_checkIgnoredObjects:function(a){for(var b=0;b<this._ignoredObjects.length;b++)if(a instanceof this._ignoredObjects[b++])return!0;return!1},copy:function(a){var c,d,e=0;if(!a||"object"!=typeof a||a instanceof HTMLElement||a instanceof b.Class||this._checkIgnoredObjects(a))return a;if(a instanceof Array)for(c=[];e<a.length;e++)c.push(b.copy(a[e]));else{c={};for(d in a)c[d]=b.copy(a[d])}return c},merge:function(a,c){var d,e;for(d in c)e=c[d],"object"!=typeof e||e instanceof HTMLElement||e instanceof b.Class||this._checkIgnoredObjects(e)||null===e?a[d]=e:(a[d]&&"object"==typeof a[d]||(a[d]=e instanceof Array?[]:{}),b.merge(a[d],e));return a},ksort:function(a){if(!a||"object"!=typeof a)return[];var b,c=[],d=[],e=0;for(b in a)c.push(b);for(c.sort();e<c.length;e++)d.push(a[c[e]]);return d},$:function(a){return"#"==a.charAt(0)?document.getElementById(a.substr(1)):document.getElementsByTagName(a)},$new:function(a){return document.createElement(a)},getUrlVar:function(a){var b={};return window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(a,c,d){b[c]=d}),b[a]||null},setVendorAttribute:function(a,b,c){var d=b.charAt(0).toUpperCase()+b.substr(1);a[b]=a["ms"+d]=a["moz"+d]=a["webkit"+d]=a["o"+d]=c},getVendorAttribute:function(a,b){var c=b.charAt(0).toUpperCase()+b.substr(1);return a[b]||a["ms"+c]||a["moz"+c]||a["webkit"+c]||a["o"+c]},normalizeVendorAttribute:function(a,c){var d=b.getVendorAttribute(a,c);!a[c]&&d&&(a[c]=d)},goFullscreen:function(a){a=a||document.documentElement,a.requestFullScreen?a.requestFullScreen():a.webkitRequestFullScreen?a.webkitRequestFullScreen():a.mozRequestFullScreen&&a.mozRequestFullScreen()},module:function(a){if(this._current)throw'Module "'+this._current.name+'" defines nothing';if(this.modules[a]&&this.modules[a].body)throw'Module "'+a+'" is already defined';return this._current={name:a,requires:[],loaded:!1,body:null},this.modules[a]=this._current,this._moduleQueue.push(this._current),this},requires:function(){return this._current.requires=Array.prototype.slice.call(arguments),this},defines:function(a){this._current.body=a||function(){},this._current=null,this._loadComplete&&this._loadModules()},_loadScript:function(a,c){this._waitForLoad++,this.modules[a]={name:a,requires:[],loaded:!1,body:null};var d=this.path+a.replace(/\./g,"/")+".js"+this.nocache,e=document.createElement("script");e.type="text/javascript",e.src=d,e.onload=function(){b._waitForLoad--,b._loadModules()},e.onerror=function(){throw'Failed to load module "'+a+'" at path "'+d+'" required from "'+c+'"'},document.getElementsByTagName("head")[0].appendChild(e)},_loadModules:function(){for(var a,b,c,d,e=!1,f=0;f<this._moduleQueue.length;f++){for(b=this._moduleQueue[f],a=!0,d=0;d<b.requires.length;d++)c=b.requires[d],this.modules[c]?this.modules[c].loaded||(a=!1):(a=!1,this._loadScript(c,b.name));a&&b.body&&(this._moduleQueue.splice(f,1),b.loaded=!0,b.body(),e=!0,f--)}if(e&&this._moduleQueue.length)this._loadModules();else{if(!this._waitForLoad&&this._moduleQueue.length){var g,h=[],i=[];for(f=0;f<this._moduleQueue.length;f++){for(i.length=0,g=this._moduleQueue[f].requires,d=0;d<g.length;d++)b=this.modules[g[d]],b&&b.loaded||i.push(g[d]);h.push(this._moduleQueue[f].name+" (requires "+i.join(", ")+")")}throw"Unresolved modules:\n"+h.join("\n")}this._loadComplete=!0}},_domReadyComplete:function(){if(!this._domReady){if(!document.body)return setTimeout(this._domReadyComplete.bind(this),42);this._domReady=!0,this._loadModules()}},_boot:function(){"complete"===document.readyState?this._domReadyComplete():(document.addEventListener("DOMContentLoaded",this._domReadyComplete.bind(this),!1),window.addEventListener("load",this._domReadyComplete.bind(this),!1))}},c=!1,d=/xyz/.test(function(){})?/\bparent\b/:/.*/,e=function(a){var b,c=this.prototype,e={},f=function(a,b){return function(){var c=this.parent;this.parent=e[a];var d=b.apply(this,arguments);return this.parent=c,d}};for(b in a)"function"==typeof a[b]&&"function"==typeof c[b]&&d.test(a[b])?(e[b]=c[b],c[b]=f(b,a[b])):c[b]=a[b]};b.Class=function(){},b.Class.extend=function(a){function f(){if(!c){if(this.staticInit){var a=this.staticInit.apply(this,arguments);if(a)return a}this.set=this.set||function(a){for(var b in a)this[b]=a[b];return this};for(var d in this)"object"==typeof this[d]&&(this[d]=b.copy(this[d]));this.init&&this.init.apply(this,arguments)}return this}var g=this.prototype;c=!0;var h=new this;c=!1;var i=function(a,b){return function(){var c=this.parent;this.parent=g[a];var d=b.apply(this,arguments);return this.parent=c,d}};for(var j in a)"function"==typeof a[j]&&"function"==typeof g[j]&&d.test(a[j])?h[j]=i(j,a[j]):h[j]=a[j];return f.prototype=h,f.prototype.constructor=f,f.extend=b.Class.extend,f.inject=e,f},a.PlayhouseMixin&&b.merge(b,a.PlayhouseMixin),a.ph||(a.ph=b),b._boot()}(window),function(){var a=navigator.userAgent,b={};if(b.pixelRatio=window.devicePixelRatio||1,b.iPod=/ipod/i.test(a),b.iPhone=/iphone/i.test(a),b.iPad=/ipad/i.test(a),b.iOS=b.iPod||b.iPhone||b.iPad,b.iOSVersion=b.iOS?parseFloat(((a.match(/os (\d+_\d+)?/i)||["",""])[1]+"").replace("_",".")):-1,b.kindle=/silk/i.test(a),b.android=/android/i.test(a),b.androidPhone=/(?=.*\bandroid\b)(?=.*\bmobile\b)/i.test(a),b.androidTablet=!b.androidPhone&&b.android||b.kindle,b.android=b.androidPhone||b.androidTablet,b.androidVersion=a.match(/android\s([0-9\.]*)/i),b.androidVersion=b.androidVersion?b.androidVersion[1]:-1,b.winPhone=/(iemobile|windows phone)/i.test(a),b.winTablet=/(?=.*\bwindows\b)(?=.*\\btouch\b)/i.test(a),b.chrome=/chrome/i.test(a),b.safari=/safari/i.test(a),b.ie=/msie 9/i.test(a)||!!a.match(/trident.*rv:/i),b.firefox=/firefox/i.test(a),b.mobile=b.iOS||b.android||b.winPhone||b.winTablet||/mobile/i.test(a),b.tablet=b.iPad||b.androidTablet||b.winTablet,b.opera=/opera/i.test(a)||/opr/i.test(a),b.crosswalk=/crosswalk/i.test(a),b.cocoonJS=!!navigator.isCocoonJS,b.ejecta=/ejecta/i.test(a),b.facebook=/fb/i.test(a),b.wiiu=/nintendo wiiu/i.test(a),b.touchDevice="ontouchstart"in window||window.navigator.msMaxTouchPoints,b.mobile){for(var c,d=document.getElementsByTagName("meta"),e=0,f=!1;e<d.length;e++)c=d[e],"viewport"==c.name&&(f=!0);if(!f){var g=document.createElement("meta");g.name="viewport",g.content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no",7.1===b.iOSVersion&&(g.content+=", minimal-ui"),document.getElementsByTagName("head")[0].appendChild(g)}}ph.device=b}(),function(){Math.rand=function(a,b){var c=Math.random();return a||b?a.isInt()&&b.isInt()?Math.floor(c*(b-a+1))+a:c*(b-a)+a:c},Math.lerp=function(a,b,c){return a+c*(b-a)},Math.distance=function(a,b,c,d,e){var f,g;return arguments.length>3?(f=c-a,g=d-b):(f=b.x-a.x,g=b.y-a.y,e=c),e?Math.sqrt(f*f+g*g):f*f+g*g},Math.angle=function(a,b,c,d,e){var f;return arguments.length>3?f=Math.atan2(d-b,c-a):(f=Math.atan2(b.y-a.y,b.x-a.x),e=c),e?f.toDeg():f},Math.limit=function(a,b,c){return a>c?c:b>a?b:a},Math.toRad=function(a){return a/180*Math.PI},Math.toDeg=function(a){return 180*a/Math.PI},Number.prototype.map=function(a,b,c,d){return c+(d-c)*((this-a)/(b-a))},Number.prototype.commaFormat=function(){return(this+"").replace(/\B(?=(\d{3})+(?!\d))/g,",")},Number.prototype.round=function(a){return a=Math.pow(10,a||0),Math.round(this*a)/a},Number.prototype.isInt=function(){return this%1===0},Number.prototype.toInt=function(){return 0|this},Number.prototype.toRad=function(){return this/180*Math.PI},Number.prototype.toDeg=function(){return 180*this/Math.PI},String.prototype.ucwords=function(){return this.toLowerCase().replace(/(^([a-zA-Z\p{M}]))|([ -][a-zA-Z\p{M}])/g,function(a){return a.toUpperCase()})},Array.prototype.erase||Object.defineProperty(Array.prototype,"erase",{value:function(a){var b=this.indexOf(a);return b>-1&&this.splice(b,1),this}}),Array.prototype.random||Object.defineProperty(Array.prototype,"random",{value:function(){return 1===this.length?this[0]:this[Math.rand(0,this.length-1)]}}),Array.prototype.shuffle||Object.defineProperty(Array.prototype,"shuffle",{value:function(){for(var a,b,c=this.length;c;a=parseInt(Math.random()*c),b=this[--c],this[c]=this[a],this[a]=b);return this}}),Array.prototype.random||Object.defineProperty(Array.prototype,"unique",{value:function(){for(var a=this.concat(),b=0;b<a.length;++b)for(var c=b+1;c<a.length;++c)a[b]===a[c]&&a.splice(c--,1);return a}}),Array.prototype.last||Object.defineProperty(Array.prototype,"last",{value:function(){return this[this.length-1]}})}(),function(){ph.KEY={MOUSE1:-1,MOUSE2:-3,MWHEEL_UP:-4,MWHEEL_DOWN:-5,BACKSPACE:8,TAB:9,ENTER:13,PAUSE:19,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,_0:48,_1:49,_2:50,_3:51,_4:52,_5:53,_6:54,_7:55,_8:56,_9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SHIFT:16,CTRL:17,ALT:18,PLUS:187,COMMA:188,MINUS:189,PERIOD:190},ph.Input=ph.Class.extend({bindings:{},actions:{},presses:{},locks:{},delayedKeyup:{},isUsingMouse:!1,isUsingKeyboard:!1,isUsingAccelerometer:!1,mouse:{x:0,y:0},accel:{x:0,y:0,z:0},touch:{},touchCount:0,staticInit:function(){return ph.input||null},init:function(){ph.input=this},initMouse:function(){if(!this.isUsingMouse){this.isUsingMouse=!0;var a=this.mousewheel.bind(this);document.addEventListener("mousewheel",a,!1),document.addEventListener("DOMMouseScroll",a,!1)}},initKeyboard:function(){this.isUsingKeyboard||(this.isUsingKeyboard=!0,window.addEventListener("keydown",this.keydown.bind(this),!1),window.addEventListener("keyup",this.keyup.bind(this),!1),window.addEventListener("blur",this.keysreset.bind(this),!1))},initAccelerometer:function(){this.isUsingAccelerometer||window.addEventListener("devicemotion",this.devicemotion.bind(this),!1)},mousewheel:function(a){var b=a.wheelDelta?a.wheelDelta:-1*a.detail,c=b>0?ph.KEY.MWHEEL_UP:ph.KEY.MWHEEL_DOWN,d=this.bindings[c];d&&(this.actions[d]=!0,this.presses[d]=!0,this.delayedKeyup[d]=!0,a.stopPropagation(),a.preventDefault())},mousemove:function(a){var b=ph.system.scale,c=a.stageX*b,d=a.stageY*b,e=a.pointerID;this.mouse.x=c,this.mouse.y=d,e>-1&&(this.touch[e]||(this.touch[e]={x:c,y:d}),"stagemousedown"===a.type?this.touchCount++:"stagemouseup"===a.type?(delete this.touch[e],this.touchCount--):(this.touch[e].x=c,this.touch[e].y=d))},keydown:function(a){var b=a.target.tagName;if("INPUT"!==b&&"TEXTAREA"!==b&&"SELECT"!==b){var c="keydown"===a.type?a.keyCode:2===a.button?ph.KEY.MOUSE2:ph.KEY.MOUSE1;a instanceof createjs.MouseEvent&&this.mousemove(a);var d=this.bindings[c];d&&(this.actions[d]=!0,this.locks[d]||(this.presses[d]=!0,this.locks[d]=!0),c>0&&(a.stopPropagation(),a.preventDefault()))}},keyup:function(a){var b=a.target.tagName;if("INPUT"!==b&&"TEXTAREA"!==b&&"SELECT"!==b){var c="keyup"===a.type?a.keyCode:2===a.button?ph.KEY.MOUSE2:ph.KEY.MOUSE1;a instanceof createjs.MouseEvent&&this.mousemove(a);var d=this.bindings[c];d&&(this.delayedKeyup[d]=!0,a.stopPropagation(),a.preventDefault())}},keysreset:function(){for(var a in this.delayedKeyup)this.actions[a]=!1,delete this.delayedKeyup[a]},devicemotion:function(a){this.accel=a.accelerationIncludingGravity},bind:function(a,b){a>0?this.initKeyboard():0>a&&this.initMouse(),this.bindings[a]=b||a+""},unbind:function(a){var b=this.bindings[a];this.delayedKeyup[b]=!0,this.bindings[a]=null},unbindAll:function(){this.bindings={},this.actions={},this.presses={},this.delayedKeyup={}},state:function(a){return this.actions[a]},pressed:function(a){return this.presses[a]},released:function(a){return!!this.delayedKeyup[a]},clearPressed:function(){var a;for(a in this.delayedKeyup)this.actions[a]=!1,this.locks[a]=!1,delete this.delayedKeyup[a];for(a in this.presses)delete this.presses[a]}})}(),function(){ph.Loader=ph.Class.extend({status:0,loadCallback:null,loadQueue:null,_loadedObjects:{},staticInit:function(){return ph.loader||null},init:function(){ph.loader=this},load:function(a,b){this.loadCallback=b||this.loadCallback;for(var c=0;c<a.length;c++)a[c].src+=ph.nocache,this.get(a[c].id)&&(a.splice(c,1),c--);a.length?this.loadManifest(a):this.handleComplete()},unload:function(a){for(var b=0;b<a.length;b++)this.set(a[b].id,null)},loadManifest:function(a){this.loadQueue||(this.status=0,this.loadQueue=new createjs.LoadQueue(!1),this.loadQueue.setMaxConnections(8),this.loadQueue.installPlugin(createjs.Sound),this.loadQueue.on("fileload",this.handleFileload,this)),this.loadQueue.loadManifest(a)},handleFileload:function(a){this.status=this.loadQueue?this.loadQueue.getItems(!0).length/this.loadQueue.getItems().length:this.status,this.set(a.item.id,a.result),this.status>=1&&this.handleComplete()},handleComplete:function(a){this.status=1;var b=this.loadCallback;this.loadCallback=null,this.loadQueue&&this.loadQueue.unregisterLoader(),this.loadQueue=null,b&&b()},get:function(a){return this._loadedObjects[a]||null},set:function(a,b){this._loadedObjects[a]=b,null===b&&delete this._loadedObjects[a]}}),new ph.Loader}(),function(){ph.Music=ph.Class.extend({id:null,soundObj:null,staticInit:function(){return ph.music||null},init:function(){ph.music=this},set:function(a,b,c){this.id!==a&&(this.id=a,window.app.music?this.fadeTo(0,b).wait(100).call(this._set,[a,b,c],this):this._set(a,b,c))},_set:function(a,b,c){window.app.music=a,window.app.musicInstance.volume=c},play:function(){},pause:function(){},stop:function(a){this.fadeTo(0,a||0).call(function(){window.app.music="",this.id=""},null,this)},fadeTo:function(a,b){return createjs.Tween.get(window.app.musicInstance,{override:!0}).to({volume:a},b||600)}})}(),function(){ph.Scene=ph.Class.extend({currentStateId:-1,stateId:{transit:1,title:2,menu:3,intro:4,game:5,end:6},staticInit:function(){ph.scene&&ph.scene.kill(),ph.scene=this},start:function(){},end:function(){},update:function(){},kill:function(){}})}(),function(){ph.Session=ph.Class.extend({hasLocalStorage:!0,prefix:"",expires:365,staticInit:function(){return ph.session||null},init:function(){ph.session=this,this.hasLocalStorage="undefined"!=typeof window.localStorage},set:function(a,b,c){if(this.hasLocalStorage)try{window.localStorage.setItem(a,JSON.stringify(b))}catch(d){d===QUOTA_EXCEEDED_ERR}else{c||(c=this.expires);var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3);var f="; expires="+e.toGMTString();document.cookie=this.prefix+a+"="+b+f+"; path=/"}},get:function(a){if(this.hasLocalStorage)try{return JSON.parse(localStorage.getItem(a))}catch(b){return window.localStorage.getItem(a)}else for(var c,d=this.prefix+a+"=",e=document.cookie.split(";"),f=0;f<e.length;f++){for(c=e[f];" "===c.charAt(0);)c=c.substring(1,c.length);if(0===c.indexOf(d))return c.substring(d.length,c.length)}},remove:function(a){this.hasLocalStorage?window.localStorage.removeItem(a):this.set(a,"",-1)},clear:function(){this.hasLocalStorage&&window.localStorage.clear()}}),new ph.Session}(),function(){ph.sfx=function(a,b){b=b||{},b.volume=b.volume||1,ph.vo.isPlaying&&(b.volume*=.25),window.app.sound.play(a,b)}}(),function(){ph.System=ph.Class.extend({scale:1,delta:0,deltaIgnore:0,width:240,widthMin:240,widthMax:284,height:160,heightMin:160,heightMax:192,stages:[],wrapper:null,isWrongOrientation:!1,isFocused:!0,staticInit:function(){return ph.system||null},init:function(){if(!window.createjs||!window.cjs)throw"Where is CreateJS? Go get it...";ph.system=this;var a=this.onPageShow.bind(this),b=this.onPageHide.bind(this),c=this.onChange.bind(this);window.addEventListener("pageshow",a,!1),window.addEventListener("pagehide",b,!1),window.addEventListener("focus",a,!1),window.addEventListener("blur",b,!1);var d="hidden";d in document?document.addEventListener("visibilitychange",c):(d="mozHidden")in document?document.addEventListener("mozvisibilitychange",c):(d="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",c):(d="msHidden")in document&&document.addEventListener("msvisibilitychange",c),this.hiddenEventType=d,document.ontouchmove=function(a){a.preventDefault()},new ph.Input,new ph.Music,new ph.VoiceOver;var e=app.display.stage;e.snapToPixelEnabled=!1,ph.device.mobile&&cjs.Touch.isSupported()&&cjs.Touch.enable(e),this.wrapper=ph.$("#content"),this.stages.push(e)},run:function(a){ph.Timer.step(),this.delta=.001*a*ph.Timer.timeScale,this.deltaIgnore=.001*a,ph.game&&ph.game.update(),ph.input&&ph.input.clearPressed()},updateDisplays:function(a){for(var b,c=0;c<this.displays.length;c++)b=this.displays[c],b.isActive&&b.update()},updateStage:function(a){for(var b,c=0;c<this.stages.length;c++)b=this.stages[c],b.stopUpdate||b.update(a)},setupElements:function(){this.wrapper=ph.$("#game-wrapper")||ph.$new("div"),this.wrapper.id="game-wrapper",this.wrapper.parentNode||document.body.appendChild(this.wrapper)},addStage:function(a,b){if(this.wrapper){a=a||ph.$new("canvas"),this.wrapper.insertBefore(a,this.wrapper.childNodes[b||this.stages.length]);var c=new cjs.Stage(a);c.preventSelection=!1,c.snapToPixelEnabled=!0,ph.device.mobile&&cjs.Touch.isSupported()?(cjs.Touch.enable(c),c.enableDOMEvents(!1)):c.enableMouseOver(20),this.stages.splice(b||this.stages.length,0,c);for(var d=this.stages.length-1;d>-1;d--)this.stages[d].nextStage=this.stages[d-1]||null;return this._lastSize=0,this.onWindowResize(),this.fixStages(),c}},removeStage:function(a){"number"==typeof a&&(a=this.stages.indexOf(a)),cjs.Touch.disable(a),a.removeAllEventListeners(),a.canvas.parentNode.removeChild(a.canvas),this.stages.erase(a);for(var b=this.stages.length-1;b>-1;b--)this.stages[b]._prevStage=null,this.stages[b].nextStage=this.stages[b-1]||null;this.fixStages()},fixStages:function(){for(var a,b=0;b<this.stages.length;b++)a=this.stages[b],a._prevStage=null,a.nextStage=null,a.removeAllEventListeners();for(b=this.stages.length-1;b>-1;b--)this.stages[b].nextStage=this.stages[b-1]||null;if(a=this.stages[this.stages.length-1]){var c=ph.input;a.on("stagemousedown",c.keydown.bind(c)),a.on("stagemouseup",c.keyup.bind(c)),a.on("stagemousemove",c.mousemove.bind(c))}},resize:function(a,b){this.width=a,this.height=b},_lastSize:0,onWindowResize:function(a){if(setTimeout(function(){window.scrollTo&&window.scrollTo(0,0)},1),a||this._lastSize!==window.innerWidth+window.innerHeight){var b,c=window.innerWidth,d=window.innerHeight,e=c/this.widthMin,f=d/this.heightMin,g=this.widthMin,h=this.heightMin,i=this.wrapper.style;e>f?g=c>this.widthMax*f?this.widthMax:c<this.widthMin*f?this.widthMin:c/f:h=d>this.heightMax*e?this.heightMax:d<this.heightMin*e?this.heightMin:d/e,g=~~g,h=~~h,this.resize(g,h),this.isWrongOrientation=g/h>c/d,b=e>f?d/h:c/g,i.maxWidth=i.maxHeight=i.margin="",i.width=~~(g*b)+"px",i.height=~~(h*b)+"px",i.marginTop=~~(.5*(d-h*b))+"px",i.fontSize=b+"px",this._lastSize=c+d}},onPageShow:function(){this.isFocused&&(this.isFocused=1)},onPageHide:function(){this.isFocused||(this.isFocused=-1)},onChange:function(a){document[this.hiddenEventType]?this.onPageHide():this.onPageShow()}})}(),function(){ph.Timer=ph.Class.extend({target:0,base:0,last:0,pausedAt:0,ignoreTimeScale:!1,init:function(a,b){this.base=ph.Timer.time,this.last=ph.Timer.time,this.ignoreTimeScale=!!b,this.target=a||0},set:function(a){return this.target=a||0,this.reset()},reset:function(){return this.base=this.ignoreTimeScale?ph.Timer.timeIgnoreScale:ph.Timer.time,this.pausedAt=0,this},delta:function(){return this.ignoreTimeScale?(this.pausedAt||ph.Timer.timeIgnoreScale)-this.base-this.target:(this.pausedAt||ph.Timer.time)-this.base-this.target},pause:function(){return this.pausedAt||(this.pausedAt=this.ignoreTimeScale?ph.Timer.timeIgnoreScale:ph.Timer.time),this},resume:function(){return this.pausedAt&&(this.base+=(this.ignoreTimeScale?ph.Timer.timeIgnoreScale:ph.Timer.time)-this.pausedAt,this.pausedAt=0),this}}),ph.Timer._last=0,ph.Timer.time=Number.MIN_VALUE,ph.Timer.timeIgnoreScale=Number.MIN_VALUE,ph.Timer.timeScale=1,ph.Timer.maxStep=.05,ph.Timer.step=function(){var a=Date.now(),b=.001*(a-ph.Timer._last),c=Math.min(b,ph.Timer.maxStep);ph.Timer.time+=c*ph.Timer.timeScale,ph.Timer.timeIgnoreScale+=c,ph.Timer._last=a}}(),function(){ph.VoiceOver=ph.Class.extend({isPlaying:!1,index:0,sequence:[],callback:null,scope:null,soundObj:null,endTime:0,staticInit:function(){return ph.vo||null},init:function(){ph.vo=this,this.endTime=new ph.Timer},play:function(a,b,c){this.sequence=a instanceof Array?a:[a],this.callback=b||null,this.scope=c||null,this.stop(),this.playNext()},playNext:function(){var a=this.sequence[this.index++];if(a){var b=null,c=null,d=1,e=this.scope;"object"==typeof a&&(b=a.startFtn||b,c=a.completeFtn||c,d=a.delay||d,e=a.scope||e,a=a.id);var f=cjs.Tween.get(this,{override:!0}).wait(d);b&&f.call(b,null,e),f.call(this._startVO,[a,c,e],this)}else{this.endTime.reset(),this.stop();var g=this.callback;this.callback=null,g&&g.apply(this.scope)}},_startVO:function(a,b,c){if(this.isPlaying=!0,window.app.voPlayer.play(a,this._endVO.bind(this,null,{completeFtn:b,scope:c})),window.app){var d;"score3"===a?(d={vo:[{start:0,end:1/0,content:ph.loader.get("captions")[a]+" "}]},d.vo[0].content+=ph.game.data.hitCount+" ",d.vo[0].content+=ph.loader.get("captions")[1===ph.game.data.hitCount?"score4":"score5"]):/^(score6\.|score4|score5)/.test(a)||(d={vo:[{start:0,end:1/0,content:ph.loader.get("captions")[a]}]}),d&&(window.app.captions.data=d,window.app.captions.play("vo"))}},_endVO:function(a,b){a&&"failed"===a.type,this.isPlaying&&("function"==typeof b.completeFtn&&b.completeFtn.apply(b.scope),this.playNext())},stop:function(){cjs.Tween.removeTweens(this),window.app.voPlayer.playing&&window.app.voPlayer.stop(),this.index=0,this.isPlaying=!1},fadeOut:function(a){return window.app.voPlayer.playing?(this.isPlaying=!1,cjs.Tween.removeTweens(this),createjs.Tween.get(window.app.voPlayer._soundInstance,{override:!0}).to({volume:0},a||600).call(this.stop,null,this)):cjs.Tween.get({})}})}(),this.createjs=this.createjs||{},createjs.extend=function(a,b){"use strict";function c(){this.constructor=a}return c.prototype=b.prototype,a.prototype=new c},this.createjs=this.createjs||{},createjs.promote=function(a,b){"use strict";var c=a.prototype,d=Object.getPrototypeOf&&Object.getPrototypeOf(c)||c.__proto__;if(d){c[(b+="_")+"constructor"]=d.constructor;for(var e in d)c.hasOwnProperty(e)&&"function"==typeof d[e]&&(c[b+e]=d[e])}return a},this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c){this.type=a,this.target=null,this.currentTarget=null,this.eventPhase=0,this.bubbles=!!b,this.cancelable=!!c,this.timeStamp=(new Date).getTime(),this.defaultPrevented=!1,this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.removed=!1}var b=a.prototype;b.preventDefault=function(){this.defaultPrevented=this.cancelable&&!0},b.stopPropagation=function(){this.propagationStopped=!0},b.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},b.remove=function(){this.removed=!0},b.clone=function(){return new a(this.type,this.bubbles,this.cancelable)},b.set=function(a){for(var b in a)this[b]=a[b];return this},b.toString=function(){return"[Event (type="+this.type+")]"},createjs.Event=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(){this._listeners=null,this._captureListeners=null}var b=a.prototype;a.initialize=function(a){a.addEventListener=b.addEventListener,a.on=b.on,a.removeEventListener=a.off=b.removeEventListener,a.removeAllEventListeners=b.removeAllEventListeners,a.hasEventListener=b.hasEventListener,a.dispatchEvent=b.dispatchEvent,a._dispatchEvent=b._dispatchEvent,a.willTrigger=b.willTrigger},b.addEventListener=function(a,b,c){var d;d=c?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{};var e=d[a];return e&&this.removeEventListener(a,b,c),e=d[a],e?e.push(b):d[a]=[b],b},b.on=function(a,b,c,d,e,f){return b.handleEvent&&(c=c||b,b=b.handleEvent),c=c||this,this.addEventListener(a,function(a){b.call(c,a,e),d&&a.remove()},f)},b.removeEventListener=function(a,b,c){var d=c?this._captureListeners:this._listeners;if(d){var e=d[a];if(e)for(var f=0,g=e.length;g>f;f++)if(e[f]==b){1==g?delete d[a]:e.splice(f,1);break}}},b.off=b.removeEventListener,b.removeAllEventListeners=function(a){a?(this._listeners&&delete this._listeners[a],this._captureListeners&&delete this._captureListeners[a]):this._listeners=this._captureListeners=null},b.dispatchEvent=function(a,b,c){if("string"==typeof a){var d=this._listeners;if(!(b||d&&d[a]))return!0;a=new createjs.Event(a,b,c)}else a.target&&a.clone&&(a=a.clone());try{a.target=this}catch(e){}if(a.bubbles&&this.parent){for(var f=this,g=[f];f.parent;)g.push(f=f.parent);var h,i=g.length;for(h=i-1;h>=0&&!a.propagationStopped;h--)g[h]._dispatchEvent(a,1+(0==h));for(h=1;i>h&&!a.propagationStopped;h++)g[h]._dispatchEvent(a,3)}else this._dispatchEvent(a,2);return!a.defaultPrevented},b.hasEventListener=function(a){var b=this._listeners,c=this._captureListeners;return!!(b&&b[a]||c&&c[a])},b.willTrigger=function(a){for(var b=this;b;){if(b.hasEventListener(a))return!0;b=b.parent}return!1},b.toString=function(){return"[EventDispatcher]"},b._dispatchEvent=function(a,b){var c,d=1==b?this._captureListeners:this._listeners;if(a&&d){var e=d[a.type];if(!e||!(c=e.length))return;try{a.currentTarget=this}catch(f){}try{a.eventPhase=b}catch(f){}a.removed=!1,e=e.slice();for(var g=0;c>g&&!a.immediatePropagationStopped;g++){var h=e[g];h.handleEvent?h.handleEvent(a):h(a),a.removed&&(this.off(a.type,h,1==b),a.removed=!1)}}},createjs.EventDispatcher=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"Ticker cannot be instantiated."}a.RAF_SYNCHED="synched",a.RAF="raf",a.TIMEOUT="timeout",a.useRAF=!1,a.timingMode=null,a.maxDelta=0,a.paused=!1,a.removeEventListener=null,a.removeAllEventListeners=null,a.dispatchEvent=null,a.hasEventListener=null,a._listeners=null,createjs.EventDispatcher.initialize(a),a._addEventListener=a.addEventListener,a.addEventListener=function(){return!a._inited&&a.init(),a._addEventListener.apply(a,arguments)},a._inited=!1,a._startTime=0,a._pausedTime=0,a._ticks=0,a._pausedTicks=0,a._interval=50,a._lastTime=0,a._times=null,a._tickTimes=null,a._timerId=null,a._raf=!0,a.setInterval=function(b){a._interval=b,a._inited&&a._setupTick()},a.getInterval=function(){return a._interval},a.setFPS=function(b){a.setInterval(1e3/b)},a.getFPS=function(){return 1e3/a._interval};try{Object.defineProperties(a,{interval:{get:a.getInterval,set:a.setInterval},framerate:{get:a.getFPS,set:a.setFPS}})}catch(b){}a.init=function(){a._inited||(a._inited=!0,a._times=[],a._tickTimes=[],a._startTime=a._getTime(),a._times.push(a._lastTime=0),a.interval=a._interval)},a.reset=function(){if(a._raf){var b=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame;b&&b(a._timerId)}else clearTimeout(a._timerId);a.removeAllEventListeners("tick"),a._timerId=a._times=a._tickTimes=null,a._startTime=a._lastTime=a._ticks=0,a._inited=!1},a.getMeasuredTickTime=function(b){var c=0,d=a._tickTimes;if(!d||d.length<1)return-1;b=Math.min(d.length,b||0|a.getFPS());for(var e=0;b>e;e++)c+=d[e];return c/b},a.getMeasuredFPS=function(b){var c=a._times;return!c||c.length<2?-1:(b=Math.min(c.length-1,b||0|a.getFPS()),1e3/((c[0]-c[b])/b))},a.setPaused=function(b){a.paused=b},a.getPaused=function(){return a.paused},a.getTime=function(b){return a._startTime?a._getTime()-(b?a._pausedTime:0):-1},a.getEventTime=function(b){return a._startTime?(a._lastTime||a._startTime)-(b?a._pausedTime:0):-1},a.getTicks=function(b){return a._ticks-(b?a._pausedTicks:0)},a._handleSynch=function(){a._timerId=null,a._setupTick(),a._getTime()-a._lastTime>=.97*(a._interval-1)&&a._tick()},a._handleRAF=function(){a._timerId=null,a._setupTick(),a._tick()},a._handleTimeout=function(){a._timerId=null,a._setupTick(),a._tick()},a._setupTick=function(){if(null==a._timerId){var b=a.timingMode||a.useRAF&&a.RAF_SYNCHED;if(b==a.RAF_SYNCHED||b==a.RAF){var c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(c)return a._timerId=c(b==a.RAF?a._handleRAF:a._handleSynch),void(a._raf=!0)}a._raf=!1,a._timerId=setTimeout(a._handleTimeout,a._interval)}};var c=null;a._tick=function(){var b=a.paused,d=a._getTime(),e=d-a._lastTime;if(a._lastTime=d,a._ticks++,b&&(a._pausedTicks++,a._pausedTime+=e),a.hasEventListener("tick")){var f=c?c:new createjs.Event("tick"),g=a.maxDelta;f.delta=g&&e>g?g:e,f.paused=b,f.time=d,f.runTime=d-a._pausedTime,f.timeStamp=Date.now(),f.target=null,f.currentTarget=null,c=f,a.dispatchEvent(f)}for(a._tickTimes.unshift(a._getTime()-d);a._tickTimes.length>100;)a._tickTimes.pop();for(a._times.unshift(d);a._times.length>100;)a._times.pop()};var d=window.performance&&(performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow);a._getTime=function(){return(d&&d.call(performance)||(new Date).getTime())-a._startTime},createjs.Ticker=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(b,c,d){this.ignoreGlobalPause=!1,this.loop=!1,this.duration=0,this.pluginData=d||{},this.target=b,this.position=null,this.passive=!1,this._paused=!1,this._curQueueProps={},this._initQueueProps={},this._steps=[],this._actions=[],this._prevPosition=0,this._stepPosition=0,this._prevPos=-1,this._target=b,this._useTicks=!1,this._inited=!1,this._registered=!1,c&&(this._useTicks=c.useTicks,this.ignoreGlobalPause=c.ignoreGlobalPause,this.loop=c.loop,c.onChange&&this.addEventListener("change",c.onChange),c.override&&a.removeTweens(b)),c&&c.paused?this._paused=!0:createjs.Tween._register(this,!0),c&&null!=c.position&&this.setPosition(c.position,a.NONE)}var b=createjs.extend(a,createjs.EventDispatcher);a.NONE=0,a.LOOP=1,a.REVERSE=2,a.IGNORE={},a._tweens=[],a._plugins={},a.get=function(b,c,d,e){return e&&a.removeTweens(b),new a(b,c,d)},a.tick=function(b,c){for(var d=a._tweens.slice(),e=d.length-1;e>=0;e--){var f=d[e];c&&!f.ignoreGlobalPause||f._paused||f.tick(f._useTicks?1:b)}},a.handleEvent=function(a){"tick"==a.type&&this.tick(a.delta,a.paused)},a.removeTweens=function(b){if(b.tweenjs_count){for(var c=a._tweens,d=c.length-1;d>=0;d--){var e=c[d];e._target==b&&(e._paused=!0,c.splice(d,1))}b.tweenjs_count=0}},a.removeAllTweens=function(){for(var b=a._tweens,c=0,d=b.length;d>c;c++){var e=b[c];e._paused=!0,e.target&&(e.target.tweenjs_count=0)}b.length=0},a.hasActiveTweens=function(b){return b?null!=b.tweenjs_count&&!!b.tweenjs_count:a._tweens&&!!a._tweens.length},a.installPlugin=function(b,c){var d=b.priority;null==d&&(b.priority=d=0);for(var e=0,f=c.length,g=a._plugins;f>e;e++){var h=c[e];if(g[h]){for(var i=g[h],j=0,k=i.length;k>j&&!(d<i[j].priority);j++);g[h].splice(j,0,b)}else g[h]=[b]}},a._register=function(b,c){var d=b._target,e=a._tweens;if(c&&!b._registered)d&&(d.tweenjs_count=d.tweenjs_count?d.tweenjs_count+1:1),e.push(b),!a._inited&&createjs.Ticker&&(createjs.Ticker.addEventListener("tick",a),a._inited=!0);else if(!c&&b._registered){d&&d.tweenjs_count--;for(var f=e.length;f--;)if(e[f]==b){e.splice(f,1);break}}b._registered=c},b.wait=function(a,b){if(null==a||0>=a)return this;var c=this._cloneProps(this._curQueueProps);return this._addStep({d:a,p0:c,e:this._linearEase,
p1:c,v:b})},b.to=function(a,b,c){return(isNaN(b)||0>b)&&(b=0),this._addStep({d:b||0,p0:this._cloneProps(this._curQueueProps),e:c,p1:this._cloneProps(this._appendQueueProps(a))})},b.call=function(a,b,c){return this._addAction({f:a,p:b?b:[this],o:c?c:this._target})},b.set=function(a,b){return this._addAction({f:this._set,o:this,p:[a,b?b:this._target]})},b.play=function(a){return a||(a=this),this.call(a.setPaused,[!1],a)},b.pause=function(a){return a||(a=this),this.call(a.setPaused,[!0],a)},b.setPosition=function(a,b){0>a&&(a=0),null==b&&(b=1);var c=a,d=!1;if(c>=this.duration&&(this.loop?c%=this.duration:(c=this.duration,d=!0)),c==this._prevPos)return d;var e=this._prevPos;if(this.position=this._prevPos=c,this._prevPosition=a,this._target)if(d)this._updateTargetProps(null,1);else if(this._steps.length>0){for(var f=0,g=this._steps.length;g>f&&!(this._steps[f].t>c);f++);var h=this._steps[f-1];this._updateTargetProps(h,(this._stepPosition=c-h.t)/h.d)}return 0!=b&&this._actions.length>0&&(this._useTicks?this._runActions(c,c):1==b&&e>c?(e!=this.duration&&this._runActions(e,this.duration),this._runActions(0,c,!0)):this._runActions(e,c)),d&&this.setPaused(!0),this.dispatchEvent("change"),d},b.tick=function(a){this._paused||this.setPosition(this._prevPosition+a)},b.setPaused=function(b){return this._paused===!!b?this:(this._paused=!!b,a._register(this,!b),this)},b.w=b.wait,b.t=b.to,b.c=b.call,b.s=b.set,b.toString=function(){return"[Tween]"},b.clone=function(){throw"Tween can not be cloned."},b._updateTargetProps=function(b,c){var d,e,f,g,h,i;if(b||1!=c){if(this.passive=!!b.v,this.passive)return;b.e&&(c=b.e(c,0,1,1)),d=b.p0,e=b.p1}else this.passive=!1,d=e=this._curQueueProps;for(var j in this._initQueueProps){null==(g=d[j])&&(d[j]=g=this._initQueueProps[j]),null==(h=e[j])&&(e[j]=h=g),f=g==h||0==c||1==c||"number"!=typeof g?1==c?h:g:g+(h-g)*c;var k=!1;if(i=a._plugins[j])for(var l=0,m=i.length;m>l;l++){var n=i[l].tween(this,j,f,d,e,c,!!b&&d==e,!b);n==a.IGNORE?k=!0:f=n}k||(this._target[j]=f)}},b._runActions=function(a,b,c){var d=a,e=b,f=-1,g=this._actions.length,h=1;for(a>b&&(d=b,e=a,f=g,g=h=-1);(f+=h)!=g;){var i=this._actions[f],j=i.t;(j==e||j>d&&e>j||c&&j==a)&&i.f.apply(i.o,i.p)}},b._appendQueueProps=function(b){var c,d,e,f,g;for(var h in b)if(void 0===this._initQueueProps[h]){if(d=this._target[h],c=a._plugins[h])for(e=0,f=c.length;f>e;e++)d=c[e].init(this,h,d);this._initQueueProps[h]=this._curQueueProps[h]=void 0===d?null:d}else d=this._curQueueProps[h];for(var h in b){if(d=this._curQueueProps[h],c=a._plugins[h])for(g=g||{},e=0,f=c.length;f>e;e++)c[e].step&&c[e].step(this,h,d,b[h],g);this._curQueueProps[h]=b[h]}return g&&this._appendQueueProps(g),this._curQueueProps},b._cloneProps=function(a){var b={};for(var c in a)b[c]=a[c];return b},b._addStep=function(a){return a.d>0&&(this._steps.push(a),a.t=this.duration,this.duration+=a.d),this},b._addAction=function(a){return a.t=this.duration,this._actions.push(a),this},b._set=function(a,b){for(var c in a)b[c]=a[c]},createjs.Tween=createjs.promote(a,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function a(a,b,c){this.EventDispatcher_constructor(),this.ignoreGlobalPause=!1,this.duration=0,this.loop=!1,this.position=null,this._paused=!1,this._tweens=[],this._labels=null,this._labelList=null,this._prevPosition=0,this._prevPos=-1,this._useTicks=!1,this._registered=!1,c&&(this._useTicks=c.useTicks,this.loop=c.loop,this.ignoreGlobalPause=c.ignoreGlobalPause,c.onChange&&this.addEventListener("change",c.onChange)),a&&this.addTween.apply(this,a),this.setLabels(b),c&&c.paused?this._paused=!0:createjs.Tween._register(this,!0),c&&null!=c.position&&this.setPosition(c.position,createjs.Tween.NONE)}var b=createjs.extend(a,createjs.EventDispatcher);b.addTween=function(a){var b=arguments.length;if(b>1){for(var c=0;b>c;c++)this.addTween(arguments[c]);return arguments[0]}return 0==b?null:(this.removeTween(a),this._tweens.push(a),a.setPaused(!0),a._paused=!1,a._useTicks=this._useTicks,a.duration>this.duration&&(this.duration=a.duration),this._prevPos>=0&&a.setPosition(this._prevPos,createjs.Tween.NONE),a)},b.removeTween=function(a){var b=arguments.length;if(b>1){for(var c=!0,d=0;b>d;d++)c=c&&this.removeTween(arguments[d]);return c}if(0==b)return!1;for(var e=this._tweens,d=e.length;d--;)if(e[d]==a)return e.splice(d,1),a.duration>=this.duration&&this.updateDuration(),!0;return!1},b.addLabel=function(a,b){this._labels[a]=b;var c=this._labelList;if(c){for(var d=0,e=c.length;e>d&&!(b<c[d].position);d++);c.splice(d,0,{label:a,position:b})}},b.setLabels=function(a){this._labels=a?a:{}},b.getLabels=function(){var a=this._labelList;if(!a){a=this._labelList=[];var b=this._labels;for(var c in b)a.push({label:c,position:b[c]});a.sort(function(a,b){return a.position-b.position})}return a},b.getCurrentLabel=function(){var a=this.getLabels(),b=this.position,c=a.length;if(c){for(var d=0;c>d&&!(b<a[d].position);d++);return 0==d?null:a[d-1].label}return null},b.gotoAndPlay=function(a){this.setPaused(!1),this._goto(a)},b.gotoAndStop=function(a){this.setPaused(!0),this._goto(a)},b.setPosition=function(a,b){var c=this._calcPosition(a),d=!this.loop&&a>=this.duration;if(c==this._prevPos)return d;this._prevPosition=a,this.position=this._prevPos=c;for(var e=0,f=this._tweens.length;f>e;e++)if(this._tweens[e].setPosition(c,b),c!=this._prevPos)return!1;return d&&this.setPaused(!0),this.dispatchEvent("change"),d},b.setPaused=function(a){this._paused=!!a,createjs.Tween._register(this,!a)},b.updateDuration=function(){this.duration=0;for(var a=0,b=this._tweens.length;b>a;a++){var c=this._tweens[a];c.duration>this.duration&&(this.duration=c.duration)}},b.tick=function(a){this.setPosition(this._prevPosition+a)},b.resolve=function(a){var b=Number(a);return isNaN(b)&&(b=this._labels[a]),b},b.toString=function(){return"[Timeline]"},b.clone=function(){throw"Timeline can not be cloned."},b._goto=function(a){var b=this.resolve(a);null!=b&&this.setPosition(b)},b._calcPosition=function(a){return 0>a?0:a<this.duration?a:this.loop?a%this.duration:this.duration},createjs.Timeline=createjs.promote(a,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"Ease cannot be instantiated."}a.linear=function(a){return a},a.none=a.linear,a.get=function(a){return-1>a&&(a=-1),a>1&&(a=1),function(b){return 0==a?b:0>a?b*(b*-a+1+a):b*((2-b)*a+(1-a))}},a.getPowIn=function(a){return function(b){return Math.pow(b,a)}},a.getPowOut=function(a){return function(b){return 1-Math.pow(1-b,a)}},a.getPowInOut=function(a){return function(b){return(b*=2)<1?.5*Math.pow(b,a):1-.5*Math.abs(Math.pow(2-b,a))}},a.quadIn=a.getPowIn(2),a.quadOut=a.getPowOut(2),a.quadInOut=a.getPowInOut(2),a.cubicIn=a.getPowIn(3),a.cubicOut=a.getPowOut(3),a.cubicInOut=a.getPowInOut(3),a.quartIn=a.getPowIn(4),a.quartOut=a.getPowOut(4),a.quartInOut=a.getPowInOut(4),a.quintIn=a.getPowIn(5),a.quintOut=a.getPowOut(5),a.quintInOut=a.getPowInOut(5),a.sineIn=function(a){return 1-Math.cos(a*Math.PI/2)},a.sineOut=function(a){return Math.sin(a*Math.PI/2)},a.sineInOut=function(a){return-.5*(Math.cos(Math.PI*a)-1)},a.getBackIn=function(a){return function(b){return b*b*((a+1)*b-a)}},a.backIn=a.getBackIn(1.7),a.getBackOut=function(a){return function(b){return--b*b*((a+1)*b+a)+1}},a.backOut=a.getBackOut(1.7),a.getBackInOut=function(a){return a*=1.525,function(b){return(b*=2)<1?.5*(b*b*((a+1)*b-a)):.5*((b-=2)*b*((a+1)*b+a)+2)}},a.backInOut=a.getBackInOut(1.7),a.circIn=function(a){return-(Math.sqrt(1-a*a)-1)},a.circOut=function(a){return Math.sqrt(1- --a*a)},a.circInOut=function(a){return(a*=2)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)},a.bounceIn=function(b){return 1-a.bounceOut(1-b)},a.bounceOut=function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},a.bounceInOut=function(b){return.5>b?.5*a.bounceIn(2*b):.5*a.bounceOut(2*b-1)+.5},a.getElasticIn=function(a,b){var c=2*Math.PI;return function(d){if(0==d||1==d)return d;var e=b/c*Math.asin(1/a);return-(a*Math.pow(2,10*(d-=1))*Math.sin((d-e)*c/b))}},a.elasticIn=a.getElasticIn(1,.3),a.getElasticOut=function(a,b){var c=2*Math.PI;return function(d){if(0==d||1==d)return d;var e=b/c*Math.asin(1/a);return a*Math.pow(2,-10*d)*Math.sin((d-e)*c/b)+1}},a.elasticOut=a.getElasticOut(1,.3),a.getElasticInOut=function(a,b){var c=2*Math.PI;return function(d){var e=b/c*Math.asin(1/a);return(d*=2)<1?-.5*(a*Math.pow(2,10*(d-=1))*Math.sin((d-e)*c/b)):a*Math.pow(2,-10*(d-=1))*Math.sin((d-e)*c/b)*.5+1}},a.elasticInOut=a.getElasticInOut(1,.3*1.5),createjs.Ease=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"MotionGuidePlugin cannot be instantiated."}a.priority=0,a._rotOffS,a._rotOffE,a._rotNormS,a._rotNormE,a.install=function(){return createjs.Tween.installPlugin(a,["guide","x","y","rotation"]),createjs.Tween.IGNORE},a.init=function(a,b,c){var d=a.target;return d.hasOwnProperty("x")||(d.x=0),d.hasOwnProperty("y")||(d.y=0),d.hasOwnProperty("rotation")||(d.rotation=0),"rotation"==b&&(a.__needsRot=!0),"guide"==b?null:c},a.step=function(b,c,d,e,f){if("rotation"==c&&(b.__rotGlobalS=d,b.__rotGlobalE=e,a.testRotData(b,f)),"guide"!=c)return e;var g,h=e;h.hasOwnProperty("path")||(h.path=[]);var i=h.path;if(h.hasOwnProperty("end")||(h.end=1),h.hasOwnProperty("start")||(h.start=d&&d.hasOwnProperty("end")&&d.path===i?d.end:0),h.hasOwnProperty("_segments")&&h._length)return e;var j=i.length,k=10;if(!(j>=6&&(j-2)%4==0))throw"invalid 'path' data, please see documentation for valid paths";h._segments=[],h._length=0;for(var l=2;j>l;l+=4){for(var m,n,o=i[l-2],p=i[l-1],q=i[l+0],r=i[l+1],s=i[l+2],t=i[l+3],u=o,v=p,w=0,x=[],y=1;k>=y;y++){var z=y/k,A=1-z;m=A*A*o+2*A*z*q+z*z*s,n=A*A*p+2*A*z*r+z*z*t,w+=x[x.push(Math.sqrt((g=m-u)*g+(g=n-v)*g))-1],u=m,v=n}h._segments.push(w),h._segments.push(x),h._length+=w}g=h.orient,h.orient=!0;var B={};return a.calc(h,h.start,B),b.__rotPathS=Number(B.rotation.toFixed(5)),a.calc(h,h.end,B),b.__rotPathE=Number(B.rotation.toFixed(5)),h.orient=!1,a.calc(h,h.end,f),h.orient=g,h.orient?(b.__guideData=h,a.testRotData(b,f),e):e},a.testRotData=function(a,b){if(void 0===a.__rotGlobalS||void 0===a.__rotGlobalE){if(a.__needsRot)return;void 0!==a._curQueueProps.rotation?a.__rotGlobalS=a.__rotGlobalE=a._curQueueProps.rotation:a.__rotGlobalS=a.__rotGlobalE=b.rotation=a.target.rotation||0}if(void 0!==a.__guideData){var c=a.__guideData,d=a.__rotGlobalE-a.__rotGlobalS,e=a.__rotPathE-a.__rotPathS,f=d-e;if("auto"==c.orient)f>180?f-=360:-180>f&&(f+=360);else if("cw"==c.orient){for(;0>f;)f+=360;0==f&&d>0&&180!=d&&(f+=360)}else if("ccw"==c.orient){for(f=d-(e>180?360-e:e);f>0;)f-=360;0==f&&0>d&&-180!=d&&(f-=360)}c.rotDelta=f,c.rotOffS=a.__rotGlobalS-a.__rotPathS,a.__rotGlobalS=a.__rotGlobalE=a.__guideData=a.__needsRot=void 0}},a.tween=function(b,c,d,e,f,g,h,i){var j=f.guide;if(void 0==j||j===e.guide)return d;if(j.lastRatio!=g){var k=(j.end-j.start)*(h?j.end:g)+j.start;switch(a.calc(j,k,b.target),j.orient){case"cw":case"ccw":case"auto":b.target.rotation+=j.rotOffS+j.rotDelta*g;break;case"fixed":default:b.target.rotation+=j.rotOffS}j.lastRatio=g}return"rotation"!=c||j.orient&&"false"!=j.orient?b.target[c]:d},a.calc=function(a,b,c){if(void 0==a._segments)throw"Missing critical pre-calculated information, please file a bug";void 0==c&&(c={x:0,y:0,rotation:0});for(var d=a._segments,e=a.path,f=a._length*b,g=d.length-2,h=0;f>d[h]&&g>h;)f-=d[h],h+=2;var i=d[h+1],j=0;for(g=i.length-1;f>i[j]&&g>j;)f-=i[j],j++;var k=j/++g+f/(g*i[j]);h=2*h+2;var l=1-k;return c.x=l*l*e[h-2]+2*l*k*e[h+0]+k*k*e[h+2],c.y=l*l*e[h-1]+2*l*k*e[h+1]+k*k*e[h+3],a.orient&&(c.rotation=57.2957795*Math.atan2((e[h+1]-e[h-1])*l+(e[h+3]-e[h+1])*k,(e[h+0]-e[h-2])*l+(e[h+2]-e[h+0])*k)),c},createjs.MotionGuidePlugin=a}(),this.createjs=this.createjs||{},function(){"use strict";var a=createjs.TweenJS=createjs.TweenJS||{};a.version="0.6.2",a.buildDate="Thu, 25 Aug 2016 17:33:11 GMT"}(),function(){window.cjs=window.createjs,cjs.LoadItem.LOAD_TIMEOUT_DEFAULT=6e4,cjs.Ticker.timingMode="raf",cjs.Sound.registerPlugins([cjs.WebAudioPlugin,cjs.HTMLAudioPlugin,cjs.FlashAudioPlugin]),cjs.Sound.alternateExtensions=["mp3","ogg"],cjs.Sound.EXTENSION_MAP.mp3="mpeg"}();var b2Scale=30,b2BoundValues=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2BoundValues.prototype.__constructor=function(){this.lowerValues=new Array,this.lowerValues[0]=0,this.lowerValues[1]=0,this.upperValues=new Array,this.upperValues[0]=0,this.upperValues[1]=0},b2BoundValues.prototype.__varz=function(){},b2BoundValues.prototype.lowerValues=null,b2BoundValues.prototype.upperValues=null;var b2PairManager=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2PairManager.prototype.__constructor=function(){this.m_pairs=new Array,this.m_pairBuffer=new Array,this.m_pairCount=0,this.m_pairBufferCount=0,this.m_freePair=null},b2PairManager.prototype.__varz=function(){},b2PairManager.prototype.AddPair=function(a,b){var c=a.pairs[b];return null!=c?c:(null==this.m_freePair&&(this.m_freePair=new b2Pair,this.m_pairs.push(this.m_freePair)),c=this.m_freePair,this.m_freePair=c.next,c.proxy1=a,c.proxy2=b,c.status=0,c.userData=null,c.next=null,a.pairs[b]=c,b.pairs[a]=c,++this.m_pairCount,c)},b2PairManager.prototype.RemovePair=function(a,b){var c=a.pairs[b];if(null==c)return null;var d=c.userData;return delete a.pairs[b],delete b.pairs[a],c.next=this.m_freePair,c.proxy1=null,c.proxy2=null,c.userData=null,c.status=0,this.m_freePair=c,--this.m_pairCount,d},b2PairManager.prototype.Find=function(a,b){return a.pairs[b]},b2PairManager.prototype.ValidateBuffer=function(){},b2PairManager.prototype.ValidateTable=function(){},b2PairManager.prototype.Initialize=function(a){this.m_broadPhase=a},b2PairManager.prototype.AddBufferedPair=function(a,b){var c=this.AddPair(a,b);0==c.IsBuffered()&&(c.SetBuffered(),this.m_pairBuffer[this.m_pairBufferCount]=c,++this.m_pairBufferCount),c.ClearRemoved(),b2BroadPhase.s_validate&&this.ValidateBuffer()},b2PairManager.prototype.RemoveBufferedPair=function(a,b){var c=this.Find(a,b);null!=c&&(0==c.IsBuffered()&&(c.SetBuffered(),this.m_pairBuffer[this.m_pairBufferCount]=c,++this.m_pairBufferCount),c.SetRemoved(),b2BroadPhase.s_validate&&this.ValidateBuffer())},b2PairManager.prototype.Commit=function(a){var b=0;for(b=0;b<this.m_pairBufferCount;++b){var c=this.m_pairBuffer[b];c.ClearBuffered();var d=c.proxy1,e=c.proxy2;c.IsRemoved()||0==c.IsFinal()&&a(d.userData,e.userData)}this.m_pairBufferCount=0,b2BroadPhase.s_validate&&this.ValidateTable()},b2PairManager.prototype.m_broadPhase=null,b2PairManager.prototype.m_pairs=null,b2PairManager.prototype.m_freePair=null,b2PairManager.prototype.m_pairCount=0,b2PairManager.prototype.m_pairBuffer=null,b2PairManager.prototype.m_pairBufferCount=0;var b2TimeStep=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2TimeStep.prototype.__constructor=function(){},b2TimeStep.prototype.__varz=function(){},b2TimeStep.prototype.Set=function(a){this.dt=a.dt,this.inv_dt=a.inv_dt,this.positionIterations=a.positionIterations,this.velocityIterations=a.velocityIterations,this.warmStarting=a.warmStarting},b2TimeStep.prototype.dt=null,b2TimeStep.prototype.inv_dt=null,b2TimeStep.prototype.dtRatio=null,b2TimeStep.prototype.velocityIterations=0,b2TimeStep.prototype.positionIterations=0,b2TimeStep.prototype.warmStarting=null;var b2Controller=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Controller.prototype.__constructor=function(){},b2Controller.prototype.__varz=function(){},b2Controller.prototype.Step=function(a){},b2Controller.prototype.Draw=function(a){},b2Controller.prototype.AddBody=function(a){var b=new b2ControllerEdge;b.controller=this,b.body=a,b.nextBody=m_bodyList,b.prevBody=null,m_bodyList=b,b.nextBody&&(b.nextBody.prevBody=b),m_bodyCount++,b.nextController=a.m_controllerList,b.prevController=null,a.m_controllerList=b,b.nextController&&(b.nextController.prevController=b),a.m_controllerCount++},b2Controller.prototype.RemoveBody=function(a){for(var b=a.m_controllerList;b&&b.controller!=this;)b=b.nextController;b.prevBody&&(b.prevBody.nextBody=b.nextBody),b.nextBody&&(b.nextBody.prevBody=b.prevBody),b.nextController&&(b.nextController.prevController=b.prevController),b.prevController&&(b.prevController.nextController=b.nextController),m_bodyList==b&&(m_bodyList=b.nextBody),a.m_controllerList==b&&(a.m_controllerList=b.nextController),a.m_controllerCount--,m_bodyCount--},b2Controller.prototype.Clear=function(){for(;m_bodyList;)this.RemoveBody(m_bodyList.body)},b2Controller.prototype.GetNext=function(){return this.m_next},b2Controller.prototype.GetWorld=function(){return this.m_world},b2Controller.prototype.GetBodyList=function(){return m_bodyList},b2Controller.prototype.m_next=null,b2Controller.prototype.m_prev=null,b2Controller.prototype.m_world=null;var b2GravityController=function(){b2Controller.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2GravityController.prototype,b2Controller.prototype),b2GravityController.prototype._super=b2Controller.prototype,b2GravityController.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2GravityController.prototype.__varz=function(){},b2GravityController.prototype.Step=function(a){var b=null,c=null,d=null,e=0,f=null,g=null,h=null,i=0,j=0,k=0,l=null;if(this.invSqr)for(b=m_bodyList;b;b=b.nextBody)for(c=b.body,d=c.GetWorldCenter(),e=c.GetMass(),f=m_bodyList;f!=b;f=f.nextBody)g=f.body,h=g.GetWorldCenter(),i=h.x-d.x,j=h.y-d.y,k=i*i+j*j,k<Number.MIN_VALUE||(l=new b2Vec2(i,j),l.Multiply(this.G/k/Math.sqrt(k)*e*g.GetMass()),c.IsAwake()&&c.ApplyForce(l,d),l.Multiply(-1),g.IsAwake()&&g.ApplyForce(l,h));else for(b=m_bodyList;b;b=b.nextBody)for(c=b.body,d=c.GetWorldCenter(),e=c.GetMass(),f=m_bodyList;f!=b;f=f.nextBody)g=f.body,h=g.GetWorldCenter(),i=h.x-d.x,j=h.y-d.y,k=i*i+j*j,k<Number.MIN_VALUE||(l=new b2Vec2(i,j),l.Multiply(this.G/k*e*g.GetMass()),c.IsAwake()&&c.ApplyForce(l,d),l.Multiply(-1),g.IsAwake()&&g.ApplyForce(l,h))},b2GravityController.prototype.G=1,b2GravityController.prototype.invSqr=!0;var b2DestructionListener=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DestructionListener.prototype.__constructor=function(){},b2DestructionListener.prototype.__varz=function(){},b2DestructionListener.prototype.SayGoodbyeJoint=function(a){},b2DestructionListener.prototype.SayGoodbyeFixture=function(a){};var b2ContactEdge=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactEdge.prototype.__constructor=function(){},b2ContactEdge.prototype.__varz=function(){},b2ContactEdge.prototype.other=null,b2ContactEdge.prototype.contact=null,b2ContactEdge.prototype.prev=null,b2ContactEdge.prototype.next=null;var b2EdgeChainDef=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2EdgeChainDef.prototype.__constructor=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},b2EdgeChainDef.prototype.__varz=function(){},b2EdgeChainDef.prototype.vertices=null,b2EdgeChainDef.prototype.vertexCount=null,b2EdgeChainDef.prototype.isALoop=null;var b2Vec2=function(a,b){2==arguments.length&&(this.x=a,this.y=b)};b2Vec2.Make=function(a,b){return new b2Vec2(a,b)},b2Vec2.prototype.SetZero=function(){this.x=0,this.y=0},b2Vec2.prototype.Set=function(a,b){this.x=a,this.y=b},b2Vec2.prototype.SetV=function(a){this.x=a.x,this.y=a.y},b2Vec2.prototype.GetNegative=function(){return new b2Vec2(-this.x,-this.y)},b2Vec2.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},b2Vec2.prototype.Copy=function(){return new b2Vec2(this.x,this.y)},b2Vec2.prototype.Add=function(a){this.x+=a.x,this.y+=a.y},b2Vec2.prototype.Subtract=function(a){this.x-=a.x,this.y-=a.y},b2Vec2.prototype.Multiply=function(a){this.x*=a,this.y*=a},b2Vec2.prototype.MulM=function(a){var b=this.x;this.x=a.col1.x*b+a.col2.x*this.y,this.y=a.col1.y*b+a.col2.y*this.y},b2Vec2.prototype.MulTM=function(a){var b=b2Math.Dot(this,a.col1);this.y=b2Math.Dot(this,a.col2),this.x=b},b2Vec2.prototype.CrossVF=function(a){var b=this.x;this.x=a*this.y,this.y=-a*b},b2Vec2.prototype.CrossFV=function(a){var b=this.x;this.x=-a*this.y,this.y=a*b},b2Vec2.prototype.MinV=function(a){this.x=this.x<a.x?this.x:a.x,this.y=this.y<a.y?this.y:a.y},b2Vec2.prototype.MaxV=function(a){this.x=this.x>a.x?this.x:a.x,this.y=this.y>a.y?this.y:a.y},b2Vec2.prototype.Abs=function(){this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y)},b2Vec2.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},b2Vec2.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},b2Vec2.prototype.Normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);if(a<Number.MIN_VALUE)return 0;var b=1/a;return this.x*=b,this.y*=b,a},b2Vec2.prototype.IsValid=function(){return b2Math.IsValid(this.x)&&b2Math.IsValid(this.y)},b2Vec2.prototype.x=0,b2Vec2.prototype.y=0;var b2Vec3=function(a,b,c){3==arguments.length&&(this.x=a,this.y=b,this.z=c)};b2Vec3.prototype.SetZero=function(){this.x=this.y=this.z=0},b2Vec3.prototype.Set=function(a,b,c){this.x=a,this.y=b,this.z=c},b2Vec3.prototype.SetV=function(a){this.x=a.x,this.y=a.y,this.z=a.z},b2Vec3.prototype.GetNegative=function(){return new b2Vec3(-this.x,-this.y,-this.z)},b2Vec3.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},b2Vec3.prototype.Copy=function(){return new b2Vec3(this.x,this.y,this.z)},b2Vec3.prototype.Add=function(a){this.x+=a.x,this.y+=a.y,this.z+=a.z},b2Vec3.prototype.Subtract=function(a){this.x-=a.x,this.y-=a.y,this.z-=a.z},b2Vec3.prototype.Multiply=function(a){this.x*=a,this.y*=a,this.z*=a},b2Vec3.prototype.x=0,b2Vec3.prototype.y=0,b2Vec3.prototype.z=0;var b2DistanceProxy=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DistanceProxy.prototype.__constructor=function(){},b2DistanceProxy.prototype.__varz=function(){},b2DistanceProxy.prototype.Set=function(a){switch(a.GetType()){case b2Shape.e_circleShape:var b=a;this.m_vertices=new Array(1),this.m_vertices[0]=b.m_p,this.m_count=1,this.m_radius=b.m_radius;break;case b2Shape.e_polygonShape:var c=a;this.m_vertices=c.m_vertices,this.m_count=c.m_vertexCount,this.m_radius=c.m_radius;break;default:b2Settings.b2Assert(!1)}},b2DistanceProxy.prototype.GetSupport=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_count;++d){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return b},b2DistanceProxy.prototype.GetSupportVertex=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_count;++d){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return this.m_vertices[b]},b2DistanceProxy.prototype.GetVertexCount=function(){return this.m_count},b2DistanceProxy.prototype.GetVertex=function(a){return b2Settings.b2Assert(a>=0&&a<this.m_count),this.m_vertices[a]},b2DistanceProxy.prototype.m_vertices=null,b2DistanceProxy.prototype.m_count=0,b2DistanceProxy.prototype.m_radius=null;var b2ContactFactory=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactFactory.prototype.__constructor=function(a){this.m_allocator=a,this.InitializeRegisters()},b2ContactFactory.prototype.__varz=function(){},b2ContactFactory.prototype.AddType=function(a,b,c,d){this.m_registers[c][d].createFcn=a,this.m_registers[c][d].destroyFcn=b,this.m_registers[c][d].primary=!0,c!=d&&(this.m_registers[d][c].createFcn=a,this.m_registers[d][c].destroyFcn=b,this.m_registers[d][c].primary=!1)},b2ContactFactory.prototype.InitializeRegisters=function(){this.m_registers=new Array(b2Shape.e_shapeTypeCount);for(var a=0;a<b2Shape.e_shapeTypeCount;a++){this.m_registers[a]=new Array(b2Shape.e_shapeTypeCount);for(var b=0;b<b2Shape.e_shapeTypeCount;b++)this.m_registers[a][b]=new b2ContactRegister}this.AddType(b2CircleContact.Create,b2CircleContact.Destroy,b2Shape.e_circleShape,b2Shape.e_circleShape),this.AddType(b2PolyAndCircleContact.Create,b2PolyAndCircleContact.Destroy,b2Shape.e_polygonShape,b2Shape.e_circleShape),this.AddType(b2PolygonContact.Create,b2PolygonContact.Destroy,b2Shape.e_polygonShape,b2Shape.e_polygonShape),this.AddType(b2EdgeAndCircleContact.Create,b2EdgeAndCircleContact.Destroy,b2Shape.e_edgeShape,b2Shape.e_circleShape),this.AddType(b2PolyAndEdgeContact.Create,b2PolyAndEdgeContact.Destroy,b2Shape.e_polygonShape,b2Shape.e_edgeShape)},b2ContactFactory.prototype.Create=function(a,b){var c,d=a.GetType(),e=b.GetType(),f=this.m_registers[d][e];if(f.pool)return c=f.pool,f.pool=c.m_next,f.poolCount--,c.Reset(a,b),c;var g=f.createFcn;return null!=g?f.primary?(c=g(this.m_allocator),c.Reset(a,b),c):(c=g(this.m_allocator),c.Reset(b,a),c):null},b2ContactFactory.prototype.Destroy=function(a){a.m_manifold.m_pointCount>0&&(a.m_fixtureA.m_body.SetAwake(!0),a.m_fixtureB.m_body.SetAwake(!0));var b,c=a.m_fixtureA.GetType(),d=a.m_fixtureB.GetType(),e=this.m_registers[c][d];e.poolCount++,a.m_next=e.pool,e.pool=a,(b=e.destroyFcn)(a,this.m_allocator)},b2ContactFactory.prototype.m_registers=null,b2ContactFactory.prototype.m_allocator=null;var b2ConstantAccelController=function(){b2Controller.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2ConstantAccelController.prototype,b2Controller.prototype),b2ConstantAccelController.prototype._super=b2Controller.prototype,b2ConstantAccelController.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2ConstantAccelController.prototype.__varz=function(){this.A=new b2Vec2(0,0)},b2ConstantAccelController.prototype.Step=function(a){for(var b=new b2Vec2(this.A.x*a.dt,this.A.y*a.dt),c=m_bodyList;c;c=c.nextBody){var d=c.body;d.IsAwake()&&d.SetLinearVelocity(new b2Vec2(d.GetLinearVelocity().x+b.x,d.GetLinearVelocity().y+b.y))}},b2ConstantAccelController.prototype.A=new b2Vec2(0,0);var b2SeparationFunction=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2SeparationFunction.prototype.__constructor=function(){},b2SeparationFunction.prototype.__varz=function(){this.m_localPoint=new b2Vec2,this.m_axis=new b2Vec2},b2SeparationFunction.e_points=1,b2SeparationFunction.e_faceA=2,b2SeparationFunction.e_faceB=4,b2SeparationFunction.prototype.Initialize=function(a,b,c,d,e){this.m_proxyA=b,this.m_proxyB=d;var f=a.count;b2Settings.b2Assert(f>0&&3>f);var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;if(1==f)this.m_type=b2SeparationFunction.e_points,g=this.m_proxyA.GetVertex(a.indexA[0]),j=this.m_proxyB.GetVertex(a.indexB[0]),t=g,s=c.R,m=c.position.x+(s.col1.x*t.x+s.col2.x*t.y),n=c.position.y+(s.col1.y*t.x+s.col2.y*t.y),t=j,s=e.R,o=e.position.x+(s.col1.x*t.x+s.col2.x*t.y),p=e.position.y+(s.col1.y*t.x+s.col2.y*t.y),this.m_axis.x=o-m,this.m_axis.y=p-n,this.m_axis.Normalize();else if(a.indexB[0]==a.indexB[1])this.m_type=b2SeparationFunction.e_faceA,h=this.m_proxyA.GetVertex(a.indexA[0]),i=this.m_proxyA.GetVertex(a.indexA[1]),j=this.m_proxyB.GetVertex(a.indexB[0]),this.m_localPoint.x=.5*(h.x+i.x),this.m_localPoint.y=.5*(h.y+i.y),this.m_axis=b2Math.CrossVF(b2Math.SubtractVV(i,h),1),this.m_axis.Normalize(),t=this.m_axis,s=c.R,q=s.col1.x*t.x+s.col2.x*t.y,r=s.col1.y*t.x+s.col2.y*t.y,t=this.m_localPoint,s=c.R,m=c.position.x+(s.col1.x*t.x+s.col2.x*t.y),n=c.position.y+(s.col1.y*t.x+s.col2.y*t.y),t=j,s=e.R,o=e.position.x+(s.col1.x*t.x+s.col2.x*t.y),p=e.position.y+(s.col1.y*t.x+s.col2.y*t.y),u=(o-m)*q+(p-n)*r,0>u&&this.m_axis.NegativeSelf();else if(a.indexA[0]==a.indexA[0])this.m_type=b2SeparationFunction.e_faceB,k=this.m_proxyB.GetVertex(a.indexB[0]),l=this.m_proxyB.GetVertex(a.indexB[1]),g=this.m_proxyA.GetVertex(a.indexA[0]),this.m_localPoint.x=.5*(k.x+l.x),this.m_localPoint.y=.5*(k.y+l.y),this.m_axis=b2Math.CrossVF(b2Math.SubtractVV(l,k),1),this.m_axis.Normalize(),t=this.m_axis,s=e.R,q=s.col1.x*t.x+s.col2.x*t.y,r=s.col1.y*t.x+s.col2.y*t.y,t=this.m_localPoint,s=e.R,o=e.position.x+(s.col1.x*t.x+s.col2.x*t.y),p=e.position.y+(s.col1.y*t.x+s.col2.y*t.y),t=g,s=c.R,m=c.position.x+(s.col1.x*t.x+s.col2.x*t.y),n=c.position.y+(s.col1.y*t.x+s.col2.y*t.y),u=(m-o)*q+(n-p)*r,0>u&&this.m_axis.NegativeSelf();else{h=this.m_proxyA.GetVertex(a.indexA[0]),i=this.m_proxyA.GetVertex(a.indexA[1]),k=this.m_proxyB.GetVertex(a.indexB[0]),l=this.m_proxyB.GetVertex(a.indexB[1]);var w=(b2Math.MulX(c,g),b2Math.MulMV(c.R,b2Math.SubtractVV(i,h))),x=(b2Math.MulX(e,j),b2Math.MulMV(e.R,b2Math.SubtractVV(l,k))),y=w.x*w.x+w.y*w.y,z=x.x*x.x+x.y*x.y,A=b2Math.SubtractVV(x,w),B=w.x*A.x+w.y*A.y,C=x.x*A.x+x.y*A.y,D=w.x*x.x+w.y*x.y,E=y*z-D*D;u=0,0!=E&&(u=b2Math.Clamp((D*C-B*z)/E,0,1));var F=(D*u+C)/z;0>F&&(F=0,u=b2Math.Clamp((D-B)/y,0,1)),g=new b2Vec2,g.x=h.x+u*(i.x-h.x),g.y=h.y+u*(i.y-h.y),j=new b2Vec2,j.x=k.x+u*(l.x-k.x),j.y=k.y+u*(l.y-k.y),0==u||1==u?(this.m_type=b2SeparationFunction.e_faceB,this.m_axis=b2Math.CrossVF(b2Math.SubtractVV(l,k),1),this.m_axis.Normalize(),this.m_localPoint=j,t=this.m_axis,s=e.R,q=s.col1.x*t.x+s.col2.x*t.y,r=s.col1.y*t.x+s.col2.y*t.y,t=this.m_localPoint,s=e.R,o=e.position.x+(s.col1.x*t.x+s.col2.x*t.y),p=e.position.y+(s.col1.y*t.x+s.col2.y*t.y),t=g,s=c.R,m=c.position.x+(s.col1.x*t.x+s.col2.x*t.y),n=c.position.y+(s.col1.y*t.x+s.col2.y*t.y),v=(m-o)*q+(n-p)*r,0>u&&this.m_axis.NegativeSelf()):(this.m_type=b2SeparationFunction.e_faceA,this.m_axis=b2Math.CrossVF(b2Math.SubtractVV(i,h),1),this.m_localPoint=g,t=this.m_axis,s=c.R,q=s.col1.x*t.x+s.col2.x*t.y,r=s.col1.y*t.x+s.col2.y*t.y,t=this.m_localPoint,s=c.R,m=c.position.x+(s.col1.x*t.x+s.col2.x*t.y),n=c.position.y+(s.col1.y*t.x+s.col2.y*t.y),t=j,s=e.R,o=e.position.x+(s.col1.x*t.x+s.col2.x*t.y),p=e.position.y+(s.col1.y*t.x+s.col2.y*t.y),v=(o-m)*q+(p-n)*r,0>u&&this.m_axis.NegativeSelf())}},b2SeparationFunction.prototype.Evaluate=function(a,b){var c,d,e,f,g,h,i,j;switch(this.m_type){case b2SeparationFunction.e_points:return c=b2Math.MulTMV(a.R,this.m_axis),d=b2Math.MulTMV(b.R,this.m_axis.GetNegative()),e=this.m_proxyA.GetSupportVertex(c),f=this.m_proxyB.GetSupportVertex(d),g=b2Math.MulX(a,e),h=b2Math.MulX(b,f),i=(h.x-g.x)*this.m_axis.x+(h.y-g.y)*this.m_axis.y;case b2SeparationFunction.e_faceA:return j=b2Math.MulMV(a.R,this.m_axis),g=b2Math.MulX(a,this.m_localPoint),d=b2Math.MulTMV(b.R,j.GetNegative()),f=this.m_proxyB.GetSupportVertex(d),h=b2Math.MulX(b,f),i=(h.x-g.x)*j.x+(h.y-g.y)*j.y;case b2SeparationFunction.e_faceB:return j=b2Math.MulMV(b.R,this.m_axis),h=b2Math.MulX(b,this.m_localPoint),c=b2Math.MulTMV(a.R,j.GetNegative()),e=this.m_proxyA.GetSupportVertex(c),g=b2Math.MulX(a,e),i=(g.x-h.x)*j.x+(g.y-h.y)*j.y;default:return b2Settings.b2Assert(!1),0}},b2SeparationFunction.prototype.m_proxyA=null,b2SeparationFunction.prototype.m_proxyB=null,b2SeparationFunction.prototype.m_type=0,b2SeparationFunction.prototype.m_localPoint=new b2Vec2,b2SeparationFunction.prototype.m_axis=new b2Vec2;var b2DynamicTreePair=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DynamicTreePair.prototype.__constructor=function(){},b2DynamicTreePair.prototype.__varz=function(){},b2DynamicTreePair.prototype.proxyA=null,b2DynamicTreePair.prototype.proxyB=null;var b2ContactConstraintPoint=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactConstraintPoint.prototype.__constructor=function(){},b2ContactConstraintPoint.prototype.__varz=function(){this.localPoint=new b2Vec2,this.rA=new b2Vec2,this.rB=new b2Vec2},b2ContactConstraintPoint.prototype.localPoint=new b2Vec2,b2ContactConstraintPoint.prototype.rA=new b2Vec2,b2ContactConstraintPoint.prototype.rB=new b2Vec2,b2ContactConstraintPoint.prototype.normalImpulse=null,b2ContactConstraintPoint.prototype.tangentImpulse=null,b2ContactConstraintPoint.prototype.normalMass=null,b2ContactConstraintPoint.prototype.tangentMass=null,b2ContactConstraintPoint.prototype.equalizedMass=null,b2ContactConstraintPoint.prototype.velocityBias=null;var b2ControllerEdge=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ControllerEdge.prototype.__constructor=function(){},b2ControllerEdge.prototype.__varz=function(){},b2ControllerEdge.prototype.controller=null,
b2ControllerEdge.prototype.body=null,b2ControllerEdge.prototype.prevBody=null,b2ControllerEdge.prototype.nextBody=null,b2ControllerEdge.prototype.prevController=null,b2ControllerEdge.prototype.nextController=null;var b2DistanceInput=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DistanceInput.prototype.__constructor=function(){},b2DistanceInput.prototype.__varz=function(){},b2DistanceInput.prototype.proxyA=null,b2DistanceInput.prototype.proxyB=null,b2DistanceInput.prototype.transformA=null,b2DistanceInput.prototype.transformB=null,b2DistanceInput.prototype.useRadii=null;var b2Settings=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Settings.prototype.__constructor=function(){},b2Settings.prototype.__varz=function(){},b2Settings.b2MixFriction=function(a,b){return Math.sqrt(a*b)},b2Settings.b2MixRestitution=function(a,b){return a>b?a:b},b2Settings.b2Assert=function(a){},b2Settings.version="2.1alpha",b2Settings.USHRT_MAX=65535,b2Settings.b2_pi=Math.PI,b2Settings.b2_maxManifoldPoints=2,b2Settings.b2_aabbExtension=.1,b2Settings.b2_aabbMultiplier=2,b2Settings.b2_polygonRadius=2*b2Settings.b2_linearSlop,b2Settings.b2_linearSlop=.005,b2Settings.b2_angularSlop=2/180*b2Settings.b2_pi,b2Settings.b2_toiSlop=8*b2Settings.b2_linearSlop,b2Settings.b2_maxTOIContactsPerIsland=32,b2Settings.b2_maxTOIJointsPerIsland=32,b2Settings.b2_velocityThreshold=1,b2Settings.b2_maxLinearCorrection=.2,b2Settings.b2_maxAngularCorrection=8/180*b2Settings.b2_pi,b2Settings.b2_maxTranslation=2,b2Settings.b2_maxTranslationSquared=b2Settings.b2_maxTranslation*b2Settings.b2_maxTranslation,b2Settings.b2_maxRotation=.5*b2Settings.b2_pi,b2Settings.b2_maxRotationSquared=b2Settings.b2_maxRotation*b2Settings.b2_maxRotation,b2Settings.b2_contactBaumgarte=.2,b2Settings.b2_timeToSleep=.5,b2Settings.b2_linearSleepTolerance=.01,b2Settings.b2_angularSleepTolerance=2/180*b2Settings.b2_pi;var b2Proxy=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Proxy.prototype.__constructor=function(){},b2Proxy.prototype.__varz=function(){this.lowerBounds=new Array(2),this.upperBounds=new Array(2),this.pairs=new Object},b2Proxy.prototype.IsValid=function(){return this.overlapCount!=b2BroadPhase.b2_invalid},b2Proxy.prototype.lowerBounds=new Array(2),b2Proxy.prototype.upperBounds=new Array(2),b2Proxy.prototype.overlapCount=0,b2Proxy.prototype.timeStamp=0,b2Proxy.prototype.pairs=new Object,b2Proxy.prototype.next=null,b2Proxy.prototype.userData=null;var b2Point=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Point.prototype.__constructor=function(){},b2Point.prototype.__varz=function(){this.p=new b2Vec2},b2Point.prototype.Support=function(a,b,c){return this.p},b2Point.prototype.GetFirstVertex=function(a){return this.p},b2Point.prototype.p=new b2Vec2;var b2WorldManifold=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2WorldManifold.prototype.__constructor=function(){this.m_points=new Array(b2Settings.b2_maxManifoldPoints);for(var a=0;a<b2Settings.b2_maxManifoldPoints;a++)this.m_points[a]=new b2Vec2},b2WorldManifold.prototype.__varz=function(){this.m_normal=new b2Vec2},b2WorldManifold.prototype.Initialize=function(a,b,c,d,e){if(0!=a.m_pointCount){var f,g,h,i,j,k,l,m,n=0;switch(a.m_type){case b2Manifold.e_circles:g=b.R,f=a.m_localPoint;var o=b.position.x+g.col1.x*f.x+g.col2.x*f.y,p=b.position.y+g.col1.y*f.x+g.col2.y*f.y;g=d.R,f=a.m_points[0].m_localPoint;var q=d.position.x+g.col1.x*f.x+g.col2.x*f.y,r=d.position.y+g.col1.y*f.x+g.col2.y*f.y,s=q-o,t=r-p,u=s*s+t*t;if(u>Number.MIN_VALUE*Number.MIN_VALUE){var v=Math.sqrt(u);this.m_normal.x=s/v,this.m_normal.y=t/v}else this.m_normal.x=1,this.m_normal.y=0;var w=o+c*this.m_normal.x,x=p+c*this.m_normal.y,y=q-e*this.m_normal.x,z=r-e*this.m_normal.y;this.m_points[0].x=.5*(w+y),this.m_points[0].y=.5*(x+z);break;case b2Manifold.e_faceA:for(g=b.R,f=a.m_localPlaneNormal,h=g.col1.x*f.x+g.col2.x*f.y,i=g.col1.y*f.x+g.col2.y*f.y,g=b.R,f=a.m_localPoint,j=b.position.x+g.col1.x*f.x+g.col2.x*f.y,k=b.position.y+g.col1.y*f.x+g.col2.y*f.y,this.m_normal.x=h,this.m_normal.y=i,n=0;n<a.m_pointCount;n++)g=d.R,f=a.m_points[n].m_localPoint,l=d.position.x+g.col1.x*f.x+g.col2.x*f.y,m=d.position.y+g.col1.y*f.x+g.col2.y*f.y,this.m_points[n].x=l+.5*(c-(l-j)*h-(m-k)*i-e)*h,this.m_points[n].y=m+.5*(c-(l-j)*h-(m-k)*i-e)*i;break;case b2Manifold.e_faceB:for(g=d.R,f=a.m_localPlaneNormal,h=g.col1.x*f.x+g.col2.x*f.y,i=g.col1.y*f.x+g.col2.y*f.y,g=d.R,f=a.m_localPoint,j=d.position.x+g.col1.x*f.x+g.col2.x*f.y,k=d.position.y+g.col1.y*f.x+g.col2.y*f.y,this.m_normal.x=-h,this.m_normal.y=-i,n=0;n<a.m_pointCount;n++)g=b.R,f=a.m_points[n].m_localPoint,l=b.position.x+g.col1.x*f.x+g.col2.x*f.y,m=b.position.y+g.col1.y*f.x+g.col2.y*f.y,this.m_points[n].x=l+.5*(e-(l-j)*h-(m-k)*i-c)*h,this.m_points[n].y=m+.5*(e-(l-j)*h-(m-k)*i-c)*i}}},b2WorldManifold.prototype.m_normal=new b2Vec2,b2WorldManifold.prototype.m_points=null;var b2RayCastOutput=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2RayCastOutput.prototype.__constructor=function(){},b2RayCastOutput.prototype.__varz=function(){this.normal=new b2Vec2},b2RayCastOutput.prototype.normal=new b2Vec2,b2RayCastOutput.prototype.fraction=null;var b2ConstantForceController=function(){b2Controller.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2ConstantForceController.prototype,b2Controller.prototype),b2ConstantForceController.prototype._super=b2Controller.prototype,b2ConstantForceController.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2ConstantForceController.prototype.__varz=function(){this.F=new b2Vec2(0,0)},b2ConstantForceController.prototype.Step=function(a){for(var b=m_bodyList;b;b=b.nextBody){var c=b.body;c.IsAwake()&&c.ApplyForce(this.F,c.GetWorldCenter())}},b2ConstantForceController.prototype.F=new b2Vec2(0,0);var b2MassData=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2MassData.prototype.__constructor=function(){},b2MassData.prototype.__varz=function(){this.center=new b2Vec2(0,0)},b2MassData.prototype.mass=0,b2MassData.prototype.center=new b2Vec2(0,0),b2MassData.prototype.I=0;var b2DynamicTree=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DynamicTree.prototype.__constructor=function(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0},b2DynamicTree.prototype.__varz=function(){},b2DynamicTree.prototype.AllocateNode=function(){if(this.m_freeList){var a=this.m_freeList;return this.m_freeList=a.parent,a.parent=null,a.child1=null,a.child2=null,a}return new b2DynamicTreeNode},b2DynamicTree.prototype.FreeNode=function(a){a.parent=this.m_freeList,this.m_freeList=a},b2DynamicTree.prototype.InsertLeaf=function(a){if(++this.m_insertionCount,null==this.m_root)return this.m_root=a,void(this.m_root.parent=null);var b,c,d,e,f,g,h=a.aabb.GetCenter(),i=this.m_root;if(0==i.IsLeaf())do b=i.child1,c=i.child2,d=Math.abs((b.aabb.lowerBound.x+b.aabb.upperBound.x)/2-h.x)+Math.abs((b.aabb.lowerBound.y+b.aabb.upperBound.y)/2-h.y),e=Math.abs((c.aabb.lowerBound.x+c.aabb.upperBound.x)/2-h.x)+Math.abs((c.aabb.lowerBound.y+c.aabb.upperBound.y)/2-h.y),i=e>d?b:c;while(0==i.IsLeaf());if(f=i.parent,g=this.AllocateNode(),g.parent=f,g.userData=null,g.aabb.Combine(a.aabb,i.aabb),f){i.parent.child1==i?f.child1=g:f.child2=g,g.child1=i,g.child2=a,i.parent=g,a.parent=g;do{if(f.aabb.Contains(g.aabb))break;f.aabb.Combine(f.child1.aabb,f.child2.aabb),g=f,f=f.parent}while(f)}else g.child1=i,g.child2=a,i.parent=g,a.parent=g,this.m_root=g},b2DynamicTree.prototype.RemoveLeaf=function(a){if(a==this.m_root)return void(this.m_root=null);var b,c,d=a.parent,e=d.parent;if(b=d.child1==a?d.child2:d.child1,e)for(e.child1==d?e.child1=b:e.child2=b,b.parent=e,this.FreeNode(d);e&&(c=e.aabb,e.aabb=b2AABB.Combine(e.child1.aabb,e.child2.aabb),!c.Contains(e.aabb));)e=e.parent;else this.m_root=b,b.parent=null,this.FreeNode(d)},b2DynamicTree.prototype.CreateProxy=function(a,b){var c=this.AllocateNode(),d=b2Settings.b2_aabbExtension,e=b2Settings.b2_aabbExtension;return c.aabb.lowerBound.x=a.lowerBound.x-d,c.aabb.lowerBound.y=a.lowerBound.y-e,c.aabb.upperBound.x=a.upperBound.x+d,c.aabb.upperBound.y=a.upperBound.y+e,c.userData=b,this.InsertLeaf(c),c},b2DynamicTree.prototype.DestroyProxy=function(a){this.RemoveLeaf(a),this.FreeNode(a)},b2DynamicTree.prototype.MoveProxy=function(a,b,c){if(b2Settings.b2Assert(a.IsLeaf()),a.aabb.Contains(b))return!1;this.RemoveLeaf(a);var d=b2Settings.b2_aabbExtension+b2Settings.b2_aabbMultiplier*(c.x>0?c.x:-c.x),e=b2Settings.b2_aabbExtension+b2Settings.b2_aabbMultiplier*(c.y>0?c.y:-c.y);return a.aabb.lowerBound.x=b.lowerBound.x-d,a.aabb.lowerBound.y=b.lowerBound.y-e,a.aabb.upperBound.x=b.upperBound.x+d,a.aabb.upperBound.y=b.upperBound.y+e,this.InsertLeaf(a),!0},b2DynamicTree.prototype.Rebalance=function(a){if(null!=this.m_root)for(var b=0;a>b;b++){for(var c=this.m_root,d=0;0==c.IsLeaf();)c=this.m_path>>d&1?c.child2:c.child1,d=d+1&31;++this.m_path,this.RemoveLeaf(c),this.InsertLeaf(c)}},b2DynamicTree.prototype.GetFatAABB=function(a){return a.aabb},b2DynamicTree.prototype.GetUserData=function(a){return a.userData},b2DynamicTree.prototype.Query=function(a,b){if(null!=this.m_root){var c=new Array,d=0;for(c[d++]=this.m_root;d>0;){var e=c[--d];if(e.aabb.TestOverlap(b))if(e.IsLeaf()){var f=a(e);if(!f)return}else c[d++]=e.child1,c[d++]=e.child2}}},b2DynamicTree.prototype.RayCast=function(a,b){if(null!=this.m_root){var c=b.p1,d=b.p2,e=b2Math.SubtractVV(c,d);e.Normalize();var f,g,h=b2Math.CrossFV(1,e),i=b2Math.AbsV(h),j=b.maxFraction,k=new b2AABB;f=c.x+j*(d.x-c.x),g=c.y+j*(d.y-c.y),k.lowerBound.x=Math.min(c.x,f),k.lowerBound.y=Math.min(c.y,g),k.upperBound.x=Math.max(c.x,f),k.upperBound.y=Math.max(c.y,g);var l,m,n,o,p,q=new Array,r=0;for(q[r++]=this.m_root;r>0;)if(l=q[--r],0!=l.aabb.TestOverlap(k)&&(m=l.aabb.GetCenter(),n=l.aabb.GetExtents(),o=Math.abs(h.x*(c.x-m.x)+h.y*(c.y-m.y))-i.x*n.x-i.y*n.y,!(o>0)))if(l.IsLeaf()){if(p=new b2RayCastInput,p.p1=b.p1,p.p2=b.p2,p.maxFraction=b.maxFraction,j=a(p,l),0==j)return;f=c.x+j*(d.x-c.x),g=c.y+j*(d.y-c.y),k.lowerBound.x=Math.min(c.x,f),k.lowerBound.y=Math.min(c.y,g),k.upperBound.x=Math.max(c.x,f),k.upperBound.y=Math.max(c.y,g)}else q[r++]=l.child1,q[r++]=l.child2}},b2DynamicTree.prototype.m_root=null,b2DynamicTree.prototype.m_freeList=null,b2DynamicTree.prototype.m_path=0,b2DynamicTree.prototype.m_insertionCount=0;var b2JointEdge=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2JointEdge.prototype.__constructor=function(){},b2JointEdge.prototype.__varz=function(){},b2JointEdge.prototype.other=null,b2JointEdge.prototype.joint=null,b2JointEdge.prototype.prev=null,b2JointEdge.prototype.next=null;var b2RayCastInput=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2RayCastInput.prototype.__constructor=function(a,b,c){a&&this.p1.SetV(a),b&&this.p2.SetV(b),c&&(this.maxFraction=c)},b2RayCastInput.prototype.__varz=function(){this.p1=new b2Vec2,this.p2=new b2Vec2},b2RayCastInput.prototype.p1=new b2Vec2,b2RayCastInput.prototype.p2=new b2Vec2,b2RayCastInput.prototype.maxFraction=1;var Features=function(){this.__varz(),this.__constructor.apply(this,arguments)};Features.prototype.__constructor=function(){},Features.prototype.__varz=function(){},Features.prototype.__defineGetter__("referenceEdge",function(){return this._referenceEdge}),Features.prototype.__defineSetter__("referenceEdge",function(a){this._referenceEdge=a,this._m_id._key=4294967040&this._m_id._key|255&this._referenceEdge}),Features.prototype.__defineGetter__("incidentEdge",function(){return this._incidentEdge}),Features.prototype.__defineSetter__("incidentEdge",function(a){this._incidentEdge=a,this._m_id._key=4294902015&this._m_id._key|this._incidentEdge<<8&65280}),Features.prototype.__defineGetter__("incidentVertex",function(){return this._incidentVertex}),Features.prototype.__defineSetter__("incidentVertex",function(a){this._incidentVertex=a,this._m_id._key=4278255615&this._m_id._key|this._incidentVertex<<16&16711680}),Features.prototype.__defineGetter__("flip",function(){return this._flip}),Features.prototype.__defineSetter__("flip",function(a){this._flip=a,this._m_id._key=16777215&this._m_id._key|this._flip<<24&4278190080}),Features.prototype._referenceEdge=0,Features.prototype._incidentEdge=0,Features.prototype._incidentVertex=0,Features.prototype._flip=0,Features.prototype._m_id=null;var b2FilterData=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2FilterData.prototype.__constructor=function(){},b2FilterData.prototype.__varz=function(){this.categoryBits=1,this.maskBits=65535},b2FilterData.prototype.Copy=function(){var a=new b2FilterData;return a.categoryBits=this.categoryBits,a.maskBits=this.maskBits,a.groupIndex=this.groupIndex,a},b2FilterData.prototype.categoryBits=1,b2FilterData.prototype.maskBits=65535,b2FilterData.prototype.groupIndex=0;var b2AABB=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2AABB.prototype.__constructor=function(){},b2AABB.prototype.__varz=function(){this.lowerBound=new b2Vec2,this.upperBound=new b2Vec2,this.centerV2=new b2Vec2,this.extentsV2=new b2Vec2},b2AABB.prototype.Reset=function(){this.lowerBound.SetZero(),this.upperBound.SetZero(),this.centerV2.SetZero(),this.extentsV2.SetZero()},b2AABB.Combine=function(a,b){var c=new b2AABB;return c.Combine(a,b),c},b2AABB.prototype.IsValid=function(){var a=this.upperBound.x-this.lowerBound.x,b=this.upperBound.y-this.lowerBound.y,c=a>=0&&b>=0;return c=c&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},b2AABB.prototype.GetCenter=function(){return this.centerV2.x=.5*(this.lowerBound.x+this.upperBound.x),this.centerV2.y=.5*(this.lowerBound.y+this.upperBound.y),this.centerV2},b2AABB.prototype.GetExtents=function(){return this.extentsV2.x=.5*(this.upperBound.x-this.lowerBound.x),this.extentsV2.y=.5*(this.upperBound.y-this.lowerBound.y),this.extentsV2},b2AABB.prototype.Contains=function(a){var b=this.lowerBound.x<=a.lowerBound.x&&this.lowerBound.y<=a.lowerBound.y&&a.upperBound.x<=this.upperBound.x&&a.upperBound.y<=this.upperBound.y;return b},b2AABB.prototype.RayCast=function(a,b){var c,d,e,f,g,h=-Number.MAX_VALUE,i=Number.MAX_VALUE,j=b.p1.x,k=b.p1.y,l=b.p2.x-b.p1.x,m=b.p2.y-b.p1.y,n=Math.abs(l),o=Math.abs(m),p=a.normal;if(n<Number.MIN_VALUE){if(j<this.lowerBound.x||this.upperBound.x<j)return!1}else if(c=1/l,d=(this.lowerBound.x-j)*c,e=(this.upperBound.x-j)*c,g=-1,d>e&&(f=d,d=e,e=f,g=1),d>h&&(p.x=g,p.y=0,h=d),i=Math.min(i,e),h>i)return!1;if(o<Number.MIN_VALUE){if(k<this.lowerBound.y||this.upperBound.y<k)return!1}else if(c=1/m,d=(this.lowerBound.y-k)*c,e=(this.upperBound.y-k)*c,g=-1,d>e&&(f=d,d=e,e=f,g=1),d>h&&(p.y=g,p.x=0,h=d),i=Math.min(i,e),h>i)return!1;return a.fraction=h,!0},b2AABB.prototype.TestOverlap=function(a){var b=a.lowerBound.x-this.upperBound.x,c=a.lowerBound.y-this.upperBound.y,d=this.lowerBound.x-a.upperBound.x,e=this.lowerBound.y-a.upperBound.y;return b>0||c>0?!1:d>0||e>0?!1:!0},b2AABB.prototype.Combine=function(a,b){this.lowerBound.x=Math.min(a.lowerBound.x,b.lowerBound.x),this.lowerBound.y=Math.min(a.lowerBound.y,b.lowerBound.y),this.upperBound.x=Math.max(a.upperBound.x,b.upperBound.x),this.upperBound.y=Math.max(a.upperBound.y,b.upperBound.y)},b2AABB.prototype.lowerBound=new b2Vec2,b2AABB.prototype.upperBound=new b2Vec2;var b2Jacobian=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Jacobian.prototype.__constructor=function(){},b2Jacobian.prototype.__varz=function(){this.linearA=new b2Vec2,this.linearB=new b2Vec2},b2Jacobian.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},b2Jacobian.prototype.Set=function(a,b,c,d){this.linearA.SetV(a),this.angularA=b,this.linearB.SetV(c),this.angularB=d},b2Jacobian.prototype.Compute=function(a,b,c,d){return this.linearA.x*a.x+this.linearA.y*a.y+this.angularA*b+(this.linearB.x*c.x+this.linearB.y*c.y)+this.angularB*d},b2Jacobian.prototype.linearA=new b2Vec2,b2Jacobian.prototype.angularA=null,b2Jacobian.prototype.linearB=new b2Vec2,b2Jacobian.prototype.angularB=null;var b2Bound=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Bound.prototype.__constructor=function(){},b2Bound.prototype.__varz=function(){},b2Bound.prototype.IsLower=function(){return 0==(1&this.value)},b2Bound.prototype.IsUpper=function(){return 1==(1&this.value)},b2Bound.prototype.Swap=function(a){var b=this.value,c=this.proxy,d=this.stabbingCount;this.value=a.value,this.proxy=a.proxy,this.stabbingCount=a.stabbingCount,a.value=b,a.proxy=c,a.stabbingCount=d},b2Bound.prototype.value=0,b2Bound.prototype.proxy=null,b2Bound.prototype.stabbingCount=0;var b2SimplexVertex=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2SimplexVertex.prototype.__constructor=function(){},b2SimplexVertex.prototype.__varz=function(){},b2SimplexVertex.prototype.Set=function(a){this.wA.SetV(a.wA),this.wB.SetV(a.wB),this.w.SetV(a.w),this.a=a.a,this.indexA=a.indexA,this.indexB=a.indexB},b2SimplexVertex.prototype.wA=null,b2SimplexVertex.prototype.wB=null,b2SimplexVertex.prototype.w=null,b2SimplexVertex.prototype.a=null,b2SimplexVertex.prototype.indexA=0,b2SimplexVertex.prototype.indexB=0;var b2Mat22=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Mat22.prototype.__constructor=function(){this.col1.x=this.col2.y=1},b2Mat22.prototype.__varz=function(){this.col1=new b2Vec2,this.col2=new b2Vec2},b2Mat22.FromAngle=function(a){var b=new b2Mat22;return b.Set(a),b},b2Mat22.FromVV=function(a,b){var c=new b2Mat22;return c.SetVV(a,b),c},b2Mat22.prototype.Set=function(a){var b=Math.cos(a),c=Math.sin(a);this.col1.x=b,this.col2.x=-c,this.col1.y=c,this.col2.y=b},b2Mat22.prototype.SetVV=function(a,b){this.col1.SetV(a),this.col2.SetV(b)},b2Mat22.prototype.Copy=function(){var a=new b2Mat22;return a.SetM(this),a},b2Mat22.prototype.SetM=function(a){this.col1.SetV(a.col1),this.col2.SetV(a.col2)},b2Mat22.prototype.AddM=function(a){this.col1.x+=a.col1.x,this.col1.y+=a.col1.y,this.col2.x+=a.col2.x,this.col2.y+=a.col2.y},b2Mat22.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},b2Mat22.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},b2Mat22.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},b2Mat22.prototype.GetInverse=function(a){var b=this.col1.x,c=this.col2.x,d=this.col1.y,e=this.col2.y,f=b*e-c*d;return 0!=f&&(f=1/f),a.col1.x=f*e,a.col2.x=-f*c,a.col1.y=-f*d,a.col2.y=f*b,a},b2Mat22.prototype.Solve=function(a,b,c){var d=this.col1.x,e=this.col2.x,f=this.col1.y,g=this.col2.y,h=d*g-e*f;return 0!=h&&(h=1/h),a.x=h*(g*b-e*c),a.y=h*(d*c-f*b),a},b2Mat22.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},b2Mat22.prototype.col1=new b2Vec2,b2Mat22.prototype.col2=new b2Vec2;var b2SimplexCache=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2SimplexCache.prototype.__constructor=function(){},b2SimplexCache.prototype.__varz=function(){this.indexA=new Array(3),this.indexB=new Array(3)},b2SimplexCache.prototype.metric=null,b2SimplexCache.prototype.count=0,b2SimplexCache.prototype.indexA=new Array(3),b2SimplexCache.prototype.indexB=new Array(3);var b2Shape=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Shape.prototype.__constructor=function(){this.m_type=b2Shape.e_unknownShape,this.m_radius=b2Settings.b2_linearSlop},b2Shape.prototype.__varz=function(){},b2Shape.TestOverlap=function(a,b,c,d){var e=new b2DistanceInput;e.proxyA=new b2DistanceProxy,e.proxyA.Set(a),e.proxyB=new b2DistanceProxy,e.proxyB.Set(c),e.transformA=b,e.transformB=d,e.useRadii=!0;var f=new b2SimplexCache;f.count=0;var g=new b2DistanceOutput;return b2Distance.Distance(g,f,e),g.distance<10*Number.MIN_VALUE},b2Shape.e_hitCollide=1,b2Shape.e_missCollide=0,b2Shape.e_startsInsideCollide=-1,b2Shape.e_unknownShape=-1,b2Shape.e_circleShape=0,b2Shape.e_polygonShape=1,b2Shape.e_edgeShape=2,b2Shape.e_shapeTypeCount=3,b2Shape.prototype.Copy=function(){return null},b2Shape.prototype.Set=function(a){this.m_radius=a.m_radius},b2Shape.prototype.GetType=function(){return this.m_type},b2Shape.prototype.TestPoint=function(a,b){return!1},b2Shape.prototype.RayCast=function(a,b,c){return!1},b2Shape.prototype.ComputeAABB=function(a,b){},b2Shape.prototype.ComputeMass=function(a,b){},b2Shape.prototype.ComputeSubmergedArea=function(a,b,c,d){return 0},b2Shape.prototype.m_type=0,b2Shape.prototype.m_radius=null;var b2Segment=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Segment.prototype.__constructor=function(){},b2Segment.prototype.__varz=function(){this.p1=new b2Vec2,this.p2=new b2Vec2},b2Segment.prototype.TestSegment=function(a,b,c,d){var e=c.p1,f=c.p2.x-e.x,g=c.p2.y-e.y,h=this.p2.x-this.p1.x,i=this.p2.y-this.p1.y,j=i,k=-h,l=100*Number.MIN_VALUE,m=-(f*j+g*k);if(m>l){var n=e.x-this.p1.x,o=e.y-this.p1.y,p=n*j+o*k;if(p>=0&&d*m>=p){var q=-f*o+g*n;if(q>=-l*m&&m*(1+l)>=q){p/=m;var r=Math.sqrt(j*j+k*k);return j/=r,k/=r,a[0]=p,b.Set(j,k),!0}}}return!1},b2Segment.prototype.Extend=function(a){this.ExtendForward(a),this.ExtendBackward(a)},b2Segment.prototype.ExtendForward=function(a){var b=this.p2.x-this.p1.x,c=this.p2.y-this.p1.y,d=Math.min(b>0?(a.upperBound.x-this.p1.x)/b:0>b?(a.lowerBound.x-this.p1.x)/b:Number.POSITIVE_INFINITY,c>0?(a.upperBound.y-this.p1.y)/c:0>c?(a.lowerBound.y-this.p1.y)/c:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+b*d,this.p2.y=this.p1.y+c*d},b2Segment.prototype.ExtendBackward=function(a){var b=-this.p2.x+this.p1.x,c=-this.p2.y+this.p1.y,d=Math.min(b>0?(a.upperBound.x-this.p2.x)/b:0>b?(a.lowerBound.x-this.p2.x)/b:Number.POSITIVE_INFINITY,c>0?(a.upperBound.y-this.p2.y)/c:0>c?(a.lowerBound.y-this.p2.y)/c:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+b*d,this.p1.y=this.p2.y+c*d},b2Segment.prototype.p1=new b2Vec2,b2Segment.prototype.p2=new b2Vec2;var b2ContactRegister=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactRegister.prototype.__constructor=function(){},b2ContactRegister.prototype.__varz=function(){},b2ContactRegister.prototype.createFcn=null,b2ContactRegister.prototype.destroyFcn=null,b2ContactRegister.prototype.primary=null,b2ContactRegister.prototype.pool=null,b2ContactRegister.prototype.poolCount=0;var b2DebugDraw=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DebugDraw.prototype.__constructor=function(){this.m_drawFlags=0},b2DebugDraw.prototype.__varz=function(){},b2DebugDraw.e_shapeBit=1,b2DebugDraw.e_jointBit=2,b2DebugDraw.e_aabbBit=4,b2DebugDraw.e_pairBit=8,b2DebugDraw.e_centerOfMassBit=16,b2DebugDraw.e_controllerBit=32,b2DebugDraw.prototype.SetFlags=function(a){this.m_drawFlags=a},b2DebugDraw.prototype.GetFlags=function(){return this.m_drawFlags},b2DebugDraw.prototype.AppendFlags=function(a){this.m_drawFlags|=a},b2DebugDraw.prototype.ClearFlags=function(a){this.m_drawFlags&=~a},b2DebugDraw.prototype.SetSprite=function(a){this.m_sprite=a},b2DebugDraw.prototype.GetSprite=function(){return this.m_sprite},b2DebugDraw.prototype.SetDrawScale=function(a){this.m_drawScale=a},b2DebugDraw.prototype.GetDrawScale=function(){return this.m_drawScale},b2DebugDraw.prototype.SetLineThickness=function(a){this.m_lineThickness=a},b2DebugDraw.prototype.GetLineThickness=function(){return this.m_lineThickness},b2DebugDraw.prototype.SetAlpha=function(a){this.m_alpha=a},b2DebugDraw.prototype.GetAlpha=function(){return this.m_alpha},b2DebugDraw.prototype.SetFillAlpha=function(a){this.m_fillAlpha=a},b2DebugDraw.prototype.GetFillAlpha=function(){return this.m_fillAlpha},b2DebugDraw.prototype.SetXFormScale=function(a){this.m_xformScale=a},b2DebugDraw.prototype.GetXFormScale=function(){return this.m_xformScale},b2DebugDraw.prototype.Clear=function(){this.m_sprite.clearRect(0,0,this.m_sprite.canvas.width,this.m_sprite.canvas.height)},b2DebugDraw.prototype.Y=function(a){return a},b2DebugDraw.prototype.ToWorldPoint=function(a){return new b2Vec2(a.x/this.m_drawScale,this.Y(a.y)/this.m_drawScale)},b2DebugDraw.prototype.ColorStyle=function(a,b){return"rgba("+a.r+", "+a.g+", "+a.b+", "+b+")"},b2DebugDraw.prototype.DrawPolygon=function(a,b,c){this.m_sprite.graphics.lineStyle(this.m_lineThickness,c.color,this.m_alpha),this.m_sprite.graphics.moveTo(a[0].x*this.m_drawScale,a[0].y*this.m_drawScale);for(var d=1;b>d;d++)this.m_sprite.graphics.lineTo(a[d].x*this.m_drawScale,a[d].y*this.m_drawScale);this.m_sprite.graphics.lineTo(a[0].x*this.m_drawScale,a[0].y*this.m_drawScale)},b2DebugDraw.prototype.DrawSolidPolygon=function(a,b,c){this.m_sprite.strokeSyle=this.ColorStyle(c,this.m_alpha),this.m_sprite.lineWidth=this.m_lineThickness,this.m_sprite.fillStyle=this.ColorStyle(c,this.m_fillAlpha),this.m_sprite.beginPath(),this.m_sprite.moveTo(a[0].x*this.m_drawScale,this.Y(a[0].y*this.m_drawScale));for(var d=1;b>d;d++)this.m_sprite.lineTo(a[d].x*this.m_drawScale,this.Y(a[d].y*this.m_drawScale));this.m_sprite.lineTo(a[0].x*this.m_drawScale,this.Y(a[0].y*this.m_drawScale)),this.m_sprite.fill(),this.m_sprite.stroke(),this.m_sprite.closePath()},b2DebugDraw.prototype.DrawCircle=function(a,b,c){this.m_sprite.graphics.lineStyle(this.m_lineThickness,c.color,this.m_alpha),this.m_sprite.graphics.drawCircle(a.x*this.m_drawScale,a.y*this.m_drawScale,b*this.m_drawScale)},b2DebugDraw.prototype.DrawSolidCircle=function(a,b,c,d){this.m_sprite.strokeSyle=this.ColorStyle(d,this.m_alpha),this.m_sprite.lineWidth=this.m_lineThickness,this.m_sprite.fillStyle=this.ColorStyle(d,this.m_fillAlpha),this.m_sprite.beginPath(),this.m_sprite.arc(a.x*this.m_drawScale,this.Y(a.y*this.m_drawScale),b*this.m_drawScale,0,2*Math.PI,!0),this.m_sprite.fill(),this.m_sprite.stroke(),this.m_sprite.closePath()},b2DebugDraw.prototype.DrawSegment=function(a,b,c){this.m_sprite.lineWidth=this.m_lineThickness,this.m_sprite.strokeSyle=this.ColorStyle(c,this.m_alpha),this.m_sprite.beginPath(),this.m_sprite.moveTo(a.x*this.m_drawScale,this.Y(a.y*this.m_drawScale)),this.m_sprite.lineTo(b.x*this.m_drawScale,this.Y(b.y*this.m_drawScale)),this.m_sprite.stroke(),this.m_sprite.closePath()},b2DebugDraw.prototype.DrawTransform=function(a){this.m_sprite.lineWidth=this.m_lineThickness,this.m_sprite.strokeSyle=this.ColorStyle(new b2Color(255,0,0),this.m_alpha),this.m_sprite.beginPath(),this.m_sprite.moveTo(a.position.x*this.m_drawScale,this.Y(a.position.y*this.m_drawScale)),this.m_sprite.lineTo((a.position.x+this.m_xformScale*a.R.col1.x)*this.m_drawScale,this.Y((a.position.y+this.m_xformScale*a.R.col1.y)*this.m_drawScale)),this.m_sprite.stroke(),this.m_sprite.closePath(),this.m_sprite.strokeSyle=this.ColorStyle(new b2Color(0,255,0),this.m_alpha),this.m_sprite.beginPath(),this.m_sprite.moveTo(a.position.x*this.m_drawScale,this.Y(a.position.y*this.m_drawScale)),this.m_sprite.lineTo((a.position.x+this.m_xformScale*a.R.col2.x)*this.m_drawScale,this.Y((a.position.y+this.m_xformScale*a.R.col2.y)*this.m_drawScale)),this.m_sprite.stroke(),this.m_sprite.closePath()},b2DebugDraw.prototype.m_drawFlags=0,b2DebugDraw.prototype.m_sprite=null,b2DebugDraw.prototype.m_drawScale=1,b2DebugDraw.prototype.m_lineThickness=1,b2DebugDraw.prototype.m_alpha=1,b2DebugDraw.prototype.m_fillAlpha=1,b2DebugDraw.prototype.m_xformScale=1;var b2Sweep=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Sweep.prototype.__constructor=function(){},b2Sweep.prototype.__varz=function(){this.localCenter=new b2Vec2,this.c0=new b2Vec2,this.c=new b2Vec2},b2Sweep.prototype.Set=function(a){this.localCenter.SetV(a.localCenter),this.c0.SetV(a.c0),this.c.SetV(a.c),this.a0=a.a0,this.a=a.a,this.t0=a.t0},b2Sweep.prototype.Copy=function(){var a=new b2Sweep;return a.localCenter.SetV(this.localCenter),a.c0.SetV(this.c0),a.c.SetV(this.c),a.a0=this.a0,a.a=this.a,a.t0=this.t0,a},b2Sweep.prototype.GetTransform=function(a,b){a.position.x=(1-b)*this.c0.x+b*this.c.x,a.position.y=(1-b)*this.c0.y+b*this.c.y;var c=(1-b)*this.a0+b*this.a;a.R.Set(c);var d=a.R;a.position.x-=d.col1.x*this.localCenter.x+d.col2.x*this.localCenter.y,a.position.y-=d.col1.y*this.localCenter.x+d.col2.y*this.localCenter.y},b2Sweep.prototype.Advance=function(a){if(this.t0<a&&1-this.t0>Number.MIN_VALUE){var b=(a-this.t0)/(1-this.t0);this.c0.x=(1-b)*this.c0.x+b*this.c.x,this.c0.y=(1-b)*this.c0.y+b*this.c.y,this.a0=(1-b)*this.a0+b*this.a,this.t0=a}},b2Sweep.prototype.localCenter=new b2Vec2,b2Sweep.prototype.c0=new b2Vec2,b2Sweep.prototype.c=new b2Vec2,b2Sweep.prototype.a0=null,b2Sweep.prototype.a=null,b2Sweep.prototype.t0=null;var b2DistanceOutput=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DistanceOutput.prototype.__constructor=function(){},b2DistanceOutput.prototype.__varz=function(){this.pointA=new b2Vec2,this.pointB=new b2Vec2},b2DistanceOutput.prototype.pointA=new b2Vec2,b2DistanceOutput.prototype.pointB=new b2Vec2,b2DistanceOutput.prototype.distance=null,b2DistanceOutput.prototype.iterations=0;var b2Mat33=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Mat33.prototype.__constructor=function(a,b,c){a||b||c?(this.col1.SetV(a),this.col2.SetV(b),this.col3.SetV(c)):(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero())},b2Mat33.prototype.__varz=function(){this.col1=new b2Vec3,this.col2=new b2Vec3,this.col3=new b2Vec3},b2Mat33.prototype.SetVVV=function(a,b,c){this.col1.SetV(a),this.col2.SetV(b),this.col3.SetV(c)},b2Mat33.prototype.Copy=function(){return new b2Mat33(this.col1,this.col2,this.col3)},b2Mat33.prototype.SetM=function(a){this.col1.SetV(a.col1),this.col2.SetV(a.col2),this.col3.SetV(a.col3)},b2Mat33.prototype.AddM=function(a){this.col1.x+=a.col1.x,this.col1.y+=a.col1.y,this.col1.z+=a.col1.z,this.col2.x+=a.col2.x,this.col2.y+=a.col2.y,this.col2.z+=a.col2.z,this.col3.x+=a.col3.x,this.col3.y+=a.col3.y,this.col3.z+=a.col3.z},b2Mat33.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=1,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=1},b2Mat33.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=0,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=0},b2Mat33.prototype.Solve22=function(a,b,c){var d=this.col1.x,e=this.col2.x,f=this.col1.y,g=this.col2.y,h=d*g-e*f;return 0!=h&&(h=1/h),a.x=h*(g*b-e*c),a.y=h*(d*c-f*b),a},b2Mat33.prototype.Solve33=function(a,b,c,d){var e=this.col1.x,f=this.col1.y,g=this.col1.z,h=this.col2.x,i=this.col2.y,j=this.col2.z,k=this.col3.x,l=this.col3.y,m=this.col3.z,n=e*(i*m-j*l)+f*(j*k-h*m)+g*(h*l-i*k);return 0!=n&&(n=1/n),a.x=n*(b*(i*m-j*l)+c*(j*k-h*m)+d*(h*l-i*k)),a.y=n*(e*(c*m-d*l)+f*(d*k-b*m)+g*(b*l-c*k)),a.z=n*(e*(i*d-j*c)+f*(j*b-h*d)+g*(h*c-i*b)),a},b2Mat33.prototype.col1=new b2Vec3,b2Mat33.prototype.col2=new b2Vec3,b2Mat33.prototype.col3=new b2Vec3;var b2PositionSolverManifold=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2PositionSolverManifold.prototype.__constructor=function(){this.m_normal=new b2Vec2,this.m_separations=new Array(b2Settings.b2_maxManifoldPoints),this.m_points=new Array(b2Settings.b2_maxManifoldPoints);for(var a=0;a<b2Settings.b2_maxManifoldPoints;a++)this.m_points[a]=new b2Vec2},b2PositionSolverManifold.prototype.__varz=function(){},b2PositionSolverManifold.circlePointA=new b2Vec2,b2PositionSolverManifold.circlePointB=new b2Vec2,b2PositionSolverManifold.prototype.Initialize=function(a){b2Settings.b2Assert(a.pointCount>0);var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p=0;switch(a.type){case b2Manifold.e_circles:d=a.bodyA.m_xf.R,e=a.localPoint,h=a.bodyA.m_xf.position.x+(d.col1.x*e.x+d.col2.x*e.y),i=a.bodyA.m_xf.position.y+(d.col1.y*e.x+d.col2.y*e.y),d=a.bodyB.m_xf.R,e=a.points[0].localPoint,j=a.bodyB.m_xf.position.x+(d.col1.x*e.x+d.col2.x*e.y),k=a.bodyB.m_xf.position.y+(d.col1.y*e.x+d.col2.y*e.y),l=j-h,m=k-i,n=l*l+m*m,n>Number.MIN_VALUE*Number.MIN_VALUE?(o=Math.sqrt(n),this.m_normal.x=l/o,this.m_normal.y=m/o):(this.m_normal.x=1,this.m_normal.y=0),this.m_points[0].x=.5*(h+j),this.m_points[0].y=.5*(i+k),this.m_separations[0]=l*this.m_normal.x+m*this.m_normal.y-a.radius;
break;case b2Manifold.e_faceA:for(d=a.bodyA.m_xf.R,e=a.localPlaneNormal,this.m_normal.x=d.col1.x*e.x+d.col2.x*e.y,this.m_normal.y=d.col1.y*e.x+d.col2.y*e.y,d=a.bodyA.m_xf.R,e=a.localPoint,f=a.bodyA.m_xf.position.x+(d.col1.x*e.x+d.col2.x*e.y),g=a.bodyA.m_xf.position.y+(d.col1.y*e.x+d.col2.y*e.y),d=a.bodyB.m_xf.R,p=0;p<a.pointCount;++p)e=a.points[p].localPoint,b=a.bodyB.m_xf.position.x+(d.col1.x*e.x+d.col2.x*e.y),c=a.bodyB.m_xf.position.y+(d.col1.y*e.x+d.col2.y*e.y),this.m_separations[p]=(b-f)*this.m_normal.x+(c-g)*this.m_normal.y-a.radius,this.m_points[p].x=b,this.m_points[p].y=c;break;case b2Manifold.e_faceB:for(d=a.bodyB.m_xf.R,e=a.localPlaneNormal,this.m_normal.x=d.col1.x*e.x+d.col2.x*e.y,this.m_normal.y=d.col1.y*e.x+d.col2.y*e.y,d=a.bodyB.m_xf.R,e=a.localPoint,f=a.bodyB.m_xf.position.x+(d.col1.x*e.x+d.col2.x*e.y),g=a.bodyB.m_xf.position.y+(d.col1.y*e.x+d.col2.y*e.y),d=a.bodyA.m_xf.R,p=0;p<a.pointCount;++p)e=a.points[p].localPoint,b=a.bodyA.m_xf.position.x+(d.col1.x*e.x+d.col2.x*e.y),c=a.bodyA.m_xf.position.y+(d.col1.y*e.x+d.col2.y*e.y),this.m_separations[p]=(b-f)*this.m_normal.x+(c-g)*this.m_normal.y-a.radius,this.m_points[p].Set(b,c);this.m_normal.x*=-1,this.m_normal.y*=-1}},b2PositionSolverManifold.prototype.m_normal=null,b2PositionSolverManifold.prototype.m_points=null,b2PositionSolverManifold.prototype.m_separations=null;var b2OBB=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2OBB.prototype.__constructor=function(){},b2OBB.prototype.__varz=function(){this.R=new b2Mat22,this.center=new b2Vec2,this.extents=new b2Vec2},b2OBB.prototype.R=new b2Mat22,b2OBB.prototype.center=new b2Vec2,b2OBB.prototype.extents=new b2Vec2;var b2Pair=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Pair.prototype.__constructor=function(){},b2Pair.prototype.__varz=function(){},b2Pair.b2_nullProxy=b2Settings.USHRT_MAX,b2Pair.e_pairBuffered=1,b2Pair.e_pairRemoved=2,b2Pair.e_pairFinal=4,b2Pair.prototype.SetBuffered=function(){this.status|=b2Pair.e_pairBuffered},b2Pair.prototype.ClearBuffered=function(){this.status&=~b2Pair.e_pairBuffered},b2Pair.prototype.IsBuffered=function(){return(this.status&b2Pair.e_pairBuffered)==b2Pair.e_pairBuffered},b2Pair.prototype.SetRemoved=function(){this.status|=b2Pair.e_pairRemoved},b2Pair.prototype.ClearRemoved=function(){this.status&=~b2Pair.e_pairRemoved},b2Pair.prototype.IsRemoved=function(){return(this.status&b2Pair.e_pairRemoved)==b2Pair.e_pairRemoved},b2Pair.prototype.SetFinal=function(){this.status|=b2Pair.e_pairFinal},b2Pair.prototype.IsFinal=function(){return(this.status&b2Pair.e_pairFinal)==b2Pair.e_pairFinal},b2Pair.prototype.userData=null,b2Pair.prototype.proxy1=null,b2Pair.prototype.proxy2=null,b2Pair.prototype.next=null,b2Pair.prototype.status=0;var b2FixtureDef=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2FixtureDef.prototype.__constructor=function(){this.shape=null,this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.isSensor=!1},b2FixtureDef.prototype.__varz=function(){this.filter=new b2FilterData},b2FixtureDef.prototype.shape=null,b2FixtureDef.prototype.userData=null,b2FixtureDef.prototype.friction=null,b2FixtureDef.prototype.restitution=null,b2FixtureDef.prototype.density=null,b2FixtureDef.prototype.isSensor=null,b2FixtureDef.prototype.filter=new b2FilterData;var b2ContactID=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactID.prototype.__constructor=function(){this.features._m_id=this},b2ContactID.prototype.__varz=function(){this.features=new Features},b2ContactID.prototype.Set=function(a){key=a._key},b2ContactID.prototype.Copy=function(){var a=new b2ContactID;return a.key=key,a},b2ContactID.prototype.__defineSetter__("key",function(){return this._key}),b2ContactID.prototype.__defineSetter__("key",function(a){this._key=a,this.features._referenceEdge=255&this._key,this.features._incidentEdge=(65280&this._key)>>8&255,this.features._incidentVertex=(16711680&this._key)>>16&255,this.features._flip=(4278190080&this._key)>>24&255}),b2ContactID.prototype._key=0,b2ContactID.prototype.features=new Features;var b2Transform=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Transform.prototype.__constructor=function(a,b){a&&(this.position.SetV(a),this.R.SetM(b))},b2Transform.prototype.__varz=function(){this.position=new b2Vec2,this.R=new b2Mat22},b2Transform.prototype.Initialize=function(a,b){this.position.SetV(a),this.R.SetM(b)},b2Transform.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},b2Transform.prototype.Set=function(a){this.position.SetV(a.position),this.R.SetM(a.R)},b2Transform.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},b2Transform.prototype.position=new b2Vec2,b2Transform.prototype.R=new b2Mat22;var b2EdgeShape=function(){b2Shape.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2EdgeShape.prototype,b2Shape.prototype),b2EdgeShape.prototype._super=b2Shape.prototype,b2EdgeShape.prototype.__constructor=function(a,b){this._super.__constructor.apply(this,[]),this.m_type=b2Shape.e_edgeShape,this.m_prevEdge=null,this.m_nextEdge=null,this.m_v1=a,this.m_v2=b,this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal.Set(this.m_direction.y,-this.m_direction.x),this.m_coreV1.Set(-b2Settings.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-b2Settings.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2.Set(-b2Settings.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-b2Settings.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)},b2EdgeShape.prototype.__varz=function(){this.s_supportVec=new b2Vec2,this.m_v1=new b2Vec2,this.m_v2=new b2Vec2,this.m_coreV1=new b2Vec2,this.m_coreV2=new b2Vec2,this.m_normal=new b2Vec2,this.m_direction=new b2Vec2,this.m_cornerDir1=new b2Vec2,this.m_cornerDir2=new b2Vec2},b2EdgeShape.prototype.SetPrevEdge=function(a,b,c,d){this.m_prevEdge=a,this.m_coreV1=b,this.m_cornerDir1=c,this.m_cornerConvex1=d},b2EdgeShape.prototype.SetNextEdge=function(a,b,c,d){this.m_nextEdge=a,this.m_coreV2=b,this.m_cornerDir2=c,this.m_cornerConvex2=d},b2EdgeShape.prototype.TestPoint=function(a,b){return!1},b2EdgeShape.prototype.RayCast=function(a,b,c){var d,e=b.p2.x-b.p1.x,f=b.p2.y-b.p1.y;d=c.R;var g,h,i,j,k,l=c.position.x+(d.col1.x*this.m_v1.x+d.col2.x*this.m_v1.y),m=c.position.y+(d.col1.y*this.m_v1.x+d.col2.y*this.m_v1.y),n=c.position.y+(d.col1.y*this.m_v2.x+d.col2.y*this.m_v2.y)-m,o=-(c.position.x+(d.col1.x*this.m_v2.x+d.col2.x*this.m_v2.y)-l),p=100*Number.MIN_VALUE,q=-(e*n+f*o);return q>p&&(g=b.p1.x-l,h=b.p1.y-m,i=g*n+h*o,i>=0&&i<=b.maxFraction*q&&(j=-e*h+f*g,j>=-p*q&&q*(1+p)>=j))?(i/=q,a.fraction=i,k=Math.sqrt(n*n+o*o),a.normal.x=n/k,a.normal.y=o/k,!0):!1},b2EdgeShape.prototype.ComputeAABB=function(a,b){var c=b.R,d=b.position.x+(c.col1.x*this.m_v1.x+c.col2.x*this.m_v1.y),e=b.position.y+(c.col1.y*this.m_v1.x+c.col2.y*this.m_v1.y),f=b.position.x+(c.col1.x*this.m_v2.x+c.col2.x*this.m_v2.y),g=b.position.y+(c.col1.y*this.m_v2.x+c.col2.y*this.m_v2.y);f>d?(a.lowerBound.x=d,a.upperBound.x=f):(a.lowerBound.x=f,a.upperBound.x=d),g>e?(a.lowerBound.y=e,a.upperBound.y=g):(a.lowerBound.y=g,a.upperBound.y=e)},b2EdgeShape.prototype.ComputeMass=function(a,b){a.mass=0,a.center.SetV(this.m_v1),a.I=0},b2EdgeShape.prototype.ComputeSubmergedArea=function(a,b,c,d){var e=new b2Vec2(a.x*b,a.y*b),f=b2Math.MulX(c,this.m_v1),g=b2Math.MulX(c,this.m_v2),h=b2Math.Dot(a,f)-b,i=b2Math.Dot(a,g)-b;if(h>0){if(i>0)return 0;f.x=-i/(h-i)*f.x+h/(h-i)*g.x,f.y=-i/(h-i)*f.y+h/(h-i)*g.y}else i>0&&(g.x=-i/(h-i)*f.x+h/(h-i)*g.x,g.y=-i/(h-i)*f.y+h/(h-i)*g.y);return d.x=(e.x+f.x+g.x)/3,d.y=(e.y+f.y+g.y)/3,.5*((f.x-e.x)*(g.y-e.y)-(f.y-e.y)*(g.x-e.x))},b2EdgeShape.prototype.GetLength=function(){return this.m_length},b2EdgeShape.prototype.GetVertex1=function(){return this.m_v1},b2EdgeShape.prototype.GetVertex2=function(){return this.m_v2},b2EdgeShape.prototype.GetCoreVertex1=function(){return this.m_coreV1},b2EdgeShape.prototype.GetCoreVertex2=function(){return this.m_coreV2},b2EdgeShape.prototype.GetNormalVector=function(){return this.m_normal},b2EdgeShape.prototype.GetDirectionVector=function(){return this.m_direction},b2EdgeShape.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},b2EdgeShape.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},b2EdgeShape.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},b2EdgeShape.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},b2EdgeShape.prototype.GetFirstVertex=function(a){var b=a.R;return new b2Vec2(a.position.x+(b.col1.x*this.m_coreV1.x+b.col2.x*this.m_coreV1.y),a.position.y+(b.col1.y*this.m_coreV1.x+b.col2.y*this.m_coreV1.y))},b2EdgeShape.prototype.GetNextEdge=function(){return this.m_nextEdge},b2EdgeShape.prototype.GetPrevEdge=function(){return this.m_prevEdge},b2EdgeShape.prototype.Support=function(a,b,c){var d=a.R,e=a.position.x+(d.col1.x*this.m_coreV1.x+d.col2.x*this.m_coreV1.y),f=a.position.y+(d.col1.y*this.m_coreV1.x+d.col2.y*this.m_coreV1.y),g=a.position.x+(d.col1.x*this.m_coreV2.x+d.col2.x*this.m_coreV2.y),h=a.position.y+(d.col1.y*this.m_coreV2.x+d.col2.y*this.m_coreV2.y);return e*b+f*c>g*b+h*c?(this.s_supportVec.x=e,this.s_supportVec.y=f):(this.s_supportVec.x=g,this.s_supportVec.y=h),this.s_supportVec},b2EdgeShape.prototype.s_supportVec=new b2Vec2,b2EdgeShape.prototype.m_v1=new b2Vec2,b2EdgeShape.prototype.m_v2=new b2Vec2,b2EdgeShape.prototype.m_coreV1=new b2Vec2,b2EdgeShape.prototype.m_coreV2=new b2Vec2,b2EdgeShape.prototype.m_length=null,b2EdgeShape.prototype.m_normal=new b2Vec2,b2EdgeShape.prototype.m_direction=new b2Vec2,b2EdgeShape.prototype.m_cornerDir1=new b2Vec2,b2EdgeShape.prototype.m_cornerDir2=new b2Vec2,b2EdgeShape.prototype.m_cornerConvex1=null,b2EdgeShape.prototype.m_cornerConvex2=null,b2EdgeShape.prototype.m_nextEdge=null,b2EdgeShape.prototype.m_prevEdge=null;var b2BuoyancyController=function(){b2Controller.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2BuoyancyController.prototype,b2Controller.prototype),b2BuoyancyController.prototype._super=b2Controller.prototype,b2BuoyancyController.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2BuoyancyController.prototype.__varz=function(){this.normal=new b2Vec2(0,-1),this.velocity=new b2Vec2(0,0)},b2BuoyancyController.prototype.Step=function(a){if(m_bodyList){this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy());for(var b=m_bodyList;b;b=b.nextBody){var c=b.body;if(0!=c.IsAwake()){for(var d=new b2Vec2,e=new b2Vec2,f=0,g=0,h=c.GetFixtureList();h;h=h.GetNext()){var i=new b2Vec2,j=h.GetShape().ComputeSubmergedArea(this.normal,this.offset,c.GetTransform(),i);f+=j,d.x+=j*i.x,d.y+=j*i.y;var k;k=(this.useDensity,1),g+=j*k,e.x+=j*i.x*k,e.y+=j*i.y*k}if(d.x/=f,d.y/=f,e.x/=g,e.y/=g,!(f<Number.MIN_VALUE)){var l=this.gravity.GetNegative();l.Multiply(this.density*f),c.ApplyForce(l,e);var m=c.GetLinearVelocityFromWorldPoint(d);m.Subtract(this.velocity),m.Multiply(-this.linearDrag*f),c.ApplyForce(m,d),c.ApplyTorque(-c.GetInertia()/c.GetMass()*f*c.GetAngularVelocity()*this.angularDrag)}}}}},b2BuoyancyController.prototype.Draw=function(a){var b=1e3,c=new b2Vec2,d=new b2Vec2;c.x=this.normal.x*this.offset+this.normal.y*b,c.y=this.normal.y*this.offset-this.normal.x*b,d.x=this.normal.x*this.offset-this.normal.y*b,d.y=this.normal.y*this.offset+this.normal.x*b;var e=new b2Color(0,0,1);a.DrawSegment(c,d,e)},b2BuoyancyController.prototype.normal=new b2Vec2(0,-1),b2BuoyancyController.prototype.offset=0,b2BuoyancyController.prototype.density=0,b2BuoyancyController.prototype.velocity=new b2Vec2(0,0),b2BuoyancyController.prototype.linearDrag=2,b2BuoyancyController.prototype.angularDrag=1,b2BuoyancyController.prototype.useDensity=!1,b2BuoyancyController.prototype.useWorldGravity=!0,b2BuoyancyController.prototype.gravity=null;var b2Body=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Body.prototype.__constructor=function(a,b){this.m_flags=0,a.bullet&&(this.m_flags|=b2Body.e_bulletFlag),a.fixedRotation&&(this.m_flags|=b2Body.e_fixedRotationFlag),a.allowSleep&&(this.m_flags|=b2Body.e_allowSleepFlag),a.awake&&(this.m_flags|=b2Body.e_awakeFlag),a.active&&(this.m_flags|=b2Body.e_activeFlag),this.m_world=b,this.m_xf.position.SetV(a.position),this.m_xf.R.Set(a.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=a.angle;var c=this.m_xf.R,d=this.m_sweep.localCenter;this.m_sweep.c.x=c.col1.x*d.x+c.col2.x*d.y,this.m_sweep.c.y=c.col1.y*d.x+c.col2.y*d.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_jointList=null,this.m_controllerList=null,this.m_contactList=null,this.m_controllerCount=0,this.m_prev=null,this.m_next=null,this.m_linearVelocity.SetV(a.linearVelocity),this.m_angularVelocity=a.angularVelocity,this.m_linearDamping=a.linearDamping,this.m_angularDamping=a.angularDamping,this.m_force.Set(0,0),this.m_torque=0,this.m_sleepTime=0,this.m_type=a.type,this.m_type==b2Body.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_inertiaScale=a.inertiaScale,this.m_userData=a.userData,this.m_fixtureList=null,this.m_fixtureCount=0},b2Body.prototype.__varz=function(){this.m_xf=new b2Transform,this.m_sweep=new b2Sweep,this.m_linearVelocity=new b2Vec2,this.m_force=new b2Vec2},b2Body.b2_staticBody=0,b2Body.b2_kinematicBody=1,b2Body.b2_dynamicBody=2,b2Body.s_xf1=new b2Transform,b2Body.e_islandFlag=1,b2Body.e_awakeFlag=2,b2Body.e_allowSleepFlag=4,b2Body.e_bulletFlag=8,b2Body.e_fixedRotationFlag=16,b2Body.e_activeFlag=32,b2Body.prototype.connectEdges=function(a,b,c){var d=Math.atan2(b.GetDirectionVector().y,b.GetDirectionVector().x),e=Math.tan(.5*(d-c)),f=b2Math.MulFV(e,b.GetDirectionVector());f=b2Math.SubtractVV(f,b.GetNormalVector()),f=b2Math.MulFV(b2Settings.b2_toiSlop,f),f=b2Math.AddVV(f,b.GetVertex1());var g=b2Math.AddVV(a.GetDirectionVector(),b.GetDirectionVector());g.Normalize();var h=b2Math.Dot(a.GetDirectionVector(),b.GetNormalVector())>0;return a.SetNextEdge(b,f,g,h),b.SetPrevEdge(a,f,g,h),d},b2Body.prototype.SynchronizeFixtures=function(){var a,b,c,d,e=b2Body.s_xf1;for(e.R.Set(this.m_sweep.a0),a=e.R,b=this.m_sweep.localCenter,e.position.x=this.m_sweep.c0.x-(a.col1.x*b.x+a.col2.x*b.y),e.position.y=this.m_sweep.c0.y-(a.col1.y*b.x+a.col2.y*b.y),d=this.m_world.m_contactManager.m_broadPhase,c=this.m_fixtureList;c;c=c.m_next)c.Synchronize(d,e,this.m_xf)},b2Body.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var a=this.m_xf.R,b=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(a.col1.x*b.x+a.col2.x*b.y),this.m_xf.position.y=this.m_sweep.c.y-(a.col1.y*b.x+a.col2.y*b.y)},b2Body.prototype.ShouldCollide=function(a){if(this.m_type!=b2Body.b2_dynamicBody&&a.m_type!=b2Body.b2_dynamicBody)return!1;for(var b=this.m_jointList;b;b=b.next)if(b.other==a&&0==b.joint.m_collideConnected)return!1;return!0},b2Body.prototype.Advance=function(a){this.m_sweep.Advance(a),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},b2Body.prototype.CreateFixture=function(a){if(1==this.m_world.IsLocked())return null;var b=new b2Fixture;if(b.Create(this,this.m_xf,a),this.m_flags&b2Body.e_activeFlag){var c=this.m_world.m_contactManager.m_broadPhase;b.CreateProxy(c,this.m_xf)}return b.m_next=this.m_fixtureList,this.m_fixtureList=b,++this.m_fixtureCount,b.m_body=this,b.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=b2World.e_newFixture,b},b2Body.prototype.CreateFixture2=function(a,b){var c=new b2FixtureDef;return c.shape=a,c.density=b,this.CreateFixture(c)},b2Body.prototype.DestroyFixture=function(a){if(1!=this.m_world.IsLocked()){for(var b=this.m_fixtureList,c=null,d=!1;null!=b;){if(b==a){c?c.m_next=a.m_next:this.m_fixtureList=a.m_next,d=!0;break}c=b,b=b.m_next}for(var e=this.m_contactList;e;){var f=e.contact;e=e.next;var g=f.GetFixtureA(),h=f.GetFixtureB();(a==g||a==h)&&this.m_world.m_contactManager.Destroy(f)}if(this.m_flags&b2Body.e_activeFlag){var i=this.m_world.m_contactManager.m_broadPhase;a.DestroyProxy(i)}a.Destroy(),a.m_body=null,a.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},b2Body.prototype.SetPositionAndAngle=function(a,b){if(1!=this.m_world.IsLocked()){var c,d,e,f;for(this.m_xf.R.Set(b),this.m_xf.position.SetV(a),d=this.m_xf.R,e=this.m_sweep.localCenter,this.m_sweep.c.x=d.col1.x*e.x+d.col2.x*e.y,this.m_sweep.c.y=d.col1.y*e.x+d.col2.y*e.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=b,f=this.m_world.m_contactManager.m_broadPhase,c=this.m_fixtureList;c;c=c.m_next)c.Synchronize(f,this.m_xf,this.m_xf)}},b2Body.prototype.SetTransform=function(a){this.SetPositionAndAngle(a.position,a.GetAngle())},b2Body.prototype.GetTransform=function(){return this.m_xf},b2Body.prototype.GetPosition=function(){return this.m_xf.position},b2Body.prototype.SetPosition=function(a){this.SetPositionAndAngle(a,this.GetAngle())},b2Body.prototype.GetAngle=function(){return this.m_sweep.a},b2Body.prototype.SetAngle=function(a){this.SetPositionAndAngle(this.GetPosition(),a)},b2Body.prototype.GetWorldCenter=function(){return this.m_sweep.c},b2Body.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},b2Body.prototype.SetLinearVelocity=function(a){this.m_type!=b2Body.b2_staticBody&&this.m_linearVelocity.SetV(a)},b2Body.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},b2Body.prototype.SetAngularVelocity=function(a){this.m_type!=b2Body.b2_staticBody&&(this.m_angularVelocity=a)},b2Body.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},b2Body.prototype.GetDefinition=function(){var a=new b2BodyDef;return a.type=this.GetType(),a.allowSleep=(this.m_flags&b2Body.e_allowSleepFlag)==b2Body.e_allowSleepFlag,a.angle=this.GetAngle(),a.angularDamping=this.m_angularDamping,a.angularVelocity=this.m_angularVelocity,a.fixedRotation=(this.m_flags&b2Body.e_fixedRotationFlag)==b2Body.e_fixedRotationFlag,a.bullet=(this.m_flags&b2Body.e_bulletFlag)==b2Body.e_bulletFlag,a.awake=(this.m_flags&b2Body.e_awakeFlag)==b2Body.e_awakeFlag,a.linearDamping=this.m_linearDamping,a.linearVelocity.SetV(this.GetLinearVelocity()),a.position=this.GetPosition(),a.userData=this.GetUserData(),a},b2Body.prototype.ApplyForce=function(a,b){this.m_type==b2Body.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_force.x+=a.x,this.m_force.y+=a.y,this.m_torque+=(b.x-this.m_sweep.c.x)*a.y-(b.y-this.m_sweep.c.y)*a.x)},b2Body.prototype.ApplyTorque=function(a){this.m_type==b2Body.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_torque+=a)},b2Body.prototype.ApplyImpulse=function(a,b){this.m_type==b2Body.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*a.x,this.m_linearVelocity.y+=this.m_invMass*a.y,this.m_angularVelocity+=this.m_invI*((b.x-this.m_sweep.c.x)*a.y-(b.y-this.m_sweep.c.y)*a.x))},b2Body.prototype.Split=function(a){for(var b,c=this.GetLinearVelocity().Copy(),d=this.GetAngularVelocity(),e=this.GetWorldCenter(),f=this,g=this.m_world.CreateBody(this.GetDefinition()),h=f.m_fixtureList;h;)if(a(h)){var i=h.m_next;b?b.m_next=i:f.m_fixtureList=i,f.m_fixtureCount--,h.m_next=g.m_fixtureList,g.m_fixtureList=h,g.m_fixtureCount++,h.m_body=g,h=i}else b=h,h=h.m_next;f.ResetMassData(),g.ResetMassData();var j=f.GetWorldCenter(),k=g.GetWorldCenter(),l=b2Math.AddVV(c,b2Math.CrossFV(d,b2Math.SubtractVV(j,e))),m=b2Math.AddVV(c,b2Math.CrossFV(d,b2Math.SubtractVV(k,e)));return f.SetLinearVelocity(l),g.SetLinearVelocity(m),f.SetAngularVelocity(d),g.SetAngularVelocity(d),f.SynchronizeFixtures(),g.SynchronizeFixtures(),g},b2Body.prototype.Merge=function(a){var b;for(b=a.m_fixtureList;b;){var c=b.m_next;a.m_fixtureCount--,b.m_next=this.m_fixtureList,this.m_fixtureList=b,this.m_fixtureCount++,b.m_body=e,b=c}d.m_fixtureCount=0;var d=this,e=a;d.GetWorldCenter(),e.GetWorldCenter(),d.GetLinearVelocity().Copy(),e.GetLinearVelocity().Copy(),d.GetAngularVelocity(),e.GetAngularVelocity();d.ResetMassData(),this.SynchronizeFixtures()},b2Body.prototype.GetMass=function(){return this.m_mass},b2Body.prototype.GetInertia=function(){return this.m_I},b2Body.prototype.GetMassData=function(a){a.mass=this.m_mass,a.I=this.m_I,a.center.SetV(this.m_sweep.localCenter)},b2Body.prototype.SetMassData=function(a){if(b2Settings.b2Assert(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()&&this.m_type==b2Body.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=a.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,a.I>0&&0==(this.m_flags&b2Body.e_fixedRotationFlag)&&(this.m_I=a.I-this.m_mass*(a.center.x*a.center.x+a.center.y*a.center.y),this.m_invI=1/this.m_I);var b=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(a.center),this.m_sweep.c0.SetV(b2Math.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-b.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-b.x)}},b2Body.prototype.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type!=b2Body.b2_staticBody&&this.m_type!=b2Body.b2_kinematicBody){for(var a=b2Vec2.Make(0,0),b=this.m_fixtureList;b;b=b.m_next)if(0!=b.m_density){var c=b.GetMassData();this.m_mass+=c.mass,a.x+=c.center.x*c.mass,a.y+=c.center.y*c.mass,this.m_I+=c.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,a.x*=this.m_invMass,a.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&0==(this.m_flags&b2Body.e_fixedRotationFlag)?(this.m_I-=this.m_mass*(a.x*a.x+a.y*a.y),this.m_I*=this.m_inertiaScale,b2Settings.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var d=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(a),this.m_sweep.c0.SetV(b2Math.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-d.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-d.x)}},b2Body.prototype.GetWorldPoint=function(a){var b=this.m_xf.R,c=new b2Vec2(b.col1.x*a.x+b.col2.x*a.y,b.col1.y*a.x+b.col2.y*a.y);return c.x+=this.m_xf.position.x,c.y+=this.m_xf.position.y,c},b2Body.prototype.GetWorldVector=function(a){return b2Math.MulMV(this.m_xf.R,a)},b2Body.prototype.GetLocalPoint=function(a){return b2Math.MulXT(this.m_xf,a)},b2Body.prototype.GetLocalVector=function(a){return b2Math.MulTMV(this.m_xf.R,a)},b2Body.prototype.GetLinearVelocityFromWorldPoint=function(a){return new b2Vec2(this.m_linearVelocity.x-this.m_angularVelocity*(a.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a.x-this.m_sweep.c.x))},b2Body.prototype.GetLinearVelocityFromLocalPoint=function(a){var b=this.m_xf.R,c=new b2Vec2(b.col1.x*a.x+b.col2.x*a.y,b.col1.y*a.x+b.col2.y*a.y);return c.x+=this.m_xf.position.x,c.y+=this.m_xf.position.y,new b2Vec2(this.m_linearVelocity.x-this.m_angularVelocity*(c.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(c.x-this.m_sweep.c.x))},b2Body.prototype.GetLinearDamping=function(){return this.m_linearDamping},b2Body.prototype.SetLinearDamping=function(a){this.m_linearDamping=a},b2Body.prototype.GetAngularDamping=function(){return this.m_angularDamping},b2Body.prototype.SetAngularDamping=function(a){this.m_angularDamping=a},b2Body.prototype.SetType=function(a){if(this.m_type!=a){this.m_type=a,this.ResetMassData(),this.m_type==b2Body.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var b=this.m_contactList;b;b=b.next)b.contact.FlagForFiltering()}},b2Body.prototype.GetType=function(){return this.m_type},b2Body.prototype.SetBullet=function(a){a?this.m_flags|=b2Body.e_bulletFlag:this.m_flags&=~b2Body.e_bulletFlag},b2Body.prototype.IsBullet=function(){return(this.m_flags&b2Body.e_bulletFlag)==b2Body.e_bulletFlag},b2Body.prototype.SetSleepingAllowed=function(a){a?this.m_flags|=b2Body.e_allowSleepFlag:(this.m_flags&=~b2Body.e_allowSleepFlag,this.SetAwake(!0))},b2Body.prototype.SetAwake=function(a){a?(this.m_flags|=b2Body.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~b2Body.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},b2Body.prototype.IsAwake=function(){return(this.m_flags&b2Body.e_awakeFlag)==b2Body.e_awakeFlag},b2Body.prototype.SetFixedRotation=function(a){a?this.m_flags|=b2Body.e_fixedRotationFlag:this.m_flags&=~b2Body.e_fixedRotationFlag,this.ResetMassData()},b2Body.prototype.IsFixedRotation=function(){return(this.m_flags&b2Body.e_fixedRotationFlag)==b2Body.e_fixedRotationFlag},b2Body.prototype.SetActive=function(a){if(a!=this.IsActive()){var b,c;if(a)for(this.m_flags|=b2Body.e_activeFlag,b=this.m_world.m_contactManager.m_broadPhase,c=this.m_fixtureList;c;c=c.m_next)c.CreateProxy(b,this.m_xf);else{for(this.m_flags&=~b2Body.e_activeFlag,b=this.m_world.m_contactManager.m_broadPhase,c=this.m_fixtureList;c;c=c.m_next)c.DestroyProxy(b);for(var d=this.m_contactList;d;){var e=d;d=d.next,this.m_world.m_contactManager.Destroy(e.contact)}this.m_contactList=null}}},b2Body.prototype.IsActive=function(){return(this.m_flags&b2Body.e_activeFlag)==b2Body.e_activeFlag},b2Body.prototype.IsSleepingAllowed=function(){return(this.m_flags&b2Body.e_allowSleepFlag)==b2Body.e_allowSleepFlag},b2Body.prototype.GetFixtureList=function(){return this.m_fixtureList},b2Body.prototype.GetJointList=function(){return this.m_jointList},b2Body.prototype.GetControllerList=function(){return this.m_controllerList},b2Body.prototype.GetContactList=function(){return this.m_contactList},b2Body.prototype.GetNext=function(){return this.m_next},b2Body.prototype.GetUserData=function(){return this.m_userData},b2Body.prototype.SetUserData=function(a){this.m_userData=a},b2Body.prototype.GetWorld=function(){return this.m_world},b2Body.prototype.m_flags=0,b2Body.prototype.m_type=0,b2Body.prototype.m_islandIndex=0,b2Body.prototype.m_xf=new b2Transform,b2Body.prototype.m_sweep=new b2Sweep,b2Body.prototype.m_linearVelocity=new b2Vec2,b2Body.prototype.m_angularVelocity=null,b2Body.prototype.m_force=new b2Vec2,b2Body.prototype.m_torque=null,b2Body.prototype.m_world=null,b2Body.prototype.m_prev=null,b2Body.prototype.m_next=null,b2Body.prototype.m_fixtureList=null,b2Body.prototype.m_fixtureCount=0,b2Body.prototype.m_controllerList=null,b2Body.prototype.m_controllerCount=0,b2Body.prototype.m_jointList=null,b2Body.prototype.m_contactList=null,b2Body.prototype.m_mass=null,b2Body.prototype.m_invMass=null,b2Body.prototype.m_I=null,b2Body.prototype.m_invI=null,b2Body.prototype.m_inertiaScale=null,b2Body.prototype.m_linearDamping=null,b2Body.prototype.m_angularDamping=null,b2Body.prototype.m_sleepTime=null,b2Body.prototype.m_userData=null;var b2ContactImpulse=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactImpulse.prototype.__constructor=function(){},b2ContactImpulse.prototype.__varz=function(){this.normalImpulses=new Array(b2Settings.b2_maxManifoldPoints),this.tangentImpulses=new Array(b2Settings.b2_maxManifoldPoints)},b2ContactImpulse.prototype.normalImpulses=new Array(b2Settings.b2_maxManifoldPoints),b2ContactImpulse.prototype.tangentImpulses=new Array(b2Settings.b2_maxManifoldPoints);var b2TensorDampingController=function(){b2Controller.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2TensorDampingController.prototype,b2Controller.prototype),b2TensorDampingController.prototype._super=b2Controller.prototype,b2TensorDampingController.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2TensorDampingController.prototype.__varz=function(){this.T=new b2Mat22},b2TensorDampingController.prototype.SetAxisAligned=function(a,b){this.T.col1.x=-a,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-b,a>0||b>0?this.maxTimestep=1/Math.max(a,b):this.maxTimestep=0},b2TensorDampingController.prototype.Step=function(a){var b=a.dt;if(!(b<=Number.MIN_VALUE)){b>this.maxTimestep&&this.maxTimestep>0&&(b=this.maxTimestep);for(var c=m_bodyList;c;c=c.nextBody){var d=c.body;if(d.IsAwake()){var e=d.GetWorldVector(b2Math.MulMV(this.T,d.GetLocalVector(d.GetLinearVelocity())));d.SetLinearVelocity(new b2Vec2(d.GetLinearVelocity().x+e.x*b,d.GetLinearVelocity().y+e.y*b))}}}},b2TensorDampingController.prototype.T=new b2Mat22,b2TensorDampingController.prototype.maxTimestep=0;var b2ManifoldPoint=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ManifoldPoint.prototype.__constructor=function(){this.Reset()},b2ManifoldPoint.prototype.__varz=function(){this.m_localPoint=new b2Vec2,this.m_id=new b2ContactID},b2ManifoldPoint.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_normalImpulse=0,this.m_tangentImpulse=0,this.m_id.key=0},b2ManifoldPoint.prototype.Set=function(a){this.m_localPoint.SetV(a.m_localPoint),this.m_normalImpulse=a.m_normalImpulse,this.m_tangentImpulse=a.m_tangentImpulse,this.m_id.Set(a.m_id)},b2ManifoldPoint.prototype.m_localPoint=new b2Vec2,b2ManifoldPoint.prototype.m_normalImpulse=null,b2ManifoldPoint.prototype.m_tangentImpulse=null,b2ManifoldPoint.prototype.m_id=new b2ContactID;var b2PolygonShape=function(){b2Shape.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PolygonShape.prototype,b2Shape.prototype),b2PolygonShape.prototype._super=b2Shape.prototype,b2PolygonShape.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.m_type=b2Shape.e_polygonShape,this.m_centroid=new b2Vec2,this.m_vertices=new Array,this.m_normals=new Array},b2PolygonShape.prototype.__varz=function(){},b2PolygonShape.AsArray=function(a,b){var c=new b2PolygonShape;return c.SetAsArray(a,b),c},b2PolygonShape.AsVector=function(a,b){var c=new b2PolygonShape;return c.SetAsVector(a,b),c},b2PolygonShape.AsBox=function(a,b){var c=new b2PolygonShape;return c.SetAsBox(a,b),c},b2PolygonShape.AsOrientedBox=function(a,b,c,d){var e=new b2PolygonShape;return e.SetAsOrientedBox(a,b,c,d),e},b2PolygonShape.AsEdge=function(a,b){var c=new b2PolygonShape;return c.SetAsEdge(a,b),c},b2PolygonShape.ComputeCentroid=function(a,b){for(var c=new b2Vec2,d=0,e=0,f=0,g=1/3,h=0;b>h;++h){var i=a[h],j=b>h+1?a[~~(h+1)]:a[0],k=i.x-e,l=i.y-f,m=j.x-e,n=j.y-f,o=k*n-l*m,p=.5*o;d+=p,c.x+=p*g*(e+i.x+j.x),c.y+=p*g*(f+i.y+j.y)}return c.x*=1/d,c.y*=1/d,c},b2PolygonShape.ComputeOBB=function(a,b,c){var d=0,e=new Array(c+1);for(d=0;c>d;++d)e[d]=b[d];e[c]=e[0];var f=Number.MAX_VALUE;for(d=1;c>=d;++d){var g=e[~~(d-1)],h=e[d].x-g.x,i=e[d].y-g.y,j=Math.sqrt(h*h+i*i);h/=j,i/=j;for(var k=-i,l=h,m=Number.MAX_VALUE,n=Number.MAX_VALUE,o=-Number.MAX_VALUE,p=-Number.MAX_VALUE,q=0;c>q;++q){var r=e[q].x-g.x,s=e[q].y-g.y,t=h*r+i*s,u=k*r+l*s;m>t&&(m=t),n>u&&(n=u),t>o&&(o=t),u>p&&(p=u)}var v=(o-m)*(p-n);if(.95*f>v){f=v,a.R.col1.x=h,a.R.col1.y=i,a.R.col2.x=k,a.R.col2.y=l;var w=.5*(m+o),x=.5*(n+p),y=a.R;a.center.x=g.x+(y.col1.x*w+y.col2.x*x),a.center.y=g.y+(y.col1.y*w+y.col2.y*x),a.extents.x=.5*(o-m),a.extents.y=.5*(p-n)}}},b2PolygonShape.s_mat=new b2Mat22,b2PolygonShape.prototype.Validate=function(){return!1},b2PolygonShape.prototype.Reserve=function(a){for(var b=this.m_vertices.length;a>b;b++)this.m_vertices[b]=new b2Vec2,this.m_normals[b]=new b2Vec2},b2PolygonShape.prototype.Copy=function(){var a=new b2PolygonShape;return a.Set(this),a},b2PolygonShape.prototype.Set=function(a){if(this._super.Set.apply(this,[a]),isInstanceOf(a,b2PolygonShape)){var b=a;this.m_centroid.SetV(b.m_centroid),
this.m_vertexCount=b.m_vertexCount,this.Reserve(this.m_vertexCount);for(var c=0;c<this.m_vertexCount;c++)this.m_vertices[c].SetV(b.m_vertices[c]),this.m_normals[c].SetV(b.m_normals[c])}},b2PolygonShape.prototype.SetAsArray=function(a,b){for(var c=new Array,d=0,e=null;d<a.length,e=a[d];d++)c.push(e);this.SetAsVector(c,b)},b2PolygonShape.prototype.SetAsVector=function(a,b){"undefined"==typeof b&&(b=a.length),b2Settings.b2Assert(b>=2),this.m_vertexCount=b,this.Reserve(b);var c=0;for(c=0;c<this.m_vertexCount;c++)this.m_vertices[c].SetV(a[c]);for(c=0;c<this.m_vertexCount;++c){var d=c,e=c+1<this.m_vertexCount?c+1:0,f=b2Math.SubtractVV(this.m_vertices[e],this.m_vertices[d]);b2Settings.b2Assert(f.LengthSquared()>Number.MIN_VALUE),this.m_normals[c].SetV(b2Math.CrossVF(f,1)),this.m_normals[c].Normalize()}this.m_centroid=b2PolygonShape.ComputeCentroid(this.m_vertices,this.m_vertexCount)},b2PolygonShape.prototype.SetAsBox=function(a,b){this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-a,-b),this.m_vertices[1].Set(a,-b),this.m_vertices[2].Set(a,b),this.m_vertices[3].Set(-a,b),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},b2PolygonShape.prototype.SetAsOrientedBox=function(a,b,c,d){this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-a,-b),this.m_vertices[1].Set(a,-b),this.m_vertices[2].Set(a,b),this.m_vertices[3].Set(-a,b),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=c;var e=new b2Transform;e.position=c,e.R.Set(d);for(var f=0;f<this.m_vertexCount;++f)this.m_vertices[f]=b2Math.MulX(e,this.m_vertices[f]),this.m_normals[f]=b2Math.MulMV(e.R,this.m_normals[f])},b2PolygonShape.prototype.SetAsEdge=function(a,b){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(a),this.m_vertices[1].SetV(b),this.m_centroid.x=.5*(a.x+b.x),this.m_centroid.y=.5*(a.y+b.y),this.m_normals[0]=b2Math.CrossVF(b2Math.SubtractVV(b,a),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},b2PolygonShape.prototype.TestPoint=function(a,b){for(var c,d=a.R,e=b.x-a.position.x,f=b.y-a.position.y,g=e*d.col1.x+f*d.col1.y,h=e*d.col2.x+f*d.col2.y,i=0;i<this.m_vertexCount;++i){c=this.m_vertices[i],e=g-c.x,f=h-c.y,c=this.m_normals[i];var j=c.x*e+c.y*f;if(j>0)return!1}return!0},b2PolygonShape.prototype.RayCast=function(a,b,c){var d,e,f,g,h=0,i=b.maxFraction;d=b.p1.x-c.position.x,e=b.p1.y-c.position.y,f=c.R;var j=d*f.col1.x+e*f.col1.y,k=d*f.col2.x+e*f.col2.y;d=b.p2.x-c.position.x,e=b.p2.y-c.position.y,f=c.R;for(var l,m,n=d*f.col1.x+e*f.col1.y,o=d*f.col2.x+e*f.col2.y,p=n-j,q=o-k,r=-1,s=0;s<this.m_vertexCount;++s){if(g=this.m_vertices[s],d=g.x-j,e=g.y-k,g=this.m_normals[s],l=g.x*d+g.y*e,m=g.x*p+g.y*q,0==m){if(0>l)return!1}else 0>m&&h*m>l?(h=l/m,r=s):m>0&&i*m>l&&(i=l/m);if(i<h-Number.MIN_VALUE)return!1}return r>=0?(a.fraction=h,f=c.R,g=this.m_normals[r],a.normal.x=f.col1.x*g.x+f.col2.x*g.y,a.normal.y=f.col1.y*g.x+f.col2.y*g.y,!0):!1},b2PolygonShape.prototype.ComputeAABB=function(a,b){for(var c,d,e=b.R,f=this.m_vertices[0],g=b.position.x+(e.col1.x*f.x+e.col2.x*f.y),h=b.position.y+(e.col1.y*f.x+e.col2.y*f.y),i=g,j=h,k=1;k<this.m_vertexCount;++k)f=this.m_vertices[k],c=b.position.x+(e.col1.x*f.x+e.col2.x*f.y),d=b.position.y+(e.col1.y*f.x+e.col2.y*f.y),g=c>g?g:c,h=d>h?h:d,i=i>c?i:c,j=j>d?j:d;a.lowerBound.x=g-this.m_radius,a.lowerBound.y=h-this.m_radius,a.upperBound.x=i+this.m_radius,a.upperBound.y=j+this.m_radius},b2PolygonShape.prototype.ComputeMass=function(a,b){if(2==this.m_vertexCount)return a.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),a.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),a.mass=0,void(a.I=0);for(var c=0,d=0,e=0,f=0,g=0,h=0,i=1/3,j=0;j<this.m_vertexCount;++j){var k=this.m_vertices[j],l=j+1<this.m_vertexCount?this.m_vertices[~~(j+1)]:this.m_vertices[0],m=k.x-g,n=k.y-h,o=l.x-g,p=l.y-h,q=m*p-n*o,r=.5*q;e+=r,c+=r*i*(g+k.x+l.x),d+=r*i*(h+k.y+l.y);var s=g,t=h,u=m,v=n,w=o,x=p,y=i*(.25*(u*u+w*u+w*w)+(s*u+s*w))+.5*s*s,z=i*(.25*(v*v+x*v+x*x)+(t*v+t*x))+.5*t*t;f+=q*(y+z)}a.mass=b*e,c*=1/e,d*=1/e,a.center.Set(c,d),a.I=b*f},b2PolygonShape.prototype.ComputeSubmergedArea=function(a,b,c,d){var e=b2Math.MulTMV(c.R,a),f=b-b2Math.Dot(a,c.position),g=new Array,h=0,i=-1,j=-1,k=!1,l=0;for(l=0;l<this.m_vertexCount;++l){g[l]=b2Math.Dot(e,this.m_vertices[l])-f;var m=g[l]<-Number.MIN_VALUE;l>0&&(m?k||(i=l-1,h++):k&&(j=l-1,h++)),k=m}switch(h){case 0:if(k){var n=new b2MassData;return this.ComputeMass(n,1),d.SetV(b2Math.MulX(c,n.center)),n.mass}return 0;case 1:-1==i?i=this.m_vertexCount-1:j=this.m_vertexCount-1}var o,p=(i+1)%this.m_vertexCount,q=(j+1)%this.m_vertexCount,r=(0-g[i])/(g[p]-g[i]),s=(0-g[j])/(g[q]-g[j]),t=new b2Vec2(this.m_vertices[i].x*(1-r)+this.m_vertices[p].x*r,this.m_vertices[i].y*(1-r)+this.m_vertices[p].y*r),u=new b2Vec2(this.m_vertices[j].x*(1-s)+this.m_vertices[q].x*s,this.m_vertices[j].y*(1-s)+this.m_vertices[q].y*s),v=0,w=new b2Vec2,x=this.m_vertices[p];for(l=p;l!=q;){l=(l+1)%this.m_vertexCount,o=l==q?u:this.m_vertices[l];var y=.5*((x.x-t.x)*(o.y-t.y)-(x.y-t.y)*(o.x-t.x));v+=y,w.x+=y*(t.x+x.x+o.x)/3,w.y+=y*(t.y+x.y+o.y)/3,x=o}return w.Multiply(1/v),d.SetV(b2Math.MulX(c,w)),v},b2PolygonShape.prototype.GetVertexCount=function(){return this.m_vertexCount},b2PolygonShape.prototype.GetVertices=function(){return this.m_vertices},b2PolygonShape.prototype.GetNormals=function(){return this.m_normals},b2PolygonShape.prototype.GetSupport=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_vertexCount;++d){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return b},b2PolygonShape.prototype.GetSupportVertex=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_vertexCount;++d){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return this.m_vertices[b]},b2PolygonShape.prototype.m_centroid=null,b2PolygonShape.prototype.m_vertices=null,b2PolygonShape.prototype.m_normals=null,b2PolygonShape.prototype.m_vertexCount=0;var b2Fixture=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Fixture.prototype.__constructor=function(){this.m_aabb=new b2AABB,this.m_userData=null,this.m_body=null,this.m_next=null,this.m_shape=null,this.m_density=0,this.m_friction=0,this.m_restitution=0},b2Fixture.prototype.__varz=function(){this.m_filter=new b2FilterData,this.m_aabb1=new b2AABB,this.m_aabb2=new b2AABB},b2Fixture.prototype.Create=function(a,b,c){this.m_userData=c.userData,this.m_friction=c.friction,this.m_restitution=c.restitution,this.m_body=a,this.m_next=null,this.m_filter=c.filter.Copy(),this.m_isSensor=c.isSensor,this.m_shape=c.shape.Copy(),this.m_density=c.density,this.m_displacement={x:0,y:0}},b2Fixture.prototype.Destroy=function(){this.m_shape=null},b2Fixture.prototype.CreateProxy=function(a,b){this.m_shape.ComputeAABB(this.m_aabb,b),this.m_proxy=a.CreateProxy(this.m_aabb,this)},b2Fixture.prototype.DestroyProxy=function(a){null!=this.m_proxy&&(a.DestroyProxy(this.m_proxy),this.m_proxy=null)},b2Fixture.prototype.Synchronize=function(a,b,c){this.m_proxy&&(this.m_aabb1.Reset(),this.m_aabb2.Reset(),this.m_shape.ComputeAABB(this.m_aabb1,b),this.m_shape.ComputeAABB(this.m_aabb2,c),this.m_aabb.Combine(this.m_aabb1,this.m_aabb2),this.m_displacement.x=c.position.x-b.position.x,this.m_displacement.y=c.position.y-b.position.y,a.MoveProxy(this.m_proxy,this.m_aabb,this.m_displacement))},b2Fixture.prototype.GetType=function(){return this.m_shape.GetType()},b2Fixture.prototype.GetShape=function(){return this.m_shape},b2Fixture.prototype.SetSensor=function(a){if(this.m_isSensor!=a&&(this.m_isSensor=a,null!=this.m_body))for(var b=this.m_body.GetContactList();b;){var c=b.contact,d=c.GetFixtureA(),e=c.GetFixtureB();(d==this||e==this)&&c.SetSensor(d.IsSensor()||e.IsSensor()),b=b.next}},b2Fixture.prototype.IsSensor=function(){return this.m_isSensor},b2Fixture.prototype.SetFilterData=function(a){if(this.m_filter=a.Copy(),!this.m_body)for(var b=this.m_body.GetContactList();b;){var c=b.contact,d=c.GetFixtureA(),e=c.GetFixtureB();(d==this||e==this)&&c.FlagForFiltering(),b=b.next}},b2Fixture.prototype.GetFilterData=function(){return this.m_filter.Copy()},b2Fixture.prototype.GetBody=function(){return this.m_body},b2Fixture.prototype.GetNext=function(){return this.m_next},b2Fixture.prototype.GetUserData=function(){return this.m_userData},b2Fixture.prototype.SetUserData=function(a){this.m_userData=a},b2Fixture.prototype.TestPoint=function(a){return this.m_shape.TestPoint(this.m_body.GetTransform(),a)},b2Fixture.prototype.RayCast=function(a,b){return this.m_shape.RayCast(a,b,this.m_body.GetTransform())},b2Fixture.prototype.GetMassData=function(a){return null==a&&(a=new b2MassData),this.m_shape.ComputeMass(a,this.m_density),a},b2Fixture.prototype.SetDensity=function(a){this.m_density=a},b2Fixture.prototype.GetDensity=function(){return this.m_density},b2Fixture.prototype.GetFriction=function(){return this.m_friction},b2Fixture.prototype.SetFriction=function(a){this.m_friction=a},b2Fixture.prototype.GetRestitution=function(){return this.m_restitution},b2Fixture.prototype.SetRestitution=function(a){this.m_restitution=a},b2Fixture.prototype.GetAABB=function(){return this.m_aabb},b2Fixture.prototype.m_massData=null,b2Fixture.prototype.m_aabb=null,b2Fixture.prototype.m_density=null,b2Fixture.prototype.m_next=null,b2Fixture.prototype.m_body=null,b2Fixture.prototype.m_shape=null,b2Fixture.prototype.m_friction=null,b2Fixture.prototype.m_restitution=null,b2Fixture.prototype.m_proxy=null,b2Fixture.prototype.m_filter=new b2FilterData,b2Fixture.prototype.m_isSensor=null,b2Fixture.prototype.m_userData=null;var b2DynamicTreeNode=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DynamicTreeNode.prototype.__constructor=function(){},b2DynamicTreeNode.prototype.__varz=function(){this.aabb=new b2AABB},b2DynamicTreeNode.prototype.IsLeaf=function(){return null==this.child1},b2DynamicTreeNode.prototype.userData=null,b2DynamicTreeNode.prototype.aabb=new b2AABB,b2DynamicTreeNode.prototype.parent=null,b2DynamicTreeNode.prototype.child1=null,b2DynamicTreeNode.prototype.child2=null;var b2BodyDef=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2BodyDef.prototype.__constructor=function(){this.userData=null,this.position.Set(0,0),this.angle=0,this.linearVelocity.Set(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.type=b2Body.b2_staticBody,this.active=!0,this.inertiaScale=1},b2BodyDef.prototype.__varz=function(){this.position=new b2Vec2,this.linearVelocity=new b2Vec2},b2BodyDef.prototype.type=0,b2BodyDef.prototype.position=new b2Vec2,b2BodyDef.prototype.angle=null,b2BodyDef.prototype.linearVelocity=new b2Vec2,b2BodyDef.prototype.angularVelocity=null,b2BodyDef.prototype.linearDamping=null,b2BodyDef.prototype.angularDamping=null,b2BodyDef.prototype.allowSleep=null,b2BodyDef.prototype.awake=null,b2BodyDef.prototype.fixedRotation=null,b2BodyDef.prototype.bullet=null,b2BodyDef.prototype.active=null,b2BodyDef.prototype.userData=null,b2BodyDef.prototype.inertiaScale=null;var b2DynamicTreeBroadPhase=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DynamicTreeBroadPhase.prototype.__constructor=function(){},b2DynamicTreeBroadPhase.prototype.__varz=function(){this.m_tree=new b2DynamicTree,this.m_moveBuffer=new Array,this.m_pairBuffer=new Array},b2DynamicTreeBroadPhase.prototype.BufferMove=function(a){this.m_moveBuffer[this.m_moveBuffer.length]=a},b2DynamicTreeBroadPhase.prototype.UnBufferMove=function(a){var b=this.m_moveBuffer.indexOf(a);this.m_moveBuffer.splice(b,1)},b2DynamicTreeBroadPhase.prototype.ComparePairs=function(a,b){return 0},b2DynamicTreeBroadPhase.prototype.CreateProxy=function(a,b){var c=this.m_tree.CreateProxy(a,b);return++this.m_proxyCount,this.BufferMove(c),c},b2DynamicTreeBroadPhase.prototype.DestroyProxy=function(a){this.UnBufferMove(a),--this.m_proxyCount,this.m_tree.DestroyProxy(a)},b2DynamicTreeBroadPhase.prototype.MoveProxy=function(a,b,c){var d=this.m_tree.MoveProxy(a,b,c);d&&this.BufferMove(a)},b2DynamicTreeBroadPhase.prototype.TestOverlap=function(a,b){var c=this.m_tree.GetFatAABB(a),d=this.m_tree.GetFatAABB(b);return c.TestOverlap(d)},b2DynamicTreeBroadPhase.prototype.GetUserData=function(a){return this.m_tree.GetUserData(a)},b2DynamicTreeBroadPhase.prototype.GetFatAABB=function(a){return this.m_tree.GetFatAABB(a)},b2DynamicTreeBroadPhase.prototype.GetProxyCount=function(){return this.m_proxyCount},b2DynamicTreeBroadPhase.prototype.UpdatePairs=function(a){function b(a){return a==i?!0:(j.m_pairCount==j.m_pairBuffer.length&&(j.m_pairBuffer[j.m_pairCount]=new b2DynamicTreePair),c=j.m_pairBuffer[j.m_pairCount],c.proxyA=i>a?a:i,c.proxyB=a>=i?a:i,++j.m_pairCount,!0)}this.m_pairCount=0;for(var c,d,e,f,g,c,h=0,i=null,j=this;h<this.m_moveBuffer.length,i=this.m_moveBuffer[h];h++)d=this.m_tree.GetFatAABB(i),this.m_tree.Query(b,d);for(this.m_moveBuffer.length=0,h=0;h<this.m_pairCount;)for(e=this.m_pairBuffer[h],f=this.m_tree.GetUserData(e.proxyA),g=this.m_tree.GetUserData(e.proxyB),a(f,g),++h;h<this.m_pairCount&&(c=this.m_pairBuffer[h],c.proxyA==e.proxyA&&c.proxyB==e.proxyB);)++h},b2DynamicTreeBroadPhase.prototype.Query=function(a,b){this.m_tree.Query(a,b)},b2DynamicTreeBroadPhase.prototype.RayCast=function(a,b){this.m_tree.RayCast(a,b)},b2DynamicTreeBroadPhase.prototype.Validate=function(){},b2DynamicTreeBroadPhase.prototype.Rebalance=function(a){this.m_tree.Rebalance(a)},b2DynamicTreeBroadPhase.prototype.m_tree=new b2DynamicTree,b2DynamicTreeBroadPhase.prototype.m_proxyCount=0,b2DynamicTreeBroadPhase.prototype.m_moveBuffer=new Array,b2DynamicTreeBroadPhase.prototype.m_pairBuffer=new Array,b2DynamicTreeBroadPhase.prototype.m_pairCount=0;var b2BroadPhase=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2BroadPhase.prototype.__constructor=function(a){var b=0;for(this.m_pairManager.Initialize(this),this.m_worldAABB=a,this.m_proxyCount=0,this.m_bounds=new Array,b=0;2>b;b++)this.m_bounds[b]=new Array;var c=a.upperBound.x-a.lowerBound.x,d=a.upperBound.y-a.lowerBound.y;this.m_quantizationFactor.x=b2Settings.USHRT_MAX/c,this.m_quantizationFactor.y=b2Settings.USHRT_MAX/d,this.m_timeStamp=1,this.m_queryResultCount=0},b2BroadPhase.prototype.__varz=function(){this.m_pairManager=new b2PairManager,this.m_proxyPool=new Array,this.m_querySortKeys=new Array,this.m_queryResults=new Array,this.m_quantizationFactor=new b2Vec2},b2BroadPhase.BinarySearch=function(a,b,c){for(var d=0,e=b-1;e>=d;){var f=Math.round((d+e)/2),g=a[f];if(g.value>c)e=f-1;else{if(!(g.value<c))return~~f;d=f+1}}return~~d},b2BroadPhase.s_validate=!1,b2BroadPhase.b2_invalid=b2Settings.USHRT_MAX,b2BroadPhase.b2_nullEdge=b2Settings.USHRT_MAX,b2BroadPhase.prototype.ComputeBounds=function(a,b,c){var d=c.lowerBound.x,e=c.lowerBound.y;d=b2Math.Min(d,this.m_worldAABB.upperBound.x),e=b2Math.Min(e,this.m_worldAABB.upperBound.y),d=b2Math.Max(d,this.m_worldAABB.lowerBound.x),e=b2Math.Max(e,this.m_worldAABB.lowerBound.y);var f=c.upperBound.x,g=c.upperBound.y;f=b2Math.Min(f,this.m_worldAABB.upperBound.x),g=b2Math.Min(g,this.m_worldAABB.upperBound.y),f=b2Math.Max(f,this.m_worldAABB.lowerBound.x),g=b2Math.Max(g,this.m_worldAABB.lowerBound.y),a[0]=~~(this.m_quantizationFactor.x*(d-this.m_worldAABB.lowerBound.x))&b2Settings.USHRT_MAX-1,b[0]=~~(this.m_quantizationFactor.x*(f-this.m_worldAABB.lowerBound.x))%65535|1,a[1]=~~(this.m_quantizationFactor.y*(e-this.m_worldAABB.lowerBound.y))&b2Settings.USHRT_MAX-1,b[1]=~~(this.m_quantizationFactor.y*(g-this.m_worldAABB.lowerBound.y))%65535|1},b2BroadPhase.prototype.TestOverlapValidate=function(a,b){for(var c=0;2>c;++c){var d=this.m_bounds[c],e=d[a.lowerBounds[c]],f=d[b.upperBounds[c]];if(e.value>f.value)return!1;if(e=d[a.upperBounds[c]],f=d[b.lowerBounds[c]],e.value<f.value)return!1}return!0},b2BroadPhase.prototype.QueryAxis=function(a,b,c,d,e,f,g){for(var h,i=b2BroadPhase.BinarySearch(e,f,c),j=b2BroadPhase.BinarySearch(e,f,d),k=i;j>k;++k)h=e[k],h.IsLower()&&this.IncrementOverlapCount(h.proxy);if(i>0){var l=i-1;h=e[l];for(var m=h.stabbingCount;m;){if(h=e[l],h.IsLower()){var n=h.proxy;i<=n.upperBounds[g]&&(this.IncrementOverlapCount(h.proxy),--m)}--l}}a[0]=i,b[0]=j},b2BroadPhase.prototype.IncrementOverlapCount=function(a){a.timeStamp<this.m_timeStamp?(a.timeStamp=this.m_timeStamp,a.overlapCount=1):(a.overlapCount=2,this.m_queryResults[this.m_queryResultCount]=a,++this.m_queryResultCount)},b2BroadPhase.prototype.IncrementTimeStamp=function(){if(this.m_timeStamp==b2Settings.USHRT_MAX){for(var a=0;a<this.m_proxyPool.length;++a)this.m_proxyPool[a].timeStamp=0;this.m_timeStamp=1}else++this.m_timeStamp},b2BroadPhase.prototype.InRange=function(a){var b,c,d,e;return b=a.lowerBound.x,c=a.lowerBound.y,b-=this.m_worldAABB.upperBound.x,c-=this.m_worldAABB.upperBound.y,d=this.m_worldAABB.lowerBound.x,e=this.m_worldAABB.lowerBound.y,d-=a.upperBound.x,e-=a.upperBound.y,b=b2Math.Max(b,d),c=b2Math.Max(c,e),b2Math.Max(b,c)<0},b2BroadPhase.prototype.CreateProxy=function(a,b){var c,d=0,e=0,f=0;if(!this.m_freeProxy)for(this.m_freeProxy=this.m_proxyPool[this.m_proxyCount]=new b2Proxy,this.m_freeProxy.next=null,this.m_freeProxy.timeStamp=0,this.m_freeProxy.overlapCount=b2BroadPhase.b2_invalid,this.m_freeProxy.userData=null,e=0;2>e;e++)f=2*this.m_proxyCount,this.m_bounds[e][f++]=new b2Bound,this.m_bounds[e][f]=new b2Bound;c=this.m_freeProxy,this.m_freeProxy=c.next,c.overlapCount=0,c.userData=b;var g=2*this.m_proxyCount,h=new Array,i=new Array;this.ComputeBounds(h,i,a);for(var j=0;2>j;++j){var k=this.m_bounds[j],l=0,m=0,n=new Array;n.push(l);var o=new Array;o.push(m),this.QueryAxis(n,o,h[j],i[j],k,g,j),l=n[0],m=o[0],k.splice(m,0,k[k.length-1]),k.length--,k.splice(l,0,k[k.length-1]),k.length--,++m;var p=k[l],q=k[m];p.value=h[j],p.proxy=c,q.value=i[j],q.proxy=c;var r=k[~~(l-1)];for(p.stabbingCount=0==l?0:r.stabbingCount,r=k[~~(m-1)],q.stabbingCount=r.stabbingCount,d=l;m>d;++d)r=k[d],r.stabbingCount++;for(d=l;g+2>d;++d){p=k[d];var s=p.proxy;p.IsLower()?s.lowerBounds[j]=d:s.upperBounds[j]=d}}for(++this.m_proxyCount,e=0;e<this.m_queryResultCount;++e)this.m_pairManager.AddBufferedPair(c,this.m_queryResults[e]);return this.m_queryResultCount=0,this.IncrementTimeStamp(),c},b2BroadPhase.prototype.DestroyProxy=function(a){for(var b,c,d=a,e=2*this.m_proxyCount,f=0;2>f;++f){var g=this.m_bounds[f],h=d.lowerBounds[f],i=d.upperBounds[f];b=g[h];var j=b.value;c=g[i];var k=c.value;g.splice(i,1),g.splice(h,1),g.push(b),g.push(c);for(var l=e-2,m=h;l>m;++m){b=g[m];var n=b.proxy;b.IsLower()?n.lowerBounds[f]=m:n.upperBounds[f]=m}l=i-1;for(var o=h;l>o;++o)b=g[o],b.stabbingCount--;var p=new Array;this.QueryAxis(p,p,j,k,g,e-2,f)}for(var q=0;q<this.m_queryResultCount;++q)this.m_pairManager.RemoveBufferedPair(d,this.m_queryResults[q]);this.m_queryResultCount=0,this.IncrementTimeStamp(),d.userData=null,d.overlapCount=b2BroadPhase.b2_invalid,d.lowerBounds[0]=b2BroadPhase.b2_invalid,d.lowerBounds[1]=b2BroadPhase.b2_invalid,d.upperBounds[0]=b2BroadPhase.b2_invalid,d.upperBounds[1]=b2BroadPhase.b2_invalid,d.next=this.m_freeProxy,this.m_freeProxy=d,--this.m_proxyCount},b2BroadPhase.prototype.MoveProxy=function(a,b,c){if(null!=a&&0!=b.IsValid()){var d,e,f,g,h,i,j,k,l,m,n,o,p,q=a,r=0,s=0,t=0,u=2*this.m_proxyCount,v=new b2BoundValues,w=new b2BoundValues;for(this.ComputeBounds(v.lowerValues,v.upperValues,b),s=0;2>s;++s)e=this.m_bounds[s][q.lowerBounds[s]],w.lowerValues[s]=e.value,e=this.m_bounds[s][q.upperBounds[s]],w.upperValues[s]=e.value;for(s=0;2>s;++s){if(i=this.m_bounds[s],j=q.lowerBounds[s],k=q.upperBounds[s],l=v.lowerValues[s],m=v.upperValues[s],e=i[j],n=l-e.value,e.value=l,e=i[k],o=m-e.value,e.value=m,0>n)for(t=j;t>0&&l<i[~~(t-1)].value;)e=i[t],f=i[~~(t-1)],p=f.proxy,f.stabbingCount++,1==f.IsUpper()?(this.TestOverlapBound(v,p)&&this.m_pairManager.AddBufferedPair(q,p),d=p.upperBounds,r=d[s],r++,d[s]=r,e.stabbingCount++):(d=p.lowerBounds,r=d[s],r++,d[s]=r,e.stabbingCount--),d=q.lowerBounds,r=d[s],r--,d[s]=r,e.Swap(f),--t;if(o>0)for(t=k;u-1>t&&i[~~(t+1)].value<=m;)e=i[t],g=i[~~(t+1)],h=g.proxy,g.stabbingCount++,1==g.IsLower()?(this.TestOverlapBound(v,h)&&this.m_pairManager.AddBufferedPair(q,h),d=h.lowerBounds,r=d[s],r--,d[s]=r,e.stabbingCount++):(d=h.upperBounds,r=d[s],r--,d[s]=r,e.stabbingCount--),d=q.upperBounds,r=d[s],r++,d[s]=r,e.Swap(g),t++;if(n>0)for(t=j;u-1>t&&i[~~(t+1)].value<=l;)e=i[t],g=i[~~(t+1)],h=g.proxy,g.stabbingCount--,g.IsUpper()?(this.TestOverlapBound(w,h)&&this.m_pairManager.RemoveBufferedPair(q,h),d=h.upperBounds,r=d[s],r--,d[s]=r,e.stabbingCount--):(d=h.lowerBounds,r=d[s],r--,d[s]=r,e.stabbingCount++),d=q.lowerBounds,r=d[s],r++,d[s]=r,e.Swap(g),t++;if(0>o)for(t=k;t>0&&m<i[~~(t-1)].value;)e=i[t],f=i[~~(t-1)],p=f.proxy,f.stabbingCount--,1==f.IsLower()?(this.TestOverlapBound(w,p)&&this.m_pairManager.RemoveBufferedPair(q,p),d=p.lowerBounds,r=d[s],r++,d[s]=r,e.stabbingCount--):(d=p.upperBounds,r=d[s],r++,d[s]=r,e.stabbingCount++),d=q.upperBounds,r=d[s],r--,d[s]=r,e.Swap(f),t--}}},b2BroadPhase.prototype.UpdatePairs=function(a){this.m_pairManager.Commit(a)},b2BroadPhase.prototype.TestOverlap=function(a,b){return a.lowerBounds[0]>b.upperBounds[0]?!1:b.lowerBounds[0]>a.upperBounds[0]?!1:a.lowerBounds[1]>b.upperBounds[1]?!1:b.lowerBounds[1]>a.upperBounds[1]?!1:!0},b2BroadPhase.prototype.GetUserData=function(a){return a.userData},b2BroadPhase.prototype.GetFatAABB=function(a){var b=new b2AABB,c=a;return b.lowerBound.x=this.m_worldAABB.lowerBound.x+this.m_bounds[0][c.lowerBounds[0]].value/this.m_quantizationFactor.x,b.lowerBound.y=this.m_worldAABB.lowerBound.y+this.m_bounds[1][c.lowerBounds[1]].value/this.m_quantizationFactor.y,b.upperBound.x=this.m_worldAABB.lowerBound.x+this.m_bounds[0][c.upperBounds[0]].value/this.m_quantizationFactor.x,b.upperBound.y=this.m_worldAABB.lowerBound.y+this.m_bounds[1][c.upperBounds[1]].value/this.m_quantizationFactor.y,b},b2BroadPhase.prototype.GetProxyCount=function(){return this.m_proxyCount},b2BroadPhase.prototype.Query=function(a,b){var c=new Array,d=new Array;this.ComputeBounds(c,d,b);var e=0,f=0,g=new Array;g.push(e);var h=new Array;h.push(f),this.QueryAxis(g,h,c[0],d[0],this.m_bounds[0],2*this.m_proxyCount,0),this.QueryAxis(g,h,c[1],d[1],this.m_bounds[1],2*this.m_proxyCount,1);for(var i=0;i<this.m_queryResultCount;++i){var j=this.m_queryResults[i];if(!a(j))break}this.m_queryResultCount=0,this.IncrementTimeStamp()},b2BroadPhase.prototype.Validate=function(){for(var a=0;2>a;++a)for(var b=this.m_bounds[a],c=2*this.m_proxyCount,d=0,e=0;c>e;++e){var f=b[e];1==f.IsLower()?d++:d--}},b2BroadPhase.prototype.Rebalance=function(a){},b2BroadPhase.prototype.RayCast=function(a,b){var c=new b2RayCastInput;c.p1.SetV(b.p1),c.p2.SetV(b.p2),c.maxFraction=b.maxFraction;var d=(b.p2.x-b.p1.x)*this.m_quantizationFactor.x,e=(b.p2.y-b.p1.y)*this.m_quantizationFactor.y,f=d<-Number.MIN_VALUE?-1:d>Number.MIN_VALUE?1:0,g=e<-Number.MIN_VALUE?-1:e>Number.MIN_VALUE?1:0,h=this.m_quantizationFactor.x*(b.p1.x-this.m_worldAABB.lowerBound.x),i=this.m_quantizationFactor.y*(b.p1.y-this.m_worldAABB.lowerBound.y),j=new Array,k=new Array;j[0]=~~h&b2Settings.USHRT_MAX-1,j[1]=~~i&b2Settings.USHRT_MAX-1,k[0]=j[0]+1,k[1]=j[1]+1;var l,m,n,o=(new Array,0),p=0,q=0,r=0,s=new Array,t=new Array,u=0;for(s.push(q),t.push(r),this.QueryAxis(s,t,j[0],k[0],this.m_bounds[0],2*this.m_proxyCount,0),o=f>=0?t[0]-1:s[0],this.QueryAxis(s,t,j[1],k[1],this.m_bounds[1],2*this.m_proxyCount,1),p=g>=0?t[0]-1:s[0];u<this.m_queryResultCount;u++)c.maxFraction=a(this.m_queryResults[u],c);for(;(m=0,n=0,o+=f>=0?1:-1,!(0>o||o>=2*this.m_proxyCount))&&(0!=f&&(m=(this.m_bounds[0][o].value-h)/d),p+=g>=0?1:-1,!(0>p||p>=2*this.m_proxyCount));){for(0!=g&&(n=(this.m_bounds[1][p].value-i)/e);;)if(0==g||0!=f&&n>m){if(m>c.maxFraction)break;if((f>0?this.m_bounds[0][o].IsLower():this.m_bounds[0][o].IsUpper())&&(l=this.m_bounds[0][o].proxy,g>=0?l.lowerBounds[1]<=p-1&&l.upperBounds[1]>=p&&(c.maxFraction=a(l,c)):l.lowerBounds[1]<=p&&l.upperBounds[1]>=p+1&&(c.maxFraction=a(l,c))),0==c.maxFraction)break;if(f>0){if(o++,o==2*this.m_proxyCount)break}else if(o--,0>o)break;m=(this.m_bounds[0][o].value-h)/d}else{if(n>c.maxFraction)break;if((g>0?this.m_bounds[1][p].IsLower():this.m_bounds[1][p].IsUpper())&&(l=this.m_bounds[1][p].proxy,f>=0?l.lowerBounds[0]<=o-1&&l.upperBounds[0]>=o&&(c.maxFraction=a(l,c)):l.lowerBounds[0]<=o&&l.upperBounds[0]>=o+1&&(c.maxFraction=a(l,c))),0==c.maxFraction)break;if(g>0){if(p++,p==2*this.m_proxyCount)break}else if(p--,0>p)break;n=(this.m_bounds[1][p].value-i)/e}break}this.m_queryResultCount=0,this.IncrementTimeStamp()},b2BroadPhase.prototype.TestOverlapBound=function(a,b){for(var c=0;2>c;++c){var d=this.m_bounds[c],e=d[b.upperBounds[c]];if(a.lowerValues[c]>e.value)return!1;if(e=d[b.lowerBounds[c]],a.upperValues[c]<e.value)return!1}return!0},b2BroadPhase.prototype.m_pairManager=new b2PairManager,b2BroadPhase.prototype.m_proxyPool=new Array,b2BroadPhase.prototype.m_freeProxy=null,b2BroadPhase.prototype.m_bounds=null,b2BroadPhase.prototype.m_querySortKeys=new Array,b2BroadPhase.prototype.m_queryResults=new Array,b2BroadPhase.prototype.m_queryResultCount=0,b2BroadPhase.prototype.m_worldAABB=null,b2BroadPhase.prototype.m_quantizationFactor=new b2Vec2,b2BroadPhase.prototype.m_proxyCount=0,b2BroadPhase.prototype.m_timeStamp=0;var b2Manifold=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Manifold.prototype.__constructor=function(){this.m_points=new Array(b2Settings.b2_maxManifoldPoints);for(var a=0;a<b2Settings.b2_maxManifoldPoints;a++)this.m_points[a]=new b2ManifoldPoint;this.m_localPlaneNormal=new b2Vec2,this.m_localPoint=new b2Vec2},b2Manifold.prototype.__varz=function(){},b2Manifold.e_circles=1,b2Manifold.e_faceA=2,b2Manifold.e_faceB=4,b2Manifold.prototype.Reset=function(){for(var a=0;a<b2Settings.b2_maxManifoldPoints;a++)this.m_points[a].Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_type=0,this.m_pointCount=0},b2Manifold.prototype.Set=function(a){this.m_pointCount=a.m_pointCount;for(var b=0;b<b2Settings.b2_maxManifoldPoints;b++)this.m_points[b].Set(a.m_points[b]);this.m_localPlaneNormal.SetV(a.m_localPlaneNormal),this.m_localPoint.SetV(a.m_localPoint),this.m_type=a.m_type},b2Manifold.prototype.Copy=function(){var a=new b2Manifold;return a.Set(this),a},b2Manifold.prototype.m_points=null,b2Manifold.prototype.m_localPlaneNormal=null,b2Manifold.prototype.m_localPoint=null,b2Manifold.prototype.m_type=0,b2Manifold.prototype.m_pointCount=0;var b2CircleShape=function(){b2Shape.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2CircleShape.prototype,b2Shape.prototype),b2CircleShape.prototype._super=b2Shape.prototype,b2CircleShape.prototype.__constructor=function(a){this._super.__constructor.apply(this,[]),this.m_type=b2Shape.e_circleShape,this.m_radius=a},b2CircleShape.prototype.__varz=function(){this.m_p=new b2Vec2},b2CircleShape.prototype.Copy=function(){var a=new b2CircleShape;return a.Set(this),a},b2CircleShape.prototype.Set=function(a){if(this._super.Set.apply(this,[a]),isInstanceOf(a,b2CircleShape)){var b=a;this.m_p.SetV(b.m_p)}},b2CircleShape.prototype.TestPoint=function(a,b){var c=a.R,d=a.position.x+(c.col1.x*this.m_p.x+c.col2.x*this.m_p.y),e=a.position.y+(c.col1.y*this.m_p.x+c.col2.y*this.m_p.y);return d=b.x-d,e=b.y-e,d*d+e*e<=this.m_radius*this.m_radius},b2CircleShape.prototype.RayCast=function(a,b,c){var d,e=c.R,f=c.position.x+(e.col1.x*this.m_p.x+e.col2.x*this.m_p.y),g=c.position.y+(e.col1.y*this.m_p.x+e.col2.y*this.m_p.y),h=b.p1.x-f,i=b.p1.y-g,j=h*h+i*i-this.m_radius*this.m_radius,k=b.p2.x-b.p1.x,l=b.p2.y-b.p1.y,m=h*k+i*l,n=k*k+l*l,o=m*m-n*j;return 0>o||n<Number.MIN_VALUE?!1:(d=-(m+Math.sqrt(o)),d>=0&&d<=b.maxFraction*n?(d/=n,a.fraction=d,a.normal.x=h+d*k,a.normal.y=i+d*l,a.normal.Normalize(),!0):!1)},b2CircleShape.prototype.ComputeAABB=function(a,b){var c=b.R,d=b.position.x+(c.col1.x*this.m_p.x+c.col2.x*this.m_p.y),e=b.position.y+(c.col1.y*this.m_p.x+c.col2.y*this.m_p.y);a.lowerBound.Set(d-this.m_radius,e-this.m_radius),a.upperBound.Set(d+this.m_radius,e+this.m_radius)},b2CircleShape.prototype.ComputeMass=function(a,b){a.mass=b*b2Settings.b2_pi*this.m_radius*this.m_radius,a.center.SetV(this.m_p),a.I=a.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},b2CircleShape.prototype.ComputeSubmergedArea=function(a,b,c,d){var e=b2Math.MulX(c,this.m_p),f=-(b2Math.Dot(a,e)-b);if(f<-this.m_radius+Number.MIN_VALUE)return 0;if(f>this.m_radius)return d.SetV(e),Math.PI*this.m_radius*this.m_radius;var g=this.m_radius*this.m_radius,h=f*f,i=g*(Math.asin(f/this.m_radius)+Math.PI/2)+f*Math.sqrt(g-h),j=-2/3*Math.pow(g-h,1.5)/i;return d.x=e.x+a.x*j,d.y=e.y+a.y*j,i},b2CircleShape.prototype.GetLocalPosition=function(){return this.m_p},b2CircleShape.prototype.SetLocalPosition=function(a){this.m_p.SetV(a)},b2CircleShape.prototype.GetRadius=function(){return this.m_radius},b2CircleShape.prototype.SetRadius=function(a){this.m_radius=a},b2CircleShape.prototype.m_p=new b2Vec2;var b2Joint=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Joint.prototype.__constructor=function(a){b2Settings.b2Assert(a.bodyA!=a.bodyB),this.m_type=a.type,this.m_prev=null,this.m_next=null,this.m_bodyA=a.bodyA,this.m_bodyB=a.bodyB,this.m_collideConnected=a.collideConnected,this.m_islandFlag=!1,this.m_userData=a.userData},b2Joint.prototype.__varz=function(){this.m_edgeA=new b2JointEdge,this.m_edgeB=new b2JointEdge,this.m_localCenterA=new b2Vec2,this.m_localCenterB=new b2Vec2},b2Joint.Create=function(a,b){var c=null;switch(a.type){case b2Joint.e_distanceJoint:c=new b2DistanceJoint(a);break;case b2Joint.e_mouseJoint:c=new b2MouseJoint(a);break;case b2Joint.e_prismaticJoint:c=new b2PrismaticJoint(a);break;case b2Joint.e_revoluteJoint:c=new b2RevoluteJoint(a);break;case b2Joint.e_pulleyJoint:c=new b2PulleyJoint(a);break;case b2Joint.e_gearJoint:c=new b2GearJoint(a);break;case b2Joint.e_lineJoint:c=new b2LineJoint(a);break;case b2Joint.e_weldJoint:c=new b2WeldJoint(a);break;case b2Joint.e_frictionJoint:c=new b2FrictionJoint(a)}return c},b2Joint.Destroy=function(a,b){},b2Joint.e_unknownJoint=0,b2Joint.e_revoluteJoint=1,b2Joint.e_prismaticJoint=2,b2Joint.e_distanceJoint=3,b2Joint.e_pulleyJoint=4,b2Joint.e_mouseJoint=5,b2Joint.e_gearJoint=6,b2Joint.e_lineJoint=7,b2Joint.e_weldJoint=8,b2Joint.e_frictionJoint=9,b2Joint.e_inactiveLimit=0,b2Joint.e_atLowerLimit=1,b2Joint.e_atUpperLimit=2,b2Joint.e_equalLimits=3,b2Joint.prototype.InitVelocityConstraints=function(a){},b2Joint.prototype.SolveVelocityConstraints=function(a){},b2Joint.prototype.FinalizeVelocityConstraints=function(){},b2Joint.prototype.SolvePositionConstraints=function(a){return!1},b2Joint.prototype.GetType=function(){return this.m_type},b2Joint.prototype.GetAnchorA=function(){return null},b2Joint.prototype.GetAnchorB=function(){return null},b2Joint.prototype.GetReactionForce=function(a){return null},b2Joint.prototype.GetReactionTorque=function(a){return 0},b2Joint.prototype.GetBodyA=function(){return this.m_bodyA},b2Joint.prototype.GetBodyB=function(){return this.m_bodyB},b2Joint.prototype.GetNext=function(){return this.m_next},b2Joint.prototype.GetUserData=function(){return this.m_userData},b2Joint.prototype.SetUserData=function(a){this.m_userData=a},b2Joint.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},b2Joint.prototype.m_type=0,b2Joint.prototype.m_prev=null,b2Joint.prototype.m_next=null,b2Joint.prototype.m_edgeA=new b2JointEdge,b2Joint.prototype.m_edgeB=new b2JointEdge,b2Joint.prototype.m_bodyA=null,b2Joint.prototype.m_bodyB=null,b2Joint.prototype.m_islandFlag=null,b2Joint.prototype.m_collideConnected=null,b2Joint.prototype.m_userData=null,b2Joint.prototype.m_localCenterA=new b2Vec2,b2Joint.prototype.m_localCenterB=new b2Vec2,b2Joint.prototype.m_invMassA=null,
b2Joint.prototype.m_invMassB=null,b2Joint.prototype.m_invIA=null,b2Joint.prototype.m_invIB=null;var b2LineJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2LineJoint.prototype,b2Joint.prototype),b2LineJoint.prototype._super=b2Joint.prototype,b2LineJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]);this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_localXAxis1.SetV(a.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=a.lowerTranslation,this.m_upperTranslation=a.upperTranslation,this.m_maxMotorForce=a.maxMotorForce,this.m_motorSpeed=a.motorSpeed,this.m_enableLimit=a.enableLimit,this.m_enableMotor=a.enableMotor,this.m_limitState=b2Joint.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},b2LineJoint.prototype.__varz=function(){this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_localXAxis1=new b2Vec2,this.m_localYAxis1=new b2Vec2,this.m_axis=new b2Vec2,this.m_perp=new b2Vec2,this.m_K=new b2Mat22,this.m_impulse=new b2Vec2},b2LineJoint.prototype.InitVelocityConstraints=function(a){var b,c,d=this.m_bodyA,e=this.m_bodyB;this.m_localCenterA.SetV(d.GetLocalCenter()),this.m_localCenterB.SetV(e.GetLocalCenter());var f=d.GetTransform();e.GetTransform();b=d.m_xf.R;var g=this.m_localAnchor1.x-this.m_localCenterA.x,h=this.m_localAnchor1.y-this.m_localCenterA.y;c=b.col1.x*g+b.col2.x*h,h=b.col1.y*g+b.col2.y*h,g=c,b=e.m_xf.R;var i=this.m_localAnchor2.x-this.m_localCenterB.x,j=this.m_localAnchor2.y-this.m_localCenterB.y;c=b.col1.x*i+b.col2.x*j,j=b.col1.y*i+b.col2.y*j,i=c;var k=e.m_sweep.c.x+i-d.m_sweep.c.x-g,l=e.m_sweep.c.y+j-d.m_sweep.c.y-h;this.m_invMassA=d.m_invMass,this.m_invMassB=e.m_invMass,this.m_invIA=d.m_invI,this.m_invIB=e.m_invI,this.m_axis.SetV(b2Math.MulMV(f.R,this.m_localXAxis1)),this.m_a1=(k+g)*this.m_axis.y-(l+h)*this.m_axis.x,this.m_a2=i*this.m_axis.y-j*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(b2Math.MulMV(f.R,this.m_localYAxis1)),this.m_s1=(k+g)*this.m_perp.y-(l+h)*this.m_perp.x,this.m_s2=i*this.m_perp.y-j*this.m_perp.x;var m=this.m_invMassA,n=this.m_invMassB,o=this.m_invIA,p=this.m_invIB;if(this.m_K.col1.x=m+n+o*this.m_s1*this.m_s1+p*this.m_s2*this.m_s2,this.m_K.col1.y=o*this.m_s1*this.m_a1+p*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=m+n+o*this.m_a1*this.m_a1+p*this.m_a2*this.m_a2,this.m_enableLimit){var q=this.m_axis.x*k+this.m_axis.y*l;b2Math.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?this.m_limitState=b2Joint.e_equalLimits:q<=this.m_lowerTranslation?this.m_limitState!=b2Joint.e_atLowerLimit&&(this.m_limitState=b2Joint.e_atLowerLimit,this.m_impulse.y=0):q>=this.m_upperTranslation?this.m_limitState!=b2Joint.e_atUpperLimit&&(this.m_limitState=b2Joint.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=b2Joint.e_inactiveLimit,this.m_impulse.y=0)}else this.m_limitState=b2Joint.e_inactiveLimit;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),a.warmStarting){this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio;var r=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,s=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,t=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,u=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;d.m_linearVelocity.x-=this.m_invMassA*r,d.m_linearVelocity.y-=this.m_invMassA*s,d.m_angularVelocity-=this.m_invIA*t,e.m_linearVelocity.x+=this.m_invMassB*r,e.m_linearVelocity.y+=this.m_invMassB*s,e.m_angularVelocity+=this.m_invIB*u}else this.m_impulse.SetZero(),this.m_motorImpulse=0},b2LineJoint.prototype.SolveVelocityConstraints=function(a){var b,c,d,e,f=this.m_bodyA,g=this.m_bodyB,h=f.m_linearVelocity,i=f.m_angularVelocity,j=g.m_linearVelocity,k=g.m_angularVelocity;if(this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits){var l=this.m_axis.x*(j.x-h.x)+this.m_axis.y*(j.y-h.y)+this.m_a2*k-this.m_a1*i,m=this.m_motorMass*(this.m_motorSpeed-l),n=this.m_motorImpulse,o=a.dt*this.m_maxMotorForce;this.m_motorImpulse=b2Math.Clamp(this.m_motorImpulse+m,-o,o),m=this.m_motorImpulse-n,b=m*this.m_axis.x,c=m*this.m_axis.y,d=m*this.m_a1,e=m*this.m_a2,h.x-=this.m_invMassA*b,h.y-=this.m_invMassA*c,i-=this.m_invIA*d,j.x+=this.m_invMassB*b,j.y+=this.m_invMassB*c,k+=this.m_invIB*e}var p=this.m_perp.x*(j.x-h.x)+this.m_perp.y*(j.y-h.y)+this.m_s2*k-this.m_s1*i;if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){var q=this.m_axis.x*(j.x-h.x)+this.m_axis.y*(j.y-h.y)+this.m_a2*k-this.m_a1*i,r=this.m_impulse.Copy(),s=this.m_K.Solve(new b2Vec2,-p,-q);this.m_impulse.Add(s),this.m_limitState==b2Joint.e_atLowerLimit?this.m_impulse.y=b2Math.Max(this.m_impulse.y,0):this.m_limitState==b2Joint.e_atUpperLimit&&(this.m_impulse.y=b2Math.Min(this.m_impulse.y,0));var t,u=-p-(this.m_impulse.y-r.y)*this.m_K.col2.x;t=0!=this.m_K.col1.x?u/this.m_K.col1.x+r.x:r.x,this.m_impulse.x=t,s.x=this.m_impulse.x-r.x,s.y=this.m_impulse.y-r.y,b=s.x*this.m_perp.x+s.y*this.m_axis.x,c=s.x*this.m_perp.y+s.y*this.m_axis.y,d=s.x*this.m_s1+s.y*this.m_a1,e=s.x*this.m_s2+s.y*this.m_a2,h.x-=this.m_invMassA*b,h.y-=this.m_invMassA*c,i-=this.m_invIA*d,j.x+=this.m_invMassB*b,j.y+=this.m_invMassB*c,k+=this.m_invIB*e}else{var v;v=0!=this.m_K.col1.x?-p/this.m_K.col1.x:0,this.m_impulse.x+=v,b=v*this.m_perp.x,c=v*this.m_perp.y,d=v*this.m_s1,e=v*this.m_s2,h.x-=this.m_invMassA*b,h.y-=this.m_invMassA*c,i-=this.m_invIA*d,j.x+=this.m_invMassB*b,j.y+=this.m_invMassB*c,k+=this.m_invIB*e}f.m_linearVelocity.SetV(h),f.m_angularVelocity=i,g.m_linearVelocity.SetV(j),g.m_angularVelocity=k},b2LineJoint.prototype.SolvePositionConstraints=function(a){var b,c,d,e,f,g,h=this.m_bodyA,i=this.m_bodyB,j=h.m_sweep.c,k=h.m_sweep.a,l=i.m_sweep.c,m=i.m_sweep.a,n=0,o=0,p=!1,q=0,r=b2Mat22.FromAngle(k),s=b2Mat22.FromAngle(m);b=r;var t=this.m_localAnchor1.x-this.m_localCenterA.x,u=this.m_localAnchor1.y-this.m_localCenterA.y;c=b.col1.x*t+b.col2.x*u,u=b.col1.y*t+b.col2.y*u,t=c,b=s;var v=this.m_localAnchor2.x-this.m_localCenterB.x,w=this.m_localAnchor2.y-this.m_localCenterB.y;c=b.col1.x*v+b.col2.x*w,w=b.col1.y*v+b.col2.y*w,v=c;var x=l.x+v-j.x-t,y=l.y+w-j.y-u;if(this.m_enableLimit){this.m_axis=b2Math.MulMV(r,this.m_localXAxis1),this.m_a1=(x+t)*this.m_axis.y-(y+u)*this.m_axis.x,this.m_a2=v*this.m_axis.y-w*this.m_axis.x;var z=this.m_axis.x*x+this.m_axis.y*y;b2Math.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?(q=b2Math.Clamp(z,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection),n=b2Math.Abs(z),p=!0):z<=this.m_lowerTranslation?(q=b2Math.Clamp(z-this.m_lowerTranslation+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),n=this.m_lowerTranslation-z,p=!0):z>=this.m_upperTranslation&&(q=b2Math.Clamp(z-this.m_upperTranslation+b2Settings.b2_linearSlop,0,b2Settings.b2_maxLinearCorrection),n=z-this.m_upperTranslation,p=!0)}this.m_perp=b2Math.MulMV(r,this.m_localYAxis1),this.m_s1=(x+t)*this.m_perp.y-(y+u)*this.m_perp.x,this.m_s2=v*this.m_perp.y-w*this.m_perp.x;var A=new b2Vec2,B=this.m_perp.x*x+this.m_perp.y*y;if(n=b2Math.Max(n,b2Math.Abs(B)),o=0,p)d=this.m_invMassA,e=this.m_invMassB,f=this.m_invIA,g=this.m_invIB,this.m_K.col1.x=d+e+f*this.m_s1*this.m_s1+g*this.m_s2*this.m_s2,this.m_K.col1.y=f*this.m_s1*this.m_a1+g*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=d+e+f*this.m_a1*this.m_a1+g*this.m_a2*this.m_a2,this.m_K.Solve(A,-B,-q);else{d=this.m_invMassA,e=this.m_invMassB,f=this.m_invIA,g=this.m_invIB;var C,D=d+e+f*this.m_s1*this.m_s1+g*this.m_s2*this.m_s2;C=0!=D?-B/D:0,A.x=C,A.y=0}var E=A.x*this.m_perp.x+A.y*this.m_axis.x,F=A.x*this.m_perp.y+A.y*this.m_axis.y,G=A.x*this.m_s1+A.y*this.m_a1,H=A.x*this.m_s2+A.y*this.m_a2;return j.x-=this.m_invMassA*E,j.y-=this.m_invMassA*F,k-=this.m_invIA*G,l.x+=this.m_invMassB*E,l.y+=this.m_invMassB*F,m+=this.m_invIB*H,h.m_sweep.a=k,i.m_sweep.a=m,h.SynchronizeTransform(),i.SynchronizeTransform(),n<=b2Settings.b2_linearSlop&&o<=b2Settings.b2_angularSlop},b2LineJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2LineJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2LineJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},b2LineJoint.prototype.GetReactionTorque=function(a){return a*this.m_impulse.y},b2LineJoint.prototype.GetJointTranslation=function(){var a=this.m_bodyA,b=this.m_bodyB,c=a.GetWorldPoint(this.m_localAnchor1),d=b.GetWorldPoint(this.m_localAnchor2),e=d.x-c.x,f=d.y-c.y,g=a.GetWorldVector(this.m_localXAxis1),h=g.x*e+g.y*f;return h},b2LineJoint.prototype.GetJointSpeed=function(){var a,b=this.m_bodyA,c=this.m_bodyB;a=b.m_xf.R;var d=this.m_localAnchor1.x-b.m_sweep.localCenter.x,e=this.m_localAnchor1.y-b.m_sweep.localCenter.y,f=a.col1.x*d+a.col2.x*e;e=a.col1.y*d+a.col2.y*e,d=f,a=c.m_xf.R;var g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,h=this.m_localAnchor2.y-c.m_sweep.localCenter.y;f=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=f;var i=b.m_sweep.c.x+d,j=b.m_sweep.c.y+e,k=c.m_sweep.c.x+g,l=c.m_sweep.c.y+h,m=k-i,n=l-j,o=b.GetWorldVector(this.m_localXAxis1),p=b.m_linearVelocity,q=c.m_linearVelocity,r=b.m_angularVelocity,s=c.m_angularVelocity,t=m*-r*o.y+n*r*o.x+(o.x*(q.x+-s*h-p.x- -r*e)+o.y*(q.y+s*g-p.y-r*d));return t},b2LineJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},b2LineJoint.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=a},b2LineJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},b2LineJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation},b2LineJoint.prototype.SetLimits=function(a,b){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=a,this.m_upperTranslation=b},b2LineJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},b2LineJoint.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=a},b2LineJoint.prototype.SetMotorSpeed=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=a},b2LineJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},b2LineJoint.prototype.SetMaxMotorForce=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=a},b2LineJoint.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},b2LineJoint.prototype.GetMotorForce=function(){return this.m_motorImpulse},b2LineJoint.prototype.m_localAnchor1=new b2Vec2,b2LineJoint.prototype.m_localAnchor2=new b2Vec2,b2LineJoint.prototype.m_localXAxis1=new b2Vec2,b2LineJoint.prototype.m_localYAxis1=new b2Vec2,b2LineJoint.prototype.m_axis=new b2Vec2,b2LineJoint.prototype.m_perp=new b2Vec2,b2LineJoint.prototype.m_s1=null,b2LineJoint.prototype.m_s2=null,b2LineJoint.prototype.m_a1=null,b2LineJoint.prototype.m_a2=null,b2LineJoint.prototype.m_K=new b2Mat22,b2LineJoint.prototype.m_impulse=new b2Vec2,b2LineJoint.prototype.m_motorMass=null,b2LineJoint.prototype.m_motorImpulse=null,b2LineJoint.prototype.m_lowerTranslation=null,b2LineJoint.prototype.m_upperTranslation=null,b2LineJoint.prototype.m_maxMotorForce=null,b2LineJoint.prototype.m_motorSpeed=null,b2LineJoint.prototype.m_enableLimit=null,b2LineJoint.prototype.m_enableMotor=null,b2LineJoint.prototype.m_limitState=0;var b2ContactSolver=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactSolver.prototype.__constructor=function(){},b2ContactSolver.prototype.__varz=function(){this.m_step=new b2TimeStep,this.m_constraints=new Array},b2ContactSolver.s_worldManifold=new b2WorldManifold,b2ContactSolver.s_psm=new b2PositionSolverManifold,b2ContactSolver.prototype.Initialize=function(a,b,c,d){var e,f=0;for(this.m_step.Set(a),this.m_allocator=d,this.m_constraintCount=c;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new b2ContactConstraint;for(;c>f;++f){e=b[f];var g=e.m_fixtureA,h=e.m_fixtureB,i=g.m_shape,j=h.m_shape,k=i.m_radius,l=j.m_radius,m=g.m_body,n=h.m_body,o=e.GetManifold(),p=b2Settings.b2MixFriction(g.GetFriction(),h.GetFriction()),q=b2Settings.b2MixRestitution(g.GetRestitution(),h.GetRestitution()),r=m.m_linearVelocity.x,s=m.m_linearVelocity.y,t=n.m_linearVelocity.x,u=n.m_linearVelocity.y,v=m.m_angularVelocity,w=n.m_angularVelocity;b2Settings.b2Assert(o.m_pointCount>0),b2ContactSolver.s_worldManifold.Initialize(o,m.m_xf,k,n.m_xf,l);var x=b2ContactSolver.s_worldManifold.m_normal.x,y=b2ContactSolver.s_worldManifold.m_normal.y,z=this.m_constraints[f];z.bodyA=m,z.bodyB=n,z.manifold=o,z.normal.x=x,z.normal.y=y,z.pointCount=o.m_pointCount,z.friction=p,z.restitution=q,z.localPlaneNormal.x=o.m_localPlaneNormal.x,z.localPlaneNormal.y=o.m_localPlaneNormal.y,z.localPoint.x=o.m_localPoint.x,z.localPoint.y=o.m_localPoint.y,z.radius=k+l,z.type=o.m_type;for(var A=0;A<z.pointCount;++A){var B=o.m_points[A],C=z.points[A];C.normalImpulse=B.m_normalImpulse,C.tangentImpulse=B.m_tangentImpulse,C.localPoint.SetV(B.m_localPoint);var D=C.rA.x=b2ContactSolver.s_worldManifold.m_points[A].x-m.m_sweep.c.x,E=C.rA.y=b2ContactSolver.s_worldManifold.m_points[A].y-m.m_sweep.c.y,F=C.rB.x=b2ContactSolver.s_worldManifold.m_points[A].x-n.m_sweep.c.x,G=C.rB.y=b2ContactSolver.s_worldManifold.m_points[A].y-n.m_sweep.c.y,H=D*y-E*x,I=F*y-G*x;H*=H,I*=I;var J=m.m_invMass+n.m_invMass+m.m_invI*H+n.m_invI*I;C.normalMass=1/J;var K=m.m_mass*m.m_invMass+n.m_mass*n.m_invMass;K+=m.m_mass*m.m_invI*H+n.m_mass*n.m_invI*I,C.equalizedMass=1/K;var L=y,M=-x,N=D*M-E*L,O=F*M-G*L;N*=N,O*=O;var P=m.m_invMass+n.m_invMass+m.m_invI*N+n.m_invI*O;C.tangentMass=1/P,C.velocityBias=0;var Q=t+-w*G-r- -v*E,R=u+w*F-s-v*D,S=z.normal.x*Q+z.normal.y*R;S<-b2Settings.b2_velocityThreshold&&(C.velocityBias+=-z.restitution*S)}if(2==z.pointCount){var T=z.points[0],U=z.points[1],V=m.m_invMass,W=m.m_invI,X=n.m_invMass,Y=n.m_invI,Z=T.rA.x*y-T.rA.y*x,$=T.rB.x*y-T.rB.y*x,_=U.rA.x*y-U.rA.y*x,aa=U.rB.x*y-U.rB.y*x,ba=V+X+W*Z*Z+Y*$*$,ca=V+X+W*_*_+Y*aa*aa,da=V+X+W*Z*_+Y*$*aa,ea=100;ea*(ba*ca-da*da)>ba*ba?(z.K.col1.Set(ba,da),z.K.col2.Set(da,ca),z.K.GetInverse(z.normalMass)):z.pointCount=1}}},b2ContactSolver.prototype.InitVelocityConstraints=function(a){for(var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=0;r<this.m_constraintCount;++r)if(b=this.m_constraints[r],c=b.bodyA,d=b.bodyB,e=c.m_invMass,f=c.m_invI,g=d.m_invMass,h=d.m_invI,i=b.normal.x,j=b.normal.y,k=j,l=-i,n=0,a.warmStarting)for(n=b.pointCount,m=0;n>m;++m)o=b.points[m],o.normalImpulse*=a.dtRatio,o.tangentImpulse*=a.dtRatio,p=o.normalImpulse*i+o.tangentImpulse*k,q=o.normalImpulse*j+o.tangentImpulse*l,c.m_angularVelocity-=f*(o.rA.x*q-o.rA.y*p),c.m_linearVelocity.x-=e*p,c.m_linearVelocity.y-=e*q,d.m_angularVelocity+=h*(o.rB.x*q-o.rB.y*p),d.m_linearVelocity.x+=g*p,d.m_linearVelocity.y+=g*q;else for(n=b.pointCount,m=0;n>m;++m){var s=b.points[m];s.normalImpulse=0,s.tangentImpulse=0}},b2ContactSolver.prototype.SolveVelocityConstraints=function(){for(var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=0,s=0;s<this.m_constraintCount;++s){var t=this.m_constraints[s],u=t.bodyA,v=t.bodyB,w=u.m_angularVelocity,x=v.m_angularVelocity,y=u.m_linearVelocity,z=v.m_linearVelocity,A=u.m_invMass,B=u.m_invI,C=v.m_invMass,D=v.m_invI,E=t.normal.x,F=t.normal.y,G=F,H=-E,I=t.friction;for(r=0;r<t.pointCount;r++)a=t.points[r],b=z.x-x*a.rB.y-y.x+w*a.rA.y,c=z.y+x*a.rB.x-y.y-w*a.rA.x,e=b*G+c*H,f=a.tangentMass*-e,g=I*a.normalImpulse,h=b2Math.Clamp(a.tangentImpulse+f,-g,g),f=h-a.tangentImpulse,i=f*G,j=f*H,y.x-=A*i,y.y-=A*j,w-=B*(a.rA.x*j-a.rA.y*i),z.x+=C*i,z.y+=C*j,x+=D*(a.rB.x*j-a.rB.y*i),a.tangentImpulse=h;t.pointCount;if(1==t.pointCount)a=t.points[0],b=z.x+-x*a.rB.y-y.x- -w*a.rA.y,c=z.y+x*a.rB.x-y.y-w*a.rA.x,d=b*E+c*F,f=-a.normalMass*(d-a.velocityBias),h=a.normalImpulse+f,h=h>0?h:0,f=h-a.normalImpulse,i=f*E,j=f*F,y.x-=A*i,y.y-=A*j,w-=B*(a.rA.x*j-a.rA.y*i),z.x+=C*i,z.y+=C*j,x+=D*(a.rB.x*j-a.rB.y*i),a.normalImpulse=h;else{var J=t.points[0],K=t.points[1],L=J.normalImpulse,M=K.normalImpulse,N=z.x-x*J.rB.y-y.x+w*J.rA.y,O=z.y+x*J.rB.x-y.y-w*J.rA.x,P=z.x-x*K.rB.y-y.x+w*K.rA.y,Q=z.y+x*K.rB.x-y.y-w*K.rA.x,R=N*E+O*F,S=P*E+Q*F,T=R-J.velocityBias,U=S-K.velocityBias;q=t.K,T-=q.col1.x*L+q.col2.x*M,U-=q.col1.y*L+q.col2.y*M;for(;;){q=t.normalMass;var V=-(q.col1.x*T+q.col2.x*U),W=-(q.col1.y*T+q.col2.y*U);if(V>=0&&W>=0){k=V-L,l=W-M,m=k*E,n=k*F,o=l*E,p=l*F,y.x-=A*(m+o),y.y-=A*(n+p),w-=B*(J.rA.x*n-J.rA.y*m+K.rA.x*p-K.rA.y*o),z.x+=C*(m+o),z.y+=C*(n+p),x+=D*(J.rB.x*n-J.rB.y*m+K.rB.x*p-K.rB.y*o),J.normalImpulse=V,K.normalImpulse=W;break}if(V=-J.normalMass*T,W=0,R=0,S=t.K.col1.y*V+U,V>=0&&S>=0){k=V-L,l=W-M,m=k*E,n=k*F,o=l*E,p=l*F,y.x-=A*(m+o),y.y-=A*(n+p),w-=B*(J.rA.x*n-J.rA.y*m+K.rA.x*p-K.rA.y*o),z.x+=C*(m+o),z.y+=C*(n+p),x+=D*(J.rB.x*n-J.rB.y*m+K.rB.x*p-K.rB.y*o),J.normalImpulse=V,K.normalImpulse=W;break}if(V=0,W=-K.normalMass*U,R=t.K.col2.x*W+T,S=0,W>=0&&R>=0){k=V-L,l=W-M,m=k*E,n=k*F,o=l*E,p=l*F,y.x-=A*(m+o),y.y-=A*(n+p),w-=B*(J.rA.x*n-J.rA.y*m+K.rA.x*p-K.rA.y*o),z.x+=C*(m+o),z.y+=C*(n+p),x+=D*(J.rB.x*n-J.rB.y*m+K.rB.x*p-K.rB.y*o),J.normalImpulse=V,K.normalImpulse=W;break}if(V=0,W=0,R=T,S=U,R>=0&&S>=0){k=V-L,l=W-M,m=k*E,n=k*F,o=l*E,p=l*F,y.x-=A*(m+o),y.y-=A*(n+p),w-=B*(J.rA.x*n-J.rA.y*m+K.rA.x*p-K.rA.y*o),z.x+=C*(m+o),z.y+=C*(n+p),x+=D*(J.rB.x*n-J.rB.y*m+K.rB.x*p-K.rB.y*o),J.normalImpulse=V,K.normalImpulse=W;break}break}}u.m_angularVelocity=w,v.m_angularVelocity=x}},b2ContactSolver.prototype.FinalizeVelocityConstraints=function(){for(var a,b,c,d,e=0,f=0;e<this.m_constraintCount;++e)for(a=this.m_constraints[e],b=a.manifold,f=0;f<a.pointCount;++f)c=b.m_points[f],d=a.points[f],c.m_normalImpulse=d.normalImpulse,c.m_tangentImpulse=d.tangentImpulse},b2ContactSolver.prototype.SolvePositionConstraints=function(a){for(var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=0,w=0;w<this.m_constraintCount;w++)for(b=this.m_constraints[w],c=b.bodyA,d=b.bodyB,e=c.m_mass*c.m_invMass,f=c.m_mass*c.m_invI,g=d.m_mass*d.m_invMass,h=d.m_mass*d.m_invI,b2ContactSolver.s_psm.Initialize(b),i=b2ContactSolver.s_psm.m_normal,j=0;j<b.pointCount;j++)k=b.points[j],l=b2ContactSolver.s_psm.m_points[j],m=b2ContactSolver.s_psm.m_separations[j],n=l.x-c.m_sweep.c.x,o=l.y-c.m_sweep.c.y,p=l.x-d.m_sweep.c.x,q=l.y-d.m_sweep.c.y,v=m>v?v:m,r=b2Math.Clamp(a*(m+b2Settings.b2_linearSlop),-b2Settings.b2_maxLinearCorrection,0),s=-k.equalizedMass*r,t=s*i.x,u=s*i.y,c.m_sweep.c.x-=e*t,c.m_sweep.c.y-=e*u,c.m_sweep.a-=f*(n*u-o*t),c.SynchronizeTransform(),d.m_sweep.c.x+=g*t,d.m_sweep.c.y+=g*u,d.m_sweep.a+=h*(p*u-q*t),d.SynchronizeTransform();return v>-1.5*b2Settings.b2_linearSlop},b2ContactSolver.prototype.m_step=new b2TimeStep,b2ContactSolver.prototype.m_allocator=null,b2ContactSolver.prototype.m_constraints=new Array,b2ContactSolver.prototype.m_constraintCount=0;var b2Simplex=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Simplex.prototype.__constructor=function(){this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},b2Simplex.prototype.__varz=function(){this.m_v1=new b2SimplexVertex,this.m_v2=new b2SimplexVertex,this.m_v3=new b2SimplexVertex,this.m_vertices=new Array(3)},b2Simplex.prototype.ReadCache=function(a,b,c,d,e){b2Settings.b2Assert(0<=a.count&&a.count<=3);var f,g;this.m_count=a.count;for(var h=this.m_vertices,i=0;i<this.m_count;i++){var j=h[i];j.indexA=a.indexA[i],j.indexB=a.indexB[i],f=b.GetVertex(j.indexA),g=d.GetVertex(j.indexB),j.wA=b2Math.MulX(c,f),j.wB=b2Math.MulX(e,g),j.w=b2Math.SubtractVV(j.wB,j.wA),j.a=0}if(this.m_count>1){var k=a.metric,l=this.GetMetric();(.5*k>l||l>2*k||l<Number.MIN_VALUE)&&(this.m_count=0)}0==this.m_count&&(j=h[0],j.indexA=0,j.indexB=0,f=b.GetVertex(0),g=d.GetVertex(0),j.wA=b2Math.MulX(c,f),j.wB=b2Math.MulX(e,g),j.w=b2Math.SubtractVV(j.wB,j.wA),this.m_count=1)},b2Simplex.prototype.WriteCache=function(a){a.metric=this.GetMetric(),a.count=~~this.m_count;for(var b=this.m_vertices,c=0;c<this.m_count;c++)a.indexA[c]=~~b[c].indexA,a.indexB[c]=~~b[c].indexB},b2Simplex.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var a=b2Math.SubtractVV(this.m_v2.w,this.m_v1.w),b=b2Math.CrossVV(a,this.m_v1.w.GetNegative());return b>0?b2Math.CrossFV(1,a):b2Math.CrossVF(a,1);default:return b2Settings.b2Assert(!1),new b2Vec2}},b2Simplex.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return b2Settings.b2Assert(!1),new b2Vec2;case 1:return this.m_v1.w;case 2:return new b2Vec2(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return b2Settings.b2Assert(!1),new b2Vec2}},b2Simplex.prototype.GetWitnessPoints=function(a,b){switch(this.m_count){case 0:b2Settings.b2Assert(!1);break;case 1:a.SetV(this.m_v1.wA),b.SetV(this.m_v1.wB);break;case 2:a.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,a.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,b.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,b.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:b.x=a.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,b.y=a.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:b2Settings.b2Assert(!1)}},b2Simplex.prototype.GetMetric=function(){switch(this.m_count){case 0:return b2Settings.b2Assert(!1),0;case 1:return 0;case 2:return b2Math.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return b2Math.CrossVV(b2Math.SubtractVV(this.m_v2.w,this.m_v1.w),b2Math.SubtractVV(this.m_v3.w,this.m_v1.w));default:return b2Settings.b2Assert(!1),0}},b2Simplex.prototype.Solve2=function(){var a=this.m_v1.w,b=this.m_v2.w,c=b2Math.SubtractVV(b,a),d=-(a.x*c.x+a.y*c.y);if(0>=d)return this.m_v1.a=1,void(this.m_count=1);var e=b.x*c.x+b.y*c.y;if(0>=e)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Set(this.m_v2);var f=1/(e+d);this.m_v1.a=e*f,this.m_v2.a=d*f,this.m_count=2},b2Simplex.prototype.Solve3=function(){var a=this.m_v1.w,b=this.m_v2.w,c=this.m_v3.w,d=b2Math.SubtractVV(b,a),e=b2Math.Dot(a,d),f=b2Math.Dot(b,d),g=f,h=-e,i=b2Math.SubtractVV(c,a),j=b2Math.Dot(a,i),k=b2Math.Dot(c,i),l=k,m=-j,n=b2Math.SubtractVV(c,b),o=b2Math.Dot(b,n),p=b2Math.Dot(c,n),q=p,r=-o,s=b2Math.CrossVV(d,i),t=s*b2Math.CrossVV(b,c),u=s*b2Math.CrossVV(c,a),v=s*b2Math.CrossVV(a,b);if(0>=h&&0>=m)return this.m_v1.a=1,void(this.m_count=1);if(g>0&&h>0&&0>=v){var w=1/(g+h);return this.m_v1.a=g*w,this.m_v2.a=h*w,void(this.m_count=2)}if(l>0&&m>0&&0>=u){var x=1/(l+m);return this.m_v1.a=l*x,this.m_v3.a=m*x,this.m_count=2,void this.m_v2.Set(this.m_v3)}if(0>=g&&0>=r)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Set(this.m_v2);if(0>=l&&0>=q)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Set(this.m_v3);if(q>0&&r>0&&0>=t){var y=1/(q+r);return this.m_v2.a=q*y,this.m_v3.a=r*y,this.m_count=2,void this.m_v1.Set(this.m_v3)}var z=1/(t+u+v);this.m_v1.a=t*z,this.m_v2.a=u*z,this.m_v3.a=v*z,this.m_count=3},b2Simplex.prototype.m_v1=new b2SimplexVertex,b2Simplex.prototype.m_v2=new b2SimplexVertex,b2Simplex.prototype.m_v3=new b2SimplexVertex,b2Simplex.prototype.m_vertices=new Array(3),b2Simplex.prototype.m_count=0;var b2WeldJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2WeldJoint.prototype,b2Joint.prototype),b2WeldJoint.prototype._super=b2Joint.prototype,b2WeldJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]),this.m_localAnchorA.SetV(a.localAnchorA),this.m_localAnchorB.SetV(a.localAnchorB),this.m_referenceAngle=a.referenceAngle,this.m_impulse.SetZero(),this.m_mass=new b2Mat33},b2WeldJoint.prototype.__varz=function(){this.m_localAnchorA=new b2Vec2,this.m_localAnchorB=new b2Vec2,this.m_impulse=new b2Vec3,this.m_mass=new b2Mat33},b2WeldJoint.prototype.InitVelocityConstraints=function(a){var b,c,d=this.m_bodyA,e=this.m_bodyB;b=d.m_xf.R;var f=this.m_localAnchorA.x-d.m_sweep.localCenter.x,g=this.m_localAnchorA.y-d.m_sweep.localCenter.y;c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c,b=e.m_xf.R;var h=this.m_localAnchorB.x-e.m_sweep.localCenter.x,i=this.m_localAnchorB.y-e.m_sweep.localCenter.y;c=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=c;var j=d.m_invMass,k=e.m_invMass,l=d.m_invI,m=e.m_invI;this.m_mass.col1.x=j+k+g*g*l+i*i*m,this.m_mass.col2.x=-g*f*l-i*h*m,this.m_mass.col3.x=-g*l-i*m,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=j+k+f*f*l+h*h*m,this.m_mass.col3.y=f*l+h*m,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=l+m,a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_impulse.z*=a.dtRatio,d.m_linearVelocity.x-=j*this.m_impulse.x,d.m_linearVelocity.y-=j*this.m_impulse.y,d.m_angularVelocity-=l*(f*this.m_impulse.y-g*this.m_impulse.x+this.m_impulse.z),e.m_linearVelocity.x+=k*this.m_impulse.x,e.m_linearVelocity.y+=k*this.m_impulse.y,e.m_angularVelocity+=m*(h*this.m_impulse.y-i*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},b2WeldJoint.prototype.SolveVelocityConstraints=function(a){var b,c,d=this.m_bodyA,e=this.m_bodyB,f=d.m_linearVelocity,g=d.m_angularVelocity,h=e.m_linearVelocity,i=e.m_angularVelocity,j=d.m_invMass,k=e.m_invMass,l=d.m_invI,m=e.m_invI;b=d.m_xf.R;var n=this.m_localAnchorA.x-d.m_sweep.localCenter.x,o=this.m_localAnchorA.y-d.m_sweep.localCenter.y;c=b.col1.x*n+b.col2.x*o,o=b.col1.y*n+b.col2.y*o,n=c,b=e.m_xf.R;var p=this.m_localAnchorB.x-e.m_sweep.localCenter.x,q=this.m_localAnchorB.y-e.m_sweep.localCenter.y;c=b.col1.x*p+b.col2.x*q,q=b.col1.y*p+b.col2.y*q,p=c;var r=h.x-i*q-f.x+g*o,s=h.y+i*p-f.y-g*n,t=i-g,u=new b2Vec3;this.m_mass.Solve33(u,-r,-s,-t),this.m_impulse.Add(u),f.x-=j*u.x,f.y-=j*u.y,g-=l*(n*u.y-o*u.x+u.z),h.x+=k*u.x,h.y+=k*u.y,i+=m*(p*u.y-q*u.x+u.z),d.m_angularVelocity=g,e.m_angularVelocity=i},b2WeldJoint.prototype.SolvePositionConstraints=function(a){var b,c,d=this.m_bodyA,e=this.m_bodyB;b=d.m_xf.R;var f=this.m_localAnchorA.x-d.m_sweep.localCenter.x,g=this.m_localAnchorA.y-d.m_sweep.localCenter.y;c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c,b=e.m_xf.R;var h=this.m_localAnchorB.x-e.m_sweep.localCenter.x,i=this.m_localAnchorB.y-e.m_sweep.localCenter.y;c=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=c;var j=d.m_invMass,k=e.m_invMass,l=d.m_invI,m=e.m_invI,n=e.m_sweep.c.x+h-d.m_sweep.c.x-f,o=e.m_sweep.c.y+i-d.m_sweep.c.y-g,p=e.m_sweep.a-d.m_sweep.a-this.m_referenceAngle,q=10*b2Settings.b2_linearSlop,r=Math.sqrt(n*n+o*o),s=b2Math.Abs(p);r>q&&(l*=1,m*=1),this.m_mass.col1.x=j+k+g*g*l+i*i*m,this.m_mass.col2.x=-g*f*l-i*h*m,this.m_mass.col3.x=-g*l-i*m,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=j+k+f*f*l+h*h*m,this.m_mass.col3.y=f*l+h*m,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=l+m;var t=new b2Vec3;return this.m_mass.Solve33(t,-n,-o,-p),d.m_sweep.c.x-=j*t.x,d.m_sweep.c.y-=j*t.y,d.m_sweep.a-=l*(f*t.y-g*t.x+t.z),e.m_sweep.c.x+=k*t.x,e.m_sweep.c.y+=k*t.y,e.m_sweep.a+=m*(h*t.y-i*t.x+t.z),d.SynchronizeTransform(),e.SynchronizeTransform(),r<=b2Settings.b2_linearSlop&&s<=b2Settings.b2_angularSlop},b2WeldJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},b2WeldJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},b2WeldJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*this.m_impulse.x,a*this.m_impulse.y)},b2WeldJoint.prototype.GetReactionTorque=function(a){return a*this.m_impulse.z},b2WeldJoint.prototype.m_localAnchorA=new b2Vec2,b2WeldJoint.prototype.m_localAnchorB=new b2Vec2,b2WeldJoint.prototype.m_referenceAngle=null,b2WeldJoint.prototype.m_impulse=new b2Vec3,b2WeldJoint.prototype.m_mass=new b2Mat33;var b2Math=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Math.prototype.__constructor=function(){},b2Math.prototype.__varz=function(){},b2Math.IsValid=function(a){return isFinite(a)},b2Math.Dot=function(a,b){return a.x*b.x+a.y*b.y},b2Math.CrossVV=function(a,b){return a.x*b.y-a.y*b.x},b2Math.CrossVF=function(a,b){var c=new b2Vec2(b*a.y,-b*a.x);return c},b2Math.CrossFV=function(a,b){var c=new b2Vec2(-a*b.y,a*b.x);return c},b2Math.MulMV=function(a,b){var c=new b2Vec2(a.col1.x*b.x+a.col2.x*b.y,a.col1.y*b.x+a.col2.y*b.y);return c},b2Math.MulTMV=function(a,b){var c=new b2Vec2(b2Math.Dot(b,a.col1),b2Math.Dot(b,a.col2));return c},b2Math.MulX=function(a,b){var c=b2Math.MulMV(a.R,b);return c.x+=a.position.x,c.y+=a.position.y,c},b2Math.MulXT=function(a,b){var c=b2Math.SubtractVV(b,a.position),d=c.x*a.R.col1.x+c.y*a.R.col1.y;return c.y=c.x*a.R.col2.x+c.y*a.R.col2.y,c.x=d,c},b2Math.AddVV=function(a,b){var c=new b2Vec2(a.x+b.x,a.y+b.y);return c},b2Math.SubtractVV=function(a,b){var c=new b2Vec2(a.x-b.x,a.y-b.y);return c},b2Math.Distance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)},b2Math.DistanceSquared=function(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d},b2Math.MulFV=function(a,b){var c=new b2Vec2(a*b.x,a*b.y);return c},b2Math.AddMM=function(a,b){var c=b2Mat22.FromVV(b2Math.AddVV(a.col1,b.col1),b2Math.AddVV(a.col2,b.col2));return c},b2Math.MulMM=function(a,b){var c=b2Mat22.FromVV(b2Math.MulMV(a,b.col1),b2Math.MulMV(a,b.col2));return c},b2Math.MulTMM=function(a,b){var c=new b2Vec2(b2Math.Dot(a.col1,b.col1),b2Math.Dot(a.col2,b.col1)),d=new b2Vec2(b2Math.Dot(a.col1,b.col2),b2Math.Dot(a.col2,b.col2)),e=b2Mat22.FromVV(c,d);return e},b2Math.Abs=function(a){return a>0?a:-a},b2Math.AbsV=function(a){var b=new b2Vec2(b2Math.Abs(a.x),b2Math.Abs(a.y));return b},b2Math.AbsM=function(a){var b=b2Mat22.FromVV(b2Math.AbsV(a.col1),b2Math.AbsV(a.col2));return b},b2Math.Min=function(a,b){return b>a?a:b},b2Math.MinV=function(a,b){var c=new b2Vec2(b2Math.Min(a.x,b.x),b2Math.Min(a.y,b.y));return c},b2Math.Max=function(a,b){return a>b?a:b},b2Math.MaxV=function(a,b){var c=new b2Vec2(b2Math.Max(a.x,b.x),b2Math.Max(a.y,b.y));return c},b2Math.Clamp=function(a,b,c){return b>a?b:a>c?c:a},b2Math.ClampV=function(a,b,c){return b2Math.MaxV(b,b2Math.MinV(a,c))},b2Math.Swap=function(a,b){var c=a[0];a[0]=b[0],b[0]=c},b2Math.Random=function(){return 2*Math.random()-1},b2Math.RandomRange=function(a,b){var c=Math.random();return c=(b-a)*c+a},b2Math.NextPowerOfTwo=function(a){return a|=a>>1&2147483647,a|=a>>2&1073741823,a|=a>>4&268435455,a|=a>>8&16777215,a|=a>>16&65535,a+1},b2Math.IsPowerOfTwo=function(a){var b=a>0&&0==(a&a-1);return b},b2Math.b2Vec2_zero=new b2Vec2(0,0),b2Math.b2Mat22_identity=b2Mat22.FromVV(new b2Vec2(1,0),new b2Vec2(0,1)),b2Math.b2Transform_identity=new b2Transform(b2Math.b2Vec2_zero,b2Math.b2Mat22_identity);var b2PulleyJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PulleyJoint.prototype,b2Joint.prototype),b2PulleyJoint.prototype._super=b2Joint.prototype,b2PulleyJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]);this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=a.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=a.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=a.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=a.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_ratio=a.ratio,this.m_constant=a.lengthA+this.m_ratio*a.lengthB,this.m_maxLength1=b2Math.Min(a.maxLengthA,this.m_constant-this.m_ratio*b2PulleyJoint.b2_minPulleyLength),
this.m_maxLength2=b2Math.Min(a.maxLengthB,(this.m_constant-b2PulleyJoint.b2_minPulleyLength)/this.m_ratio),this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},b2PulleyJoint.prototype.__varz=function(){this.m_groundAnchor1=new b2Vec2,this.m_groundAnchor2=new b2Vec2,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_u1=new b2Vec2,this.m_u2=new b2Vec2},b2PulleyJoint.b2_minPulleyLength=2,b2PulleyJoint.prototype.InitVelocityConstraints=function(a){var b,c=this.m_bodyA,d=this.m_bodyB;b=c.m_xf.R;var e=this.m_localAnchor1.x-c.m_sweep.localCenter.x,f=this.m_localAnchor1.y-c.m_sweep.localCenter.y,g=b.col1.x*e+b.col2.x*f;f=b.col1.y*e+b.col2.y*f,e=g,b=d.m_xf.R;var h=this.m_localAnchor2.x-d.m_sweep.localCenter.x,i=this.m_localAnchor2.y-d.m_sweep.localCenter.y;g=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=g;var j=c.m_sweep.c.x+e,k=c.m_sweep.c.y+f,l=d.m_sweep.c.x+h,m=d.m_sweep.c.y+i,n=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,o=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,p=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,q=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(j-n,k-o),this.m_u2.Set(l-p,m-q);var r=this.m_u1.Length(),s=this.m_u2.Length();r>b2Settings.b2_linearSlop?this.m_u1.Multiply(1/r):this.m_u1.SetZero(),s>b2Settings.b2_linearSlop?this.m_u2.Multiply(1/s):this.m_u2.SetZero();var t=this.m_constant-r-this.m_ratio*s;t>0?(this.m_state=b2Joint.e_inactiveLimit,this.m_impulse=0):this.m_state=b2Joint.e_atUpperLimit,r<this.m_maxLength1?(this.m_limitState1=b2Joint.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=b2Joint.e_atUpperLimit,s<this.m_maxLength2?(this.m_limitState2=b2Joint.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=b2Joint.e_atUpperLimit;var u=e*this.m_u1.y-f*this.m_u1.x,v=h*this.m_u2.y-i*this.m_u2.x;if(this.m_limitMass1=c.m_invMass+c.m_invI*u*u,this.m_limitMass2=d.m_invMass+d.m_invI*v*v,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,a.warmStarting){this.m_impulse*=a.dtRatio,this.m_limitImpulse1*=a.dtRatio,this.m_limitImpulse2*=a.dtRatio;var w=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,x=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,y=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,z=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;c.m_linearVelocity.x+=c.m_invMass*w,c.m_linearVelocity.y+=c.m_invMass*x,c.m_angularVelocity+=c.m_invI*(e*x-f*w),d.m_linearVelocity.x+=d.m_invMass*y,d.m_linearVelocity.y+=d.m_invMass*z,d.m_angularVelocity+=d.m_invI*(h*z-i*y)}else this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},b2PulleyJoint.prototype.SolveVelocityConstraints=function(a){var b,c=this.m_bodyA,d=this.m_bodyB;b=c.m_xf.R;var e=this.m_localAnchor1.x-c.m_sweep.localCenter.x,f=this.m_localAnchor1.y-c.m_sweep.localCenter.y,g=b.col1.x*e+b.col2.x*f;f=b.col1.y*e+b.col2.y*f,e=g,b=d.m_xf.R;var h=this.m_localAnchor2.x-d.m_sweep.localCenter.x,i=this.m_localAnchor2.y-d.m_sweep.localCenter.y;g=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=g;var j,k,l,m,n,o,p,q,r,s,t;this.m_state==b2Joint.e_atUpperLimit&&(j=c.m_linearVelocity.x+-c.m_angularVelocity*f,k=c.m_linearVelocity.y+c.m_angularVelocity*e,l=d.m_linearVelocity.x+-d.m_angularVelocity*i,m=d.m_linearVelocity.y+d.m_angularVelocity*h,r=-(this.m_u1.x*j+this.m_u1.y*k)-this.m_ratio*(this.m_u2.x*l+this.m_u2.y*m),s=this.m_pulleyMass*-r,t=this.m_impulse,this.m_impulse=b2Math.Max(0,this.m_impulse+s),s=this.m_impulse-t,n=-s*this.m_u1.x,o=-s*this.m_u1.y,p=-this.m_ratio*s*this.m_u2.x,q=-this.m_ratio*s*this.m_u2.y,c.m_linearVelocity.x+=c.m_invMass*n,c.m_linearVelocity.y+=c.m_invMass*o,c.m_angularVelocity+=c.m_invI*(e*o-f*n),d.m_linearVelocity.x+=d.m_invMass*p,d.m_linearVelocity.y+=d.m_invMass*q,d.m_angularVelocity+=d.m_invI*(h*q-i*p)),this.m_limitState1==b2Joint.e_atUpperLimit&&(j=c.m_linearVelocity.x+-c.m_angularVelocity*f,k=c.m_linearVelocity.y+c.m_angularVelocity*e,r=-(this.m_u1.x*j+this.m_u1.y*k),s=-this.m_limitMass1*r,t=this.m_limitImpulse1,this.m_limitImpulse1=b2Math.Max(0,this.m_limitImpulse1+s),s=this.m_limitImpulse1-t,n=-s*this.m_u1.x,o=-s*this.m_u1.y,c.m_linearVelocity.x+=c.m_invMass*n,c.m_linearVelocity.y+=c.m_invMass*o,c.m_angularVelocity+=c.m_invI*(e*o-f*n)),this.m_limitState2==b2Joint.e_atUpperLimit&&(l=d.m_linearVelocity.x+-d.m_angularVelocity*i,m=d.m_linearVelocity.y+d.m_angularVelocity*h,r=-(this.m_u2.x*l+this.m_u2.y*m),s=-this.m_limitMass2*r,t=this.m_limitImpulse2,this.m_limitImpulse2=b2Math.Max(0,this.m_limitImpulse2+s),s=this.m_limitImpulse2-t,p=-s*this.m_u2.x,q=-s*this.m_u2.y,d.m_linearVelocity.x+=d.m_invMass*p,d.m_linearVelocity.y+=d.m_invMass*q,d.m_angularVelocity+=d.m_invI*(h*q-i*p))},b2PulleyJoint.prototype.SolvePositionConstraints=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p=this.m_bodyA,q=this.m_bodyB,r=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,s=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,t=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,u=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,v=0;return this.m_state==b2Joint.e_atUpperLimit&&(b=p.m_xf.R,c=this.m_localAnchor1.x-p.m_sweep.localCenter.x,d=this.m_localAnchor1.y-p.m_sweep.localCenter.y,o=b.col1.x*c+b.col2.x*d,d=b.col1.y*c+b.col2.y*d,c=o,b=q.m_xf.R,e=this.m_localAnchor2.x-q.m_sweep.localCenter.x,f=this.m_localAnchor2.y-q.m_sweep.localCenter.y,o=b.col1.x*e+b.col2.x*f,f=b.col1.y*e+b.col2.y*f,e=o,g=p.m_sweep.c.x+c,h=p.m_sweep.c.y+d,i=q.m_sweep.c.x+e,j=q.m_sweep.c.y+f,this.m_u1.Set(g-r,h-s),this.m_u2.Set(i-t,j-u),k=this.m_u1.Length(),l=this.m_u2.Length(),k>b2Settings.b2_linearSlop?this.m_u1.Multiply(1/k):this.m_u1.SetZero(),l>b2Settings.b2_linearSlop?this.m_u2.Multiply(1/l):this.m_u2.SetZero(),m=this.m_constant-k-this.m_ratio*l,v=b2Math.Max(v,-m),m=b2Math.Clamp(m+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),n=-this.m_pulleyMass*m,g=-n*this.m_u1.x,h=-n*this.m_u1.y,i=-this.m_ratio*n*this.m_u2.x,j=-this.m_ratio*n*this.m_u2.y,p.m_sweep.c.x+=p.m_invMass*g,p.m_sweep.c.y+=p.m_invMass*h,p.m_sweep.a+=p.m_invI*(c*h-d*g),q.m_sweep.c.x+=q.m_invMass*i,q.m_sweep.c.y+=q.m_invMass*j,q.m_sweep.a+=q.m_invI*(e*j-f*i),p.SynchronizeTransform(),q.SynchronizeTransform()),this.m_limitState1==b2Joint.e_atUpperLimit&&(b=p.m_xf.R,c=this.m_localAnchor1.x-p.m_sweep.localCenter.x,d=this.m_localAnchor1.y-p.m_sweep.localCenter.y,o=b.col1.x*c+b.col2.x*d,d=b.col1.y*c+b.col2.y*d,c=o,g=p.m_sweep.c.x+c,h=p.m_sweep.c.y+d,this.m_u1.Set(g-r,h-s),k=this.m_u1.Length(),k>b2Settings.b2_linearSlop?(this.m_u1.x*=1/k,this.m_u1.y*=1/k):this.m_u1.SetZero(),m=this.m_maxLength1-k,v=b2Math.Max(v,-m),m=b2Math.Clamp(m+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),n=-this.m_limitMass1*m,g=-n*this.m_u1.x,h=-n*this.m_u1.y,p.m_sweep.c.x+=p.m_invMass*g,p.m_sweep.c.y+=p.m_invMass*h,p.m_sweep.a+=p.m_invI*(c*h-d*g),p.SynchronizeTransform()),this.m_limitState2==b2Joint.e_atUpperLimit&&(b=q.m_xf.R,e=this.m_localAnchor2.x-q.m_sweep.localCenter.x,f=this.m_localAnchor2.y-q.m_sweep.localCenter.y,o=b.col1.x*e+b.col2.x*f,f=b.col1.y*e+b.col2.y*f,e=o,i=q.m_sweep.c.x+e,j=q.m_sweep.c.y+f,this.m_u2.Set(i-t,j-u),l=this.m_u2.Length(),l>b2Settings.b2_linearSlop?(this.m_u2.x*=1/l,this.m_u2.y*=1/l):this.m_u2.SetZero(),m=this.m_maxLength2-l,v=b2Math.Max(v,-m),m=b2Math.Clamp(m+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),n=-this.m_limitMass2*m,i=-n*this.m_u2.x,j=-n*this.m_u2.y,q.m_sweep.c.x+=q.m_invMass*i,q.m_sweep.c.y+=q.m_invMass*j,q.m_sweep.a+=q.m_invI*(e*j-f*i),q.SynchronizeTransform()),v<b2Settings.b2_linearSlop},b2PulleyJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2PulleyJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2PulleyJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*this.m_impulse*this.m_u2.x,a*this.m_impulse*this.m_u2.y)},b2PulleyJoint.prototype.GetReactionTorque=function(a){return 0},b2PulleyJoint.prototype.GetGroundAnchorA=function(){var a=this.m_ground.m_xf.position.Copy();return a.Add(this.m_groundAnchor1),a},b2PulleyJoint.prototype.GetGroundAnchorB=function(){var a=this.m_ground.m_xf.position.Copy();return a.Add(this.m_groundAnchor2),a},b2PulleyJoint.prototype.GetLength1=function(){var a=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),b=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,c=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,d=a.x-b,e=a.y-c;return Math.sqrt(d*d+e*e)},b2PulleyJoint.prototype.GetLength2=function(){var a=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),b=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,c=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,d=a.x-b,e=a.y-c;return Math.sqrt(d*d+e*e)},b2PulleyJoint.prototype.GetRatio=function(){return this.m_ratio},b2PulleyJoint.prototype.m_ground=null,b2PulleyJoint.prototype.m_groundAnchor1=new b2Vec2,b2PulleyJoint.prototype.m_groundAnchor2=new b2Vec2,b2PulleyJoint.prototype.m_localAnchor1=new b2Vec2,b2PulleyJoint.prototype.m_localAnchor2=new b2Vec2,b2PulleyJoint.prototype.m_u1=new b2Vec2,b2PulleyJoint.prototype.m_u2=new b2Vec2,b2PulleyJoint.prototype.m_constant=null,b2PulleyJoint.prototype.m_ratio=null,b2PulleyJoint.prototype.m_maxLength1=null,b2PulleyJoint.prototype.m_maxLength2=null,b2PulleyJoint.prototype.m_pulleyMass=null,b2PulleyJoint.prototype.m_limitMass1=null,b2PulleyJoint.prototype.m_limitMass2=null,b2PulleyJoint.prototype.m_impulse=null,b2PulleyJoint.prototype.m_limitImpulse1=null,b2PulleyJoint.prototype.m_limitImpulse2=null,b2PulleyJoint.prototype.m_state=0,b2PulleyJoint.prototype.m_limitState1=0,b2PulleyJoint.prototype.m_limitState2=0;var b2PrismaticJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PrismaticJoint.prototype,b2Joint.prototype),b2PrismaticJoint.prototype._super=b2Joint.prototype,b2PrismaticJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]);this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_localXAxis1.SetV(a.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=a.referenceAngle,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=a.lowerTranslation,this.m_upperTranslation=a.upperTranslation,this.m_maxMotorForce=a.maxMotorForce,this.m_motorSpeed=a.motorSpeed,this.m_enableLimit=a.enableLimit,this.m_enableMotor=a.enableMotor,this.m_limitState=b2Joint.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},b2PrismaticJoint.prototype.__varz=function(){this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_localXAxis1=new b2Vec2,this.m_localYAxis1=new b2Vec2,this.m_axis=new b2Vec2,this.m_perp=new b2Vec2,this.m_K=new b2Mat33,this.m_impulse=new b2Vec3},b2PrismaticJoint.prototype.InitVelocityConstraints=function(a){var b,c,d=this.m_bodyA,e=this.m_bodyB;this.m_localCenterA.SetV(d.GetLocalCenter()),this.m_localCenterB.SetV(e.GetLocalCenter());var f=d.GetTransform();e.GetTransform();b=d.m_xf.R;var g=this.m_localAnchor1.x-this.m_localCenterA.x,h=this.m_localAnchor1.y-this.m_localCenterA.y;c=b.col1.x*g+b.col2.x*h,h=b.col1.y*g+b.col2.y*h,g=c,b=e.m_xf.R;var i=this.m_localAnchor2.x-this.m_localCenterB.x,j=this.m_localAnchor2.y-this.m_localCenterB.y;c=b.col1.x*i+b.col2.x*j,j=b.col1.y*i+b.col2.y*j,i=c;var k=e.m_sweep.c.x+i-d.m_sweep.c.x-g,l=e.m_sweep.c.y+j-d.m_sweep.c.y-h;this.m_invMassA=d.m_invMass,this.m_invMassB=e.m_invMass,this.m_invIA=d.m_invI,this.m_invIB=e.m_invI,this.m_axis.SetV(b2Math.MulMV(f.R,this.m_localXAxis1)),this.m_a1=(k+g)*this.m_axis.y-(l+h)*this.m_axis.x,this.m_a2=i*this.m_axis.y-j*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),this.m_perp.SetV(b2Math.MulMV(f.R,this.m_localYAxis1)),this.m_s1=(k+g)*this.m_perp.y-(l+h)*this.m_perp.x,this.m_s2=i*this.m_perp.y-j*this.m_perp.x;var m=this.m_invMassA,n=this.m_invMassB,o=this.m_invIA,p=this.m_invIB;if(this.m_K.col1.x=m+n+o*this.m_s1*this.m_s1+p*this.m_s2*this.m_s2,this.m_K.col1.y=o*this.m_s1+p*this.m_s2,this.m_K.col1.z=o*this.m_s1*this.m_a1+p*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=o+p,this.m_K.col2.z=o*this.m_a1+p*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=m+n+o*this.m_a1*this.m_a1+p*this.m_a2*this.m_a2,this.m_enableLimit){var q=this.m_axis.x*k+this.m_axis.y*l;b2Math.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?this.m_limitState=b2Joint.e_equalLimits:q<=this.m_lowerTranslation?this.m_limitState!=b2Joint.e_atLowerLimit&&(this.m_limitState=b2Joint.e_atLowerLimit,this.m_impulse.z=0):q>=this.m_upperTranslation?this.m_limitState!=b2Joint.e_atUpperLimit&&(this.m_limitState=b2Joint.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=b2Joint.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=b2Joint.e_inactiveLimit;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),a.warmStarting){this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio;var r=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,s=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,t=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,u=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;d.m_linearVelocity.x-=this.m_invMassA*r,d.m_linearVelocity.y-=this.m_invMassA*s,d.m_angularVelocity-=this.m_invIA*t,e.m_linearVelocity.x+=this.m_invMassB*r,e.m_linearVelocity.y+=this.m_invMassB*s,e.m_angularVelocity+=this.m_invIB*u}else this.m_impulse.SetZero(),this.m_motorImpulse=0},b2PrismaticJoint.prototype.SolveVelocityConstraints=function(a){var b,c,d,e,f=this.m_bodyA,g=this.m_bodyB,h=f.m_linearVelocity,i=f.m_angularVelocity,j=g.m_linearVelocity,k=g.m_angularVelocity;if(this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits){var l=this.m_axis.x*(j.x-h.x)+this.m_axis.y*(j.y-h.y)+this.m_a2*k-this.m_a1*i,m=this.m_motorMass*(this.m_motorSpeed-l),n=this.m_motorImpulse,o=a.dt*this.m_maxMotorForce;this.m_motorImpulse=b2Math.Clamp(this.m_motorImpulse+m,-o,o),m=this.m_motorImpulse-n,b=m*this.m_axis.x,c=m*this.m_axis.y,d=m*this.m_a1,e=m*this.m_a2,h.x-=this.m_invMassA*b,h.y-=this.m_invMassA*c,i-=this.m_invIA*d,j.x+=this.m_invMassB*b,j.y+=this.m_invMassB*c,k+=this.m_invIB*e}var p=this.m_perp.x*(j.x-h.x)+this.m_perp.y*(j.y-h.y)+this.m_s2*k-this.m_s1*i,q=k-i;if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){var r=this.m_axis.x*(j.x-h.x)+this.m_axis.y*(j.y-h.y)+this.m_a2*k-this.m_a1*i,s=this.m_impulse.Copy(),t=this.m_K.Solve33(new b2Vec3,-p,-q,-r);this.m_impulse.Add(t),this.m_limitState==b2Joint.e_atLowerLimit?this.m_impulse.z=b2Math.Max(this.m_impulse.z,0):this.m_limitState==b2Joint.e_atUpperLimit&&(this.m_impulse.z=b2Math.Min(this.m_impulse.z,0));var u=-p-(this.m_impulse.z-s.z)*this.m_K.col3.x,v=-q-(this.m_impulse.z-s.z)*this.m_K.col3.y,w=this.m_K.Solve22(new b2Vec2,u,v);w.x+=s.x,w.y+=s.y,this.m_impulse.x=w.x,this.m_impulse.y=w.y,t.x=this.m_impulse.x-s.x,t.y=this.m_impulse.y-s.y,t.z=this.m_impulse.z-s.z,b=t.x*this.m_perp.x+t.z*this.m_axis.x,c=t.x*this.m_perp.y+t.z*this.m_axis.y,d=t.x*this.m_s1+t.y+t.z*this.m_a1,e=t.x*this.m_s2+t.y+t.z*this.m_a2,h.x-=this.m_invMassA*b,h.y-=this.m_invMassA*c,i-=this.m_invIA*d,j.x+=this.m_invMassB*b,j.y+=this.m_invMassB*c,k+=this.m_invIB*e}else{var x=this.m_K.Solve22(new b2Vec2,-p,-q);this.m_impulse.x+=x.x,this.m_impulse.y+=x.y,b=x.x*this.m_perp.x,c=x.x*this.m_perp.y,d=x.x*this.m_s1+x.y,e=x.x*this.m_s2+x.y,h.x-=this.m_invMassA*b,h.y-=this.m_invMassA*c,i-=this.m_invIA*d,j.x+=this.m_invMassB*b,j.y+=this.m_invMassB*c,k+=this.m_invIB*e}f.m_linearVelocity.SetV(h),f.m_angularVelocity=i,g.m_linearVelocity.SetV(j),g.m_angularVelocity=k},b2PrismaticJoint.prototype.SolvePositionConstraints=function(a){var b,c,d,e,f,g,h=this.m_bodyA,i=this.m_bodyB,j=h.m_sweep.c,k=h.m_sweep.a,l=i.m_sweep.c,m=i.m_sweep.a,n=0,o=0,p=!1,q=0,r=b2Mat22.FromAngle(k),s=b2Mat22.FromAngle(m);b=r;var t=this.m_localAnchor1.x-this.m_localCenterA.x,u=this.m_localAnchor1.y-this.m_localCenterA.y;c=b.col1.x*t+b.col2.x*u,u=b.col1.y*t+b.col2.y*u,t=c,b=s;var v=this.m_localAnchor2.x-this.m_localCenterB.x,w=this.m_localAnchor2.y-this.m_localCenterB.y;c=b.col1.x*v+b.col2.x*w,w=b.col1.y*v+b.col2.y*w,v=c;var x=l.x+v-j.x-t,y=l.y+w-j.y-u;if(this.m_enableLimit){this.m_axis=b2Math.MulMV(r,this.m_localXAxis1),this.m_a1=(x+t)*this.m_axis.y-(y+u)*this.m_axis.x,this.m_a2=v*this.m_axis.y-w*this.m_axis.x;var z=this.m_axis.x*x+this.m_axis.y*y;b2Math.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?(q=b2Math.Clamp(z,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection),n=b2Math.Abs(z),p=!0):z<=this.m_lowerTranslation?(q=b2Math.Clamp(z-this.m_lowerTranslation+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),n=this.m_lowerTranslation-z,p=!0):z>=this.m_upperTranslation&&(q=b2Math.Clamp(z-this.m_upperTranslation+b2Settings.b2_linearSlop,0,b2Settings.b2_maxLinearCorrection),n=z-this.m_upperTranslation,p=!0)}this.m_perp=b2Math.MulMV(r,this.m_localYAxis1),this.m_s1=(x+t)*this.m_perp.y-(y+u)*this.m_perp.x,this.m_s2=v*this.m_perp.y-w*this.m_perp.x;var A=new b2Vec3,B=this.m_perp.x*x+this.m_perp.y*y,C=m-k-this.m_refAngle;if(n=b2Math.Max(n,b2Math.Abs(B)),o=b2Math.Abs(C),p)d=this.m_invMassA,e=this.m_invMassB,f=this.m_invIA,g=this.m_invIB,this.m_K.col1.x=d+e+f*this.m_s1*this.m_s1+g*this.m_s2*this.m_s2,this.m_K.col1.y=f*this.m_s1+g*this.m_s2,this.m_K.col1.z=f*this.m_s1*this.m_a1+g*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=f+g,this.m_K.col2.z=f*this.m_a1+g*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=d+e+f*this.m_a1*this.m_a1+g*this.m_a2*this.m_a2,this.m_K.Solve33(A,-B,-C,-q);else{d=this.m_invMassA,e=this.m_invMassB,f=this.m_invIA,g=this.m_invIB;var D=d+e+f*this.m_s1*this.m_s1+g*this.m_s2*this.m_s2,E=f*this.m_s1+g*this.m_s2,F=f+g;this.m_K.col1.Set(D,E,0),this.m_K.col2.Set(E,F,0);var G=this.m_K.Solve22(new b2Vec2,-B,-C);A.x=G.x,A.y=G.y,A.z=0}var H=A.x*this.m_perp.x+A.z*this.m_axis.x,I=A.x*this.m_perp.y+A.z*this.m_axis.y,J=A.x*this.m_s1+A.y+A.z*this.m_a1,K=A.x*this.m_s2+A.y+A.z*this.m_a2;return j.x-=this.m_invMassA*H,j.y-=this.m_invMassA*I,k-=this.m_invIA*J,l.x+=this.m_invMassB*H,l.y+=this.m_invMassB*I,m+=this.m_invIB*K,h.m_sweep.a=k,i.m_sweep.a=m,h.SynchronizeTransform(),i.SynchronizeTransform(),n<=b2Settings.b2_linearSlop&&o<=b2Settings.b2_angularSlop},b2PrismaticJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2PrismaticJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2PrismaticJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},b2PrismaticJoint.prototype.GetReactionTorque=function(a){return a*this.m_impulse.y},b2PrismaticJoint.prototype.GetJointTranslation=function(){var a=this.m_bodyA,b=this.m_bodyB,c=a.GetWorldPoint(this.m_localAnchor1),d=b.GetWorldPoint(this.m_localAnchor2),e=d.x-c.x,f=d.y-c.y,g=a.GetWorldVector(this.m_localXAxis1),h=g.x*e+g.y*f;return h},b2PrismaticJoint.prototype.GetJointSpeed=function(){var a,b=this.m_bodyA,c=this.m_bodyB;a=b.m_xf.R;var d=this.m_localAnchor1.x-b.m_sweep.localCenter.x,e=this.m_localAnchor1.y-b.m_sweep.localCenter.y,f=a.col1.x*d+a.col2.x*e;e=a.col1.y*d+a.col2.y*e,d=f,a=c.m_xf.R;var g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,h=this.m_localAnchor2.y-c.m_sweep.localCenter.y;f=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=f;var i=b.m_sweep.c.x+d,j=b.m_sweep.c.y+e,k=c.m_sweep.c.x+g,l=c.m_sweep.c.y+h,m=k-i,n=l-j,o=b.GetWorldVector(this.m_localXAxis1),p=b.m_linearVelocity,q=c.m_linearVelocity,r=b.m_angularVelocity,s=c.m_angularVelocity,t=m*-r*o.y+n*r*o.x+(o.x*(q.x+-s*h-p.x- -r*e)+o.y*(q.y+s*g-p.y-r*d));return t},b2PrismaticJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},b2PrismaticJoint.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=a},b2PrismaticJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},b2PrismaticJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation},b2PrismaticJoint.prototype.SetLimits=function(a,b){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=a,this.m_upperTranslation=b},b2PrismaticJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},b2PrismaticJoint.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=a},b2PrismaticJoint.prototype.SetMotorSpeed=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=a},b2PrismaticJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},b2PrismaticJoint.prototype.SetMaxMotorForce=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=a},b2PrismaticJoint.prototype.GetMotorForce=function(){return this.m_motorImpulse},b2PrismaticJoint.prototype.m_localAnchor1=new b2Vec2,b2PrismaticJoint.prototype.m_localAnchor2=new b2Vec2,b2PrismaticJoint.prototype.m_localXAxis1=new b2Vec2,b2PrismaticJoint.prototype.m_localYAxis1=new b2Vec2,b2PrismaticJoint.prototype.m_refAngle=null,b2PrismaticJoint.prototype.m_axis=new b2Vec2,b2PrismaticJoint.prototype.m_perp=new b2Vec2,b2PrismaticJoint.prototype.m_s1=null,b2PrismaticJoint.prototype.m_s2=null,b2PrismaticJoint.prototype.m_a1=null,b2PrismaticJoint.prototype.m_a2=null,b2PrismaticJoint.prototype.m_K=new b2Mat33,b2PrismaticJoint.prototype.m_impulse=new b2Vec3,b2PrismaticJoint.prototype.m_motorMass=null,b2PrismaticJoint.prototype.m_motorImpulse=null,b2PrismaticJoint.prototype.m_lowerTranslation=null,b2PrismaticJoint.prototype.m_upperTranslation=null,b2PrismaticJoint.prototype.m_maxMotorForce=null,b2PrismaticJoint.prototype.m_motorSpeed=null,b2PrismaticJoint.prototype.m_enableLimit=null,b2PrismaticJoint.prototype.m_enableMotor=null,b2PrismaticJoint.prototype.m_limitState=0;var b2RevoluteJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2RevoluteJoint.prototype,b2Joint.prototype),b2RevoluteJoint.prototype._super=b2Joint.prototype,b2RevoluteJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]),this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_referenceAngle=a.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=a.lowerAngle,this.m_upperAngle=a.upperAngle,this.m_maxMotorTorque=a.maxMotorTorque,this.m_motorSpeed=a.motorSpeed,this.m_enableLimit=a.enableLimit,this.m_enableMotor=a.enableMotor,this.m_limitState=b2Joint.e_inactiveLimit},b2RevoluteJoint.prototype.__varz=function(){this.K=new b2Mat22,this.K1=new b2Mat22,this.K2=new b2Mat22,this.K3=new b2Mat22,this.impulse3=new b2Vec3,this.impulse2=new b2Vec2,this.reduced=new b2Vec2,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_impulse=new b2Vec3,this.m_mass=new b2Mat33},b2RevoluteJoint.tImpulse=new b2Vec2,b2RevoluteJoint.prototype.InitVelocityConstraints=function(a){var b,c,d=this.m_bodyA,e=this.m_bodyB;this.m_enableMotor||this.m_enableLimit,b=d.m_xf.R;var f=this.m_localAnchor1.x-d.m_sweep.localCenter.x,g=this.m_localAnchor1.y-d.m_sweep.localCenter.y;c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c,b=e.m_xf.R;var h=this.m_localAnchor2.x-e.m_sweep.localCenter.x,i=this.m_localAnchor2.y-e.m_sweep.localCenter.y;c=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=c;var j=d.m_invMass,k=e.m_invMass,l=d.m_invI,m=e.m_invI;if(this.m_mass.col1.x=j+k+g*g*l+i*i*m,this.m_mass.col2.x=-g*f*l-i*h*m,this.m_mass.col3.x=-g*l-i*m,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=j+k+f*f*l+h*h*m,this.m_mass.col3.y=f*l+h*m,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=l+m,this.m_motorMass=1/(l+m),0==this.m_enableMotor&&(this.m_motorImpulse=0),this.m_enableLimit){var n=e.m_sweep.a-d.m_sweep.a-this.m_referenceAngle;b2Math.Abs(this.m_upperAngle-this.m_lowerAngle)<2*b2Settings.b2_angularSlop?this.m_limitState=b2Joint.e_equalLimits:n<=this.m_lowerAngle?(this.m_limitState!=b2Joint.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=b2Joint.e_atLowerLimit):n>=this.m_upperAngle?(this.m_limitState!=b2Joint.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=b2Joint.e_atUpperLimit):(this.m_limitState=b2Joint.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=b2Joint.e_inactiveLimit;if(a.warmStarting){this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio;var o=this.m_impulse.x,p=this.m_impulse.y;d.m_linearVelocity.x-=j*o,d.m_linearVelocity.y-=j*p,d.m_angularVelocity-=l*(f*p-g*o+this.m_motorImpulse+this.m_impulse.z),e.m_linearVelocity.x+=k*o,e.m_linearVelocity.y+=k*p,e.m_angularVelocity+=m*(h*p-i*o+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0},b2RevoluteJoint.prototype.SolveVelocityConstraints=function(a){var b,c,d,e,f,g,h,i=this.m_bodyA,j=this.m_bodyB,k=i.m_linearVelocity,l=i.m_angularVelocity,m=j.m_linearVelocity,n=j.m_angularVelocity,o=i.m_invMass,p=j.m_invMass,q=i.m_invI,r=j.m_invI;if(this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits){var s=n-l-this.m_motorSpeed,t=this.m_motorMass*-s,u=this.m_motorImpulse,v=a.dt*this.m_maxMotorTorque;this.m_motorImpulse=b2Math.Clamp(this.m_motorImpulse+t,-v,v),t=this.m_motorImpulse-u,l-=q*t,n+=r*t}if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){b=i.m_xf.R,e=this.m_localAnchor1.x-i.m_sweep.localCenter.x,f=this.m_localAnchor1.y-i.m_sweep.localCenter.y,c=b.col1.x*e+b.col2.x*f,f=b.col1.y*e+b.col2.y*f,e=c,b=j.m_xf.R,g=this.m_localAnchor2.x-j.m_sweep.localCenter.x,h=this.m_localAnchor2.y-j.m_sweep.localCenter.y,c=b.col1.x*g+b.col2.x*h,h=b.col1.y*g+b.col2.y*h,g=c;var w=m.x+-n*h-k.x- -l*f,x=m.y+n*g-k.y-l*e,y=n-l;this.m_mass.Solve33(this.impulse3,-w,-x,-y),this.m_limitState==b2Joint.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==b2Joint.e_atLowerLimit?(d=this.m_impulse.z+this.impulse3.z,0>d&&(this.m_mass.Solve22(this.reduced,-w,-x),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==b2Joint.e_atUpperLimit&&(d=this.m_impulse.z+this.impulse3.z,d>0&&(this.m_mass.Solve22(this.reduced,-w,-x),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)),k.x-=o*this.impulse3.x,k.y-=o*this.impulse3.y,l-=q*(e*this.impulse3.y-f*this.impulse3.x+this.impulse3.z),m.x+=p*this.impulse3.x,m.y+=p*this.impulse3.y,n+=r*(g*this.impulse3.y-h*this.impulse3.x+this.impulse3.z)}else{b=i.m_xf.R,e=this.m_localAnchor1.x-i.m_sweep.localCenter.x,f=this.m_localAnchor1.y-i.m_sweep.localCenter.y,c=b.col1.x*e+b.col2.x*f,f=b.col1.y*e+b.col2.y*f,e=c,b=j.m_xf.R,g=this.m_localAnchor2.x-j.m_sweep.localCenter.x,h=this.m_localAnchor2.y-j.m_sweep.localCenter.y,c=b.col1.x*g+b.col2.x*h,h=b.col1.y*g+b.col2.y*h,g=c;var z=m.x+-n*h-k.x- -l*f,A=m.y+n*g-k.y-l*e;this.m_mass.Solve22(this.impulse2,-z,-A),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,k.x-=o*this.impulse2.x,k.y-=o*this.impulse2.y,l-=q*(e*this.impulse2.y-f*this.impulse2.x),m.x+=p*this.impulse2.x,m.y+=p*this.impulse2.y,n+=r*(g*this.impulse2.y-h*this.impulse2.x)}i.m_linearVelocity.SetV(k),i.m_angularVelocity=l,j.m_linearVelocity.SetV(m),j.m_angularVelocity=n},b2RevoluteJoint.prototype.SolvePositionConstraints=function(a){var b,c,d,e,f,g=this.m_bodyA,h=this.m_bodyB,i=0,j=0;if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){var k=h.m_sweep.a-g.m_sweep.a-this.m_referenceAngle,l=0;this.m_limitState==b2Joint.e_equalLimits?(b=b2Math.Clamp(k-this.m_lowerAngle,-b2Settings.b2_maxAngularCorrection,b2Settings.b2_maxAngularCorrection),l=-this.m_motorMass*b,i=b2Math.Abs(b)):this.m_limitState==b2Joint.e_atLowerLimit?(b=k-this.m_lowerAngle,i=-b,b=b2Math.Clamp(b+b2Settings.b2_angularSlop,-b2Settings.b2_maxAngularCorrection,0),l=-this.m_motorMass*b):this.m_limitState==b2Joint.e_atUpperLimit&&(b=k-this.m_upperAngle,i=b,b=b2Math.Clamp(b-b2Settings.b2_angularSlop,0,b2Settings.b2_maxAngularCorrection),l=-this.m_motorMass*b),g.m_sweep.a-=g.m_invI*l,h.m_sweep.a+=h.m_invI*l,g.SynchronizeTransform(),h.SynchronizeTransform()}c=g.m_xf.R;var m=this.m_localAnchor1.x-g.m_sweep.localCenter.x,n=this.m_localAnchor1.y-g.m_sweep.localCenter.y;d=c.col1.x*m+c.col2.x*n,n=c.col1.y*m+c.col2.y*n,m=d,c=h.m_xf.R;var o=this.m_localAnchor2.x-h.m_sweep.localCenter.x,p=this.m_localAnchor2.y-h.m_sweep.localCenter.y;d=c.col1.x*o+c.col2.x*p,p=c.col1.y*o+c.col2.y*p,o=d;var q=h.m_sweep.c.x+o-g.m_sweep.c.x-m,r=h.m_sweep.c.y+p-g.m_sweep.c.y-n,s=q*q+r*r,t=Math.sqrt(s);j=t;var u=g.m_invMass,v=h.m_invMass,w=g.m_invI,x=h.m_invI,y=10*b2Settings.b2_linearSlop;if(s>y*y){var z=u+v,A=1/z;e=A*-q,f=A*-r;var B=.5;g.m_sweep.c.x-=B*u*e,g.m_sweep.c.y-=B*u*f,h.m_sweep.c.x+=B*v*e,h.m_sweep.c.y+=B*v*f,q=h.m_sweep.c.x+o-g.m_sweep.c.x-m,r=h.m_sweep.c.y+p-g.m_sweep.c.y-n}return this.K1.col1.x=u+v,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=u+v,this.K2.col1.x=w*n*n,this.K2.col2.x=-w*m*n,this.K2.col1.y=-w*m*n,this.K2.col2.y=w*m*m,this.K3.col1.x=x*p*p,this.K3.col2.x=-x*o*p,this.K3.col1.y=-x*o*p,this.K3.col2.y=x*o*o,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(b2RevoluteJoint.tImpulse,-q,-r),e=b2RevoluteJoint.tImpulse.x,f=b2RevoluteJoint.tImpulse.y,g.m_sweep.c.x-=g.m_invMass*e,g.m_sweep.c.y-=g.m_invMass*f,g.m_sweep.a-=g.m_invI*(m*f-n*e),h.m_sweep.c.x+=h.m_invMass*e,h.m_sweep.c.y+=h.m_invMass*f,h.m_sweep.a+=h.m_invI*(o*f-p*e),g.SynchronizeTransform(),h.SynchronizeTransform(),j<=b2Settings.b2_linearSlop&&i<=b2Settings.b2_angularSlop},b2RevoluteJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2RevoluteJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2RevoluteJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*this.m_impulse.x,a*this.m_impulse.y)},b2RevoluteJoint.prototype.GetReactionTorque=function(a){return a*this.m_impulse.z},b2RevoluteJoint.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},b2RevoluteJoint.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},b2RevoluteJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},b2RevoluteJoint.prototype.EnableLimit=function(a){this.m_enableLimit=a},b2RevoluteJoint.prototype.GetLowerLimit=function(){return this.m_lowerAngle},b2RevoluteJoint.prototype.GetUpperLimit=function(){return this.m_upperAngle},b2RevoluteJoint.prototype.SetLimits=function(a,b){this.m_lowerAngle=a,this.m_upperAngle=b},b2RevoluteJoint.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},b2RevoluteJoint.prototype.EnableMotor=function(a){this.m_enableMotor=a},b2RevoluteJoint.prototype.SetMotorSpeed=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=a},b2RevoluteJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},b2RevoluteJoint.prototype.SetMaxMotorTorque=function(a){this.m_maxMotorTorque=a},b2RevoluteJoint.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},b2RevoluteJoint.prototype.K=new b2Mat22,
b2RevoluteJoint.prototype.K1=new b2Mat22,b2RevoluteJoint.prototype.K2=new b2Mat22,b2RevoluteJoint.prototype.K3=new b2Mat22,b2RevoluteJoint.prototype.impulse3=new b2Vec3,b2RevoluteJoint.prototype.impulse2=new b2Vec2,b2RevoluteJoint.prototype.reduced=new b2Vec2,b2RevoluteJoint.prototype.m_localAnchor1=new b2Vec2,b2RevoluteJoint.prototype.m_localAnchor2=new b2Vec2,b2RevoluteJoint.prototype.m_impulse=new b2Vec3,b2RevoluteJoint.prototype.m_motorImpulse=null,b2RevoluteJoint.prototype.m_mass=new b2Mat33,b2RevoluteJoint.prototype.m_motorMass=null,b2RevoluteJoint.prototype.m_enableMotor=null,b2RevoluteJoint.prototype.m_maxMotorTorque=null,b2RevoluteJoint.prototype.m_motorSpeed=null,b2RevoluteJoint.prototype.m_enableLimit=null,b2RevoluteJoint.prototype.m_referenceAngle=null,b2RevoluteJoint.prototype.m_lowerAngle=null,b2RevoluteJoint.prototype.m_upperAngle=null,b2RevoluteJoint.prototype.m_limitState=0;var b2JointDef=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2JointDef.prototype.__constructor=function(){this.type=b2Joint.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},b2JointDef.prototype.__varz=function(){},b2JointDef.prototype.type=0,b2JointDef.prototype.userData=null,b2JointDef.prototype.bodyA=null,b2JointDef.prototype.bodyB=null,b2JointDef.prototype.collideConnected=null;var b2LineJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2LineJointDef.prototype,b2JointDef.prototype),b2LineJointDef.prototype._super=b2JointDef.prototype,b2LineJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},b2LineJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2,this.localAxisA=new b2Vec2},b2LineJointDef.prototype.Initialize=function(a,b,c,d){this.bodyA=a,this.bodyB=b,this.localAnchorA=this.bodyA.GetLocalPoint(c),this.localAnchorB=this.bodyB.GetLocalPoint(c),this.localAxisA=this.bodyA.GetLocalVector(d)},b2LineJointDef.prototype.localAnchorA=new b2Vec2,b2LineJointDef.prototype.localAnchorB=new b2Vec2,b2LineJointDef.prototype.localAxisA=new b2Vec2,b2LineJointDef.prototype.enableLimit=null,b2LineJointDef.prototype.lowerTranslation=null,b2LineJointDef.prototype.upperTranslation=null,b2LineJointDef.prototype.enableMotor=null,b2LineJointDef.prototype.maxMotorForce=null,b2LineJointDef.prototype.motorSpeed=null;var b2DistanceJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2DistanceJoint.prototype,b2Joint.prototype),b2DistanceJoint.prototype._super=b2Joint.prototype,b2DistanceJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]);this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_length=a.length,this.m_frequencyHz=a.frequencyHz,this.m_dampingRatio=a.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0},b2DistanceJoint.prototype.__varz=function(){this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_u=new b2Vec2},b2DistanceJoint.prototype.InitVelocityConstraints=function(a){var b,c,d,e,f,g,h,i,j,k,l=this.m_bodyA,m=this.m_bodyB;if(b=l.m_xf.R,d=this.m_localAnchor1.x-l.m_sweep.localCenter.x,e=this.m_localAnchor1.y-l.m_sweep.localCenter.y,c=b.col1.x*d+b.col2.x*e,e=b.col1.y*d+b.col2.y*e,d=c,b=m.m_xf.R,f=this.m_localAnchor2.x-m.m_sweep.localCenter.x,g=this.m_localAnchor2.y-m.m_sweep.localCenter.y,c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c,this.m_u.x=m.m_sweep.c.x+f-l.m_sweep.c.x-d,this.m_u.y=m.m_sweep.c.y+g-l.m_sweep.c.y-e,h=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y),h>b2Settings.b2_linearSlop?this.m_u.Multiply(1/h):this.m_u.SetZero(),i=d*this.m_u.y-e*this.m_u.x,j=f*this.m_u.y-g*this.m_u.x,k=l.m_invMass+l.m_invI*i*i+m.m_invMass+m.m_invI*j*j,this.m_mass=0!=k?1/k:0,this.m_frequencyHz>0){var n=h-this.m_length,o=2*Math.PI*this.m_frequencyHz,p=2*this.m_mass*this.m_dampingRatio*o,q=this.m_mass*o*o;this.m_gamma=a.dt*(p+a.dt*q),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=n*a.dt*q*this.m_gamma,this.m_mass=k+this.m_gamma,this.m_mass=0!=this.m_mass?1/this.m_mass:0}if(a.warmStarting){this.m_impulse*=a.dtRatio;var r=this.m_impulse*this.m_u.x,s=this.m_impulse*this.m_u.y;l.m_linearVelocity.x-=l.m_invMass*r,l.m_linearVelocity.y-=l.m_invMass*s,l.m_angularVelocity-=l.m_invI*(d*s-e*r),m.m_linearVelocity.x+=m.m_invMass*r,m.m_linearVelocity.y+=m.m_invMass*s,m.m_angularVelocity+=m.m_invI*(f*s-g*r)}else this.m_impulse=0},b2DistanceJoint.prototype.SolveVelocityConstraints=function(a){var b,c,d,e,f,g,h,i,j,k=this.m_bodyA,l=this.m_bodyB,m=k.m_xf.R,n=l.m_xf.R,o=this.m_localAnchor1.x-k.m_sweep.localCenter.x,p=this.m_localAnchor1.y-k.m_sweep.localCenter.y,q=this.m_localAnchor2.x-l.m_sweep.localCenter.x,r=this.m_localAnchor2.y-l.m_sweep.localCenter.y;b=m.col1.x*o+m.col2.x*p,p=m.col1.y*o+m.col2.y*p,o=b,b=n.col1.x*q+n.col2.x*r,r=n.col1.y*q+n.col2.y*r,q=b,c=k.m_linearVelocity.x+-k.m_angularVelocity*p,d=k.m_linearVelocity.y+k.m_angularVelocity*o,e=l.m_linearVelocity.x+-l.m_angularVelocity*r,f=l.m_linearVelocity.y+l.m_angularVelocity*q,g=this.m_u.x*(e-c)+this.m_u.y*(f-d),h=-this.m_mass*(g+this.m_bias+this.m_gamma*this.m_impulse),this.m_impulse+=h,i=h*this.m_u.x,j=h*this.m_u.y,k.m_linearVelocity.x-=k.m_invMass*i,k.m_linearVelocity.y-=k.m_invMass*j,k.m_angularVelocity-=k.m_invI*(o*j-p*i),l.m_linearVelocity.x+=l.m_invMass*i,l.m_linearVelocity.y+=l.m_invMass*j,l.m_angularVelocity+=l.m_invI*(q*j-r*i)},b2DistanceJoint.prototype.SolvePositionConstraints=function(a){var b;if(this.m_frequencyHz>0)return!0;var c=this.m_bodyA,d=this.m_bodyB;b=c.m_xf.R;var e=this.m_localAnchor1.x-c.m_sweep.localCenter.x,f=this.m_localAnchor1.y-c.m_sweep.localCenter.y,g=b.col1.x*e+b.col2.x*f;f=b.col1.y*e+b.col2.y*f,e=g,b=d.m_xf.R;var h=this.m_localAnchor2.x-d.m_sweep.localCenter.x,i=this.m_localAnchor2.y-d.m_sweep.localCenter.y;g=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=g;var j=d.m_sweep.c.x+h-c.m_sweep.c.x-e,k=d.m_sweep.c.y+i-c.m_sweep.c.y-f,l=Math.sqrt(j*j+k*k);j/=l,k/=l;var m=l-this.m_length;m=b2Math.Clamp(m,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);var n=-this.m_mass*m;this.m_u.Set(j,k);var o=n*this.m_u.x,p=n*this.m_u.y;return c.m_sweep.c.x-=c.m_invMass*o,c.m_sweep.c.y-=c.m_invMass*p,c.m_sweep.a-=c.m_invI*(e*p-f*o),d.m_sweep.c.x+=d.m_invMass*o,d.m_sweep.c.y+=d.m_invMass*p,d.m_sweep.a+=d.m_invI*(h*p-i*o),c.SynchronizeTransform(),d.SynchronizeTransform(),b2Math.Abs(m)<b2Settings.b2_linearSlop},b2DistanceJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2DistanceJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2DistanceJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*this.m_impulse*this.m_u.x,a*this.m_impulse*this.m_u.y)},b2DistanceJoint.prototype.GetReactionTorque=function(a){return 0},b2DistanceJoint.prototype.GetLength=function(){return this.m_length},b2DistanceJoint.prototype.SetLength=function(a){this.m_length=a},b2DistanceJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},b2DistanceJoint.prototype.SetFrequency=function(a){this.m_frequencyHz=a},b2DistanceJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},b2DistanceJoint.prototype.SetDampingRatio=function(a){this.m_dampingRatio=a},b2DistanceJoint.prototype.m_localAnchor1=new b2Vec2,b2DistanceJoint.prototype.m_localAnchor2=new b2Vec2,b2DistanceJoint.prototype.m_u=new b2Vec2,b2DistanceJoint.prototype.m_frequencyHz=null,b2DistanceJoint.prototype.m_dampingRatio=null,b2DistanceJoint.prototype.m_gamma=null,b2DistanceJoint.prototype.m_bias=null,b2DistanceJoint.prototype.m_impulse=null,b2DistanceJoint.prototype.m_mass=null,b2DistanceJoint.prototype.m_length=null;var b2PulleyJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PulleyJointDef.prototype,b2JointDef.prototype),b2PulleyJointDef.prototype._super=b2JointDef.prototype,b2PulleyJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.lengthA=0,this.maxLengthA=0,this.lengthB=0,this.maxLengthB=0,this.ratio=1,this.collideConnected=!0},b2PulleyJointDef.prototype.__varz=function(){this.groundAnchorA=new b2Vec2,this.groundAnchorB=new b2Vec2,this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2PulleyJointDef.prototype.Initialize=function(a,b,c,d,e,f,g){this.bodyA=a,this.bodyB=b,this.groundAnchorA.SetV(c),this.groundAnchorB.SetV(d),this.localAnchorA=this.bodyA.GetLocalPoint(e),this.localAnchorB=this.bodyB.GetLocalPoint(f);var h=e.x-c.x,i=e.y-c.y;this.lengthA=Math.sqrt(h*h+i*i);var j=f.x-d.x,k=f.y-d.y;this.lengthB=Math.sqrt(j*j+k*k),this.ratio=g;var l=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=l-this.ratio*b2PulleyJoint.b2_minPulleyLength,this.maxLengthB=(l-b2PulleyJoint.b2_minPulleyLength)/this.ratio},b2PulleyJointDef.prototype.groundAnchorA=new b2Vec2,b2PulleyJointDef.prototype.groundAnchorB=new b2Vec2,b2PulleyJointDef.prototype.localAnchorA=new b2Vec2,b2PulleyJointDef.prototype.localAnchorB=new b2Vec2,b2PulleyJointDef.prototype.lengthA=null,b2PulleyJointDef.prototype.maxLengthA=null,b2PulleyJointDef.prototype.lengthB=null,b2PulleyJointDef.prototype.maxLengthB=null,b2PulleyJointDef.prototype.ratio=null;var b2DistanceJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2DistanceJointDef.prototype,b2JointDef.prototype),b2DistanceJointDef.prototype._super=b2JointDef.prototype,b2DistanceJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_distanceJoint,this.length=1,this.frequencyHz=0,this.dampingRatio=0},b2DistanceJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2DistanceJointDef.prototype.Initialize=function(a,b,c,d){this.bodyA=a,this.bodyB=b,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(d));var e=d.x-c.x,f=d.y-c.y;this.length=Math.sqrt(e*e+f*f),this.frequencyHz=0,this.dampingRatio=0},b2DistanceJointDef.prototype.localAnchorA=new b2Vec2,b2DistanceJointDef.prototype.localAnchorB=new b2Vec2,b2DistanceJointDef.prototype.length=null,b2DistanceJointDef.prototype.frequencyHz=null,b2DistanceJointDef.prototype.dampingRatio=null;var b2FrictionJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2FrictionJointDef.prototype,b2JointDef.prototype),b2FrictionJointDef.prototype._super=b2JointDef.prototype,b2FrictionJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_frictionJoint,this.maxForce=0,this.maxTorque=0},b2FrictionJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2FrictionJointDef.prototype.Initialize=function(a,b,c){this.bodyA=a,this.bodyB=b,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(c))},b2FrictionJointDef.prototype.localAnchorA=new b2Vec2,b2FrictionJointDef.prototype.localAnchorB=new b2Vec2,b2FrictionJointDef.prototype.maxForce=null,b2FrictionJointDef.prototype.maxTorque=null;var b2WeldJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2WeldJointDef.prototype,b2JointDef.prototype),b2WeldJointDef.prototype._super=b2JointDef.prototype,b2WeldJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_weldJoint,this.referenceAngle=0},b2WeldJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2WeldJointDef.prototype.Initialize=function(a,b,c){this.bodyA=a,this.bodyB=b,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(c)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},b2WeldJointDef.prototype.localAnchorA=new b2Vec2,b2WeldJointDef.prototype.localAnchorB=new b2Vec2,b2WeldJointDef.prototype.referenceAngle=null;var b2GearJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2GearJointDef.prototype,b2JointDef.prototype),b2GearJointDef.prototype._super=b2JointDef.prototype,b2GearJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_gearJoint,this.joint1=null,this.joint2=null,this.ratio=1},b2GearJointDef.prototype.__varz=function(){},b2GearJointDef.prototype.joint1=null,b2GearJointDef.prototype.joint2=null,b2GearJointDef.prototype.ratio=null;var b2Color=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Color.prototype.__constructor=function(a,b,c){this._r=~~(255*b2Math.Clamp(a,0,1)),this._g=~~(255*b2Math.Clamp(b,0,1)),this._b=~~(255*b2Math.Clamp(c,0,1))},b2Color.prototype.__varz=function(){},b2Color.prototype.Set=function(a,b,c){this._r=~~(255*b2Math.Clamp(a,0,1)),this._g=~~(255*b2Math.Clamp(b,0,1)),this._b=~~(255*b2Math.Clamp(c,0,1))},b2Color.prototype.__defineGetter__("r",function(){return this._r}),b2Color.prototype.__defineSetter__("r",function(a){this._r=~~(255*b2Math.Clamp(a,0,1))}),b2Color.prototype.__defineGetter__("g",function(){return this._g}),b2Color.prototype.__defineSetter__("g",function(a){this._g=~~(255*b2Math.Clamp(a,0,1))}),b2Color.prototype.__defineGetter__("b",function(){return this._b}),b2Color.prototype.__defineSetter__("b",function(a){this._b=~~(255*b2Math.Clamp(a,0,1))}),b2Color.prototype.__defineGetter__("color",function(){return this._r<<16|this._g<<8|this._b}),b2Color.prototype._r=0,b2Color.prototype._g=0,b2Color.prototype._b=0;var b2FrictionJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2FrictionJoint.prototype,b2Joint.prototype),b2FrictionJoint.prototype._super=b2Joint.prototype,b2FrictionJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]),this.m_localAnchorA.SetV(a.localAnchorA),this.m_localAnchorB.SetV(a.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=a.maxForce,this.m_maxTorque=a.maxTorque},b2FrictionJoint.prototype.__varz=function(){this.m_localAnchorA=new b2Vec2,this.m_localAnchorB=new b2Vec2,this.m_linearImpulse=new b2Vec2,this.m_linearMass=new b2Mat22},b2FrictionJoint.prototype.InitVelocityConstraints=function(a){var b,c,d=this.m_bodyA,e=this.m_bodyB;b=d.m_xf.R;var f=this.m_localAnchorA.x-d.m_sweep.localCenter.x,g=this.m_localAnchorA.y-d.m_sweep.localCenter.y;c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c,b=e.m_xf.R;var h=this.m_localAnchorB.x-e.m_sweep.localCenter.x,i=this.m_localAnchorB.y-e.m_sweep.localCenter.y;c=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=c;var j=d.m_invMass,k=e.m_invMass,l=d.m_invI,m=e.m_invI,n=new b2Mat22;if(n.col1.x=j+k,n.col2.x=0,n.col1.y=0,n.col2.y=j+k,n.col1.x+=l*g*g,n.col2.x+=-l*f*g,n.col1.y+=-l*f*g,n.col2.y+=l*f*f,n.col1.x+=m*i*i,n.col2.x+=-m*h*i,n.col1.y+=-m*h*i,n.col2.y+=m*h*h,n.GetInverse(this.m_linearMass),this.m_angularMass=l+m,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),a.warmStarting){this.m_linearImpulse.x*=a.dtRatio,this.m_linearImpulse.y*=a.dtRatio,this.m_angularImpulse*=a.dtRatio;var o=this.m_linearImpulse;d.m_linearVelocity.x-=j*o.x,d.m_linearVelocity.y-=j*o.y,d.m_angularVelocity-=l*(f*o.y-g*o.x+this.m_angularImpulse),e.m_linearVelocity.x+=k*o.x,e.m_linearVelocity.y+=k*o.y,e.m_angularVelocity+=m*(h*o.y-i*o.x+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0},b2FrictionJoint.prototype.SolveVelocityConstraints=function(a){var b,c,d=this.m_bodyA,e=this.m_bodyB,f=d.m_linearVelocity,g=d.m_angularVelocity,h=e.m_linearVelocity,i=e.m_angularVelocity,j=d.m_invMass,k=e.m_invMass,l=d.m_invI,m=e.m_invI;b=d.m_xf.R;var n=this.m_localAnchorA.x-d.m_sweep.localCenter.x,o=this.m_localAnchorA.y-d.m_sweep.localCenter.y;c=b.col1.x*n+b.col2.x*o,o=b.col1.y*n+b.col2.y*o,n=c,b=e.m_xf.R;var p=this.m_localAnchorB.x-e.m_sweep.localCenter.x,q=this.m_localAnchorB.y-e.m_sweep.localCenter.y;c=b.col1.x*p+b.col2.x*q,q=b.col1.y*p+b.col2.y*q,p=c;var r,s=i-g,t=-this.m_angularMass*s,u=this.m_angularImpulse;r=a.dt*this.m_maxTorque,this.m_angularImpulse=b2Math.Clamp(this.m_angularImpulse+t,-r,r),t=this.m_angularImpulse-u,g-=l*t,i+=m*t;var v=h.x-i*q-f.x+g*o,w=h.y+i*p-f.y-g*n,x=b2Math.MulMV(this.m_linearMass,new b2Vec2(-v,-w)),y=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(x),r=a.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>r*r&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(r)),x=b2Math.SubtractVV(this.m_linearImpulse,y),f.x-=j*x.x,f.y-=j*x.y,g-=l*(n*x.y-o*x.x),h.x+=k*x.x,h.y+=k*x.y,i+=m*(p*x.y-q*x.x),d.m_angularVelocity=g,e.m_angularVelocity=i},b2FrictionJoint.prototype.SolvePositionConstraints=function(a){return!0},b2FrictionJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},b2FrictionJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},b2FrictionJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*this.m_linearImpulse.x,a*this.m_linearImpulse.y)},b2FrictionJoint.prototype.GetReactionTorque=function(a){return a*this.m_angularImpulse},b2FrictionJoint.prototype.SetMaxForce=function(a){this.m_maxForce=a},b2FrictionJoint.prototype.GetMaxForce=function(){return this.m_maxForce},b2FrictionJoint.prototype.SetMaxTorque=function(a){this.m_maxTorque=a},b2FrictionJoint.prototype.GetMaxTorque=function(){return this.m_maxTorque},b2FrictionJoint.prototype.m_localAnchorA=new b2Vec2,b2FrictionJoint.prototype.m_localAnchorB=new b2Vec2,b2FrictionJoint.prototype.m_linearImpulse=new b2Vec2,b2FrictionJoint.prototype.m_angularImpulse=null,b2FrictionJoint.prototype.m_maxForce=null,b2FrictionJoint.prototype.m_maxTorque=null,b2FrictionJoint.prototype.m_linearMass=new b2Mat22,b2FrictionJoint.prototype.m_angularMass=null;var b2Distance=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Distance.prototype.__constructor=function(){},b2Distance.prototype.__varz=function(){},b2Distance.Distance=function(a,b,c){++b2Distance.b2_gjkCalls;var d=c.proxyA,e=c.proxyB,f=c.transformA,g=c.transformB,h=b2Distance.s_simplex;h.ReadCache(b,d,f,e,g);for(var i,j=h.m_vertices,k=20,l=b2Distance.s_saveA,m=b2Distance.s_saveB,n=0,o=h.GetClosestPoint(),p=o.LengthSquared(),q=p,r=0,s=0;k>s;){for(n=h.m_count,r=0;n>r;r++)l[r]=j[r].indexA,m[r]=j[r].indexB;switch(h.m_count){case 1:break;case 2:h.Solve2();break;case 3:h.Solve3();break;default:b2Settings.b2Assert(!1)}if(3==h.m_count)break;i=h.GetClosestPoint(),q=i.LengthSquared(),p=q;var t=h.GetSearchDirection();if(t.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;var u=j[h.m_count];u.indexA=d.GetSupport(b2Math.MulTMV(f.R,t.GetNegative())),u.wA=b2Math.MulX(f,d.GetVertex(u.indexA)),u.indexB=e.GetSupport(b2Math.MulTMV(g.R,t)),u.wB=b2Math.MulX(g,e.GetVertex(u.indexB)),u.w=b2Math.SubtractVV(u.wB,u.wA),++s,++b2Distance.b2_gjkIters;var v=!1;for(r=0;n>r;r++)if(u.indexA==l[r]&&u.indexB==m[r]){v=!0;break}if(v)break;++h.m_count}if(b2Distance.b2_gjkMaxIters=b2Math.Max(b2Distance.b2_gjkMaxIters,s),h.GetWitnessPoints(a.pointA,a.pointB),a.distance=b2Math.SubtractVV(a.pointA,a.pointB).Length(),a.iterations=s,h.WriteCache(b),c.useRadii){var w=d.m_radius,x=e.m_radius;if(a.distance>w+x&&a.distance>Number.MIN_VALUE){a.distance-=w+x;var y=b2Math.SubtractVV(a.pointB,a.pointA);y.Normalize(),a.pointA.x+=w*y.x,a.pointA.y+=w*y.y,a.pointB.x-=x*y.x,a.pointB.y-=x*y.y}else i=new b2Vec2,i.x=.5*(a.pointA.x+a.pointB.x),i.y=.5*(a.pointA.y+a.pointB.y),a.pointA.x=a.pointB.x=i.x,a.pointA.y=a.pointB.y=i.y,a.distance=0}},b2Distance.b2_gjkCalls=0,b2Distance.b2_gjkIters=0,b2Distance.b2_gjkMaxIters=0,b2Distance.s_simplex=new b2Simplex,b2Distance.s_saveA=new Array(3),b2Distance.s_saveB=new Array(3);var b2MouseJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2MouseJoint.prototype,b2Joint.prototype),b2MouseJoint.prototype._super=b2Joint.prototype,b2MouseJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]),this.m_target.SetV(a.target);var b=this.m_target.x-this.m_bodyB.m_xf.position.x,c=this.m_target.y-this.m_bodyB.m_xf.position.y,d=this.m_bodyB.m_xf.R;this.m_localAnchor.x=b*d.col1.x+c*d.col1.y,this.m_localAnchor.y=b*d.col2.x+c*d.col2.y,this.m_maxForce=a.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=a.frequencyHz,this.m_dampingRatio=a.dampingRatio,this.m_beta=0,this.m_gamma=0},b2MouseJoint.prototype.__varz=function(){this.K=new b2Mat22,this.K1=new b2Mat22,this.K2=new b2Mat22,this.m_localAnchor=new b2Vec2,this.m_target=new b2Vec2,this.m_impulse=new b2Vec2,this.m_mass=new b2Mat22,this.m_C=new b2Vec2},b2MouseJoint.prototype.InitVelocityConstraints=function(a){var b=this.m_bodyB,c=b.GetMass(),d=2*Math.PI*this.m_frequencyHz,e=2*c*this.m_dampingRatio*d,f=c*d*d;this.m_gamma=a.dt*(e+a.dt*f),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_beta=a.dt*f*this.m_gamma;var g;g=b.m_xf.R;var h=this.m_localAnchor.x-b.m_sweep.localCenter.x,i=this.m_localAnchor.y-b.m_sweep.localCenter.y,j=g.col1.x*h+g.col2.x*i;i=g.col1.y*h+g.col2.y*i,h=j;var k=b.m_invMass,l=b.m_invI;this.K1.col1.x=k,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=k,this.K2.col1.x=l*i*i,this.K2.col2.x=-l*h*i,this.K2.col1.y=-l*h*i,this.K2.col2.y=l*h*h,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=b.m_sweep.c.x+h-this.m_target.x,this.m_C.y=b.m_sweep.c.y+i-this.m_target.y,b.m_angularVelocity*=.98,this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,b.m_linearVelocity.x+=k*this.m_impulse.x,b.m_linearVelocity.y+=k*this.m_impulse.y,b.m_angularVelocity+=l*(h*this.m_impulse.y-i*this.m_impulse.x)},b2MouseJoint.prototype.SolveVelocityConstraints=function(a){var b,c,d,e=this.m_bodyB;b=e.m_xf.R;var f=this.m_localAnchor.x-e.m_sweep.localCenter.x,g=this.m_localAnchor.y-e.m_sweep.localCenter.y;c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c;var h=e.m_linearVelocity.x+-e.m_angularVelocity*g,i=e.m_linearVelocity.y+e.m_angularVelocity*f;b=this.m_mass,c=h+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,d=i+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;var j=-(b.col1.x*c+b.col2.x*d),k=-(b.col1.y*c+b.col2.y*d),l=this.m_impulse.x,m=this.m_impulse.y;this.m_impulse.x+=j,this.m_impulse.y+=k;var n=a.dt*this.m_maxForce;this.m_impulse.LengthSquared()>n*n&&this.m_impulse.Multiply(n/this.m_impulse.Length()),j=this.m_impulse.x-l,k=this.m_impulse.y-m,e.m_linearVelocity.x+=e.m_invMass*j,e.m_linearVelocity.y+=e.m_invMass*k,e.m_angularVelocity+=e.m_invI*(f*k-g*j)},b2MouseJoint.prototype.SolvePositionConstraints=function(a){return!0},b2MouseJoint.prototype.GetAnchorA=function(){return this.m_target},b2MouseJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},b2MouseJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*this.m_impulse.x,a*this.m_impulse.y)},b2MouseJoint.prototype.GetReactionTorque=function(a){return 0},b2MouseJoint.prototype.GetTarget=function(){return this.m_target},b2MouseJoint.prototype.SetTarget=function(a){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0),this.m_target=a},b2MouseJoint.prototype.GetMaxForce=function(){return this.m_maxForce},b2MouseJoint.prototype.SetMaxForce=function(a){this.m_maxForce=a},b2MouseJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},b2MouseJoint.prototype.SetFrequency=function(a){this.m_frequencyHz=a},b2MouseJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},b2MouseJoint.prototype.SetDampingRatio=function(a){this.m_dampingRatio=a},b2MouseJoint.prototype.K=new b2Mat22,b2MouseJoint.prototype.K1=new b2Mat22,b2MouseJoint.prototype.K2=new b2Mat22,b2MouseJoint.prototype.m_localAnchor=new b2Vec2,b2MouseJoint.prototype.m_target=new b2Vec2,b2MouseJoint.prototype.m_impulse=new b2Vec2,b2MouseJoint.prototype.m_mass=new b2Mat22,b2MouseJoint.prototype.m_C=new b2Vec2,b2MouseJoint.prototype.m_maxForce=null,b2MouseJoint.prototype.m_frequencyHz=null,b2MouseJoint.prototype.m_dampingRatio=null,b2MouseJoint.prototype.m_beta=null,b2MouseJoint.prototype.m_gamma=null;var b2PrismaticJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PrismaticJointDef.prototype,b2JointDef.prototype),b2PrismaticJointDef.prototype._super=b2JointDef.prototype,b2PrismaticJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},b2PrismaticJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2,this.localAxisA=new b2Vec2},b2PrismaticJointDef.prototype.Initialize=function(a,b,c,d){this.bodyA=a,this.bodyB=b,this.localAnchorA=this.bodyA.GetLocalPoint(c),this.localAnchorB=this.bodyB.GetLocalPoint(c),this.localAxisA=this.bodyA.GetLocalVector(d),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},b2PrismaticJointDef.prototype.localAnchorA=new b2Vec2,b2PrismaticJointDef.prototype.localAnchorB=new b2Vec2,b2PrismaticJointDef.prototype.localAxisA=new b2Vec2,b2PrismaticJointDef.prototype.referenceAngle=null,b2PrismaticJointDef.prototype.enableLimit=null,b2PrismaticJointDef.prototype.lowerTranslation=null,b2PrismaticJointDef.prototype.upperTranslation=null,b2PrismaticJointDef.prototype.enableMotor=null,b2PrismaticJointDef.prototype.maxMotorForce=null,b2PrismaticJointDef.prototype.motorSpeed=null;var b2TimeOfImpact=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2TimeOfImpact.prototype.__constructor=function(){},b2TimeOfImpact.prototype.__varz=function(){},b2TimeOfImpact.TimeOfImpact=function(a){++b2TimeOfImpact.b2_toiCalls;var b=a.proxyA,c=a.proxyB,d=a.sweepA,e=a.sweepB;b2Settings.b2Assert(d.t0==e.t0),b2Settings.b2Assert(1-d.t0>Number.MIN_VALUE);var f=b.m_radius+c.m_radius,g=a.tolerance,h=0,i=1e3,j=0,k=0;for(b2TimeOfImpact.s_cache.count=0,b2TimeOfImpact.s_distanceInput.useRadii=!1;;){if(d.GetTransform(b2TimeOfImpact.s_xfA,h),e.GetTransform(b2TimeOfImpact.s_xfB,h),b2TimeOfImpact.s_distanceInput.proxyA=b,b2TimeOfImpact.s_distanceInput.proxyB=c,b2TimeOfImpact.s_distanceInput.transformA=b2TimeOfImpact.s_xfA,b2TimeOfImpact.s_distanceInput.transformB=b2TimeOfImpact.s_xfB,b2Distance.Distance(b2TimeOfImpact.s_distanceOutput,b2TimeOfImpact.s_cache,b2TimeOfImpact.s_distanceInput),b2TimeOfImpact.s_distanceOutput.distance<=0){h=1;break}b2TimeOfImpact.s_fcn.Initialize(b2TimeOfImpact.s_cache,b,b2TimeOfImpact.s_xfA,c,b2TimeOfImpact.s_xfB);var l=b2TimeOfImpact.s_fcn.Evaluate(b2TimeOfImpact.s_xfA,b2TimeOfImpact.s_xfB);if(0>=l){h=1;break}if(0==j&&(k=l>f?b2Math.Max(f-g,.75*f):b2Math.Max(l-g,.02*f)),.5*g>l-k){if(0==j){h=1;break}break}var m=h,n=h,o=1,p=l;d.GetTransform(b2TimeOfImpact.s_xfA,o),e.GetTransform(b2TimeOfImpact.s_xfB,o);var q=b2TimeOfImpact.s_fcn.Evaluate(b2TimeOfImpact.s_xfA,b2TimeOfImpact.s_xfB);if(q>=k){h=1;break}for(var r=0;;){var s;s=1&r?n+(k-p)*(o-n)/(q-p):.5*(n+o),d.GetTransform(b2TimeOfImpact.s_xfA,s),e.GetTransform(b2TimeOfImpact.s_xfB,s);var t=b2TimeOfImpact.s_fcn.Evaluate(b2TimeOfImpact.s_xfA,b2TimeOfImpact.s_xfB);if(b2Math.Abs(t-k)<.025*g){m=s;break}if(t>k?(n=s,p=t):(o=s,q=t),++r,++b2TimeOfImpact.b2_toiRootIters,50==r)break}if(b2TimeOfImpact.b2_toiMaxRootIters=b2Math.Max(b2TimeOfImpact.b2_toiMaxRootIters,r),m<(1+100*Number.MIN_VALUE)*h)break;if(h=m,j++,++b2TimeOfImpact.b2_toiIters,j==i)break}return b2TimeOfImpact.b2_toiMaxIters=b2Math.Max(b2TimeOfImpact.b2_toiMaxIters,j),h},b2TimeOfImpact.b2_toiCalls=0,b2TimeOfImpact.b2_toiIters=0,b2TimeOfImpact.b2_toiMaxIters=0,b2TimeOfImpact.b2_toiRootIters=0,b2TimeOfImpact.b2_toiMaxRootIters=0,b2TimeOfImpact.s_cache=new b2SimplexCache,b2TimeOfImpact.s_distanceInput=new b2DistanceInput,b2TimeOfImpact.s_xfA=new b2Transform,b2TimeOfImpact.s_xfB=new b2Transform,b2TimeOfImpact.s_fcn=new b2SeparationFunction,b2TimeOfImpact.s_distanceOutput=new b2DistanceOutput;var b2GearJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2GearJoint.prototype,b2Joint.prototype),b2GearJoint.prototype._super=b2Joint.prototype,b2GearJoint.prototype.__constructor=function(a){this._super.__constructor.apply(this,[a]);var b=a.joint1.m_type,c=a.joint2.m_type;this.m_revolute1=null,this.m_prismatic1=null,this.m_revolute2=null,this.m_prismatic2=null;var d,e;this.m_ground1=a.joint1.GetBodyA(),this.m_bodyA=a.joint1.GetBodyB(),b==b2Joint.e_revoluteJoint?(this.m_revolute1=a.joint1,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),d=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=a.joint1,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),d=this.m_prismatic1.GetJointTranslation()),this.m_ground2=a.joint2.GetBodyA(),this.m_bodyB=a.joint2.GetBodyB(),c==b2Joint.e_revoluteJoint?(this.m_revolute2=a.joint2,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),e=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=a.joint2,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),e=this.m_prismatic2.GetJointTranslation()),this.m_ratio=a.ratio,this.m_constant=d+this.m_ratio*e,this.m_impulse=0},b2GearJoint.prototype.__varz=function(){this.m_groundAnchor1=new b2Vec2,this.m_groundAnchor2=new b2Vec2,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_J=new b2Jacobian},b2GearJoint.prototype.InitVelocityConstraints=function(a){var b,c,d,e,f,g,h,i,j=this.m_ground1,k=this.m_ground2,l=this.m_bodyA,m=this.m_bodyB,n=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,n+=l.m_invI):(f=j.m_xf.R,g=this.m_prismatic1.m_localXAxis1,b=f.col1.x*g.x+f.col2.x*g.y,c=f.col1.y*g.x+f.col2.y*g.y,f=l.m_xf.R,d=this.m_localAnchor1.x-l.m_sweep.localCenter.x,e=this.m_localAnchor1.y-l.m_sweep.localCenter.y,i=f.col1.x*d+f.col2.x*e,e=f.col1.y*d+f.col2.y*e,d=i,h=d*c-e*b,this.m_J.linearA.Set(-b,-c),this.m_J.angularA=-h,n+=l.m_invMass+l.m_invI*h*h),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,n+=this.m_ratio*this.m_ratio*m.m_invI):(f=k.m_xf.R,g=this.m_prismatic2.m_localXAxis1,b=f.col1.x*g.x+f.col2.x*g.y,c=f.col1.y*g.x+f.col2.y*g.y,f=m.m_xf.R,d=this.m_localAnchor2.x-m.m_sweep.localCenter.x,e=this.m_localAnchor2.y-m.m_sweep.localCenter.y,i=f.col1.x*d+f.col2.x*e,e=f.col1.y*d+f.col2.y*e,d=i,h=d*c-e*b,this.m_J.linearB.Set(-this.m_ratio*b,-this.m_ratio*c),this.m_J.angularB=-this.m_ratio*h,n+=this.m_ratio*this.m_ratio*(m.m_invMass+m.m_invI*h*h)),this.m_mass=n>0?1/n:0,a.warmStarting?(l.m_linearVelocity.x+=l.m_invMass*this.m_impulse*this.m_J.linearA.x,l.m_linearVelocity.y+=l.m_invMass*this.m_impulse*this.m_J.linearA.y,l.m_angularVelocity+=l.m_invI*this.m_impulse*this.m_J.angularA,m.m_linearVelocity.x+=m.m_invMass*this.m_impulse*this.m_J.linearB.x,m.m_linearVelocity.y+=m.m_invMass*this.m_impulse*this.m_J.linearB.y,m.m_angularVelocity+=m.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},b2GearJoint.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,c=this.m_bodyB,d=this.m_J.Compute(b.m_linearVelocity,b.m_angularVelocity,c.m_linearVelocity,c.m_angularVelocity),e=-this.m_mass*d;
this.m_impulse+=e,b.m_linearVelocity.x+=b.m_invMass*e*this.m_J.linearA.x,b.m_linearVelocity.y+=b.m_invMass*e*this.m_J.linearA.y,b.m_angularVelocity+=b.m_invI*e*this.m_J.angularA,c.m_linearVelocity.x+=c.m_invMass*e*this.m_J.linearB.x,c.m_linearVelocity.y+=c.m_invMass*e*this.m_J.linearB.y,c.m_angularVelocity+=c.m_invI*e*this.m_J.angularB},b2GearJoint.prototype.SolvePositionConstraints=function(a){var b,c,d=0,e=this.m_bodyA,f=this.m_bodyB;b=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),c=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation();var g=this.m_constant-(b+this.m_ratio*c),h=-this.m_mass*g;return e.m_sweep.c.x+=e.m_invMass*h*this.m_J.linearA.x,e.m_sweep.c.y+=e.m_invMass*h*this.m_J.linearA.y,e.m_sweep.a+=e.m_invI*h*this.m_J.angularA,f.m_sweep.c.x+=f.m_invMass*h*this.m_J.linearB.x,f.m_sweep.c.y+=f.m_invMass*h*this.m_J.linearB.y,f.m_sweep.a+=f.m_invI*h*this.m_J.angularB,e.SynchronizeTransform(),f.SynchronizeTransform(),d<b2Settings.b2_linearSlop},b2GearJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2GearJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2GearJoint.prototype.GetReactionForce=function(a){return new b2Vec2(a*this.m_impulse*this.m_J.linearB.x,a*this.m_impulse*this.m_J.linearB.y)},b2GearJoint.prototype.GetReactionTorque=function(a){var b=this.m_bodyB.m_xf.R,c=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,d=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,e=b.col1.x*c+b.col2.x*d;d=b.col1.y*c+b.col2.y*d,c=e;var f=this.m_impulse*this.m_J.linearB.x,g=this.m_impulse*this.m_J.linearB.y;return a*(this.m_impulse*this.m_J.angularB-c*g+d*f)},b2GearJoint.prototype.GetRatio=function(){return this.m_ratio},b2GearJoint.prototype.SetRatio=function(a){this.m_ratio=a},b2GearJoint.prototype.m_ground1=null,b2GearJoint.prototype.m_ground2=null,b2GearJoint.prototype.m_revolute1=null,b2GearJoint.prototype.m_prismatic1=null,b2GearJoint.prototype.m_revolute2=null,b2GearJoint.prototype.m_prismatic2=null,b2GearJoint.prototype.m_groundAnchor1=new b2Vec2,b2GearJoint.prototype.m_groundAnchor2=new b2Vec2,b2GearJoint.prototype.m_localAnchor1=new b2Vec2,b2GearJoint.prototype.m_localAnchor2=new b2Vec2,b2GearJoint.prototype.m_J=new b2Jacobian,b2GearJoint.prototype.m_constant=null,b2GearJoint.prototype.m_ratio=null,b2GearJoint.prototype.m_mass=null,b2GearJoint.prototype.m_impulse=null;var b2TOIInput=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2TOIInput.prototype.__constructor=function(){},b2TOIInput.prototype.__varz=function(){this.proxyA=new b2DistanceProxy,this.proxyB=new b2DistanceProxy,this.sweepA=new b2Sweep,this.sweepB=new b2Sweep},b2TOIInput.prototype.proxyA=new b2DistanceProxy,b2TOIInput.prototype.proxyB=new b2DistanceProxy,b2TOIInput.prototype.sweepA=new b2Sweep,b2TOIInput.prototype.sweepB=new b2Sweep,b2TOIInput.prototype.tolerance=null;var b2RevoluteJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2RevoluteJointDef.prototype,b2JointDef.prototype),b2RevoluteJointDef.prototype._super=b2JointDef.prototype,b2RevoluteJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_revoluteJoint,this.localAnchorA.Set(0,0),this.localAnchorB.Set(0,0),this.referenceAngle=0,this.lowerAngle=0,this.upperAngle=0,this.maxMotorTorque=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1},b2RevoluteJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2RevoluteJointDef.prototype.Initialize=function(a,b,c){this.bodyA=a,this.bodyB=b,this.localAnchorA=this.bodyA.GetLocalPoint(c),this.localAnchorB=this.bodyB.GetLocalPoint(c),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},b2RevoluteJointDef.prototype.localAnchorA=new b2Vec2,b2RevoluteJointDef.prototype.localAnchorB=new b2Vec2,b2RevoluteJointDef.prototype.referenceAngle=null,b2RevoluteJointDef.prototype.enableLimit=null,b2RevoluteJointDef.prototype.lowerAngle=null,b2RevoluteJointDef.prototype.upperAngle=null,b2RevoluteJointDef.prototype.enableMotor=null,b2RevoluteJointDef.prototype.motorSpeed=null,b2RevoluteJointDef.prototype.maxMotorTorque=null;var b2MouseJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2MouseJointDef.prototype,b2JointDef.prototype),b2MouseJointDef.prototype._super=b2JointDef.prototype,b2MouseJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},b2MouseJointDef.prototype.__varz=function(){this.target=new b2Vec2},b2MouseJointDef.prototype.target=new b2Vec2,b2MouseJointDef.prototype.maxForce=null,b2MouseJointDef.prototype.frequencyHz=null,b2MouseJointDef.prototype.dampingRatio=null;var b2Contact=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Contact.prototype.__constructor=function(){},b2Contact.prototype.__varz=function(){this.m_nodeA=new b2ContactEdge,this.m_nodeB=new b2ContactEdge,this.m_manifold=new b2Manifold,this.m_oldManifold=new b2Manifold},b2Contact.s_input=new b2TOIInput,b2Contact.e_sensorFlag=1,b2Contact.e_continuousFlag=2,b2Contact.e_islandFlag=4,b2Contact.e_toiFlag=8,b2Contact.e_touchingFlag=16,b2Contact.e_enabledFlag=32,b2Contact.e_filterFlag=64,b2Contact.prototype.Reset=function(a,b){if(this.m_flags=b2Contact.e_enabledFlag,!a||!b)return this.m_fixtureA=null,void(this.m_fixtureB=null);(a.IsSensor()||b.IsSensor())&&(this.m_flags|=b2Contact.e_sensorFlag);var c=a.GetBody(),d=b.GetBody();(c.GetType()!=b2Body.b2_dynamicBody||c.IsBullet()||d.GetType()!=b2Body.b2_dynamicBody||d.IsBullet())&&(this.m_flags|=b2Contact.e_continuousFlag),this.m_fixtureA=a,this.m_fixtureB=b,this.m_manifold.m_pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null},b2Contact.prototype.Update=function(a){var b=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=b,this.m_flags|=b2Contact.e_enabledFlag;var c,d,e,f,g=!1,h=(this.m_flags&b2Contact.e_touchingFlag)==b2Contact.e_touchingFlag,i=this.m_fixtureA.m_body,j=this.m_fixtureB.m_body,k=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&b2Contact.e_sensorFlag)k&&(c=this.m_fixtureA.GetShape(),d=this.m_fixtureB.GetShape(),e=i.GetTransform(),f=j.GetTransform(),g=b2Shape.TestOverlap(c,e,d,f)),this.m_manifold.m_pointCount=0;else{if(i.GetType()!=b2Body.b2_dynamicBody||i.IsBullet()||j.GetType()!=b2Body.b2_dynamicBody||j.IsBullet()?this.m_flags|=b2Contact.e_continuousFlag:this.m_flags&=~b2Contact.e_continuousFlag,k){this.Evaluate(),g=this.m_manifold.m_pointCount>0;for(var l,m,n,o,p=0;p<this.m_manifold.m_pointCount;++p)for(m=this.m_manifold.m_points[p],m.m_normalImpulse=0,m.m_tangentImpulse=0,n=m.m_id,o=0;o<this.m_oldManifold.m_pointCount;++o)if(l=this.m_oldManifold.m_points[o],l.m_id.key==n.key){m.m_normalImpulse=l.m_normalImpulse,m.m_tangentImpulse=l.m_tangentImpulse;break}}else this.m_manifold.m_pointCount=0;g!=h&&(i.SetAwake(!0),j.SetAwake(!0))}g?this.m_flags|=b2Contact.e_touchingFlag:this.m_flags&=~b2Contact.e_touchingFlag,0==h&&1==g&&a.BeginContact(this),1==h&&0==g&&a.EndContact(this),0==(this.m_flags&b2Contact.e_sensorFlag)&&a.PreSolve(this,this.m_oldManifold)},b2Contact.prototype.Evaluate=function(){},b2Contact.prototype.ComputeTOI=function(a,b){return b2Contact.s_input.proxyA.Set(this.m_fixtureA.GetShape()),b2Contact.s_input.proxyB.Set(this.m_fixtureB.GetShape()),b2Contact.s_input.sweepA=a,b2Contact.s_input.sweepB=b,b2Contact.s_input.tolerance=b2Settings.b2_linearSlop,b2TimeOfImpact.TimeOfImpact(b2Contact.s_input)},b2Contact.prototype.GetManifold=function(){return this.m_manifold},b2Contact.prototype.GetWorldManifold=function(a){var b=this.m_fixtureA.GetBody(),c=this.m_fixtureB.GetBody(),d=this.m_fixtureA.GetShape(),e=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,b.GetTransform(),d.m_radius,c.GetTransform(),e.m_radius)},b2Contact.prototype.IsTouching=function(){return(this.m_flags&b2Contact.e_touchingFlag)==b2Contact.e_touchingFlag},b2Contact.prototype.IsContinuous=function(){return(this.m_flags&b2Contact.e_continuousFlag)==b2Contact.e_continuousFlag},b2Contact.prototype.SetSensor=function(a){a?this.m_flags|=b2Contact.e_sensorFlag:this.m_flags&=~b2Contact.e_sensorFlag},b2Contact.prototype.IsSensor=function(){return(this.m_flags&b2Contact.e_sensorFlag)==b2Contact.e_sensorFlag},b2Contact.prototype.SetEnabled=function(a){a?this.m_flags|=b2Contact.e_enabledFlag:this.m_flags&=~b2Contact.e_enabledFlag},b2Contact.prototype.IsEnabled=function(){return(this.m_flags&b2Contact.e_enabledFlag)==b2Contact.e_enabledFlag},b2Contact.prototype.GetNext=function(){return this.m_next},b2Contact.prototype.GetFixtureA=function(){return this.m_fixtureA},b2Contact.prototype.GetFixtureB=function(){return this.m_fixtureB},b2Contact.prototype.FlagForFiltering=function(){this.m_flags|=b2Contact.e_filterFlag},b2Contact.prototype.m_flags=0,b2Contact.prototype.m_prev=null,b2Contact.prototype.m_next=null,b2Contact.prototype.m_nodeA=new b2ContactEdge,b2Contact.prototype.m_nodeB=new b2ContactEdge,b2Contact.prototype.m_fixtureA=null,b2Contact.prototype.m_fixtureB=null,b2Contact.prototype.m_manifold=new b2Manifold,b2Contact.prototype.m_oldManifold=new b2Manifold,b2Contact.prototype.m_toi=null;var b2ContactConstraint=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactConstraint.prototype.__constructor=function(){this.points=new Array(b2Settings.b2_maxManifoldPoints);for(var a=0;a<b2Settings.b2_maxManifoldPoints;a++)this.points[a]=new b2ContactConstraintPoint},b2ContactConstraint.prototype.__varz=function(){this.localPlaneNormal=new b2Vec2,this.localPoint=new b2Vec2,this.normal=new b2Vec2,this.normalMass=new b2Mat22,this.K=new b2Mat22},b2ContactConstraint.prototype.points=null,b2ContactConstraint.prototype.localPlaneNormal=new b2Vec2,b2ContactConstraint.prototype.localPoint=new b2Vec2,b2ContactConstraint.prototype.normal=new b2Vec2,b2ContactConstraint.prototype.normalMass=new b2Mat22,b2ContactConstraint.prototype.K=new b2Mat22,b2ContactConstraint.prototype.bodyA=null,b2ContactConstraint.prototype.bodyB=null,b2ContactConstraint.prototype.type=0,b2ContactConstraint.prototype.radius=null,b2ContactConstraint.prototype.friction=null,b2ContactConstraint.prototype.restitution=null,b2ContactConstraint.prototype.pointCount=0,b2ContactConstraint.prototype.manifold=null;var b2ContactResult=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactResult.prototype.__constructor=function(){},b2ContactResult.prototype.__varz=function(){this.position=new b2Vec2,this.normal=new b2Vec2,this.id=new b2ContactID},b2ContactResult.prototype.shape1=null,b2ContactResult.prototype.shape2=null,b2ContactResult.prototype.position=new b2Vec2,b2ContactResult.prototype.normal=new b2Vec2,b2ContactResult.prototype.normalImpulse=null,b2ContactResult.prototype.tangentImpulse=null,b2ContactResult.prototype.id=new b2ContactID;var b2PolygonContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PolygonContact.prototype,b2Contact.prototype),b2PolygonContact.prototype._super=b2Contact.prototype,b2PolygonContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2PolygonContact.prototype.__varz=function(){},b2PolygonContact.Create=function(a){return new b2PolygonContact},b2PolygonContact.Destroy=function(a,b){},b2PolygonContact.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();b2Collision.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape(),a.m_xf,this.m_fixtureB.GetShape(),b.m_xf)},b2PolygonContact.prototype.Reset=function(a,b){this._super.Reset.apply(this,[a,b])};var ClipVertex=function(){this.__varz(),this.__constructor.apply(this,arguments)};ClipVertex.prototype.__constructor=function(){},ClipVertex.prototype.__varz=function(){this.v=new b2Vec2,this.id=new b2ContactID},ClipVertex.prototype.Set=function(a){this.v.SetV(a.v),this.id.Set(a.id)},ClipVertex.prototype.v=new b2Vec2,ClipVertex.prototype.id=new b2ContactID;var b2ContactFilter=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactFilter.prototype.__constructor=function(){},b2ContactFilter.prototype.__varz=function(){},b2ContactFilter.b2_defaultFilter=new b2ContactFilter,b2ContactFilter.prototype.ShouldCollide=function(a,b){var c=a.GetFilterData(),d=b.GetFilterData();if(c.groupIndex==d.groupIndex&&0!=c.groupIndex)return c.groupIndex>0;var e=0!=(c.maskBits&d.categoryBits)&&0!=(c.categoryBits&d.maskBits);return e},b2ContactFilter.prototype.RayCollide=function(a,b){return a?this.ShouldCollide(a,b):!0};var b2NullContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2NullContact.prototype,b2Contact.prototype),b2NullContact.prototype._super=b2Contact.prototype,b2NullContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2NullContact.prototype.__varz=function(){},b2NullContact.prototype.Evaluate=function(){};var b2ContactListener=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactListener.prototype.__constructor=function(){},b2ContactListener.prototype.__varz=function(){},b2ContactListener.b2_defaultListener=new b2ContactListener,b2ContactListener.prototype.BeginContact=function(a){},b2ContactListener.prototype.EndContact=function(a){},b2ContactListener.prototype.PreSolve=function(a,b){},b2ContactListener.prototype.PostSolve=function(a,b){};var b2Island=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Island.prototype.__constructor=function(){this.m_bodies=new Array,this.m_contacts=new Array,this.m_joints=new Array},b2Island.prototype.__varz=function(){},b2Island.s_impulse=new b2ContactImpulse,b2Island.prototype.Initialize=function(a,b,c,d,e,f){var g=0;for(this.m_bodyCapacity=a,this.m_contactCapacity=b,this.m_jointCapacity=c,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=d,this.m_listener=e,this.m_contactSolver=f,g=this.m_bodies.length;a>g;g++)this.m_bodies[g]=null;for(g=this.m_contacts.length;b>g;g++)this.m_contacts[g]=null;for(g=this.m_joints.length;c>g;g++)this.m_joints[g]=null},b2Island.prototype.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},b2Island.prototype.Solve=function(a,b,c){var d,e,f,g,h,i,j,k,l,m=0,n=0;for(m=0;m<this.m_bodyCount;++m)d=this.m_bodies[m],d.GetType()==b2Body.b2_dynamicBody&&(d.m_linearVelocity.x+=a.dt*(b.x+d.m_invMass*d.m_force.x),d.m_linearVelocity.y+=a.dt*(b.y+d.m_invMass*d.m_force.y),d.m_angularVelocity+=a.dt*d.m_invI*d.m_torque,d.m_linearVelocity.Multiply(b2Math.Clamp(1-a.dt*d.m_linearDamping,0,1)),d.m_angularVelocity*=b2Math.Clamp(1-a.dt*d.m_angularDamping,0,1));for(this.m_contactSolver.Initialize(a,this.m_contacts,this.m_contactCount,this.m_allocator),f=this.m_contactSolver,f.InitVelocityConstraints(a),m=0;m<this.m_jointCount;++m)e=this.m_joints[m],e.InitVelocityConstraints(a);for(m=0;m<a.velocityIterations;++m){for(n=0;n<this.m_jointCount;++n)e=this.m_joints[n],e.SolveVelocityConstraints(a);f.SolveVelocityConstraints()}for(m=0;m<this.m_jointCount;++m)e=this.m_joints[m],e.FinalizeVelocityConstraints();for(f.FinalizeVelocityConstraints(),m=0;m<this.m_bodyCount;++m)d=this.m_bodies[m],d.GetType()!=b2Body.b2_staticBody&&(g=a.dt*d.m_linearVelocity.x,h=a.dt*d.m_linearVelocity.y,g*g+h*h>b2Settings.b2_maxTranslationSquared&&(d.m_linearVelocity.Normalize(),d.m_linearVelocity.x*=b2Settings.b2_maxTranslation*a.inv_dt,d.m_linearVelocity.y*=b2Settings.b2_maxTranslation*a.inv_dt),i=a.dt*d.m_angularVelocity,i*i>b2Settings.b2_maxRotationSquared&&(d.m_angularVelocity<0?d.m_angularVelocity=-b2Settings.b2_maxRotation*a.inv_dt:d.m_angularVelocity=b2Settings.b2_maxRotation*a.inv_dt),d.m_sweep.c0.SetV(d.m_sweep.c),d.m_sweep.a0=d.m_sweep.a,d.m_sweep.c.x+=a.dt*d.m_linearVelocity.x,d.m_sweep.c.y+=a.dt*d.m_linearVelocity.y,d.m_sweep.a+=a.dt*d.m_angularVelocity,d.SynchronizeTransform());for(m=0;m<a.positionIterations;++m){for(j=f.SolvePositionConstraints(b2Settings.b2_contactBaumgarte),k=!0,n=0;n<this.m_jointCount;++n)e=this.m_joints[n],l=e.SolvePositionConstraints(b2Settings.b2_contactBaumgarte),k=k&&l;if(j&&k)break}if(this.Report(f.m_constraints),c){var o=Number.MAX_VALUE,p=b2Settings.b2_linearSleepTolerance*b2Settings.b2_linearSleepTolerance,q=b2Settings.b2_angularSleepTolerance*b2Settings.b2_angularSleepTolerance;for(m=0;m<this.m_bodyCount;++m)d=this.m_bodies[m],d.GetType()!=b2Body.b2_staticBody&&(0==(d.m_flags&b2Body.e_allowSleepFlag)&&(d.m_sleepTime=0,o=0),0==(d.m_flags&b2Body.e_allowSleepFlag)||d.m_angularVelocity*d.m_angularVelocity>q||b2Math.Dot(d.m_linearVelocity,d.m_linearVelocity)>p?(d.m_sleepTime=0,o=0):(d.m_sleepTime+=a.dt,o=b2Math.Min(o,d.m_sleepTime)));if(o>=b2Settings.b2_timeToSleep)for(m=0;m<this.m_bodyCount;++m)d=this.m_bodies[m],d.SetAwake(!1)}},b2Island.prototype.SolveTOI=function(a){var b=0,c=0;this.m_contactSolver.Initialize(a,this.m_contacts,this.m_contactCount,this.m_allocator);var d=this.m_contactSolver;for(b=0;b<this.m_jointCount;++b)this.m_joints[b].InitVelocityConstraints(a);for(b=0;b<a.velocityIterations;++b)for(d.SolveVelocityConstraints(),c=0;c<this.m_jointCount;++c)this.m_joints[c].SolveVelocityConstraints(a);for(b=0;b<this.m_bodyCount;++b){var e=this.m_bodies[b];if(e.GetType()!=b2Body.b2_staticBody){var f=a.dt*e.m_linearVelocity.x,g=a.dt*e.m_linearVelocity.y;f*f+g*g>b2Settings.b2_maxTranslationSquared&&(e.m_linearVelocity.Normalize(),e.m_linearVelocity.x*=b2Settings.b2_maxTranslation*a.inv_dt,e.m_linearVelocity.y*=b2Settings.b2_maxTranslation*a.inv_dt);var h=a.dt*e.m_angularVelocity;h*h>b2Settings.b2_maxRotationSquared&&(e.m_angularVelocity<0?e.m_angularVelocity=-b2Settings.b2_maxRotation*a.inv_dt:e.m_angularVelocity=b2Settings.b2_maxRotation*a.inv_dt),e.m_sweep.c0.SetV(e.m_sweep.c),e.m_sweep.a0=e.m_sweep.a,e.m_sweep.c.x+=a.dt*e.m_linearVelocity.x,e.m_sweep.c.y+=a.dt*e.m_linearVelocity.y,e.m_sweep.a+=a.dt*e.m_angularVelocity,e.SynchronizeTransform()}}var i=.75;for(b=0;b<a.positionIterations;++b){var j=d.SolvePositionConstraints(i),k=!0;for(c=0;c<this.m_jointCount;++c){var l=this.m_joints[c].SolvePositionConstraints(b2Settings.b2_contactBaumgarte);k=k&&l}if(j&&k)break}this.Report(d.m_constraints)},b2Island.prototype.Report=function(a){if(null!=this.m_listener)for(var b=0;b<this.m_contactCount;++b){for(var c=this.m_contacts[b],d=a[b],e=0;e<d.pointCount;++e)b2Island.s_impulse.normalImpulses[e]=d.points[e].normalImpulse,b2Island.s_impulse.tangentImpulses[e]=d.points[e].tangentImpulse;this.m_listener.PostSolve(c,b2Island.s_impulse)}},b2Island.prototype.AddBody=function(a){a.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=a},b2Island.prototype.AddContact=function(a){this.m_contacts[this.m_contactCount++]=a},b2Island.prototype.AddJoint=function(a){this.m_joints[this.m_jointCount++]=a},b2Island.prototype.m_allocator=null,b2Island.prototype.m_listener=null,b2Island.prototype.m_contactSolver=null,b2Island.prototype.m_bodies=null,b2Island.prototype.m_contacts=null,b2Island.prototype.m_joints=null,b2Island.prototype.m_bodyCount=0,b2Island.prototype.m_jointCount=0,b2Island.prototype.m_contactCount=0,b2Island.prototype.m_bodyCapacity=0,b2Island.prototype.m_contactCapacity=0,b2Island.prototype.m_jointCapacity=0;var b2PolyAndEdgeContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PolyAndEdgeContact.prototype,b2Contact.prototype),b2PolyAndEdgeContact.prototype._super=b2Contact.prototype,b2PolyAndEdgeContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2PolyAndEdgeContact.prototype.__varz=function(){},b2PolyAndEdgeContact.Create=function(a){return new b2PolyAndEdgeContact},b2PolyAndEdgeContact.Destroy=function(a,b){},b2PolyAndEdgeContact.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape(),a.m_xf,this.m_fixtureB.GetShape(),b.m_xf)},b2PolyAndEdgeContact.prototype.b2CollidePolyAndEdge=function(a,b,c,d,e){},b2PolyAndEdgeContact.prototype.Reset=function(a,b){this._super.Reset.apply(this,[a,b]),b2Settings.b2Assert(a.GetType()==b2Shape.e_polygonShape),b2Settings.b2Assert(b.GetType()==b2Shape.e_edgeShape)};var b2Collision=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Collision.prototype.__constructor=function(){},b2Collision.prototype.__varz=function(){},b2Collision.MakeClipPointVector=function(){var a=new Array(2);return a[0]=new ClipVertex,a[1]=new ClipVertex,a},b2Collision.ClipSegmentToLine=function(a,b,c,d){var e,f=0;e=b[0];var g=e.v;e=b[1];var h=e.v,i=c.x*g.x+c.y*g.y-d,j=c.x*h.x+c.y*h.y-d;if(0>=i&&a[f++].Set(b[0]),0>=j&&a[f++].Set(b[1]),0>i*j){var k=i/(i-j);e=a[f];var l=e.v;l.x=g.x+k*(h.x-g.x),l.y=g.y+k*(h.y-g.y),e=a[f];var m;i>0?(m=b[0],e.id=m.id):(m=b[1],e.id=m.id),++f}return f},b2Collision.EdgeSeparation=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,p,r,s=(a.m_vertexCount,a.m_vertices),t=a.m_normals,u=d.m_vertexCount,v=d.m_vertices,w=0;for(f=b.R,g=t[c],h=f.col1.x*g.x+f.col2.x*g.y,i=f.col1.y*g.x+f.col2.y*g.y,f=e.R,j=f.col1.x*h+f.col1.y*i,k=f.col2.x*h+f.col2.y*i,l=0,m=Number.MAX_VALUE;u>w;++w)g=v[w],n=g.x*j+g.y*k,m>n&&(m=n,l=w);return g=s[c],f=b.R,o=b.position.x+(f.col1.x*g.x+f.col2.x*g.y),v1Y=b.position.y+(f.col1.y*g.x+f.col2.y*g.y),g=v[l],f=e.R,q=e.position.x+(f.col1.x*g.x+f.col2.x*g.y),p=e.position.y+(f.col1.y*g.x+f.col2.y*g.y),q-=o,p-=v1Y,r=q*h+p*i},b2Collision.FindMaxSeparation=function(a,b,c,d,e){var f,g,h=b.m_vertexCount,i=b.m_normals;g=e.R,f=d.m_centroid;var j=e.position.x+(g.col1.x*f.x+g.col2.x*f.y),k=e.position.y+(g.col1.y*f.x+g.col2.y*f.y);g=c.R,f=b.m_centroid,j-=c.position.x+(g.col1.x*f.x+g.col2.x*f.y),k-=c.position.y+(g.col1.y*f.x+g.col2.y*f.y);for(var l=j*c.R.col1.x+k*c.R.col1.y,m=j*c.R.col2.x+k*c.R.col2.y,n=0,o=-Number.MAX_VALUE,p=0;h>p;++p){f=i[p];var q=f.x*l+f.y*m;q>o&&(o=q,n=p)}var r,s=b2Collision.EdgeSeparation(b,c,n,d,e),t=n-1>=0?n-1:h-1,u=b2Collision.EdgeSeparation(b,c,t,d,e),v=h>n+1?n+1:0,w=b2Collision.EdgeSeparation(b,c,v,d,e),x=0,y=0;if(u>s&&u>w)y=-1,x=t,r=u;else{if(!(w>s))return a[0]=n,s;y=1,x=v,r=w}for(;;){if(n=-1==y?x-1>=0?x-1:h-1:h>x+1?x+1:0,s=b2Collision.EdgeSeparation(b,c,n,d,e),!(s>r))break;x=n,r=s}return a[0]=x,r},b2Collision.FindIncidentEdge=function(a,b,c,d,e,f){var g,h,i=(b.m_vertexCount,b.m_normals),j=e.m_vertexCount,k=e.m_vertices,l=e.m_normals;g=c.R,h=i[d];var m=g.col1.x*h.x+g.col2.x*h.y,n=g.col1.y*h.x+g.col2.y*h.y;g=f.R;var o=g.col1.x*m+g.col1.y*n;n=g.col2.x*m+g.col2.y*n,m=o;for(var p=0,q=Number.MAX_VALUE,r=0;j>r;++r){h=l[r];var s=m*h.x+n*h.y;q>s&&(q=s,p=r)}var t,u=p,v=j>u+1?u+1:0;t=a[0],h=k[u],g=f.R,t.v.x=f.position.x+(g.col1.x*h.x+g.col2.x*h.y),t.v.y=f.position.y+(g.col1.y*h.x+g.col2.y*h.y),t.id.features.referenceEdge=d,t.id.features.incidentEdge=u,t.id.features.incidentVertex=0,t=a[1],h=k[v],g=f.R,t.v.x=f.position.x+(g.col1.x*h.x+g.col2.x*h.y),t.v.y=f.position.y+(g.col1.y*h.x+g.col2.y*h.y),t.id.features.referenceEdge=d,t.id.features.incidentEdge=v,t.id.features.incidentVertex=1},b2Collision.CollidePolygons=function(a,b,c,d,e){var f;a.m_pointCount=0;var g=b.m_radius+d.m_radius,h=0;b2Collision.s_edgeAO[0]=h;var i=b2Collision.FindMaxSeparation(b2Collision.s_edgeAO,b,c,d,e);if(h=b2Collision.s_edgeAO[0],!(i>g)){var j=0;b2Collision.s_edgeBO[0]=j;var k=b2Collision.FindMaxSeparation(b2Collision.s_edgeBO,d,e,b,c);if(j=b2Collision.s_edgeBO[0],!(k>g)){var l,m,n,o,p,q=0,r=0,s=.98,t=.001;k>s*i+t?(l=d,m=b,n=e,o=c,q=j,a.m_type=b2Manifold.e_faceB,r=1):(l=b,m=d,n=c,o=e,q=h,a.m_type=b2Manifold.e_faceA,r=0);var u=b2Collision.s_incidentEdge;b2Collision.FindIncidentEdge(u,l,n,q,m,o);var v,w=l.m_vertexCount,x=l.m_vertices,y=x[q];v=w>q+1?x[~~(q+1)]:x[0];var z=b2Collision.s_localTangent;z.Set(v.x-y.x,v.y-y.y),z.Normalize();var A=b2Collision.s_localNormal;A.x=z.y,A.y=-z.x;var B=b2Collision.s_planePoint;B.Set(.5*(y.x+v.x),.5*(y.y+v.y));var C=b2Collision.s_tangent;p=n.R,C.x=p.col1.x*z.x+p.col2.x*z.y,C.y=p.col1.y*z.x+p.col2.y*z.y;var D=b2Collision.s_tangent2;D.x=-C.x,D.y=-C.y;var E=b2Collision.s_normal;E.x=C.y,E.y=-C.x;var F=b2Collision.s_v11,G=b2Collision.s_v12;F.x=n.position.x+(p.col1.x*y.x+p.col2.x*y.y),F.y=n.position.y+(p.col1.y*y.x+p.col2.y*y.y),G.x=n.position.x+(p.col1.x*v.x+p.col2.x*v.y),G.y=n.position.y+(p.col1.y*v.x+p.col2.y*v.y);var H=E.x*F.x+E.y*F.y,I=-C.x*F.x-C.y*F.y+g,J=C.x*G.x+C.y*G.y+g,K=b2Collision.s_clipPoints1,L=b2Collision.s_clipPoints2,M=0;if(M=b2Collision.ClipSegmentToLine(K,u,D,I),!(2>M||(M=b2Collision.ClipSegmentToLine(L,K,C,J),2>M))){a.m_localPlaneNormal.SetV(A),a.m_localPoint.SetV(B);for(var N=0,O=0;O<b2Settings.b2_maxManifoldPoints;++O){f=L[O];var P=E.x*f.v.x+E.y*f.v.y-H;if(g>=P){var Q=a.m_points[N];p=o.R;var R=f.v.x-o.position.x,S=f.v.y-o.position.y;Q.m_localPoint.x=R*p.col1.x+S*p.col1.y,Q.m_localPoint.y=R*p.col2.x+S*p.col2.y,Q.m_id.Set(f.id),Q.m_id.features.flip=r,++N}}a.m_pointCount=N}}}},b2Collision.CollideCircles=function(a,b,c,d,e){a.m_pointCount=0;var f,g;f=c.R,g=b.m_p;var h=c.position.x+(f.col1.x*g.x+f.col2.x*g.y),i=c.position.y+(f.col1.y*g.x+f.col2.y*g.y);f=e.R,g=d.m_p;var j=e.position.x+(f.col1.x*g.x+f.col2.x*g.y),k=e.position.y+(f.col1.y*g.x+f.col2.y*g.y),l=j-h,m=k-i,n=l*l+m*m,o=b.m_radius+d.m_radius;n>o*o||(a.m_type=b2Manifold.e_circles,a.m_localPoint.SetV(b.m_p),a.m_localPlaneNormal.SetZero(),a.m_pointCount=1,a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.key=0)},b2Collision.CollidePolygonAndCircle=function(a,b,c,d,e){a.m_pointCount=0;var f,g,h,i;i=e.R,h=d.m_p;var j=e.position.x+(i.col1.x*h.x+i.col2.x*h.y),k=e.position.y+(i.col1.y*h.x+i.col2.y*h.y);f=j-c.position.x,g=k-c.position.y,i=c.R;for(var l=f*i.col1.x+g*i.col1.y,m=f*i.col2.x+g*i.col2.y,n=0,o=-Number.MAX_VALUE,p=b.m_radius+d.m_radius,q=b.m_vertexCount,r=b.m_vertices,s=b.m_normals,t=0;q>t;++t){h=r[t],f=l-h.x,g=m-h.y,h=s[t];var u=h.x*f+h.y*g;if(u>p)return;u>o&&(o=u,n=t)}var v=n,w=q>v+1?v+1:0,x=r[v],y=r[w];if(o<Number.MIN_VALUE)return a.m_pointCount=1,a.m_type=b2Manifold.e_faceA,a.m_localPlaneNormal.SetV(s[n]),a.m_localPoint.x=.5*(x.x+y.x),a.m_localPoint.y=.5*(x.y+y.y),a.m_points[0].m_localPoint.SetV(d.m_p),void(a.m_points[0].m_id.key=0);var z=(l-x.x)*(y.x-x.x)+(m-x.y)*(y.y-x.y),A=(l-y.x)*(x.x-y.x)+(m-y.y)*(x.y-y.y);if(0>=z){if((l-x.x)*(l-x.x)+(m-x.y)*(m-x.y)>p*p)return;a.m_pointCount=1,a.m_type=b2Manifold.e_faceA,a.m_localPlaneNormal.x=l-x.x,a.m_localPlaneNormal.y=m-x.y,a.m_localPlaneNormal.Normalize(),a.m_localPoint.SetV(x),a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.key=0}else if(0>=A){if((l-y.x)*(l-y.x)+(m-y.y)*(m-y.y)>p*p)return;a.m_pointCount=1,a.m_type=b2Manifold.e_faceA,a.m_localPlaneNormal.x=l-y.x,a.m_localPlaneNormal.y=m-y.y,a.m_localPlaneNormal.Normalize(),a.m_localPoint.SetV(y),a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.key=0}else{var B=.5*(x.x+y.x),C=.5*(x.y+y.y);if(o=(l-B)*s[v].x+(m-C)*s[v].y,o>p)return;a.m_pointCount=1,a.m_type=b2Manifold.e_faceA,a.m_localPlaneNormal.x=s[v].x,a.m_localPlaneNormal.y=s[v].y,a.m_localPlaneNormal.Normalize(),a.m_localPoint.Set(B,C),a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.key=0}},b2Collision.TestOverlap=function(a,b){var c,d,e=b.lowerBound,f=a.upperBound,g=e.x-f.x,h=e.y-f.y;return e=a.lowerBound,f=b.upperBound,c=e.x-f.x,d=e.y-f.y,g>0||h>0?!1:c>0||d>0?!1:!0},b2Collision.b2_nullFeature=255,b2Collision.s_incidentEdge=b2Collision.MakeClipPointVector(),b2Collision.s_clipPoints1=b2Collision.MakeClipPointVector(),b2Collision.s_clipPoints2=b2Collision.MakeClipPointVector(),b2Collision.s_edgeAO=new Array(1),b2Collision.s_edgeBO=new Array(1),b2Collision.s_localTangent=new b2Vec2,b2Collision.s_localNormal=new b2Vec2,b2Collision.s_planePoint=new b2Vec2,b2Collision.s_normal=new b2Vec2,b2Collision.s_tangent=new b2Vec2,b2Collision.s_tangent2=new b2Vec2,b2Collision.s_v11=new b2Vec2,b2Collision.s_v12=new b2Vec2,b2Collision.b2CollidePolyTempVec=new b2Vec2;var b2PolyAndCircleContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PolyAndCircleContact.prototype,b2Contact.prototype),b2PolyAndCircleContact.prototype._super=b2Contact.prototype,b2PolyAndCircleContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2PolyAndCircleContact.prototype.__varz=function(){},b2PolyAndCircleContact.Create=function(a){return new b2PolyAndCircleContact},b2PolyAndCircleContact.Destroy=function(a,b){},b2PolyAndCircleContact.prototype.Evaluate=function(){var a=this.m_fixtureA.m_body,b=this.m_fixtureB.m_body;b2Collision.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape(),a.m_xf,this.m_fixtureB.GetShape(),b.m_xf)},b2PolyAndCircleContact.prototype.Reset=function(a,b){this._super.Reset.apply(this,[a,b]),b2Settings.b2Assert(a.GetType()==b2Shape.e_polygonShape),b2Settings.b2Assert(b.GetType()==b2Shape.e_circleShape)};var b2ContactPoint=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactPoint.prototype.__constructor=function(){},b2ContactPoint.prototype.__varz=function(){this.position=new b2Vec2,this.velocity=new b2Vec2,this.normal=new b2Vec2,this.id=new b2ContactID},b2ContactPoint.prototype.shape1=null,b2ContactPoint.prototype.shape2=null,b2ContactPoint.prototype.position=new b2Vec2,b2ContactPoint.prototype.velocity=new b2Vec2,b2ContactPoint.prototype.normal=new b2Vec2,b2ContactPoint.prototype.separation=null,b2ContactPoint.prototype.friction=null,b2ContactPoint.prototype.restitution=null,b2ContactPoint.prototype.id=new b2ContactID;var b2CircleContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2CircleContact.prototype,b2Contact.prototype),b2CircleContact.prototype._super=b2Contact.prototype,b2CircleContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2CircleContact.prototype.__varz=function(){},b2CircleContact.Create=function(a){return new b2CircleContact},b2CircleContact.Destroy=function(a,b){},b2CircleContact.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();b2Collision.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape(),a.m_xf,this.m_fixtureB.GetShape(),b.m_xf)},b2CircleContact.prototype.Reset=function(a,b){this._super.Reset.apply(this,[a,b])};var b2EdgeAndCircleContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2EdgeAndCircleContact.prototype,b2Contact.prototype),b2EdgeAndCircleContact.prototype._super=b2Contact.prototype,b2EdgeAndCircleContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2EdgeAndCircleContact.prototype.__varz=function(){},b2EdgeAndCircleContact.Create=function(a){return new b2EdgeAndCircleContact},b2EdgeAndCircleContact.Destroy=function(a,b){},b2EdgeAndCircleContact.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape(),a.m_xf,this.m_fixtureB.GetShape(),b.m_xf)},b2EdgeAndCircleContact.prototype.b2CollideEdgeAndCircle=function(a,b,c,d,e){},b2EdgeAndCircleContact.prototype.Reset=function(a,b){this._super.Reset.apply(this,[a,b])};var b2ContactManager=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactManager.prototype.__constructor=function(){this.m_world=null,this.m_contactCount=0,this.m_contactFilter=b2ContactFilter.b2_defaultFilter,this.m_contactListener=b2ContactListener.b2_defaultListener,this.m_contactFactory=new b2ContactFactory(this.m_allocator),
this.m_broadPhase=new b2DynamicTreeBroadPhase},b2ContactManager.prototype.__varz=function(){},b2ContactManager.s_evalCP=new b2ContactPoint,b2ContactManager.prototype.AddPair=function(a,b){var c=a,d=b,e=c.GetBody(),f=d.GetBody();if(e!=f){for(var g,h,i=f.GetContactList();i;){if(i.other==e){if(g=i.contact.GetFixtureA(),h=i.contact.GetFixtureB(),g==c&&h==d)return;if(g==d&&h==c)return}i=i.next}if(0!=f.ShouldCollide(e)&&0!=this.m_contactFilter.ShouldCollide(c,d)){var j=this.m_contactFactory.Create(c,d);c=j.GetFixtureA(),d=j.GetFixtureB(),e=c.m_body,f=d.m_body,j.m_prev=null,j.m_next=this.m_world.m_contactList,null!=this.m_world.m_contactList&&(this.m_world.m_contactList.m_prev=j),this.m_world.m_contactList=j,j.m_nodeA.contact=j,j.m_nodeA.other=f,j.m_nodeA.prev=null,j.m_nodeA.next=e.m_contactList,null!=e.m_contactList&&(e.m_contactList.prev=j.m_nodeA),e.m_contactList=j.m_nodeA,j.m_nodeB.contact=j,j.m_nodeB.other=e,j.m_nodeB.prev=null,j.m_nodeB.next=f.m_contactList,null!=f.m_contactList&&(f.m_contactList.prev=j.m_nodeB),f.m_contactList=j.m_nodeB,++this.m_world.m_contactCount}}},b2ContactManager.prototype.FindNewContacts=function(){var a=this;this.m_broadPhase.UpdatePairs(function(b,c){return a.AddPair(b,c)})},b2ContactManager.prototype.Destroy=function(a){var b=a.GetFixtureA(),c=a.GetFixtureB(),d=b.GetBody(),e=c.GetBody();a.IsTouching()&&this.m_contactListener.EndContact(a),a.m_prev&&(a.m_prev.m_next=a.m_next),a.m_next&&(a.m_next.m_prev=a.m_prev),a==this.m_world.m_contactList&&(this.m_world.m_contactList=a.m_next),a.m_nodeA.prev&&(a.m_nodeA.prev.next=a.m_nodeA.next),a.m_nodeA.next&&(a.m_nodeA.next.prev=a.m_nodeA.prev),a.m_nodeA==d.m_contactList&&(d.m_contactList=a.m_nodeA.next),a.m_nodeB.prev&&(a.m_nodeB.prev.next=a.m_nodeB.next),a.m_nodeB.next&&(a.m_nodeB.next.prev=a.m_nodeB.prev),a.m_nodeB==e.m_contactList&&(e.m_contactList=a.m_nodeB.next),this.m_contactFactory.Destroy(a),--this.m_contactCount},b2ContactManager.prototype.Collide=function(){for(var a,b,c,d,e,f,g,h,i=this.m_world.m_contactList;i;)if(a=i.GetFixtureA(),b=i.GetFixtureB(),c=a.GetBody(),d=b.GetBody(),0!=c.IsAwake()||0!=d.IsAwake()){if(i.m_flags&b2Contact.e_filterFlag){if(0==d.ShouldCollide(c)){e=i,i=e.GetNext(),this.Destroy(e);continue}if(0==this.m_contactFilter.ShouldCollide(a,b)){e=i,i=e.GetNext(),this.Destroy(e);continue}i.m_flags&=~b2Contact.e_filterFlag}f=a.m_proxy,g=b.m_proxy,h=this.m_broadPhase.TestOverlap(f,g),0!=h?(i.Update(this.m_contactListener),i=i.GetNext()):(e=i,i=e.GetNext(),this.Destroy(e))}else i=i.GetNext()},b2ContactManager.prototype.m_world=null,b2ContactManager.prototype.m_broadPhase=null,b2ContactManager.prototype.m_contactList=null,b2ContactManager.prototype.m_contactCount=0,b2ContactManager.prototype.m_contactFilter=null,b2ContactManager.prototype.m_contactListener=null,b2ContactManager.prototype.m_contactFactory=null,b2ContactManager.prototype.m_allocator=null;var b2World=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2World.prototype.__constructor=function(a,b){this.m_destructionListener=null,this.m_debugDraw=null,this.m_bodyList=null,this.m_contactList=null,this.m_jointList=null,this.m_controllerList=null,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_controllerCount=0,b2World.m_warmStarting=!0,b2World.m_continuousPhysics=!0,this.m_allowSleep=b,this.m_gravity=a,this.m_inv_dt0=0,this.m_contactManager.m_world=this;var c=new b2BodyDef;this.m_groundBody=this.CreateBody(c)},b2World.prototype.__varz=function(){this.s_stack=new Array,this.m_contactManager=new b2ContactManager,this.m_contactSolver=new b2ContactSolver,this.m_island=new b2Island},b2World.s_timestep2=new b2TimeStep,b2World.s_backupA=new b2Sweep,b2World.s_backupB=new b2Sweep,b2World.s_timestep=new b2TimeStep,b2World.s_queue=new Array,b2World.e_newFixture=1,b2World.e_locked=2,b2World.s_xf=new b2Transform,b2World.s_jointColor=new b2Color(.5,.8,.8),b2World.m_warmStarting=null,b2World.m_continuousPhysics=null,b2World.prototype.Solve=function(a){var b,c,d,e,f,g,h;for(c=this.m_controllerList;c;c=c.m_next)c.Step(a);for(d=this.m_island,d.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver),b=this.m_bodyList;b;b=b.m_next)b.m_flags&=~b2Body.e_islandFlag;for(e=this.m_contactList;e;e=e.m_next)e.m_flags&=~b2Contact.e_islandFlag;for(j=this.m_jointList;j;j=j.m_next)j.m_islandFlag=!1;for(f=this.m_bodyCount,g=this.s_stack,h=this.m_bodyList;h;h=h.m_next)if(!(h.m_flags&b2Body.e_islandFlag)&&0!=h.IsAwake()&&0!=h.IsActive()&&h.GetType()!=b2Body.b2_staticBody){d.Clear();var i=0;for(g[i++]=h,h.m_flags|=b2Body.e_islandFlag;i>0;)if(b=g[--i],d.AddBody(b),0==b.IsAwake()&&b.SetAwake(!0),b.GetType()!=b2Body.b2_staticBody){for(var k,l=b.m_contactList;l;l=l.next)l.contact.m_flags&b2Contact.e_islandFlag||1!=l.contact.IsSensor()&&0!=l.contact.IsEnabled()&&0!=l.contact.IsTouching()&&(d.AddContact(l.contact),l.contact.m_flags|=b2Contact.e_islandFlag,k=l.other,k.m_flags&b2Body.e_islandFlag||(g[i++]=k,k.m_flags|=b2Body.e_islandFlag));for(var m=b.m_jointList;m;m=m.next)1!=m.joint.m_islandFlag&&(k=m.other,0!=k.IsActive()&&(d.AddJoint(m.joint),m.joint.m_islandFlag=!0,k.m_flags&b2Body.e_islandFlag||(g[i++]=k,k.m_flags|=b2Body.e_islandFlag)))}d.Solve(a,this.m_gravity,this.m_allowSleep);for(var n=0;n<d.m_bodyCount;++n)b=d.m_bodies[n],b.GetType()==b2Body.b2_staticBody&&(b.m_flags&=~b2Body.e_islandFlag)}for(n=0;n<g.length&&g[n];++n)g[n]=null;for(b=this.m_bodyList;b;b=b.m_next)0!=b.IsAwake()&&0!=b.IsActive()&&b.GetType()!=b2Body.b2_staticBody&&b.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},b2World.prototype.SolveTOI=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o=this.m_island;for(o.Initialize(this.m_bodyCount,b2Settings.b2_maxTOIContactsPerIsland,b2Settings.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver),i=b2World.s_queue,b=this.m_bodyList;b;b=b.m_next)b.m_flags&=~b2Body.e_islandFlag,b.m_sweep.t0=0;for(j=this.m_contactList;j;j=j.m_next)j.m_flags&=~(b2Contact.e_toiFlag|b2Contact.e_islandFlag);for(h=this.m_jointList;h;h=h.m_next)h.m_islandFlag=!1;for(;;){for(k=null,l=1,j=this.m_contactList;j;j=j.m_next)if(1!=j.IsSensor()&&0!=j.IsEnabled()&&0!=j.IsContinuous()){if(m=1,j.m_flags&b2Contact.e_toiFlag)m=j.m_toi;else{if(c=j.m_fixtureA,d=j.m_fixtureB,e=c.m_body,f=d.m_body,!(e.GetType()==b2Body.b2_dynamicBody&&0!=e.IsAwake()||f.GetType()==b2Body.b2_dynamicBody&&0!=f.IsAwake()))continue;n=e.m_sweep.t0,e.m_sweep.t0<f.m_sweep.t0?(n=f.m_sweep.t0,e.m_sweep.Advance(n)):f.m_sweep.t0<e.m_sweep.t0&&(n=e.m_sweep.t0,f.m_sweep.Advance(n)),m=j.ComputeTOI(e.m_sweep,f.m_sweep),b2Settings.b2Assert(m>=0&&1>=m),m>0&&1>m&&(m=(1-m)*n+m,m>1&&(m=1)),j.m_toi=m,j.m_flags|=b2Contact.e_toiFlag}Number.MIN_VALUE<m&&l>m&&(k=j,l=m)}if(null==k||1-100*Number.MIN_VALUE<l)break;if(c=k.m_fixtureA,d=k.m_fixtureB,e=c.m_body,f=d.m_body,b2World.s_backupA.Set(e.m_sweep),b2World.s_backupB.Set(f.m_sweep),e.Advance(l),f.Advance(l),k.Update(this.m_contactManager.m_contactListener),k.m_flags&=~b2Contact.e_toiFlag,1!=k.IsSensor()&&0!=k.IsEnabled()){if(0!=k.IsTouching()){var p=e;p.GetType()!=b2Body.b2_dynamicBody&&(p=f),o.Clear();var q=0,r=0;for(i[q+r++]=p,p.m_flags|=b2Body.e_islandFlag;r>0;)if(b=i[q++],--r,o.AddBody(b),0==b.IsAwake()&&b.SetAwake(!0),b.GetType()==b2Body.b2_dynamicBody){for(g=b.m_contactList;g&&o.m_contactCount!=o.m_contactCapacity;g=g.next)if(!(g.contact.m_flags&b2Contact.e_islandFlag)&&1!=g.contact.IsSensor()&&0!=g.contact.IsEnabled()&&0!=g.contact.IsTouching()){o.AddContact(g.contact),g.contact.m_flags|=b2Contact.e_islandFlag;var s=g.other;s.m_flags&b2Body.e_islandFlag||(s.GetType()!=b2Body.b2_staticBody&&(s.Advance(l),s.SetAwake(!0)),i[q+r]=s,++r,s.m_flags|=b2Body.e_islandFlag)}for(var t=b.m_jointList;t;t=t.next)o.m_jointCount!=o.m_jointCapacity&&1!=t.joint.m_islandFlag&&(s=t.other,0!=s.IsActive()&&(o.AddJoint(t.joint),t.joint.m_islandFlag=!0,s.m_flags&b2Body.e_islandFlag||(s.GetType()!=b2Body.b2_staticBody&&(s.Advance(l),s.SetAwake(!0)),i[q+r]=s,++r,s.m_flags|=b2Body.e_islandFlag)))}var u=b2World.s_timestep;u.warmStarting=!1,u.dt=(1-l)*a.dt,u.inv_dt=1/u.dt,u.dtRatio=0,u.velocityIterations=a.velocityIterations,u.positionIterations=a.positionIterations,o.SolveTOI(u);var v=0;for(v=0;v<o.m_bodyCount;++v)if(b=o.m_bodies[v],b.m_flags&=~b2Body.e_islandFlag,0!=b.IsAwake()&&b.GetType()==b2Body.b2_dynamicBody)for(b.SynchronizeFixtures(),g=b.m_contactList;g;g=g.next)g.contact.m_flags&=~b2Contact.e_toiFlag;for(v=0;v<o.m_contactCount;++v)j=o.m_contacts[v],j.m_flags&=~(b2Contact.e_toiFlag|b2Contact.e_islandFlag);for(v=0;v<o.m_jointCount;++v)h=o.m_joints[v],h.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}else e.m_sweep.Set(b2World.s_backupA),f.m_sweep.Set(b2World.s_backupB),e.SynchronizeTransform(),f.SynchronizeTransform()}},b2World.prototype.DrawJoint=function(a){var b=a.GetBodyA(),c=a.GetBodyB(),d=b.m_xf,e=c.m_xf,f=d.position,g=e.position,h=a.GetAnchorA(),i=a.GetAnchorB(),j=b2World.s_jointColor;switch(a.m_type){case b2Joint.e_distanceJoint:this.m_debugDraw.DrawSegment(h,i,j);break;case b2Joint.e_pulleyJoint:var k=a,l=k.GetGroundAnchorA(),m=k.GetGroundAnchorB();this.m_debugDraw.DrawSegment(l,h,j),this.m_debugDraw.DrawSegment(m,i,j),this.m_debugDraw.DrawSegment(l,m,j);break;case b2Joint.e_mouseJoint:this.m_debugDraw.DrawSegment(h,i,j);break;default:b!=this.m_groundBody&&this.m_debugDraw.DrawSegment(f,h,j),this.m_debugDraw.DrawSegment(h,i,j),c!=this.m_groundBody&&this.m_debugDraw.DrawSegment(g,i,j)}},b2World.prototype.DrawShape=function(a,b,c){switch(a.m_type){case b2Shape.e_circleShape:var d=a,e=b2Math.MulX(b,d.m_p),f=d.m_radius,g=b.R.col1;this.m_debugDraw.DrawSolidCircle(e,f,g,c);break;case b2Shape.e_polygonShape:var h=0,i=a,j=i.GetVertexCount(),k=i.GetVertices(),l=new Array(j);for(h=0;j>h;++h)l[h]=b2Math.MulX(b,k[h]);this.m_debugDraw.DrawSolidPolygon(l,j,c);break;case b2Shape.e_edgeShape:var m=a;this.m_debugDraw.DrawSegment(b2Math.MulX(b,m.GetVertex1()),b2Math.MulX(b,m.GetVertex2()),c)}},b2World.prototype.SetDestructionListener=function(a){this.m_destructionListener=a},b2World.prototype.SetContactFilter=function(a){this.m_contactManager.m_contactFilter=a},b2World.prototype.SetContactListener=function(a){this.m_contactManager.m_contactListener=a},b2World.prototype.SetDebugDraw=function(a){this.m_debugDraw=a},b2World.prototype.SetBroadPhase=function(a){var b=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=a;for(var c=this.m_bodyList;c;c=c.m_next)for(var d=c.m_fixtureList;d;d=d.m_next)d.m_proxy=a.CreateProxy(b.GetFatAABB(d.m_proxy),d)},b2World.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()},b2World.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},b2World.prototype.CreateBody=function(a){if(1==this.IsLocked())return null;var b=new b2Body(a,this);return b.m_prev=null,b.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=b),this.m_bodyList=b,++this.m_bodyCount,b},b2World.prototype.DestroyBody=function(a){if(1!=this.IsLocked()){for(var b=a.m_jointList;b;){var c=b;b=b.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(c.joint),this.DestroyJoint(c.joint)}for(var d=a.m_controllerList;d;){var e=d;d=d.nextController,e.controller.RemoveBody(a)}for(var f=a.m_contactList;f;){var g=f;f=f.next,this.m_contactManager.Destroy(g.contact)}a.m_contactList=null;for(var h=a.m_fixtureList;h;){var i=h;h=h.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(i),i.DestroyProxy(this.m_contactManager.m_broadPhase),i.Destroy()}a.m_fixtureList=null,a.m_fixtureCount=0,a.m_prev&&(a.m_prev.m_next=a.m_next),a.m_next&&(a.m_next.m_prev=a.m_prev),a==this.m_bodyList&&(this.m_bodyList=a.m_next),--this.m_bodyCount}},b2World.prototype.CreateJoint=function(a){var b=b2Joint.Create(a,null);b.m_prev=null,b.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=b),this.m_jointList=b,++this.m_jointCount,b.m_edgeA.joint=b,b.m_edgeA.other=b.m_bodyB,b.m_edgeA.prev=null,b.m_edgeA.next=b.m_bodyA.m_jointList,b.m_bodyA.m_jointList&&(b.m_bodyA.m_jointList.prev=b.m_edgeA),b.m_bodyA.m_jointList=b.m_edgeA,b.m_edgeB.joint=b,b.m_edgeB.other=b.m_bodyA,b.m_edgeB.prev=null,b.m_edgeB.next=b.m_bodyB.m_jointList,b.m_bodyB.m_jointList&&(b.m_bodyB.m_jointList.prev=b.m_edgeB),b.m_bodyB.m_jointList=b.m_edgeB;var c=a.bodyA,d=a.bodyB;if(0==a.collideConnected)for(var e=d.GetContactList();e;)e.other==c&&e.contact.FlagForFiltering(),e=e.next;return b},b2World.prototype.DestroyJoint=function(a){var b=a.m_collideConnected;a.m_prev&&(a.m_prev.m_next=a.m_next),a.m_next&&(a.m_next.m_prev=a.m_prev),a==this.m_jointList&&(this.m_jointList=a.m_next);var c=a.m_bodyA,d=a.m_bodyB;if(c.SetAwake(!0),d.SetAwake(!0),a.m_edgeA.prev&&(a.m_edgeA.prev.next=a.m_edgeA.next),a.m_edgeA.next&&(a.m_edgeA.next.prev=a.m_edgeA.prev),a.m_edgeA==c.m_jointList&&(c.m_jointList=a.m_edgeA.next),a.m_edgeA.prev=null,a.m_edgeA.next=null,a.m_edgeB.prev&&(a.m_edgeB.prev.next=a.m_edgeB.next),a.m_edgeB.next&&(a.m_edgeB.next.prev=a.m_edgeB.prev),a.m_edgeB==d.m_jointList&&(d.m_jointList=a.m_edgeB.next),a.m_edgeB.prev=null,a.m_edgeB.next=null,b2Joint.Destroy(a,null),--this.m_jointCount,0==b)for(var e=d.GetContactList();e;)e.other==c&&e.contact.FlagForFiltering(),e=e.next},b2World.prototype.AddController=function(a){return a.m_next=this.m_controllerList,a.m_prev=null,this.m_controllerList=a,a.m_world=this,this.m_controllerCount++,a},b2World.prototype.RemoveController=function(a){a.m_prev&&(a.m_prev.m_next=a.m_next),a.m_next&&(a.m_next.m_prev=a.m_prev),this.m_controllerList==a&&(this.m_controllerList=a.m_next),this.m_controllerCount--},b2World.prototype.CreateController=function(a){if(a.m_world!=this)throw new Error("Controller can only be a member of one world");return a.m_next=this.m_controllerList,a.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=a),this.m_controllerList=a,++this.m_controllerCount,a.m_world=this,a},b2World.prototype.DestroyController=function(a){a.Clear(),a.m_next&&(a.m_next.m_prev=a.m_prev),a.m_prev&&(a.m_prev.m_next=a.m_next),a==this.m_controllerList&&(this.m_controllerList=a.m_next),--this.m_controllerCount},b2World.prototype.SetWarmStarting=function(a){b2World.m_warmStarting=a},b2World.prototype.SetContinuousPhysics=function(a){b2World.m_continuousPhysics=a},b2World.prototype.GetBodyCount=function(){return this.m_bodyCount},b2World.prototype.GetJointCount=function(){return this.m_jointCount},b2World.prototype.GetContactCount=function(){return this.m_contactCount},b2World.prototype.SetGravity=function(a){this.m_gravity=a},b2World.prototype.GetGravity=function(){return this.m_gravity},b2World.prototype.GetGroundBody=function(){return this.m_groundBody},b2World.prototype.Step=function(a,b,c){this.m_flags&b2World.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~b2World.e_newFixture),this.m_flags|=b2World.e_locked;var d=b2World.s_timestep2;d.dt=a,d.velocityIterations=b,d.positionIterations=c,a>0?d.inv_dt=1/a:d.inv_dt=0,d.dtRatio=this.m_inv_dt0*a,d.warmStarting=b2World.m_warmStarting,this.m_contactManager.Collide(),d.dt>0&&this.Solve(d),b2World.m_continuousPhysics&&d.dt>0&&this.SolveTOI(d),d.dt>0&&(this.m_inv_dt0=d.inv_dt),this.m_flags&=~b2World.e_locked},b2World.prototype.ClearForces=function(){for(var a=this.m_bodyList;a;a=a.m_next)a.m_force.SetZero(),a.m_torque=0},b2World.prototype.DrawDebugData=function(){if(null!=this.m_debugDraw){this.m_debugDraw.Clear();var a,b,c,d,e,f,g=this.m_debugDraw.GetFlags(),h=(new b2Vec2,new b2Vec2,new b2Vec2,new b2AABB,new b2AABB,[new b2Vec2,new b2Vec2,new b2Vec2,new b2Vec2]),i=new b2Color(0,0,0);if(g&b2DebugDraw.e_shapeBit)for(a=this.m_bodyList;a;a=a.m_next)for(f=a.m_xf,b=a.GetFixtureList();b;b=b.m_next)c=b.GetShape(),0==a.IsActive()?(i.Set(.5,.5,.3),this.DrawShape(c,f,i)):a.GetType()==b2Body.b2_staticBody?(i.Set(.5,.9,.5),this.DrawShape(c,f,i)):a.GetType()==b2Body.b2_kinematicBody?(i.Set(.5,.5,.9),this.DrawShape(c,f,i)):(0==a.IsAwake()&&(i.Set(.6,.6,.6),this.DrawShape(c,f,i)),1==b.IsSensor()?(i.Set(.55,.56,.55),this.DrawShape(c,f,i)):(i.Set(.9,.7,.7),this.DrawShape(c,f,i)));if(g&b2DebugDraw.e_jointBit)for(d=this.m_jointList;d;d=d.m_next)this.DrawJoint(d);if(g&b2DebugDraw.e_controllerBit)for(var j=this.m_controllerList;j;j=j.m_next)j.Draw(this.m_debugDraw);if(g&b2DebugDraw.e_pairBit){i.Set(.3,.9,.9);for(var k=this.m_contactManager.m_contactList;k;k=k.GetNext()){var l=k.GetFixtureA(),m=k.GetFixtureB(),n=l.GetAABB().GetCenter(),o=m.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(n,o,i)}}if(g&b2DebugDraw.e_aabbBit)for(e=this.m_contactManager.m_broadPhase,h=[new b2Vec2,new b2Vec2,new b2Vec2,new b2Vec2],a=this.m_bodyList;a;a=a.GetNext())if(0!=a.IsActive())for(b=a.GetFixtureList();b;b=b.GetNext()){var p=e.GetFatAABB(b.m_proxy);h[0].Set(p.lowerBound.x,p.lowerBound.y),h[1].Set(p.upperBound.x,p.lowerBound.y),h[2].Set(p.upperBound.x,p.upperBound.y),h[3].Set(p.lowerBound.x,p.upperBound.y),this.m_debugDraw.DrawPolygon(h,4,i)}if(g&b2DebugDraw.e_centerOfMassBit)for(a=this.m_bodyList;a;a=a.m_next)f=b2World.s_xf,f.R=a.m_xf.R,f.position=a.GetWorldCenter(),this.m_debugDraw.DrawTransform(f)}},b2World.prototype.QueryAABB=function(a,b){function c(b){return a(d.GetUserData(b))}var d=this.m_contactManager.m_broadPhase;d.Query(c,b)},b2World.prototype.QueryShape=function(a,b,c){function d(d){var f=e.GetUserData(d);return b2Shape.TestOverlap(b,c,f.GetShape(),f.GetBody().GetTransform())?a(f):!0}null==c&&(c=new b2Transform,c.SetIdentity());var e=this.m_contactManager.m_broadPhase,f=new b2AABB;b.ComputeAABB(f,c),e.Query(d,f)},b2World.prototype.QueryPoint=function(a,b){function c(c){var e=d.GetUserData(c);return e.TestPoint(b)?a(e):!0}var d=this.m_contactManager.m_broadPhase,e=new b2AABB;e.lowerBound.Set(b.x-b2Settings.b2_linearSlop,b.y-b2Settings.b2_linearSlop),e.upperBound.Set(b.x+b2Settings.b2_linearSlop,b.y+b2Settings.b2_linearSlop),d.Query(c,e)},b2World.prototype.RayCast=function(a,b,c){function d(d,e){var h=f.GetUserData(e),i=h,j=i.RayCast(g,d);if(j){var k=g.fraction,l=new b2Vec2((1-k)*b.x+k*c.x,(1-k)*b.y+k*c.y);return a(i,l,g.normal,k)}return d.maxFraction}var e,f=this.m_contactManager.m_broadPhase,g=new b2RayCastOutput;e=new b2RayCastInput(b,c),f.RayCast(d,e)},b2World.prototype.RayCastOne=function(a,b){function c(a,b,c,e){return d=a,e}var d;return this.RayCast(c,a,b),d},b2World.prototype.RayCastAll=function(a,b){function c(a,b,c,e){return d[d.length]=a,1}var d=new Array;return this.RayCast(c,a,b),d},b2World.prototype.GetBodyList=function(){return this.m_bodyList},b2World.prototype.GetJointList=function(){return this.m_jointList},b2World.prototype.GetContactList=function(){return this.m_contactList},b2World.prototype.IsLocked=function(){return(this.m_flags&b2World.e_locked)>0},b2World.prototype.s_stack=new Array,b2World.prototype.m_flags=0,b2World.prototype.m_contactManager=new b2ContactManager,b2World.prototype.m_contactSolver=new b2ContactSolver,b2World.prototype.m_island=new b2Island,b2World.prototype.m_bodyList=null,b2World.prototype.m_jointList=null,b2World.prototype.m_contactList=null,b2World.prototype.m_bodyCount=0,b2World.prototype.m_contactCount=0,b2World.prototype.m_jointCount=0,b2World.prototype.m_controllerList=null,b2World.prototype.m_controllerCount=0,b2World.prototype.m_gravity=null,b2World.prototype.m_allowSleep=null,b2World.prototype.m_groundBody=null,b2World.prototype.m_destructionListener=null,b2World.prototype.m_debugDraw=null,b2World.prototype.m_inv_dt0=null,"undefined"!=typeof exports&&(exports.b2BoundValues=b2BoundValues,exports.b2Math=b2Math,exports.b2DistanceOutput=b2DistanceOutput,exports.b2Mat33=b2Mat33,exports.b2ContactPoint=b2ContactPoint,exports.b2PairManager=b2PairManager,exports.b2PositionSolverManifold=b2PositionSolverManifold,exports.b2OBB=b2OBB,exports.b2CircleContact=b2CircleContact,exports.b2PulleyJoint=b2PulleyJoint,exports.b2Pair=b2Pair,exports.b2TimeStep=b2TimeStep,exports.b2FixtureDef=b2FixtureDef,exports.b2World=b2World,exports.b2PrismaticJoint=b2PrismaticJoint,exports.b2Controller=b2Controller,exports.b2ContactID=b2ContactID,exports.b2RevoluteJoint=b2RevoluteJoint,exports.b2JointDef=b2JointDef,exports.b2Transform=b2Transform,exports.b2GravityController=b2GravityController,exports.b2EdgeAndCircleContact=b2EdgeAndCircleContact,exports.b2EdgeShape=b2EdgeShape,exports.b2BuoyancyController=b2BuoyancyController,exports.b2LineJointDef=b2LineJointDef,exports.b2Contact=b2Contact,exports.b2DistanceJoint=b2DistanceJoint,exports.b2Body=b2Body,exports.b2DestructionListener=b2DestructionListener,exports.b2PulleyJointDef=b2PulleyJointDef,exports.b2ContactEdge=b2ContactEdge,exports.b2ContactConstraint=b2ContactConstraint,exports.b2ContactImpulse=b2ContactImpulse,exports.b2DistanceJointDef=b2DistanceJointDef,exports.b2ContactResult=b2ContactResult,exports.b2EdgeChainDef=b2EdgeChainDef,exports.b2Vec2=b2Vec2,exports.b2Vec3=b2Vec3,exports.b2DistanceProxy=b2DistanceProxy,exports.b2FrictionJointDef=b2FrictionJointDef,exports.b2PolygonContact=b2PolygonContact,exports.b2TensorDampingController=b2TensorDampingController,exports.b2ContactFactory=b2ContactFactory,exports.b2WeldJointDef=b2WeldJointDef,exports.b2ConstantAccelController=b2ConstantAccelController,exports.b2GearJointDef=b2GearJointDef,exports.ClipVertex=ClipVertex,exports.b2SeparationFunction=b2SeparationFunction,exports.b2ManifoldPoint=b2ManifoldPoint,exports.b2Color=b2Color,exports.b2PolygonShape=b2PolygonShape,exports.b2DynamicTreePair=b2DynamicTreePair,exports.b2ContactConstraintPoint=b2ContactConstraintPoint,exports.b2FrictionJoint=b2FrictionJoint,exports.b2ContactFilter=b2ContactFilter,exports.b2ControllerEdge=b2ControllerEdge,exports.b2Distance=b2Distance,exports.b2Fixture=b2Fixture,exports.b2DynamicTreeNode=b2DynamicTreeNode,exports.b2MouseJoint=b2MouseJoint,exports.b2DistanceInput=b2DistanceInput,exports.b2BodyDef=b2BodyDef,exports.b2DynamicTreeBroadPhase=b2DynamicTreeBroadPhase,exports.b2Settings=b2Settings,exports.b2Proxy=b2Proxy,exports.b2Point=b2Point,exports.b2BroadPhase=b2BroadPhase,exports.b2Manifold=b2Manifold,exports.b2WorldManifold=b2WorldManifold,exports.b2PrismaticJointDef=b2PrismaticJointDef,exports.b2RayCastOutput=b2RayCastOutput,exports.b2ConstantForceController=b2ConstantForceController,exports.b2TimeOfImpact=b2TimeOfImpact,exports.b2CircleShape=b2CircleShape,exports.b2MassData=b2MassData,exports.b2Joint=b2Joint,exports.b2GearJoint=b2GearJoint,exports.b2DynamicTree=b2DynamicTree,exports.b2JointEdge=b2JointEdge,exports.b2LineJoint=b2LineJoint,exports.b2NullContact=b2NullContact,exports.b2ContactListener=b2ContactListener,exports.b2RayCastInput=b2RayCastInput,exports.b2TOIInput=b2TOIInput,exports.Features=Features,exports.b2FilterData=b2FilterData,exports.b2Island=b2Island,exports.b2ContactManager=b2ContactManager,exports.b2ContactSolver=b2ContactSolver,exports.b2Simplex=b2Simplex,exports.b2AABB=b2AABB,exports.b2Jacobian=b2Jacobian,exports.b2Bound=b2Bound,exports.b2RevoluteJointDef=b2RevoluteJointDef,exports.b2PolyAndEdgeContact=b2PolyAndEdgeContact,exports.b2SimplexVertex=b2SimplexVertex,exports.b2WeldJoint=b2WeldJoint,exports.b2Collision=b2Collision,exports.b2Mat22=b2Mat22,exports.b2SimplexCache=b2SimplexCache,exports.b2PolyAndCircleContact=b2PolyAndCircleContact,exports.b2MouseJointDef=b2MouseJointDef,exports.b2Shape=b2Shape,exports.b2Segment=b2Segment,exports.b2ContactRegister=b2ContactRegister,exports.b2DebugDraw=b2DebugDraw,exports.b2Sweep=b2Sweep),function(){window.b2CreateBox=function(a,b,c,d,e){var f=new b2FixtureDef;f.shape=new b2PolygonShape,f.shape.SetAsBox(.5*d/b2Scale,.5*e/b2Scale),f.density=1,f.friction=1,f.restitution=.5;var g=new b2BodyDef;g.position.Set(b/b2Scale,c/b2Scale);var h=a.CreateBody(g);return h.CreateFixture(f),h.SetType(b2Body.b2_staticBody),h},window.b2CreateCircle=function(a,b,c,d){var e=new b2FixtureDef;e.shape=new b2CircleShape,e.shape.SetRadius(d/b2Scale),e.density=1,e.friction=1,e.restitution=.5;var f=new b2BodyDef;f.position.Set(b/b2Scale,c/b2Scale);var g=a.CreateBody(f);return g.CreateFixture(e),g.SetType(b2Body.b2_staticBody),g},window.b2CreatePolygon=function(a,b){for(var c=new b2BodyDef,d=a.CreateBody(c),e=0;e<b.fixtures.length;e++){var f=b.fixtures[e],g=new b2FixtureDef;if(g.density=f.density,g.friction=f.friction,g.restitution=f.restitution,g.filter.categoryBits=f.categoryBits,g.filter.maskBits=f.maskBits,g.filter.groupIndex=f.groupIndex,g.isSensor=f.isSensor,f.userData&&(g.userData=f.userData),"polygon"===f.fixtureType.toLowerCase())for(var h=0;h<f.polygons.length;h++){for(var i=[],j=0;j<f.polygons[h].length;j++)i.push(new b2Vec2(f.polygons[h][j][0]/b2Scale,f.polygons[h][j][1]/b2Scale));g.shape=new b2PolygonShape,g.shape.SetAsArray(i,i.length),d.CreateFixture(g)}else"circle"===f.fixtureType.toLowerCase()&&(g.shape=new b2CircleShape(f.radius/b2Scale),g.shape.SetLocalPosition(new b2Vec2(f.center[0]/b2Scale,f.center[1]/b2Scale)),d.CreateFixture(g))}return d},window.b2CreateContactListener=function(a){var b=new b2ContactListener;a.SetContactListener(b),b.PreSolve=function(a){var b=a.GetFixtureA(),c=b.GetBody(),d=c.GetUserData(),e=a.GetFixtureB(),f=e.GetBody(),g=f.GetUserData();d&&d.b2PreSolve&&d.b2PreSolve(f,e,g,c,b,a),g&&g.b2PreSolve&&g.b2PreSolve(c,b,d,f,e,a)},b.BeginContact=function(a){var b=a.GetFixtureA(),c=b.GetBody(),d=c.GetUserData(),e=a.GetFixtureB(),f=e.GetBody(),g=f.GetUserData();d&&d.b2BeginContact&&d.b2BeginContact(f,e,g,c,b,a),g&&g.b2BeginContact&&g.b2BeginContact(c,b,d,f,e,a)},b.EndContact=function(a){var b=a.GetFixtureA(),c=b.GetBody(),d=c.GetUserData(),e=a.GetFixtureB(),f=e.GetBody(),g=f.GetUserData();d&&d.b2EndContact&&d.b2EndContact(f,e,g,c,b,a),g&&g.b2EndContact&&g.b2EndContact(c,b,d,f,e,a)},b.PostSolve=function(a){var b=a.GetFixtureA(),c=b.GetBody(),d=c.GetUserData(),e=a.GetFixtureB(),f=e.GetBody(),g=f.GetUserData();d&&d.b2PostSolve&&d.b2PostSolve(f,e,g,c,b,a),g&&g.b2PostSolve&&g.b2PostSolve(c,b,d,f,e,a)}}}(),function(){ph.System.inject({pixi:null,init:function(){if(this.parent(),window.PIXI&&!ph.device.mobile){var a=PIXI.autoDetectRenderer(1,1,{transparent:!0});if(a instanceof PIXI.WebGLRenderer){this.wrapper.insertBefore(a.view,this.stages[0].canvas),a.view.style.position=this.stages[0].canvas.style.position="absolute";var b=PIXI.Texture.fromImage(ph.loader.get("clouds").src),c=new PIXI.DisplacementFilter(b),d=new PIXI.DisplayObjectContainer;d.filters=[c];var e=new PIXI.Stage(0);e.addChild(d),this.pixi={rendererB:a,stageB:e,sprite:null,displacementFilter:c}}}},run:function(a){this.parent(a);var b=this.pixi;b&&(b.displacementFilter.offset.x+=6*this.delta,b.displacementFilter.offset.y+=6*this.delta,b.rendererB.render(b.stageB))},resize:function(a,b){this.parent(a,b);var c=this.pixi;if(c){c.rendererB.resize(a,b);var d=this.stages[0].canvas,e=c.rendererB.view,f=d.style.width,g=d.style.height;e.style.width=f,e.style.height=g,e.width=a,e.height=b,d.style.left=e.style.left=.5*-parseFloat(f)+"px",d.style.top=e.style.top=.5*-parseFloat(g)+"px"}}})}(),function(){ph.Game=ph.Class.extend({data:{playerN:2,player:["dunk","splash",""],hitCount:0,restart:!1},caption:null,staticInit:function(){return ph.game||null},init:function(){ph.game=this,cjs.Sound.registerPlugins([cjs.WebAudioPlugin,cjs.HTMLAudioPlugin,cjs.FlashAudioPlugin]),cjs.Sound.alternateExtensions=["mp3","ogg"],cjs.Sound.EXTENSION_MAP.mp3="mpeg",window.app.captions.mute=!0,this.switchScene(ph.Scene.Title)},update:function(){var a=ph.system.pixi;if(a){var b=a.stageB.children[0].children[0];b&&(b.x=.5*ph.system.width,b.y=.5*ph.system.height)}ph.scene&&ph.scene.update(),ph.curtain&&ph.curtain.update()},switchScene:function(a){var b;if(a===ph.Scene.Title)b=ph.assets("title");else if(a===ph.Scene.Selection)b=ph.assets("selection");else if(a===ph.Scene.Game){b=ph.assets("game");var c=["splash","dunk","bubbles","ripple"];this.data.player[1]||(this.data.player[1]=c.slice().erase(this.data.player[0]).random()),this.data.player[2]=c.slice().erase(this.data.player[0]).erase(this.data.player[1]).random();for(var d=0;3>d;d++)b=b.concat(ph.assets("character-"+this.data.player[d]))}else a===ph.Scene.End&&(b=ph.assets("end"));new ph.Curtain(a,b)},setBG:function(a){if(!ph.system.pixi)return void(ph.system.wrapper.style.backgroundImage="url("+a.src+")");var b=PIXI.Sprite.fromImage(a.src);b.anchor.x=.5,b.anchor.y=.5;var c=ph.system.pixi;c.stageB.children[0].removeChildren(),c.stageB.children[0].addChild(b)}})}(),function(){ph.assets=function(a){var b=[];if(a instanceof Array)for(var c=0;c<a.length;c++)b=b.concat(ph.assets(a[c]));if("prereq"===a)b.push({id:"clouds",src:"assets/images/clouds.jpg"},{id:"config",src:"assets/config/config1.json"},{id:"strings",src:"assets/config/strings.json"},{id:"captions",src:"assets/config/captions.json"},{id:"loader-sprites",src:"assets/images/loader/sprites.json",type:"spritesheet"});else if("title"===a||"selection"===a||"end"===a)b.push({id:"bg-menu",src:"assets/images/menu/bg.png"},{id:"menu-sprites",src:"assets/images/menu/sprites.json",type:"spritesheet"},{id:"loc-title-finball",src:"assets/images/localized/title/finball.png"},{id:"loc-title-friends",src:"assets/images/localized/title/friends.png"}),"title"===a?b.push():"selection"===a?b.push():"end"===a&&b.push();else if("game"===a)b.push({id:"bg-game",src:"assets/images/game/bg"+(ph.device.mobile?"-mobile":"")+".png"},{id:"game-sprites",src:"assets/images/game/sprites.json",type:"spritesheet"},{id:"data-physics",src:"assets/config/physics.json"},{id:"character-flo-sprites",src:"assets/animations/characters/flo/sprites.json",type:"spritesheet"});else if(a.indexOf("character-")>-1){var d=a.split("-")[1];b.push({id:"character-"+d+"-sprites",src:"assets/animations/characters/"+d+"/sprites.json",type:"spritesheet"})}return("selection"===a||"game"===a)&&b.push({id:"obstacle-sprites",src:"assets/animations/obstacles/sprites.json",type:"spritesheet"},{id:"character-maury-sprites",src:"assets/animations/characters/maury/sprites.json",type:"spritesheet"}),"prereq"!==a&&b.push(),b}}(),function(){ph.Curtain=ph.Class.extend({con:null,isLoading:!1,isComplete:!1,init:function(a,b){if(ph.curtain=this,this.sceneObj=a,this.manifest=b,ph.scene){cjs.Tween.removeAllTweens(),ph.vo.fadeOut(),ph.scene.end(),cjs.MotionGuidePlugin.install(),window.app.sound.play("load-in");var c=ph.loader.get("loader-sprites"),d=new cjs.Sprite(c,"right-1").set({x:1024,regX:512,regY:384,zIndex:5}),e=new cjs.Sprite(c,"right-2").set({x:1024,regX:512,regY:384,zIndex:7}),f=new cjs.Sprite(c,"right-3").set({x:1024,regX:512,regY:384,zIndex:9}),g=new cjs.Sprite(c,"left-1").set({x:-1024,regX:512,regY:384,zIndex:10}),h=new cjs.Sprite(c,"left-2").set({x:-1024,regX:512,regY:384,zIndex:8}),i=new cjs.Sprite(c,"left-3").set({x:-1024,regX:512,regY:384,zIndex:6}),j=new cjs.Text("","136px vag","#fff").set({name:"text",textAlign:"center",textBaseline:"middle",zIndex:20,alpha:0}).set(ph.loader.get("strings").LOADING);j.shadow=new cjs.Shadow("rgba(49, 71, 5, 0.2)",0,8,0);var k=ph.loader.get("strings").LOADING.text||"",l=j.clone().set({text:k.charAt(0)}),m=j.clone().set({text:k.charAt(k.length-1)}),n=j.getBounds(),o=(l.getBounds(),m.getBounds()),p=new cjs.Sprite(c,"pebble").set({name:"pebble",x:n.x+.5*l.getBounds().width,y:n.y-33,regX:31.5,regY:33,zIndex:21}),q=cjs.Tween.get(p,{loop:!0,paused:!0}).to({guide:{path:[p.x,p.y,0,-280,n.x+n.width-.5*m.getBounds().width,.5*-o.height]},rotation:540},1400,cjs.Ease.cubicInOut).call(this.loadCheck,null,this).to({guide:{path:[n.x+n.width-.5*m.getBounds().width,.5*-o.height,0,-280,p.x,p.y]},rotation:0},1400,cjs.Ease.cubicInOut).call(this.loadCheck,null,this);p.y-=768,cjs.Tween.get(d).to({x:0},800,cjs.Ease.quadOut),cjs.Tween.get(e).wait(200).to({x:0},800,cjs.Ease.quadOut),cjs.Tween.get(f).wait(400).to({x:0},800,cjs.Ease.quadOut),cjs.Tween.get(g).to({x:0},800,cjs.Ease.quadOut),cjs.Tween.get(h).wait(200).to({x:0},800,cjs.Ease.quadOut),cjs.Tween.get(i).wait(400).to({x:0},800,cjs.Ease.quadOut),cjs.Tween.get(j).wait(800).to({alpha:1},600),cjs.Tween.get(p).wait(800).to({y:p.y+768},1e3,cjs.Ease.quadOut).play(q).call(this.loadStart,null,this),
this.con=(new cjs.Layer).set({screenX:.5,screenY:.5,zIndex:1/0,mouseEnabled:!1}),this.con.addChild(d,e,f,g,h,i,j,p),app.display.stage.addChild(this.con)}else ph.loader.load(b,this.loadComplete.bind(this))},kill:function(){this.con&&(this.con.removeAllChildren(),this.con.parent.removeChild(this.con)),ph.scene&&ph.scene.start(),ph.curtain=null},update:function(){},loadCheck:function(){this.isLoading&&!this.isComplete&&ph.loader.status>=1&&this.loadComplete()},loadStart:function(){this.isLoading=!0,ph.loader.load(this.manifest)},loadComplete:function(){this.isLoading=!1,this.isComplete=!0;var a=this.sceneObj;if(new a,this.con){window.app.sound.play("load-out");var b=this.con.getChildByName("pebble");cjs.Tween.get(b,{override:!0}).to({y:b.y-768},800,cjs.Ease.quadIn);var c=this.con.getChildByName("text");cjs.Tween.get(c).to({alpha:0},200);var d=this.con.children[0],e=this.con.children[2],f=this.con.children[4],g=this.con.children[5],h=this.con.children[3],i=this.con.children[1];cjs.Tween.get(f).to({x:1024},400,cjs.Ease.quadIn),cjs.Tween.get(e).wait(200).to({x:1024},400,cjs.Ease.quadIn),cjs.Tween.get(d).wait(400).to({x:1024},400,cjs.Ease.quadIn),cjs.Tween.get(i).to({x:-1024},400,cjs.Ease.quadIn),cjs.Tween.get(h).wait(200).to({x:-1024},400,cjs.Ease.quadIn),cjs.Tween.get(g).wait(400).to({x:-1024},400,cjs.Ease.quadIn).call(this.kill,null,this)}else this.kill()}})}(),function(){function a(a,b){this.Sprite_constructor(a,b),this.isOver=!1,this.angle=0,this.speed=0,this.on("click",this.interactionEvent,this),this.on("mouseover",this.interactionEvent,this),this.on("mouseout",this.interactionEvent,this),this.on("removed",this.removeAllEventListeners,this),this.on("tick",this.update,this)}var b=cjs.extend(a,cjs.Sprite);b.update=function(){this.isOver?(this.speed<12&&(this.speed+=24*ph.system.delta),this.angle+=8*ph.system.delta,this.rotation=Math.cos(this.angle)*this.speed):this.rotation=this.angle=this.speed=0},b.interactionEvent=function(a){if(this.mouseEnabled)if("mouseover"===a.type)this.isOver=!0,cjs.Tween.get(this).to({scaleX:1.1,scaleY:1.1},200,cjs.Ease.quadOut);else if("mouseout"===a.type||"click"===a.type){if(this.scaleX<1)return;this.isOver=!1,cjs.Tween.get(this).to({scaleX:1,scaleY:1,rotation:0},200,cjs.Ease.quadOut),"click"===a.type&&window.app.sound.play("buttonhit")}},cjs.SpriteBtn=cjs.promote(a,"Sprite")}(),function(){function a(){this.Container_constructor();var a=ph.loader.get("game-sprites"),b=new cjs.Sprite(a,"shine").set({regX:76.5,regY:77,zIndex:-1,scaleX:.8,scaleY:.8}),c=new cjs.Sprite(a,"coin").set({regX:97,regY:95.5,scaleX:.3,scaleY:.3});this.addChild(c,b),this.name="coin",this.mouseEnabled=!1,this.colleced=!1,this.speed=100,this.angle=0,this.dx=Math.rand(0,1)?1:-1,this.x=this.dx<0?612:-612,this.zIndex=-1,this.on("tick",this.update,this),this.on("removed",this.removed,this)}var b=cjs.extend(a,cjs.Container);b.update=function(){this.getChildAt(0).rotation+=ph.system.delta*(40*this.dx),cjs.Tween.hasActiveTweens(this)||ph.scene.currentStateId===ph.scene.stateId.game&&(this.collected?cjs.Tween.hasActiveTweens(this)&&(this.y=.5*-ph.system.height+64):this.updatePosition())},b.updatePosition=function(){this.getChildAt(1).rotation=Math.cos(this.angle);var a=ph.system.delta;this.angle+=2*a,this.x+=this.dx*this.speed*a,this.y=120*Math.sin(this.angle);var b=Math.distance(ph.scene.player[0],this,!0);60>b&&this.collect(),this.collected||(b=Math.distance(ph.scene.player[1],this,!0),60>b&&this.collect());var c=512;(this.dx>0&&this.x>c+100||this.dx<0&&this.x<-c-100)&&(this.parent.removeChild(this),ph.scene.coinTimer.reset())},b.removed=function(){this.removeAllEventListeners(),ph.scene.coin=null},b.collect=function(){this.zIndex=100,this.collected=!0,ph.scene.hasCoin=!0,ph.vo.isPlaying||-1!==ph.scene.voId.indexOf("gameplay5")||(ph.scene.voId.push("gameplay5"),ph.vo.play("gameplay5")),ph.sfx("collectflo"),cjs.Tween.get(this.getChildAt(0)).to({scaleX:1,scaleY:1},200,cjs.Ease.cubicOut).wait(400).to({scaleX:0,scaleY:0},400,cjs.Ease.cubicIn),cjs.Tween.get(this.getChildAt(1)).to({scaleX:.5,scaleY:.5},200,cjs.Ease.cubicOut).wait(1200).wait(100).to({scaleX:.3,scaleY:.3},400,cjs.Ease.cubicIn),cjs.Tween.get(this).wait(600).to({x:-110,y:.5*-ph.system.height+64},800,cjs.Ease.cubicInOut)},b.use=function(){cjs.Tween.get(this.getChildAt(0)).to({scaleX:1,scaleY:1},200,cjs.Ease.cubicOut).wait(800).to({scaleX:0,scaleY:0},200,cjs.Ease.cubicIn),cjs.Tween.get(this.getChildAt(1)).to({scaleX:.4,scaleY:.4},200,cjs.Ease.cubicOut),cjs.Tween.get(this).wait(1e3).to({scaleX:1.4,scaleY:1.4,alpha:0},200,cjs.Ease.cubicIn)},b.toString=function(){return"[Coin Sprite (name="+this.name+")]"},cjs.SpriteCoin=cjs.promote(a,"Container")}(),function(){function a(a,b){this.Container_constructor();var c=ph.loader.get("game-sprites"),d=new cjs.Sprite(c,"pebble").set({regX:28,regY:28.5,zIndex:-1}),e=new cjs.Sprite(c,"pebble-ooze").set({regX:28,regY:28.5,alpha:0});this.addChild(d,e),this.isLive=!1,this.lastUserData=null,this.ballMinVelX=ph.loader.get("config").difficulty.ballMinVelX,this.velocityLimit=ph.loader.get("config").difficulty.ballVelocityLimit.start,this.body=b2CreateCircle(ph.scene.b2World,0,0,16),this.body.GetFixtureList().m_filter.categoryBits=1,this.body.GetFixtureList().m_filter.maskBits=65531,this.body.GetFixtureList().SetRestitution(ph.loader.get("config").difficulty.ballRestitution.start),this.body.GetFixtureList().SetFriction(0),this.body.SetFixedRotation(!0),this.body.SetLinearDamping(.8),this.body.SetBullet(!0),this.body.SetType(1),this.body.SetUserData(this),this.on("tick",this.update,this),this.on("removed",this.removed,this)}var b=cjs.extend(a,cjs.Container);b.update=function(){if(this.isLive){this.rotation=Math.toDeg(this.body.GetAngle());var a=this.body.GetPosition();if(this.parent===ph.scene.con)this.x=a.x*b2Scale,this.y=a.y*b2Scale;else{var b=ph.scene.con.localToLocal(a.x*b2Scale,a.y*b2Scale,this.parent);this.x=b.x,this.y=b.y}if(ph.scene.currentStateId===ph.scene.stateId.game){var c=this.body.GetLinearVelocity();Math.abs(c.x)<this.ballMinVelX?c.x=c.x<0?-this.ballMinVelX:this.ballMinVelX:c.LengthSquared()>this.velocityLimit*this.velocityLimit&&(c.Normalize(),c.x*=this.velocityLimit,c.y*=this.velocityLimit);var d=512;(this.x<-d-64||this.x>d+64)&&(ph.scene.hasCoin?ph.scene.useCoin():ph.scene.switchState(ph.scene.stateId.end),a.x=0,a.y=-9999,this.body.SetType(0),this.body.SetPosition(a),this.isLive=!1)}}},b.removed=function(){ph.curtain&&(this.removeAllEventListeners(),ph.scene.b2World.DestroyBody(this.body))},b.tipoff=function(){ph.sfx("ballhit"+Math.rand(1,4)),this.body.SetType(2),this.body.SetLinearVelocity(new b2Vec2(0,0)),this.body.SetAngularVelocity(0),this.body.GetFixtureList().SetSensor(!1);var a=Math.toRad(-150),b=new b2Vec2(Math.cos(a),Math.sin(a));b.Multiply(14),this.body.ApplyImpulse(b,this.body.GetPosition()),this.isLive=!0},b.floToss=function(){this.body.SetType(2),this.body.SetLinearVelocity(new b2Vec2(0,0)),this.body.SetAngularVelocity(0);var a=Math.toRad(this.x<0?-15:195),b=new b2Vec2(Math.cos(a),Math.sin(a));b.Multiply(12),this.body.ApplyImpulse(b,this.body.GetPosition());var c=this.body.GetFixtureList();c.SetSensor(!0),cjs.Tween.get(this).wait(400).call(c.SetSensor,[!1],c),this.isLive=!0},b.b2BeginContact=function(a,b,c,d,e,f){if(this.lastUserData=c,"ground"===c){var g=d.GetLinearVelocity(),h=4,i=8;Math.abs(g.x)<h&&(g.x=g.x<0?-h:h),g.y<i&&(g.y=i)}this.body.GetLinearVelocity().Length()>8&&window.app.sound.play("pebblehit"+Math.rand(1,3),{volume:.5})},b.set=function(a){for(var b in a)this[b]=a[b];var c;return a.x&&(c=this.body.GetPosition(),c.x=a.x/b2Scale,this.body.SetPosition(c)),a.y&&(c=this.body.GetPosition(),c.y=a.y/b2Scale,this.body.SetPosition(c)),this},b.toString=function(){return"[Ball Sprite (name="+this.name+")]"},cjs.SpriteBall=cjs.promote(a,"Container")}(),function(){function a(a){if(this.Sprite_constructor(ph.loader.get("character-"+a+"-sprites"),"Swim"),this.body=b2CreateCircle(ph.scene.b2World,0,0,32*(ph.device.mobile?1.4:1)),this.body.GetFixtureList().SetFriction(0),this.body.GetFixtureList().m_filter.categoryBits=2,this.body.GetFixtureList().m_filter.maskBits=65535,this.body.SetType(1),this.body.SetUserData(this),this.fishName=a,this.regX=275,this.regY=200,this.framerate=24,this.mouseEnabled=!1,this.powerup=!1,this.powerupCounter=0,this.isPlayer=!1,this.canControl=!1,this.target={x:0,y:0},this.leadX=ph.device.mobile?64:0,this.speed=480,this.speedRate=1,this.offsetAngle=0,this.offsetX=0,this.offsetY=0,this.soundUp=null,this.soundDown=null,this.hitForce=ph.loader.get("config").difficulty.fishHitForce.start,this.on("tick",this.update,this),this.on("removed",this.removed,this),ph.device.mobile){var b=ph.system.stages[0];this.listenerMouseDown=b.on("stagemousedown",this.interactionEvent,this),this.listenerMouseMove=b.on("stagemousemove",this.interactionEvent,this),this.listenerMouseUp=b.on("stagemouseup",this.interactionEvent,this)}else ph.input.bind(ph.KEY.W,"1up"),ph.input.bind(ph.KEY.S,"1down"),ph.input.bind(ph.KEY.A,"1left"),ph.input.bind(ph.KEY.D,"1right"),ph.input.bind(ph.KEY.UP_ARROW,"2up"),ph.input.bind(ph.KEY.DOWN_ARROW,"2down"),ph.input.bind(ph.KEY.LEFT_ARROW,"2left"),ph.input.bind(ph.KEY.RIGHT_ARROW,"2right")}var b=cjs.extend(a,cjs.Sprite);b.removed=function(){this.removeAllEventListeners(),ph.scene.b2World.DestroyBody(this.body),this.body=null,this.soundUp.stop(),this.soundDown.stop(),this.soundUp=this.soundDown=null;var a=ph.system.stages[0];a.off("stagemousedown",this.listenerMouseDown),a.off("stagemousemove",this.listenerMouseMove),a.off("stagemouseup",this.listenerMouseUp)},b.update=function(a){if(!cjs.Tween.hasActiveTweens(this)&&ph.scene.currentStateId!==ph.scene.stateId.menu){var b=this.body.GetFixtureList();ph.scene.hitCount>0&&this.x>0&&b.IsSensor()&&b.SetSensor(!1),this.canControl&&(this.isPlayer?this.updateControl():this.updateAI(),this.target.x=Math.limit(this.target.x,this.x<0?-470:280,this.x<0?-280:470),this.target.y=Math.limit(this.target.y,-240,240));var c=this.body.GetPosition(),d=c.y,e="splash"===this.fishName&&this.powerup?.32:.08;c.x=Math.lerp(c.x,this.target.x/b2Scale,e),c.y=Math.lerp(c.y,this.target.y/b2Scale,e),this.body.SetPosition(c),this.soundUp.volume=c.y<d-.2?.2:0,this.soundDown.volume=c.y>d+.2?.2:0,this.offsetAngle+=ph.system.delta,this.offsetX=6*Math.cos(this.offsetAngle)*Math.sin(this.offsetAngle),this.offsetY=6*Math.sin(this.offsetAngle),d=this.y,this.x=this.offsetX+c.x*b2Scale,this.y=this.offsetY+c.y*b2Scale;var f=ph.scene.ball;if(f){var g=Math.distance(f,this,1);"ripple"===this.fishName&&128>g&&this.powerup||"bubbles"===this.fishName&&84>g&&this.powerup?this.powerupGrab(f):72>g&&"Swim"===this.currentAnimation?this.gotoAndPlay("Hit"+(f.y-32<this.y?1:2)):96>g&&"dunk"===this.fishName&&this.powerup&&"Special Swim"===this.currentAnimation&&this.gotoAndPlay("Special Hit")}this.rotation=6*(this.y-d)*(this.x>0?-1:1),this.rotation=Math.limit(this.rotation,-60,60),"splash"===this.fishName&&this.powerup&&this.powerupSplash()}},b.updateAI=function(){var a=ph.scene.ball;if(a&&a.isLive){var b=this.speed*ph.system.delta*this.speedRate,c=a.body.GetLinearVelocity(),d=Math.atan2(a.y+c.y-this.y,a.x+c.x-this.x),e=Math.cos(d)*b,f=Math.sin(d)*b;this.target.y+=f,c.x>0&&a.x>120?this.x>a.x+c.x?this.target.x+=Math.limit(10-c.x,0,1)*e*.2:this.target.x+=e:this.target.x<.5*ph.system.width-200?this.target.x-=.4*e:this.target.x+=.2*e}},b.updateControl=function(){var a=0,b=0,c=this.speed*ph.system.delta*this.speedRate;if(ph.device.mobile){if(this.touchEvent){if(this.target instanceof cjs.Sprite){var d=this.target;cjs.Tween.get(d,{override:!0}).to({alpha:0},200).call(d.parent.removeChild,[d],d.parent),this.target={x:d.x,y:d.y}}var e=this.leadX*(this.x>0?-1:1),f=this.touchEvent.stageX+e-.5*ph.system.width,g=this.touchEvent.stageY-.5*ph.system.height,h=Math.atan2(g-this.y,f-this.x);a=Math.cos(h)*c,b=Math.sin(h)*c;var i=Math.distance(this.x,this.y,f,g,!0);i>1.4*c?(this.target.x+=a,this.target.y+=b):(this.target.x=Math.lerp(this.target.x,f,.12),this.target.y=Math.lerp(this.target.y,g,.12))}}else this.x<0?2===ph.game.data.playerN?(ph.input.state("1up")?b--:ph.input.state("1down")&&b++,ph.input.state("1left")?a--:ph.input.state("1right")&&a++):(ph.input.state("2up")?b--:ph.input.state("2down")&&b++,ph.input.state("2left")?a--:ph.input.state("2right")&&a++):2===ph.game.data.playerN&&(ph.input.state("2up")?b--:ph.input.state("2down")&&b++,ph.input.state("2left")?a--:ph.input.state("2right")&&a++),a*=c,b*=c,this.target.x+=a,this.target.y+=b},b.powerupGrab=function(a){if(a.lastUserData!==this){this.powerup=!1,a.isLive=!1,a.body.SetType(0),a.body.GetFixtureList().SetSensor(!0),ph.scene.powerup[this.x<0?0:1].powerTimer=.001,this.canControl=!1;var b=this.target;"bubbles"===this.fishName?(this.gotoAndPlay("Special"),cjs.Tween.get(a).to({x:b.x+(b.x<0?44:-44),y:b.y},400,cjs.Ease.quadOut).wait(400).call(window.app.sound.play,["bubbles_squirt"],window.app.sound).to({x:b.x+(b.x<0?84:-84),y:b.y},600,cjs.Ease.quadIn).call(a.set,[{x:b.x+(b.x<0?84:-84),y:b.y}],a).call(this.powerupThrow,[a],this),cjs.Tween.get(a.getChildAt(1)).wait(600).to({alpha:1},200)):"ripple"===this.fishName&&(a.getChildAt(1).alpha?this.gotoAndPlay("GrabOoze"):this.gotoAndPlay("Grab"),cjs.Tween.get(a).to({x:b.x+(b.x<0?16:-16),y:b.y+18},400,cjs.Ease.quadOut).call(a.set,[{visible:!1}],a).call(this.set,[{canControl:!0}],this))}},b.powerupThrow=function(a){a.body.SetType(2),a.body.SetLinearVelocity(new b2Vec2(0,0)),a.body.SetAngularVelocity(0),a.body.GetFixtureList().SetSensor(!1),"bubbles"===this.fishName&&a.body.SetLinearDamping(1.8);var b=Math.toRad(this.x<0?-30:-150),c=new b2Vec2(Math.cos(b),Math.sin(b));c.Multiply(18),a.body.ApplyImpulse(c,a.body.GetPosition()),a.isLive=!0,a.visible=!0,this.canControl=!0},b.powerupStart=function(){if(this.powerup=!0,"dunk"===this.fishName){ph.sfx("dunk_inflate");var a=this.body.GetFixtureList().m_shape;cjs.Tween.get(a).to({m_radius:54*(ph.device.mobile?1.4:1)/b2Scale},600,cjs.Ease.quadOut),this.gotoAndPlay("Special")}else"splash"===this.fishName&&(this.gotoAndPlay("Special"),cjs.Tween.get(this).to({speedRate:2},400))},b.powerupEnd=function(){if(this.powerup=!1,"dunk"===this.fishName){var a=this.body.GetFixtureList().m_shape;cjs.Tween.get(a).to({m_radius:32*(ph.device.mobile?1.4:1)/b2Scale},600,cjs.Ease.quadOut),this.gotoAndPlay("Deflate")}else if("bubbles"===this.fishName)cjs.Tween.get(ph.scene.ball.getChildAt(1)).to({alpha:0},600),cjs.Tween.get(ph.scene.ball.body).to({m_linearDamping:.8},600);else if("ripple"===this.fishName){this.canControl=!1,ph.scene.ball.getChildAt(1).alpha?this.gotoAndPlay("ThrowOoze"):this.gotoAndPlay("Throw");var b=this.body.GetPosition(),c=ph.scene.ball,d=c.body.GetPosition();d.x=b.x+(this.x<0?24:-24)/b2Scale,d.y=b.y+18/b2Scale,c.body.SetPosition(d);var e=this.body.GetFixtureList();e.SetSensor(!0),cjs.Tween.get(this).wait(600).call(this.powerupThrow,[c],this).wait(200).call(e.SetSensor,[!1],e)}else"splash"===this.fishName&&cjs.Tween.get(this).to({speedRate:1},400)},b.powerupSplash=function(){if("Swim"===this.currentAnimation&&(this.powerupCounter-=18*ph.system.delta,this.powerupCounter<=0)){this.powerupCounter=1;for(var a,b=0;b<ph.scene.splashSprs.length;b++)if(a=ph.scene.splashSprs[b],!(a.alpha>0)){a.x=this.x,a.y=this.y,a.rotation=this.rotation,a.scaleX=this.scaleX,a.alpha=1;break}}},b.b2BeginContact=function(a,b,c,d,e,f){if(c instanceof cjs.SpriteBall){if(b.IsSensor()||e.IsSensor())return;ph.scene.hitBall(this),ph.vo.isPlaying||(this.x<0&&this.x<.5*-ph.system.width+160||this.x>0&&this.x>.5*ph.system.width-160?ph.vo.play("score11"):ph.vo.endTime.delta()>6?ph.vo.play("score"+Math.rand(8,10)):ph.scene.hitCount>30&&-1===ph.scene.voId.indexOf("score14")&&(ph.scene.voId.push("score14"),ph.vo.play("score14"))),ph.sfx("ballhit"+Math.rand(1,4));var g=a.GetPosition(),h=d.GetPosition(),i=Math.toDeg(Math.atan2(g.y-h.y,g.x-h.x));0>i&&(i=360+i);var j=45;this.x>0?i>270-j?i=270-j:90+j>i&&(i=90+j):270+j>i&&i>180?i=270+j:i>90-j&&180>i&&(i=90-j);var k=Math.toRad(i),l=new b2Vec2(Math.cos(k),Math.sin(k));l.Multiply(this.hitForce*a.GetFixtureList().GetRestitution()),a.ApplyImpulse(l,g)}},b.interactionEvent=function(a){var b=.5*ph.system.width;if("stagemousedown"===a.type&&this.canControl&&ph.Timer.timeScale){if(a.stageY<42)return;this.touchEvent||(this.x<0&&a.stageX<b||this.x>0&&a.stageX>b)&&(this.touchEvent=a)}else"stagemousemove"===a.type&&this.canControl&&ph.Timer.timeScale?this.touchEvent&&this.touchEvent.pointerID===a.pointerID&&(this.x<0&&a.stageX<b||this.x>0&&a.stageX>b)&&(this.touchEvent=a):"stagemouseup"===a.type&&this.touchEvent&&this.touchEvent.pointerID===a.pointerID&&(this.touchEvent=null)},b.set=function(a){for(var b in a)this[b]=a[b];var c;return a.x&&(this.target.x=a.x,c=this.body.GetPosition(),c.x=a.x/b2Scale,this.body.SetPosition(c),b=a.x<0?1:2,this.soundUp=window.app.sound.play("playerup"+b,{volume:0,loop:-1}),this.soundDown=window.app.sound.play("playerdown"+b,{volume:0,loop:-1}),a.x>0&&this.body.GetFixtureList().SetSensor(!0)),a.y&&(this.target.y=a.y,c=this.body.GetPosition(),c.y=a.y/b2Scale,this.body.SetPosition(c)),this},b.toString=function(){return"[Player Sprite (name="+this.name+")]"},cjs.SpritePlayer=cjs.promote(a,"Sprite")}(),function(){function a(a){this.Container_constructor();var b=ph.loader.get("game-sprites"),c=new cjs.Sprite(b,"powerups/"+a).set({y:-1,regX:30.5,regY:30.5,zIndex:-1}),d=new cjs.Sprite(b,"shine").set({regX:76.5,regY:77,scaleX:0,scaleY:0,zIndex:-10}),e=new cjs.Shape((new cjs.Graphics).s("#fff").ss(6).arc(0,0,32,0,2*Math.PI)).set({zIndex:1}),f=new cjs.Shape((new cjs.Graphics).s("#fbe546").ss(6).arc(0,0,32,0,0)).set({zIndex:2,rotation:-90}),g=new cjs.Shape((new cjs.Graphics).s("#fff").ss(6).arc(0,0,32,0,0)).set({zIndex:3,rotation:-90});e.shadow=new cjs.Shadow("rgba(5, 32, 55, 0.2)",0,4,0),this.addChild(d,c,e,f,g),this.mouseEnabled=!1,this.cursor="pointer",this.powerIncrement=ph.loader.get("config").power.increment,this.power=ph.loader.get("config").power.start,this.powerLine=f,this.powerTimer=0,this.powerTimerLine=g,this.power>0&&cjs.Tween.get(this,{onChange:this._hitBall}).to({power:this.power},400,cjs.Ease.quadOut),this.on("tick",this.update,this),this.on("click",this.click,this),this.on("removed",this.removeAllEventListeners,this)}var b=cjs.extend(a,cjs.Container);b.update=function(){var a=this.getChildAt(0);a.rotation+=80*ph.system.delta,this.updatePowerTimer()},b.updatePowerTimer=function(){if(this.powerTimer>0){var a=ph.scene.player[this.x<0?0:1];this.powerTimer+=ph.system.delta*("ripple"===a.fishName?.5:.075),this.powerTimer>=1&&(this.power=0,this.powerTimer=0,this.powerLine.graphics.c().s("#fbe546").ss(6).arc(0,0,32,0,0),cjs.Tween.get(this.getChildAt(0)).to({scaleX:0,scaleY:0},400,cjs.Ease.cubicIn),ph.scene.player[this.x<0?0:1].powerupEnd()),this.powerTimerLine.graphics.c().s("#fff").ss(6).arc(0,0,32,0,2*Math.PI*this.powerTimer)}},b.click=function(){this.power>=1&&(ph.sfx("powerup"),cjs.Tween.get(this).to({scaleX:.9,scaleY:.9},200,cjs.Ease.cubicOut).to({scaleX:1,scaleY:1},400,cjs.Ease.cubicIn),cjs.Tween.get(this,{onChange:this._hitBall}).to({power:0},400,cjs.Ease.quadIn),cjs.Tween.get(this.getChildAt(0)).to({scaleX:0,scaleY:0},400,cjs.Ease.cubicIn))},b.hitBall=function(){var a=Math.limit(this.power+this.powerIncrement,0,1);if(a>=1&&this.power<1){ph.sfx("powerup"),cjs.Tween.get(this.getChildAt(0)).to({scaleX:.9,scaleY:.9},400,cjs.Ease.cubicOut);var b=ph.scene.player[this.x<0?0:1];if(b.powerupStart(),("dunk"===b.fishName||"splash"===b.fishName)&&(this.powerTimer=.001),!ph.vo.isPlaying){var c="gameplay100";"bubbles"===b.fishName?c="gameplay101":"ripple"===b.fishName?c="gameplay102":"dunk"===b.fishName&&(c="gameplay103"),-1===ph.scene.voId.indexOf(c)&&(b.x>0&&2===ph.game.data.playerN?ph.vo.play(c):b.x<0&&ph.vo.play(c))}}this.power<1&&(cjs.Tween.get(this,{onChange:this._hitBall}).to({power:a},400,cjs.Ease.quadOut),cjs.Tween.get(this).to({scaleX:1.2,scaleY:1.2},200,cjs.Ease.cubicOut).to({scaleX:1,scaleY:1},400,cjs.Ease.cubicIn))},b._hitBall=function(a){var b=a.target.target;b.powerLine.graphics.c().s("#fbe546").ss(6).arc(0,0,32,0,2*Math.PI*b.power)},b.toString=function(){return"[Powerup Sprite (name="+this.name+")]"},cjs.SpritePowerup=cjs.promote(a,"Container")}(),function(){function a(){this.Sprite_constructor(ph.loader.get("obstacle-sprites")),this.body=b2CreatePolygon(ph.scene.b2World,ph.loader.get("data-physics").clam),this.body.SetType(1),this.body.SetUserData(this),this.name="clam",this.regX=275,this.regY=200,this.framerate=24,this.mouseEnabled=!1,this.gotoAndStop("clam"),this.on("tick",this.update,this),this.on("removed",this.removed,this)}var b=cjs.extend(a,cjs.Sprite);b.removed=function(){this.removeAllEventListeners(),this.body&&ph.scene.b2World.DestroyBody(this.body)},b.update=function(){this.body&&this.body.GetFixtureList().SetSensor(!this.paused)},b.b2BeginContact=function(a,b,c,d,e,f){c instanceof cjs.SpriteBall&&!b.IsSensor()&&(this.paused&&(this.gotoAndPlay("clam"),ph.sfx("clam-open"),cjs.Tween.get(this).wait(1900).call(ph.sfx,["clam-close"])),ph.vo.isPlaying||-1!==ph.scene.voId.indexOf("gameplay15")||(ph.scene.voId.push("gameplay15"),ph.vo.play("gameplay15")))},b.b2EndContact=function(a,b,c,d,e,f){if(c instanceof cjs.SpriteBall&&!b.IsSensor()){var g=a.GetLinearVelocity(),h=g.x,i=1.6;-i>h&&(h=-i),h>i&&(h=2*i);var j=new b2Vec2(h,-6);a.ApplyImpulse(j,a.GetPosition())}},b.set=function(a){for(var b in a)this[b]=a[b];var c;return a.x&&(c=this.body.GetPosition(),c.x=a.x/b2Scale,this.body.SetPosition(c)),a.y&&(c=this.body.GetPosition(),c.y=a.y/b2Scale,this.body.SetPosition(c)),this},b.toString=function(){return"[Clam Sprite (name="+this.name+")]"},cjs.SpriteClam=cjs.promote(a,"Sprite")}(),function(){function a(){this.Sprite_constructor(ph.loader.get("obstacle-sprites")),this.body=b2CreateBox(ph.scene.b2World,0,0,100,400),this.body.GetFixtureList().SetSensor(!0),this.body.SetType(1),this.body.SetUserData(this),this.name="current",this.regX=275,this.regY=200,this.framerate=24,this.mouseEnabled=!1,this.visible=!1,this.hit=!1,this.gotoAndStop("current"),this.on("tick",this.update,this),this.on("removed",this.removed,this)}var b=cjs.extend(a,cjs.Sprite);b.removed=function(){this.removeAllEventListeners(),ph.scene.obstacle.current=null,this.body&&ph.scene.b2World.DestroyBody(this.body)},b.update=function(){this.hit&&this.paused&&this.parent.removeChild(this)},b.b2BeginContact=function(a,b,c,d,e,f){if(c instanceof cjs.SpriteBall&&!b.IsSensor()&&!this.hit){ph.vo.isPlaying||(-1===ph.scene.voId.indexOf("gameplay6")?(ph.scene.voId.push("gameplay6"),ph.vo.play("gameplay6")):-1===ph.scene.voId.indexOf("gameplay24")&&(ph.scene.voId.push("gameplay24"),ph.vo.play("gameplay24"))),ph.sfx("oceancurrent"),this.hit=!0,this.y=c.y;var g=a.GetLinearVelocity(),h=Math.toRad(g.x<0?Math.rand(-10,10):Math.rand(170,190));g=new b2Vec2(Math.cos(h),Math.sin(h)),g.Multiply(12),a.SetLinearVelocity(new b2Vec2(0,0)),a.SetAngularVelocity(0),a.ApplyImpulse(g,a.GetPosition()),this.gotoAndPlay("current"),this.visible=!0,this.scaleX=g.x>0?1:-1}},b.set=function(a){for(var b in a)this[b]=a[b];var c;return a.x&&(c=this.body.GetPosition(),c.x=a.x/b2Scale,this.body.SetPosition(c)),this},b.toString=function(){return"[Current Sprite (name="+this.name+")]"},cjs.SpriteCurrent=cjs.promote(a,"Sprite")}(),function(){function a(a){if(this.Sprite_constructor(ph.loader.get("obstacle-sprites"),"fish"),this.body=b2CreatePolygon(ph.scene.b2World,ph.loader.get("data-physics").fish),this.body.GetFixtureList().SetSensor(!0),this.body.SetType(1),this.body.SetUserData(this),this.name="fish",this.mouseEnabled=!1,this.regX=275,this.regY=200,this.framerate=24,this.hit=!1,this.speed=640,this.angle=a?Math.rand(170,190):Math.rand(-10,10),this.x=this.angle>90?1062:-1062,this.angle<90){this.scaleX=-1;for(var b=this.body.GetFixtureList();b;b=b.GetNext())b.m_shape.m_p.x*=-1}this.on("tick",this.update,this),this.on("removed",this.removed,this),ph.vo.isPlaying||-1!==ph.scene.voId.indexOf("gameplay12")||(ph.scene.voId.push("gameplay12"),ph.vo.play("gameplay12")),ph.sfx("schoolfish")}var b=cjs.extend(a,cjs.Sprite);b.removed=function(){this.removeAllEventListeners(),ph.scene.obstacle.fish=null,this.body&&ph.scene.b2World.DestroyBody(this.body)},b.update=function(){var a=Math.toRad(this.angle),b=Math.cos(a)*this.speed*ph.system.delta,c=Math.sin(a)*this.speed*ph.system.delta;this.x+=b,this.y+=c;var d=this.body.GetPosition();d.x=this.x/b2Scale,d.y=this.y/b2Scale,this.body.SetPosition(d);var e=512;(this.angle<90&&this.x>e+550||this.angle>90&&this.x<-e-550)&&this.parent.removeChild(this)},b.b2BeginContact=function(a,b,c,d,e,f){if(c instanceof cjs.SpriteBall&&!b.IsSensor()&&!this.hit){this.hit=!0;var g=Math.toRad(this.angle),h=new b2Vec2(Math.cos(g),Math.sin(g));h.Multiply(8),a.SetLinearVelocity(new b2Vec2(0,0)),a.SetAngularVelocity(0),a.ApplyImpulse(h,a.GetPosition())}},b.set=function(a){for(var b in a)this[b]=a[b];var c;return a.x&&(c=this.body.GetPosition(),c.x=a.x/b2Scale,this.body.SetPosition(c)),a.y&&(c=this.body.GetPosition(),c.y=a.y/b2Scale,this.body.SetPosition(c)),this},b.toString=function(){return"[Fish Sprite (name="+this.name+")]"},cjs.SpriteFish=cjs.promote(a,"Sprite")}(),function(){function a(){this.Container_constructor();var a=ph.loader.get("obstacle-sprites"),b=new cjs.Sprite(a,"toob-front").set({name:"front",regX:275,regY:200,framerate:24,zIndex:2}),c=new cjs.Sprite(a,"toob-back").set({name:"back",regX:275,regY:200,framerate:24,zIndex:-2});b.gotoAndStop("toob-front"),c.gotoAndStop("toob-back");var d=new cjs.Sprite(ph.loader.get("character-maury-sprites"),"eel-rise").set({name:"eel",regX:275,regY:230,framerate:24});d.stop(),this.addChild(b,c,d),this.name="toob",this.mouseEnabled=!1,this.eelOut=!1,this.eelDown="",this.eelTimer=10,this.on("tick",this.update,this),this.on("removed",this.removed,this)}var b=cjs.extend(a,cjs.Container);b.removed=function(){this.removeAllEventListeners(),this.body&&ph.scene.b2World.DestroyBody(this.body)},b.update=function(){this.eelOut&&(this.eelTimer-=ph.system.delta,this.eelTimer<=0&&this.eelHide())},b.b2BeginContact=function(a,b,c,d,e,f){if(c instanceof cjs.SpriteBall&&!b.IsSensor()){var g=e.GetUserData()||"";if((g.indexOf("eel-")>-1||"toob-hitArea"===g)&&this.eelOut)this.eelHit(a,b,c,d,e,f);else if("toob-hitArea"===g&&ph.scene.hitCount>=10&&1===Math.rand(0,1)){var h=ph.scene.obstacle.toob1===this?ph.scene.obstacle.toob2:ph.scene.obstacle.toob1;h.eelOut||this.suckBall(a,b,c,d,e,f)}}},b.eelShow=function(){ph.vo.isPlaying||(-1===ph.scene.voId.indexOf("gameplay22")?(ph.scene.voId.push("gameplay22"),ph.vo.play("gameplay22")):ph.vo.play("gameplay13.1"));var a=this.getChildByName("eel").gotoAndPlay("eel-rise"+this.eelDown);-1===this.scaleY?a.set({x:12,scaleY:-1,regY:170}):a.set({x:0}),cjs.Tween.get(this).wait(600).call(this.set,[{eelOut:!0,eelTimer:10}],this)},b.eelHit=function(a,b,c,d,e,f){this.eelOut=!1,ph.vo.isPlaying||("gameplay22"===ph.vo.sequence[0]?ph.vo.play("gameplay22.1"):ph.vo.play("gameplay22.2")),ph.sfx("ballhit"+Math.rand(1,4));var g=this.getChildByName("eel").gotoAndPlay("eel-hit"+this.eelDown);cjs.Tween.get(this).wait(1200).call(function(){ph.scene.obstacle.eel=null}),c.x>this.x&&1===this.scaleY?g.scaleX=-1:c.x<this.x&&-1===this.scaleY&&(g.scaleX=1);var h=a.GetPosition(),i=d.GetPosition(),j=Math.toDeg(Math.atan2(h.y-i.y,h.x-i.x));0>j&&(j=360+j);var k=45;this.x>0?j>270-k?j=270-k:90+k>j&&(j=90+k):270+k>j&&j>180?j=270+k:j>90-k&&180>j&&(j=90-k);var l=Math.toRad(j),m=new b2Vec2(Math.cos(l),Math.sin(l));m.Multiply(18),a.ApplyImpulse(m,h)},b.eelHide=function(){this.eelOut=!1,ph.vo.isPlaying||("gameplay22"===ph.vo.sequence[0]?ph.vo.play("gameplay22.1"):ph.vo.play("gameplay22.2"));this.getChildByName("eel").gotoAndPlay("eel-sink"+this.eelDown);cjs.Tween.get(this).wait(1200).call(function(){ph.scene.obstacle.eel=null})},b.suckBall=function(a,b,c,d,e,f){b.SetSensor(!0),c.isLive=!1,this.getChildByName("back").gotoAndPlay("toob-back"),this.getChildByName("front").gotoAndPlay("toob-front");var g=ph.scene.obstacle.toob1===this?ph.scene.obstacle.toob2:ph.scene.obstacle.toob1,h=c.parent.localToLocal(c.x,c.y,this);this.addChild(c.set({x:h.x,y:h.y})),cjs.Tween.get(c).to({x:0,y:this.y>0?18:0,scaleX:.5,scaleY:.5},800,cjs.Ease.quadIn).call(ph.sfx,["lava-suck"]).wait(1200).call(g.getChildByName("back").gotoAndPlay,["toob-back-spit"],g.getChildByName("back")).call(g.getChildByName("front").gotoAndPlay,["toob-front-spit"],g.getChildByName("front")).wait(400).call(g.addChild,[c],g).call(c.set,[{x:0,y:g.y>0?-18:18}],c).call(g.spitBall,[c],g).wait(200).call(ph.sfx,["lava-spit"])},b.spitBall=function(a){a.isLive=!0;var b=a.body,c=a.parent.localToLocal(a.x,a.y,ph.scene.con),d=b.GetPosition();d.x=c.x/b2Scale,d.y=c.y/b2Scale,b.SetPosition(d);var e=Math.toRad(a.parent.y>0?Math.rand(-80,-75):Math.rand(75,80)),f=new b2Vec2(Math.cos(e),Math.sin(e));f.Multiply(a.parent.y>0?14:8),b.SetLinearVelocity(new b2Vec2(0,0)),b.SetAngularVelocity(0),b.ApplyImpulse(f,b.GetPosition());var g=function(){var a=this.body.GetPosition();ph.scene.con.addChild(this).set({x:a.x*b2Scale,y:a.y*b2Scale})},h=b.GetFixtureList();cjs.Tween.get(a).wait(100).to({scaleX:1,scaleY:1},400,cjs.Ease.quadOut).wait(200).call(g,null,a).call(h.SetSensor,[!1],h)},b.set=function(a){for(var b in a)this[b]=a[b];var c;return a.name&&(this.body=b2CreatePolygon(ph.scene.b2World,ph.loader.get("data-physics")[a.name]),this.body.SetType(1),this.body.SetUserData(this)),a.x&&(c=this.body.GetPosition(),c.x=a.x/b2Scale,this.body.SetPosition(c)),a.y&&(c=this.body.GetPosition(),c.y=a.y/b2Scale,this.body.SetPosition(c)),-1===a.scaleY&&(this.eelDown="-down"),this},b.toString=function(){return"[Toob Sprite (name="+this.name+")]"},cjs.SpriteToob=cjs.promote(a,"Container")}(),function(){ph.Scene.Title=ph.Scene.extend({con:null,voComplete:!1,fishSprs:[],init:function(){ph.game.setBG(ph.loader.get("bg-menu")),this.con=new cjs.Layer,this.con.enableEvents(this.interactionEvent,this),app.display.stage.addChild(this.con);var a=ph.loader.get("menu-sprites"),b=new cjs.Sprite(a,"characters").set({regX:179.5,regY:245,x:-220,y:-12}),c=new cjs.Bitmap(ph.loader.get("loc-title-finball")).set({name:"title-top",alpha:0,regX:211.5,regY:126,x:198,y:-78}),d=new cjs.Bitmap(ph.loader.get("loc-title-friends")).set({name:"title-bottom",alpha:0,regX:211.5,regY:126,x:198,y:-78}),e=(new cjs.Container).set({name:"btn-1",x:100,y:110,mouseChildren:!1,cursor:"pointer",zIndex:100}),f=new cjs.Sprite(a,"rr-orange").set({regX:124.5,regY:31,zIndex:-1}),g=new cjs.Sprite(a,"fish-1").set({regX:53,regY:47,x:-120,y:-6}),h=new cjs.Text("","42px vag","#fff").set({x:31,y:-18,textAlign:"center",maxWidth:160,zIndex:1});h.set(ph.loader.get("strings")["1_PLAYER"]),e.addChild(f,g,h);var i=(new cjs.Container).set({name:"btn-2",x:213,y:200,mouseChildren:!1,cursor:"pointer",zIndex:100});f=new cjs.Sprite(a,"rr-green-long").set({regX:124.5,regY:31,zIndex:-1}),g=new cjs.Sprite(a,"fish-2").set({regX:53,regY:47,x:156,y:-6}),h=new cjs.Text("","42px vag","#fff").set({x:0,y:-18,textAlign:"center",maxWidth:180,zIndex:1}),h.set(ph.loader.get("strings")["2_PLAYERS"]),i.addChild(f,g,h);var j=new cjs.Sprite(a,"pebble").set({regX:31.5,regY:33,x:-96,y:-168});this.con.addChild(b,c,d,e,i,j)},kill:function(){this.con.disableEvents(),this.con.parent.removeChild(this.con)},start:function(){ph.music.set("music-menu",null,.1),ph.vo.play("title1_"+["bubbles","splash"].random(),function(){this.voComplete=!0},this),ph.device.mobile&&(this.voComplete=!0);var a=this.con.getChildByName("title-top"),b=this.con.getChildByName("title-bottom");a.y-=40,b.y+=40,cjs.Tween.get(a).to({y:a.y+40,alpha:1},1200,cjs.Ease.cubicOut),cjs.Tween.get(b).to({y:b.y-40,alpha:1},1200,cjs.Ease.cubicOut)},update:function(){!cjs.Tween.hasActiveTweens(this.fishSprs[0])},rockAndRollStar:function(a){cjs.Tween.get(a.getChildAt(1),{override:!0,loop:!0}).to({rotation:15},200,cjs.Ease.quadOut).to({rotation:-15},400,cjs.Ease.quadInOut).to({rotation:0},200,cjs.Ease.quadIn)},interactionEvent:function(a){var b=a.target.name||"",c=parseFloat(b.split("-").pop());
if(1===c||2===c)if("click"===a.type)if(this.con.disableEvents(),ph.game.data.playerN=c,ph.device.mobile){var d=this.con.getChildByName("btn-"+(1===c?2:1));cjs.Tween.get(d).to({alpha:0},400),this.rockAndRollStar(a.target),cjs.Tween.get(a.target).wait(400).to({x:1===c?220:160,y:142},400,cjs.Ease.quadInOut),ph.vo.play(1===c?"title2":"title3",function(){ph.game.switchScene(ph.Scene.Selection)})}else ph.game.switchScene(ph.Scene.Selection);else"mouseover"===a.type&&this.voComplete?(ph.vo.play(1===c?"title2":"title3"),this.rockAndRollStar(a.target)):"mouseout"===a.type&&cjs.Tween.get(a.target.getChildAt(1),{override:!0}).to({rotation:0},200,cjs.Ease.quadIn)}})}(),function(){ph.Scene.Selection=ph.Scene.extend({con:null,boxCon:null,playerCon:null,fishSprs:[],selected:null,btnBack:null,init:function(){ph.game.data.player[0]=null,ph.game.data.player[1]=null,ph.game.data.player[2]=null,ph.game.setBG(ph.loader.get("bg-menu"));var a=ph.loader.get("menu-sprites"),b=new cjs.Sprite(a,"box").set({regX:441.5,regY:97.5,zIndex:-1e3}),c=new cjs.Sprite(a,"powerups/splash").set({name:"powerup",regX:84,regY:85.5,x:-381.9,y:-81.6,scaleX:0,scaleY:0}),d=new cjs.Sprite(a,"shine").set({name:"shine",regX:76.5,regY:77,x:436,y:-44,scaleX:0,scaleY:0}),e=new cjs.SpriteBtn(a,"btn/tick").set({name:"btn-tick",regX:39,regY:40.5,x:436,y:-44,scaleX:0,scaleY:0,cursor:"pointer",zIndex:1}),f=(new cjs.Container).set({name:"text-con",x:50,y:-48}),g=new cjs.Text("","36px vag","#1eadfa").set({name:"text-1"}),h=new cjs.Text("","36px vag","#4881c1").set({name:"text-2"});f.addChild(g,h),this.boxCon=(new cjs.Container).set({y:768,zIndex:100}),this.boxCon.addChild(b,c,f,d,e);var i=new cjs.Shape((new cjs.Graphics).f("#08527a").rr(0,0,250,50,25,25,25,25)).set({alpha:.4,regX:125,zIndex:-1}),j=new cjs.Text("","40px vag","#fff").set({name:"text",x:-25,y:8,maxWidth:160,textAlign:"center"}).set(ph.loader.get("strings").PLAYER),k=new cjs.Sprite(a,"star-1").set({name:"star",x:98,y:26,regX:53,regY:47,scaleX:1.4,scaleY:1.4,alpha:0,zIndex:1});this.playerCon=(new cjs.Container).set({zIndex:100,alpha:0}),this.playerCon.addChild(i,j,k),this.btnBack=new cjs.SpriteBtn(a,"btn/back").set({name:"btn-back",regX:39,regY:40.5,x:-450,y:-768,cursor:"pointer"}),this.con=(new cjs.Layer).set({screenX:.5,screenY:.5}),this.con.addChild(this.boxCon,this.btnBack,this.playerCon),this.con.enableEvents(this.interactionEvent,this),app.display.stage.addChild(this.con)},kill:function(){this.con.disableEvents(),this.con.parent.removeChild(this.con)},start:function(){1===ph.game.data.playerN?ph.vo.play({id:"character1"}):ph.vo.play({id:"character2",delay:600});var a=ph.loader.get("menu-sprites"),b=new cjs.Sprite(a,"characters/splash").set({name:"fish-splash",regX:168.5,regY:173,x:-300,y:5,zIndex:10,cursor:"pointer",ox:-300,oy:5,r:0,angle:0}),c=new cjs.Sprite(a,"characters/bubbles").set({name:"fish-bubbles",regX:168.5,regY:173,x:260,y:8,zIndex:8,cursor:"pointer",ox:260,oy:8,r:0,angle:0}),d=new cjs.Sprite(a,"characters/dunk").set({name:"fish-dunk",regX:168.5,regY:173,x:60,y:-82,zIndex:6,cursor:"pointer",ox:60,oy:-82,r:0,angle:0}),e=new cjs.Sprite(a,"characters/ripple").set({name:"fish-ripple",regX:168.5,regY:173,x:-122,y:-4,zIndex:4,cursor:"pointer",ox:-122,oy:-4,r:0,angle:0});this.fishSprs.push(b,c,d,e);var f=this.con.addChild(new cjs.Container).set({name:"con-fish"});f.addChild(b,c,d,e),b.x-=1024,c.x+=1024,d.y-=768,e.y+=768,cjs.Tween.get(b).to({x:b.ox},1200,cjs.Ease.circOut),cjs.Tween.get(c).wait(200).to({x:c.ox},1200,cjs.Ease.circOut),cjs.Tween.get(d).wait(400).to({y:d.oy},1200,cjs.Ease.circOut),cjs.Tween.get(e).wait(600).to({y:e.oy},1200,cjs.Ease.circOut),cjs.Tween.get(this.btnBack).to({y:.5*-ph.system.height+64},600,cjs.Ease.cubicOut),cjs.Tween.get(this.playerCon).wait(600).to({alpha:1},600),cjs.Tween.get(this.playerCon.getChildByName("star")).wait(1200).to({scaleX:.7,scaleY:.7,alpha:1},600,cjs.Ease.cubicOut)},update:function(){cjs.Tween.hasActiveTweens(this.btnBack)||(this.btnBack.y=.5*-ph.system.height+64),!cjs.Tween.hasActiveTweens(this.boxCon)&&this.boxCon.y<768&&(this.boxCon.y=.5*ph.system.height-24),this.playerCon.y=.5*-ph.system.height+24;var a=this.boxCon.getChildByName("shine");a.rotation+=90*ph.system.delta;for(var b,c=0,d=ph.system.delta;c<this.fishSprs.length;c++)b=this.fishSprs[c],!cjs.Tween.hasActiveTweens(b)&&b.mouseEnabled&&(b.r<6&&(b.r+=2*d),b.angle+=d*(c%2?1:-1)*(.5*(c%4+1)),b.x=b.ox+b.r*Math.cos(b.angle),b.y=b.oy+b.r*Math.sin(b.angle))},showBox:function(a){cjs.Tween.get(this.boxCon,{override:!0}).to({y:.5*ph.system.height-24},600,cjs.Ease.cubicOut);var b=this.boxCon.getChildByName("powerup");cjs.Tween.get(b,{override:!0}).to({scaleX:0,scaleY:0},200,cjs.Ease.cubicIn).wait(this.boxCon.y>=768?400:0).call(b.gotoAndStop,["powerups/"+a],b).to({scaleX:1,scaleY:1},600,cjs.Ease.cubicOut);var c=this.boxCon.getChildByName("btn-tick").set({mouseEnabled:!0});c.scaleX||cjs.Tween.get(c).wait(800).to({scaleX:1,scaleY:1},600,cjs.Ease.cubicOut);var d=this.boxCon.getChildByName("shine");d.scaleX||cjs.Tween.get(d).wait(1e3).to({scaleX:1,scaleY:1},600,cjs.Ease.cubicOut);var e=this.boxCon.getChildByName("text-con"),f=e.getChildByName("text-1"),g=e.getChildByName("text-2");f.set(ph.loader.get("strings")["CHARACTER_"+a.toUpperCase()+"_NAME"]),f.text+=" ",g.set(ph.loader.get("strings")["CHARACTER_"+a.toUpperCase()+"_INFO"]).set({x:f.getBounds().width}),e.scaleX=1;var h=e.getBounds().width;h>650?e.scaleX=650/h:e.scaleX=1,e.regX=.5*h},hideBox:function(){var a=this.boxCon.getChildByName("shine");cjs.Tween.get(a,{override:!0}).to({scaleX:0,scaleY:0},100,cjs.Ease.cubicIn);var b=this.boxCon.getChildByName("btn-tick");cjs.Tween.get(b,{override:!0}).to({scaleX:0,scaleY:0},100,cjs.Ease.cubicIn);var c=this.boxCon.getChildByName("powerup");cjs.Tween.get(c,{override:!0}).wait(100).to({scaleX:0,scaleY:0},100,cjs.Ease.cubicOut),cjs.Tween.get(this.boxCon,{override:!0}).wait(200).to({y:768},400,cjs.Ease.cubicIn)},setStar:function(a,b){var c=this.con.getChildByName("con-fish").getChildByName("fish-"+a);c.mouseEnabled=!1,window.app.sound.play("character-select",{volume:.6});var d=new cjs.Sprite(ph.loader.get("menu-sprites"),"shine").set({regX:76.5,regY:77,zIndex:-1,scaleX:0,scaleY:0}),e=new cjs.Sprite(ph.loader.get("menu-sprites"),"star-"+b).set({regX:53,regY:47,scaleX:2,scaleY:2,alpha:0}),f=(new cjs.Container).set({name:"selected-star-"+b,zIndex:100,mouseEnabled:!1});if(f.addChild(d,e),d.on("tick",this.starRotate,d),cjs.Tween.get(e).to({scaleX:.7,scaleY:.7,alpha:1},600,cjs.Ease.cubicOut),cjs.Tween.get(d).wait(200).to({scaleX:.7,scaleY:.7},600),this.con.addChild(f),"bubbles"===a?f.set({x:290,y:82}):"splash"===a?f.set({x:-320,y:58}):"dunk"===a?f.set({x:110,y:-15}):"ripple"===a&&f.set({x:-80,y:10}),1===b&&2===ph.game.data.playerN){var g=this.playerCon.getChildByName("star");cjs.Tween.get(g,{override:!0}).to({alpha:0},200).call(g.gotoAndStop,["star-2"],g).call(g.set,[{scaleX:1.4,scaleY:1.4,alpha:0}],g).wait(100).to({alpha:1,scaleX:.7,scaleY:.7},600,cjs.Ease.cubicOut)}},unsetStar:function(a,b){var c=this.con.getChildByName("con-fish").getChildByName("fish-"+a);c.gotoAndStop("characters/"+a),c.mouseEnabled=!0;var d=this.con.getChildByName("selected-star-"+b),e=d.getChildAt(0);if(cjs.Tween.get(d).to({scaleX:0,scaleY:0},200,cjs.Ease.cubicIn).call(e.removeAllEventListeners,null,e).call(this.con.removeChild,[d],this.con),1===b){var f=this.playerCon.getChildByName("star");cjs.Tween.get(f,{override:!0}).to({alpha:0},200).call(f.gotoAndStop,["star-1"],f).call(f.set,[{scaleX:1.4,scaleY:1.4,alpha:0}],f).wait(100).to({alpha:1,scaleX:.7,scaleY:.7},600,cjs.Ease.cubicOut)}},starRotate:function(){this.rotation+=45*ph.system.delta},enableFish:function(a){for(var b=0;b<this.fishSprs.length;b++)this.fishSprs[b].mouseEnabled=a},interactionEvent:function(a){var b,c=a.target.name||"",d=!1;if("click"===a.type)if(c.indexOf("fish-")>-1){if(b=c.split("-").pop(),cjs.Tween.get(this.con.getChildByName("con-fish")).to({scaleX:.9,scaleY:.9},600,cjs.Ease.quadInOut),this.selected===a.target)return;this.selected&&this.selected.gotoAndStop("characters/"+this.selected.name.split("-")[1]);var e=[];"splash"===b?e.push("character4"):"bubbles"===b?e.push("character5"):"dunk"===b?e.push("character6"):"ripple"===b&&e.push("character7"),e.push({id:"score17",delay:1200}),ph.vo.play(e),this.selected=a.target,this.showBox(b),a.target.gotoAndStop("characters/"+b+"-selected")}else if("btn-tick"===c&&this.selected)b=this.selected.name.split("-").pop(),this.selected=null,a.target.mouseEnabled=!1,1===ph.game.data.playerN?(ph.game.data.player[0]=b,this.setStar(b,1),this.enableFish(!1),d=ph.Scene.Game):ph.game.data.player[0]?ph.game.data.player[1]||(ph.game.data.player[1]=b,this.setStar(b,2),this.hideBox(),this.enableFish(!1),d=ph.Scene.Game):(ph.vo.play("character3"),ph.game.data.player[0]=b,this.setStar(b,1),this.hideBox()),d&&(this.con.disableEvents(),cjs.Tween.get(this.boxCon.getChildByName("shine"),{override:!0}).to({scaleX:0,scaleY:0},100,cjs.Ease.cubicIn),cjs.Tween.get(a.target,{override:!0}).wait(100).to({scaleX:0,scaleY:0},200,cjs.Ease.cubicIn).wait(800).call(ph.game.switchScene,[d],ph.game));else if("btn-back"===c)if(ph.game.data.player[0]||ph.game.data.player[1]){ph.game.data.player[1]?(ph.vo.play("character3"),this.unsetStar(ph.game.data.player[1],2),ph.game.data.player[0]=null):(ph.vo.play("character2"),this.unsetStar(ph.game.data.player[0],1),ph.game.data.player[0]=null),this.enableFish(!0);var f=this.con.getChildByName("fish-"+ph.game.data.player[0]),g=this.con.getChildByName("fish-"+ph.game.data.player[1]);f&&(f.mouseEnabled=!1),g&&(g.mouseEnabled=!1);var h=this.boxCon.getChildByName("shine");cjs.Tween.get(h,{override:!0}).to({scaleX:1,scaleY:1},600,cjs.Ease.cubicOut);var i=this.boxCon.getChildByName("btn-tick").set({mouseEnabled:!0});cjs.Tween.get(i,{override:!0}).to({scaleX:1,scaleY:1},600,cjs.Ease.cubicOut)}else this.con.disableEvents(),ph.game.switchScene(ph.Scene.Title)}})}(),function(){ph.Scene.Game=ph.Scene.extend({quickReset:!1,skipTutorial:!1,con:null,conOverlay:null,conScore:null,b2World:null,b2Debug:!1,btnPause:null,player:[],powerup:[],ball:null,walls:[],obstacle:{},obstacleTimer:null,obstacleLast:"",flo:null,splashSprs:[],hitCount:0,hitLast:null,hasCoin:!1,coinTimer:null,coin:null,voId:[],voFunId:[],init:function(){ph.game.data.player[1]=ph.game.data.player[1]||["bubbles","splash","dunk"].erase(ph.game.data.player[0]).random(),ph.game.setBG(ph.loader.get("bg-game")),this.setupAnimations(),this.b2World=new b2World(new b2Vec2(0,ph.loader.get("config").difficulty.gravity.start),!1),this.b2World.SetContinuousPhysics(!1),b2CreateContactListener(this.b2World),this.walls[0]=b2CreateBox(this.b2World,0,-320,1200,80),this.walls[1]=b2CreateBox(this.b2World,0,310,1200,80),this.walls[0].GetFixtureList().SetRestitution(0),this.walls[1].GetFixtureList().SetRestitution(0),this.walls[0].GetFixtureList().SetFriction(0),this.walls[1].GetFixtureList().SetFriction(0),this.walls[0].SetUserData("ceiling"),this.walls[1].SetUserData("ground");var a=ph.loader.get("game-sprites"),b=ph.device.mobile;this.player[0]=new cjs.SpritePlayer(ph.game.data.player[0]).set({name:"player-1",x:-912,scaleX:-1*(b?1.4:1),scaleY:b?1.4:1,isPlayer:!0}),this.player[1]=new cjs.SpritePlayer(ph.game.data.player[1]).set({name:"player-2",x:912,scaleX:b?1.4:1,scaleY:b?1.4:1,isPlayer:2===ph.game.data.playerN}),this.powerup[0]=new cjs.SpritePowerup(ph.game.data.player[0]).set({name:"powerup-1",x:-428,player:this.player[0],zIndex:100}),this.powerup[1]=new cjs.SpritePowerup(ph.game.data.player[1]).set({name:"powerup-2",x:428,player:this.player[1],zIndex:100}),this.btnPause=new cjs.SpriteBtn(a,"btn/pause").set({name:"btn-pause",regX:31,regY:32,x:-470,y:-768,cursor:"pointer",zIndex:1e3}),this.flo=new cjs.Sprite(ph.loader.get("character-flo-sprites"),"flo").set({name:"flo",y:42,regX:275,regY:200,framerate:24,visible:!1,zIndex:-1,mouseEnabled:!1}),this.flo.gotoAndStop("flo");var c=new cjs.Shape((new cjs.Graphics).f("#08527a").rr(0,0,110,50,25,25,25,25)).set({alpha:.7,regX:55,regY:25,zIndex:-1}),d=new cjs.Text("123","42px vag","#fff").set({textBaseline:"middle",textAlign:"center",y:5,maxWidth:80});if(this.conScore=(new cjs.Container).set({name:"con-score",zIndex:100}),this.conScore.addChild(c,d),this.con=new cjs.Layer(app.display.stage).set({screenX:.5,screenY:.5}),this.conOverlay=new cjs.Layer(app.display.stage).set({screenX:.5,screenY:.5,zIndex:10}),this.con.addChild(this.btnPause,this.player[0],this.player[1],this.powerup[0],this.powerup[1],this.conScore,this.flo),"splash"===ph.game.data.player[0]||"splash"===ph.game.data.player[1])for(var e=0;12>e;e++){var f=new cjs.Sprite(a,"splash").set({regX:60.5,regY:33,alpha:0,zIndex:-1});this.splashSprs.push(this.con.addChild(f))}var g=new cjs.Sprite(a,"ceiling").set({regX:512,zIndex:-99990,y:-384,mouseEnabled:!1});if(this.con.addChild(g),!ph.device.mobile){var h=new cjs.Sprite(a,"sand").set({regX:512,regY:162,zIndex:-99990,y:384,mouseEnabled:!1});this.con.addChild(h)}this.obstacle.clam=(new cjs.SpriteClam).set({x:-120,y:240,zIndex:-10}),this.obstacle.toob1=(new cjs.SpriteToob).set({name:"toob",x:240,y:240,zIndex:-10}),this.obstacle.toob2=(new cjs.SpriteToob).set({name:"toob-top",x:-240,y:-260,scaleY:-1,zIndex:-99995}),this.con.addChild(this.obstacle.clam,this.obstacle.toob1,this.obstacle.toob2),this.con.enableEvents(this.interactionEvent,this),this.conOverlay.enableEvents(this.interactionEvent,this);var i=this.player[0].fisName+""+this.player[1].fishName;i.indexOf("bubbles")>-1&&this.voFunId.push("gameplay25","gameplay26"),i.indexOf("dunk")>-1&&this.voFunId.push("gameplay27","gameplay28","gameplay29"),i.indexOf("splash")>-1&&this.voFunId.push("gameplay17","gameplay18"),i.indexOf("ripple")>-1&&this.voFunId.push("gameplay19","gameplay20","gameplay21"),this.voFunId.push("gameplay16"),this.voFunId.shuffle(),this.voFunIndex=0,this.obstacleTimer=new ph.Timer(ph.loader.get("config").obstacleTimer.start),this.obstacleTimer.pause(),this.coinTimer=new ph.Timer(ph.loader.get("config").coinTimer.start),this.coinTimer.pause(),this.b2Debug&&this.setupB2Debug(),app.display.stage.addChild(this.con,this.conOverlay)},kill:function(){this.b2World.DestroyBody(this.walls[0]),this.b2World.DestroyBody(this.walls[1]),this.con.removeChild(this.player[0],this.player[1],this.powerup[0],this.powerup[1],this.ball,this.conScore,this.flo),this.player.length=0,this.powerup.length=0,this.splashSprs.length=0,this.ball=null,this.flo=null,this.conScore=null;for(var a in this.obstacle)ph.scene.con.removeChild(this.obstacle[a]);this.con.disableEvents(),this.conOverlay.disableEvents(),this.con.parent.removeChild(this.con),this.conOverlay.parent.removeChild(this.conOverlay),this.con=this.conOverlay=null,this.b2World=null,this.b2Debug=null,ph.Timer.timeScale=1},start:function(){ph.music.set("music-menu",null,.1),cjs.Tween.get(this.btnPause).to({y:.5*-ph.system.height+42},600,cjs.Ease.cubicOut),this.switchState(this.stateId.intro)},update:function(){if(this.currentStateId===this.stateId.game){this.b2World.Step(ph.system.delta,6,6),this.b2World.ClearForces();for(var a=0;a<this.splashSprs.length;a++)this.splashSprs[a].alpha-=1.8*ph.system.delta}cjs.Tween.hasActiveTweens(this.btnPause)||(this.btnPause.y=.5*-ph.system.height+42),this.conScore&&(this.conScore.y=.5*-ph.system.height+64,this.conScore.getChildAt(1).text=this.hitCount),this.powerup[0].y=this.powerup[1].y=.5*-ph.system.height+128,!this.hasCoin&&this.coinTimer.delta()>0&&!this.coin&&this.spawnCoin(),this.obstacleTimer.delta()>0&&this.spawnObstacle(),this.currentStateId===this.stateId.game&&!ph.vo.isPlaying&&ph.vo.endTime.delta()>ph.loader.get("config").voTimer.start&&this.playFunVO(),this.b2Debug&&(this.b2Debug.Clear(),this.b2Debug.GetSprite().save(),this.b2Debug.GetSprite().translate(512,384),this.b2World.DrawDebugData(),this.b2Debug.GetSprite().restore())},playFunVO:function(){ph.vo.play(this.voFunId[this.voFunIndex++]),this.voFunIndex===this.voFunId.length-1&&(this.voFunIndex=0)},hitBall:function(a){this.hitCount++;var b=this.conScore.getChildAt(1);if(cjs.Tween.get(b,{override:!0}).to({scaleX:1.4,scaleY:1.4},100).to({scaleX:1,scaleY:1},200,cjs.Ease.quadOut),this.hitLast!==a){this.hitLast=a,this.powerup[0].player===a?this.powerup[0].hitBall():this.powerup[1].hitBall();var c=ph.loader.get("config").difficulty;if(this.hitCount>=c.start){this.b2World.m_gravity.y<c.gravity.max&&(this.b2World.m_gravity.y+=c.gravity.increment);var d=this.ball.body.GetFixtureList(),e=d.GetRestitution();e<c.ballRestitution.max&&d.SetRestitution(e+c.ballRestitution.increment),this.player[0].hitForce<c.fishHitForce.max&&(this.player[0].hitForce+=c.fishHitForce.increment,this.player[1].hitForce+=c.fishHitForce.increment),this.ball.velocityLimit<c.ballVelocityLimit.max&&(this.ball.velocityLimit+=c.ballVelocityLimit.increment)}}},showIntro:function(){cjs.Tween.get(this.player[0]).to({x:-412},1200,cjs.Ease.circOut).call(this.player[0].set,[{x:-412}],this.player[0]);var a=cjs.Tween.get(this.player[1]).wait(400).to({x:412},1200,cjs.Ease.circOut).call(this.player[1].set,[{x:412}],this.player[1]);this.skipTutorial||ph.game.data.restart?a.call(this.tipoff,null,this):ph.vo.play("gameplay1",this.showTutorial,this)},spawnObstacle:function(){var a=ph.loader.get("config").obstacleTimer;this.obstacleTimer.target>a.min&&this.obstacleTimer.set(this.obstacleTimer.target-a.decrement),this.obstacleTimer.reset();var b,c=["fish","current","eel"].erase(this.obstacleLast).erase(this.hitCount<20?"eel":"").random();if(!this.obstacle[c])if(this.obstacleLast=c,"fish"===c){var d=this.ball.body.GetLinearVelocity().x<0&&this.ball.x<0?0:1;b=new cjs.SpriteFish(d).set({zIndex:-10}),this.obstacle[c]=b,this.con.addChild(b)}else if("current"===c)b=(new cjs.SpriteCurrent).set({x:this.ball.x<0?120:-120,zIndex:-10}),this.obstacle[c]=b,this.con.addChild(b);else if("eel"===c){var e="toob"+Math.rand(1,2);this.obstacle[e].eelShow(),this.obstacle[c]=this.obstacle[e]}},spawnCoin:function(){this.coinTimer.reset().set(ph.loader.get("config").coinTimer.afterFirstSpawn).reset().pause(),this.coin=new cjs.SpriteCoin,this.con.addChild(this.coin)},useCoin:function(){if(!ph.vo.isPlaying){var a=["gameplay7","gameplay7.1"],b=[];if(-1===this.voId.indexOf("gameplay30")&&b.push(30),-1===this.voId.indexOf("gameplay31")&&b.push(31),b.length){var c=b.random();a.push("gameplay"+c),this.voId.push("gameplay"+c)}ph.vo.play(a)}ph.sfx("flosave"),this.hasCoin=!1,this.coin&&this.coin.use(),this.coin=null,this.flo.visible=!0,this.ball.x<0?(this.flo.x=-512+this.flo.regX,this.flo.scaleX=-1):(this.flo.x=512-this.flo.regX,this.flo.scaleX=1),this.flo.gotoAndPlay("flo"),cjs.Tween.get(this.flo).wait(1300).call(this.floToss,null,this)},floToss:function(){this.flo.x<0?this.ball.set({x:-366,y:-116,scaleX:-1}):this.ball.set({x:366,y:-116,scaleY:1}),this.ball.floToss(),this.coinTimer.reset()},usePowerup:function(a){this.player[a.x<0?0:1].powerup()},tipoff:function(){this.player[0].canControl=this.player[1].canControl=!0;var a=ph.device.mobile,b=ph.game.data.player[2],c=new cjs.SpritePlayer(b).set({name:"tipoff-fish",x:1024,y:-120,mouseEnabled:!1,zIndex:1,scaleX:a?1.4:1,scaleY:a?1.4:1}),d=0,e=0;"dunk"===b?(d=-32,e=-18):"splash"===b?(d=-42,e=-16):"bubbles"===b?(d=-42,e=-12):"ripple"===b&&(d=-20,e=-8),this.ball=new cjs.SpriteBall(ph.loader.get("game-sprites"),"pebble").set({name:"ball",x:1024+d,y:-120+e});var f=292;cjs.Tween.get(this.ball).to({x:f+d},1200,cjs.Ease.circOut).call(this.ball.set,[{x:f+d}],this.ball).call(ph.vo.play,["score12"],ph.vo).wait(1200).call(this.ball.tipoff,null,this.ball).call(this.switchState,[this.stateId.game],this),cjs.Tween.get(c).to({x:f},1200,cjs.Ease.circOut).wait(1e3).call(c.gotoAndPlay,["Hit2"],c).wait(1e3).call(c.set,[{scaleX:-1}],c).wait(400).to({x:1024},1200,cjs.Ease.circIn).call(this.con.removeChild,[c],this.con),this.con.addChild(c,this.ball)},showTutorial:function(){var a=ph.loader.get("game-sprites");if(this.player[0].canControl=this.player[1].canControl=!0,ph.device.mobile){ph.vo.play("gameplay3",this.hideTutorial,this);var b=new cjs.Sprite(a,"hand").set({name:"hand",x:-480,regX:93,alpha:0}),c=b.clone().set({x:480,scaleX:-1,visible:2===ph.game.data.playerN});this.conOverlay.addChild(b,c),cjs.Tween.get(b).to({x:-400,alpha:1},400,cjs.Ease.quadOut).wait(200).to({scaleX:.9,scaleY:.9},100).call(this.player[0].set,[{target:b}],this.player[0]).wait(200).to({y:200},800,cjs.Ease.quadInOut).to({x:-250},800,cjs.Ease.quadInOut).to({y:-200},1600,cjs.Ease.quadInOut).to({x:this.player[0].x,y:0},1200,cjs.Ease.quadInOut).call(function(a){this.target===a&&(this.target={x:a.x,y:a.y})},[b],this.player[0]).to({scaleX:1,scaleY:1},400).to({x:b.x,alpha:0},400).call(this.conOverlay.removeChild,[b],this.conOverlay),c.visible&&cjs.Tween.get(c).to({x:400,alpha:1},400,cjs.Ease.quadOut).wait(200).to({scaleX:-.9,scaleY:.9},100).call(this.player[1].set,[{target:c}],this.player[1]).wait(200).to({y:200},800,cjs.Ease.quadInOut).to({x:250},800,cjs.Ease.quadInOut).to({y:-200},1600,cjs.Ease.quadInOut).to({x:this.player[1].x,y:0},1200,cjs.Ease.quadInOut).call(function(a){this.target===a&&(this.target={x:a.x,y:a.y})},[c],this.player[1]).to({scaleX:-1,scaleY:1},400).to({x:c.x,alpha:0},400).call(this.conOverlay.removeChild,[c],this.conOverlay)}else{2===ph.game.data.playerN?ph.vo.play("gameplay2"):ph.vo.play("gameplay4");var d=(new cjs.Container).set({name:"con-tut",mouseEnabled:!1}),e=new cjs.Shape((new cjs.Graphics).f("#000").dr(0,0,1024,768)).set({name:"bg",regX:512,regY:384,alpha:0,zIndex:-1e3,mouseEnabled:!1}),f=(new cjs.Container).set({name:"btn-1",x:0,y:-140,mouseEnabled:!1,scaleX:0,scaleY:0}),g=new cjs.Sprite(a,"rr-orange").set({regX:124.5,regY:31,zIndex:-1}),h=new cjs.Sprite(a,"star-1").set({regX:53,regY:47,x:-107,y:-6}),i=new cjs.Text("","42px vag","#fff").set({x:31,y:-18,textAlign:"center",maxWidth:160,zIndex:1});i.set(ph.loader.get("strings").PLAYER),f.addChild(g,h,i);var j=new cjs.Sprite(a,"help/key-arrows-1").set({name:"key-1",x:0,y:20,regX:164,regY:109,scaleX:0,scaleY:0,framerate:2});if(2===ph.game.data.playerN){f.set({x:-180}),j.set({x:-190}).gotoAndPlay("help/key-wasd");var k=(new cjs.Container).set({name:"btn-2",x:200,y:-140,mouseEnabled:!1,scaleX:0,scaleY:0});g=new cjs.Sprite(a,"rr-green").set({regX:124.5,regY:31,zIndex:-1}),h=new cjs.Sprite(a,"star-2").set({regX:53,regY:47,x:-107,y:-6}),i=new cjs.Text("","42px vag","#fff").set({x:31,y:-18,textAlign:"center",maxWidth:160,zIndex:1}),i.set(ph.loader.get("strings").PLAYER),k.addChild(g,h,i);var l=j.clone().set({name:"key-2",x:190});l.gotoAndPlay("help/key-arrows-2"),d.addChild(k,l),cjs.Tween.get(k).wait(800).to({scaleX:1,scaleY:1},400,cjs.Ease.cubicOut),cjs.Tween.get(l).wait(1200).to({scaleX:1,scaleY:1},400,cjs.Ease.cubicOut)}var m=new cjs.SpriteBtn(a,"btn/tick").set({name:"btn-tutorial",y:200,regX:39,regY:45.5,scaleX:0,scaleY:0,cursor:"pointer"});d.addChild(e,f,j,m),this.conOverlay.addChild(d),cjs.Tween.get(e).to({alpha:.4},600),cjs.Tween.get(f).wait(600).to({scaleX:1,scaleY:1},400,cjs.Ease.cubicOut),cjs.Tween.get(j).wait(1e3).to({scaleX:1,scaleY:1},400,cjs.Ease.cubicOut),cjs.Tween.get(m).wait(1800).to({scaleX:1,scaleY:1},400,cjs.Ease.cubicOut).call(d.set,[{mouseEnabled:!0}],d)}},hideTutorial:function(){var a;if(ph.device.mobile)a=cjs.Tween.get({}).wait(1800);else{var b=this.conOverlay.getChildByName("con-tut");b.mouseEnabled=!1;var c=b.getChildByName("bg"),d=b.getChildByName("btn-tutorial").set({mouseEnabled:!1}),e={override:!0};cjs.Tween.get(d).to({scaleX:0,scaleY:0},200,cjs.Ease.cubicIn),cjs.Tween.get(b.getChildByName("btn-1"),e).to({scaleX:0,scaleY:0},200,cjs.Ease.cubicIn),cjs.Tween.get(b.getChildByName("key-1"),e).wait(200).to({scaleX:0,scaleY:0},200,cjs.Ease.cubicIn),2===ph.game.data.playerN&&(cjs.Tween.get(b.getChildByName("btn-2"),e).wait(100).to({scaleX:0,scaleY:0},200,cjs.Ease.cubicIn),cjs.Tween.get(b.getChildByName("key-2"),e).wait(300).to({scaleX:0,scaleY:0},200,cjs.Ease.cubicIn)),a=cjs.Tween.get(c,e).wait(400).to({alpha:0},200).call(this.conOverlay.removeChild,[b],this.conOverlay)}a.wait(200).call(this.tipoff,null,this)},showPause:function(a){var b,c=this.conOverlay.getChildByName("con-pause");if(!c){var d=ph.loader.get("game-sprites"),e=new cjs.Shape((new cjs.Graphics).f("#000").dr(0,0,1024,768)).set({regX:512,regY:384,zIndex:-(1/0),alpha:0}),f=new cjs.SpriteBtn(d,"btn/replay").set({name:"btn-replay",x:-185,y:-90,regX:65.5,regY:68,cursor:"pointer",scaleX:0,scaleY:0,zIndex:1}),g=new cjs.SpriteBtn(d,"btn/play").set({name:"btn-play",x:0,y:-90,regX:76.5,regY:79,cursor:"pointer",scaleX:0,scaleY:0,zIndex:2}),h=new cjs.SpriteBtn(d,"btn/home").set({name:"btn-home",x:185,y:-90,regX:65.5,regY:68,cursor:"pointer",scaleX:0,scaleY:0,zIndex:3});b=new cjs.Sprite(d,"flo").set({name:"flo",regX:478.5,regY:193.5,y:600,zIndex:10}),c=(new cjs.Container).set({name:"con-pause",mouseEnabled:!1}),c.addChild(e,f,g,h,b),this.conOverlay.addChild(c)}b=c.getChildAt(4).set({x:512});var i={override:!0};cjs.Tween.get(c.getChildAt(0),i).to({alpha:.6},600),cjs.Tween.get(b,i).to({x:0,y:192},1200,cjs.Ease.quadOut),cjs.Tween.get(c.getChildAt(1),i).wait(600).to({scaleX:1,scaleY:1},400,cjs.Ease.cubicOut),cjs.Tween.get(c.getChildAt(2),i).wait(800).to({scaleX:1,scaleY:1},400,cjs.Ease.cubicOut),cjs.Tween.get(c.getChildAt(3),i).wait(1e3).to({scaleX:1,scaleY:1},400,cjs.Ease.cubicOut).call(c.set,[{mouseChildren:!0,mouseEnabled:!0}],c)},hidePause:function(){var a=this.conOverlay.getChildByName("con-pause");a.mouseEnabled=!1,a.mouseChildren=!1;var b={override:!0};return cjs.Tween.get(a.getChildAt(4),b).to({x:-512,y:600},600,cjs.Ease.quadIn),cjs.Tween.get(a.getChildAt(1),b).wait(0).to({scaleX:0,scaleY:0},200,cjs.Ease.cubicIn),cjs.Tween.get(a.getChildAt(2),b).wait(100).to({scaleX:0,scaleY:0},200,cjs.Ease.cubicIn),cjs.Tween.get(a.getChildAt(3),b).wait(200).to({scaleX:0,scaleY:0},200,cjs.Ease.cubicIn),cjs.Tween.get(a.getChildAt(0),b).wait(200).to({alpha:0},400)},switchState:function(a){if(a===this.stateId.intro)this.showIntro();else if(a===this.stateId.game)ph.game.data.restart=!0,ph.Timer.timeScale=1,this.obstacleTimer.pausedAt&&this.obstacleTimer.resume(),this.coinTimer.pausedAt&&this.coinTimer.resume();else if(a===this.stateId.menu)ph.Timer.timeScale=0,this.showPause();else if(a===this.stateId.end){if(this.quickReset)return this.hitCount=0,void this.ball.set({x:292,y:-120}).tipoff();ph.game.data.hitCount=this.hitCount,this.obstacleTimer.pause(),this.coinTimer.pause(),this.con.disableEvents(),this.conOverlay.disableEvents(),cjs.Tween.get(ph.Timer).to({timeScale:.5},800,cjs.Ease.quadIn).call(ph.game.switchScene,[ph.Scene.End],ph.game)}this.currentStateId=a},interactionEvent:function(a){if("click"===a.type){var b=a.target.name||"";"btn-pause"===b&&this.currentStateId===this.stateId.game?this.switchState(this.stateId.menu):"btn-replay"===b?(this.con.disableEvents(),this.conOverlay.disableEvents(),ph.game.switchScene(ph.Scene.Game)):"btn-play"===b?this.hidePause().wait(200).call(this.switchState,[this.stateId.game],this):"btn-home"===b?(this.con.disableEvents(),this.conOverlay.disableEvents(),ph.game.switchScene(ph.Scene.Title)):b.indexOf("powerup-")>-1&&a.target.power>=1?this.usePowerup(a.target):"btn-tutorial"===b&&ph.vo.fadeOut().call(this.hideTutorial,null,this)}},setupAnimations:function(){var a=ph.loader.get("obstacle-sprites")._data;a.clam.next=!1,a.current.next=!1,a["toob-front"].next=!1,a["toob-front-spit"].next=!1,a["toob-back"].next=!1,a["toob-back-spit"].next=!1,a=ph.loader.get("character-maury-sprites")._data,a["eel-sink"].next=!1,a["eel-sink-down"].next=!1,a=ph.loader.get("character-flo-sprites")._data,a.flo.next=!1},setupB2Debug:function(){var a=ph.$new("canvas");a.width=1024,a.height=768;var b=new b2DebugDraw;b.SetSprite(a.getContext("2d")),b.SetDrawScale(b2Scale),b.SetFillAlpha(.3),b.SetLineThickness(1),b.SetFlags(b2DebugDraw.e_shapeBit|b2DebugDraw.e_jointBit|b2DebugDraw.e_centerOfMassBit),this.b2World.SetDebugDraw(b),this.b2Debug=b,this.con.addChild(new cjs.Bitmap(a).set({regX:512,regY:384,zIndex:999999,mouseEnabled:!1}))}})}(),function(){ph.Scene.End=ph.Scene.extend({con:null,conScore:null,fishSprs:[],shineSpr:null,init:function(){ph.game.setBG(ph.loader.get("bg-menu")),this.con=new cjs.Layer,this.con.enableEvents(this.interactionEvent,this),app.display.stage.addChild(this.con);var a=ph.loader.get("menu-sprites"),b=new cjs.Sprite(a,"pebble").set({name:"pebble",regX:36,regY:37.5,x:-302,y:154.5}),c=ph.game.data.player[0],d=ph.game.data.player[1],e=new cjs.Sprite(a,"characters/"+c).set({name:"fish-"+c,regX:183,regY:120.5}),f=new cjs.Sprite(a,"characters/"+d).set({name:"fish-"+d,regX:183,regY:120.5}),g=[e,f].sort(function(a,b){return a.name<b.name?-1:a.name>b.name?1:0});"fish-bubbles"===g[0].name?(g[0].set({x:-280,y:-100,zIndex:-1}),"fish-splash"===g[1].name?g[1].set({x:-124,y:46,zIndex:1}):"fish-dunk"===g[1].name?g[1].set({x:-122,y:54,zIndex:1}):"fish-ripple"===g[1].name&&g[1].set({x:-134,y:50,zIndex:1})):"fish-dunk"===g[0].name?(g[0].set({x:-308,y:-76,zIndex:1}),"fish-ripple"===g[1].name?g[1].set({x:-155,y:58}):"fish-splash"===g[1].name&&g[1].set({x:-100,y:46})):"fish-ripple"===g[0].name&&(g[0].set({x:-338,y:-85}),g[1].set({x:-152,y:12})),this.fishSprs.push(e.set({ox:e.x,oy:e.y,r:0,angle:0}),f.set({ox:f.x,oy:f.y,r:0,angle:0})),this.con.addChild(b,e,f)},kill:function(){this.con.removeChild(this.conScore),this.conScore=null,this.con.disableEvents(),this.con.parent.removeChild(this.con)},start:function(){ph.music.set("music-end",null,.1);var a="",b=ph.game.data.hitCount;b>2&&10>b?a="bronze":b>9&&20>b?a="silver":b>19&&(a="gold"),b>ph.session.get("hitCount")&&ph.session.set("hitCount",b);var c=[];if(1>=b?c.push("score2"):(b>4&&c.push("score"+[13,15,16,18].random()),c.push("score1_"+["bubbles","splash"].random())),b>1&&1e3>b){c.push("score3");var d,e=b;b>=100&&(d=b.toString().split(""),c.push("score6."+d.shift(),"score6.100"),b=parseInt(d.join(""))),b>20?(d=b.toString().split(""),c.push("score6."+d[0]+"0"),b%10!==0&&c.push("score6."+d[1])):e%100!==0&&c.push("score6."+b),b=e,c.push(1===b?"score4":"score5")}ph.vo.play(c);var f=ph.loader.get("menu-sprites"),g=new cjs.SpriteBtn(f,"btn/replay2").set({name:"btn-replay",regX:65.5,regY:68,x:129,y:10,cursor:"pointer",zIndex:100,scaleX:0,scaleY:0}),h=new cjs.SpriteBtn(f,"btn/home2").set({name:"btn-home",regX:65,regY:68.5,x:233,y:125,cursor:"pointer",zIndex:100,scaleX:0,scaleY:0}),i=app.display.stage.canvas.getContext("2d").createLinearGradient(0,-42,0,24);i.addColorStop(0,"#fff"),i.addColorStop(1,"#c4f3ff");var j=new cjs.Text("","40px vag","#fff").set({y:-96,textAlign:"center",alpha:0,zIndex:100}).set(b>1?ph.loader.get("strings").END_WE_DID_IT:ph.loader.get("strings").END_NEXT_TIME);j.shadow=new cjs.Shadow("rgba(6,70,123,0.2)",0,2,2);var k=new cjs.Shape((new cjs.Graphics).f("#08527a").rr(0,0,480,100,50,50,50,50)).set({regX:240,regY:50,zIndex:-100,scaleX:0,scaleY:0,alpha:.7}),l=new cjs.Text("","90px vag","#fff").set({color:i,textAlign:"center",textBaseline:"middle",maxWidth:320,x:42,y:8,alpha:0,zIndex:-10}).set(b>1?ph.loader.get("strings").END_HITS:ph.loader.get("strings").END_HIT),m=new cjs.Sprite(f,"shine").set({name:"shine",x:-178,regX:76.5,regY:77,scaleX:0,scaleY:0,alpha:0,zIndex:-10}),n=new cjs.Sprite(f,"star-"+a).set({x:-178,regX:42,regY:39.5,alpha:0,scaleX:1.4,scaleY:1.4});this.shineSpr=new cjs.Sprite(f,"shine-big").set({name:"shine",regX:275,regY:276.5,y:-250,zIndex:10,alpha:0});var o=new cjs.Text("","30px vag","#fff").set({y:64,textAlign:"center",alpha:0}).set(ph.loader.get("strings").END_HIGHSCORE);o.shadow=new cjs.Shadow("rgba(6,70,123,0.2)",0,2,2),l.text=l.text.replace("{n}",ph.game.data.hitCount),o.text=o.text.replace("{n}",ph.session.get("hitCount")||0),this.conScore=new cjs.Container,this.conScore.addChild(j,k,l,m,n,this.shineSpr,o),this.con.addChild(g,h,this.conScore),cjs.Tween.get(j).wait(1200).to({alpha:1},400),cjs.Tween.get(o).wait(1600).to({alpha:1},400),cjs.Tween.get(k).to({scaleX:1,scaleY:1},400,cjs.Ease.circOut),cjs.Tween.get(l).wait(600).to({alpha:1},400),cjs.Tween.get(this.shineSpr).to({alpha:1},600),a?(cjs.Tween.get(n).wait(1e3).to({
scaleX:1,scaleY:1,alpha:1},400,cjs.Ease.circIn),cjs.Tween.get(m).wait(1400).to({scaleX:1,scaleY:1,alpha:1},400)):l.x=0,cjs.Tween.get(g).wait(1200).to({scaleX:1,scaleY:1},600,cjs.Ease.circOut),cjs.Tween.get(h).wait(1400).to({scaleX:1,scaleY:1},600,cjs.Ease.circOut)},update:function(){this.shineSpr&&(this.shineSpr.rotation+=20*ph.system.delta),this.conScore&&(this.conScore.y=.5*-ph.system.height+128,this.conScore.getChildByName("shine").rotation+=20*ph.system.delta);for(var a,b=0,c=ph.system.delta;b<this.fishSprs.length;b++)a=this.fishSprs[b],a.r<6&&(a.r+=2*c),a.angle+=c*(b%2?1:-1)*(.5*(b%4+1)),a.x=a.ox+a.r*Math.cos(a.angle),a.y=a.oy+a.r*Math.sin(a.angle)},interactionEvent:function(a){"click"===a.type&&("btn-replay"===a.target.name?(this.con.disableEvents(),ph.game.switchScene(ph.Scene.Game)):"btn-home"===a.target.name&&(this.con.disableEvents(),ph.game.switchScene(ph.Scene.Title)))}})}(),function(){var a=include("springroll.Application"),b=include("springroll.easeljs.EaselJSDisplay"),c=new a({name:"Finball",canvasId:"stage",configPath:"assets/config/config.json",display:b,displayOptions:{clearView:!0},resizeElement:window,maxHeight:768});c.on("init",function(){ph.loader.load(ph.assets("prereq"),function(){new ph.System,new ph.Game,c.triggerResize()})}),c.on("resize",function(a,b){if(ph.system){ph.system.resize(a,b);var c=ph.system.stages[0].canvas,d=ph.$("#captions");d&&(d.style.width=c.style.width);var e=ph.$("#framerate");e&&(e.style.left=c.style.left,e.style.top=c.style.top)}}),c.on("update",function(a){ph.system&&ph.system.run(a)}),window.app=c}();