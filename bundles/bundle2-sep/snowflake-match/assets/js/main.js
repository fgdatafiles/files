!function(){var a=include("springroll.easeljs.BasePanel"),b=include("createjs.Container"),c=include("createjs.Bitmap"),d=include("springroll.easeljs.SoundButton"),e=include("springroll.easeljs.DwellTimer"),f=function(){a.call(this),this.skin=null,this.movingItemContainer=new b},g=a.prototype,h=extend(f,a);h.setup=function(){this.background=new c(images.GameBackground),this.addChildAt(this.background,0),this.addChild(this.movingItemContainer)},h.assemble=function(){this.geraldClip=new lib.Gerald,this.geraldClip.x=-180,this.geraldClip.y=133,this.geraldClip.name="Gerald",this.geraldClip.mouseChildren=!1,e.create(this.geraldClip),this.movingItemContainer.addChild(this.geraldClip),this.replayButton=new d(images.ReplayButton),this.replayButton.x=465,this.replayButton.y=270,this.replayButton.visible=!1,this.replayButton.name="replayButton",e.create(this.replayButton),this.movingItemContainer.addChild(this.replayButton)},h.teardown=function(){g.teardown.call(this),this.background=null,this.skin=null,this.flakes=null},h.destroy=function(){this.movingItemContainer=null,g.destroy.call(this)},namespace("sid").GamePanel=f}(),function(){var a=include("springroll.easeljs.BasePanel"),b=include("createjs.Bitmap"),c=include("springroll.easeljs.SoundButton"),d=include("springroll.easeljs.DwellTimer"),e=function(){a.call(this),this.playButton=null},f=a.prototype,g=extend(e,a);g.setup=function(){this.background=new b(images.TitleBackground),this.background.name="title-background",this.background.mouseEnabled=!0,this.addChildAt(this.background,0);var a=this.config.scalingSize;this.playButton=new c(images.PlayButton),this.playButton.x=.85*a.width-.5*images.PlayButton.width,this.playButton.y=.7*a.height,this.playButton.visible=!0,this.playButton.mouseEnabled=!0,this.playButton.name="play-button",d.create(this.background),d.create(this.playButton),this.addChild(this.playButton)},g.teardown=function(){f.teardown.call(this),this.background=null,this.playButton=null},namespace("sid").TitlePanel=e}(),function(){function a(){var a,c;switch(L=[],M=[],Z=[],O){case 0:a=B;break;case 1:a=C;break;case 2:a=D}var f=["easy","medium","hard"];da.reset(a.length/A[O]),c=a[0]+a[1]+a[2],X=[];for(var g=0;3>g;g++)for(var h=[],i=this.game.config.gameplay.levels[f[g]],j=0,k=a[g];k>j;j++){var l=q(h,i.length),m=q(L,c),n=q(M,c),o=i[l],p=!0;F[O]&&(p=Math.round(2*Math.random())?!0:!1);var r=e.bind(this)(o,!0,m,c,p),s=e.bind(this)(o,!1,n,c,!p);J.push(r),K.push(s),L.push(m),M.push(n),r.index=m,s.index=n,s.target=r,this.panel.movingItemContainer.addChild(r,s),this.dragManager.addObject(s),r.alpha=0,s.alpha=0,y.get(r).wait(500+50*m).to({alpha:1},500,w.sineOut),y.get(s).wait(750+50*n).to({alpha:1},500,w.sineOut).call(s.enableDrag.bind(s)),h.push(l),P+=1}X=J,this.game.learning.startTimer("round");var t=L.map(b,J),u=M.map(b,K);t.sort(d),u.sort(d),this.game.learning.startRound(t,u),Y++}function b(a){for(var b=0,c=this.length;c>b;b++){var d=this[b];if(d.index==a)return{name:d.name,index:d.index}}return null}function c(a){return a.dropped?!1:!0}function d(a,b){return a.index>b.index?1:-1}function e(a,b,c,d,e){var f=S.getFrame(a+"0000"),g=S.getFrame(a+"0002"),h=S.getFrame(a+"0001"),i=S.getFrame("shapeDroite10000");f.offset.x=f.offset.y=h.offset.x=h.offset.y=0;var j,k,l=new createjs.Container,m=createjs.BitmapUtils.bitmapFromTexture(f,.45),n=createjs.BitmapUtils.bitmapFromTexture(g,.45),o=m.getBounds();l.left=e,l.className=a,l.name=a+(b?"_top":"_bottom")+"_r"+Y,m.name="flake",n.name="hover",n.visible=!1,G[a]&&(n.x+=8,n.y+=-1),l.addChild(m),l.addChild(n),b?(j=createjs.BitmapUtils.bitmapFromTexture(h,.45),dropbg=createjs.BitmapUtils.bitmapFromTexture(i,.45),k=new createjs.BitmapMovieClip(U,V),j.name="droparea",dropbg.name="dropbg",e?dropbg.x=o.width/2:(H[a]&&(dropbg.x+=H[a].x),dropbg.regX=50,dropbg.scaleX=-1,j.x=-8,j.regX=100,j.scaleX=-1),k.name="stars",k.x=o.width/2,k.y=o.height/4,k.loop=!1,k.visible=!1,k.stop(),l.addChild(k),l.addChild(dropbg),l.addChild(j),m.visible=!1):(n.x-=9.5,Z.push(l)),board=b?{x:170,y:10,width:722,height:190}:{x:170,y:210,width:722,height:190},l.buttonMode=l.mouseChildren=!b;var p=new createjs.Shape;p.graphics.beginFill("#000").drawRect(board.x,board.y,board.width,board.height),l.regX=l.getChildAt(0).getBounds().width/4.1,l.regY=l.getChildAt(0).getBounds().height/4.1;var q=(board.width-94*d)/d;l.x=board.x+52+q/2+c*(q+94),l.index=c+1,l.y=board.y+board.height/2,l.origin={x:l.x,y:l.y};var r=new createjs.Shape;r.graphics.beginFill("#000").drawRect(0,0,o.width,o.height),l.hitArea=r,l.setBounds(l.x,l.y,o.width,o.height);var s=new createjs.Shape;return s.graphics.drawRect(e?0:o.width/2,0,o.width/2,o.height),l.addChild(s),l.getChildAt(0).mask=s,l.getChildAt(1).mask=s,b||(l.on("mouseover",function(){this.getChildByName("flake").visible=!1,this.getChildByName("hover").visible=!0,x.instance.play("ButtonRollover",{interrupt:!0})}.bind(l)),l.on("mouseout",function(){this.getChildByName("flake").visible=!0,this.getChildByName("hover").visible=!1}.bind(l))),l.mouseEnabled=!0,l.mouseChildren=!1,l.startDragTimer=function(){this.dragTime=0,this.dragTimer=setInterval(function(){this.dragTime+=100}.bind(this),100)}.bind(l),l.stopDragTimer=function(){clearInterval(this.dragTimer)}.bind(l),z.create(l),l}function f(a,b){for(var c=a.getBounds(),d=0,e=b.length;e>d;d++)if(c.intersects(b[d].getBounds()))return!0;return!1}function g(){x.instance.stopContext("vo"),x.instance.play("POSITIVE_SFX");var a=["ANSWERRIGHT1","ANSWERRIGHT2","ANSWERRIGHT3"][Math.floor(3*Math.random())];this.game.media.playCorrectFeedback(this.panel.geraldClip.gerald,a,this._instructionsDone)}function h(){x.instance.stopContext("vo"),x.instance.play("NEGATIVE_SFX");var a=["ANSWERWRONG1","ANSWERWRONG2"][Math.round(Math.random())];this.game.media.playIncorrectFeedback(this.panel.geraldClip.gerald,a,this._instructionsDone)}function i(){if(2>N){x.instance.stopContext("vo"),x.instance.play("POSITIVE_SFX");var a=["ROUNDEND","ANSWERRIGHT4"][Math.round(Math.random())];this.game.media.playCorrectFeedback(this.panel.geraldClip.gerald,a,l.bind(this));for(var b=0,c=J.length;c>b;b++){var d=J[b];d.dropSpeed=Math.round(Math.random()*Math.random()*Q)+10,d.incrementer=Math.round(100*Math.random()),y.get(d,{onChange:k}).to({alpha:0,rotation:720*Math.random()-360},1400)}this.game.learning.endRound(this.game.learning.stopTimer("round"),da.wrong)}else x.instance.stopContext("vo"),x.instance.play("POSITIVE_SFX"),this.game.media.playCorrectFeedback(this.panel.geraldClip.gerald,"FINAL",j.bind(W)),this.game.learning.endRound(this.game.learning.stopTimer("round"),da.wrong)}function j(){s.play(W.panel.geraldClip.gerald,"idle"),this.panel.replayButton.visible=!0}function k(a){a=a.currentTarget.target,a.y+=a.dropSpeed/1.9,R++}function l(){s.play(W.panel.geraldClip.gerald,"idle"),da.can_level_up()&&2>O&&(O+=1,da.save_level(E,O)),N+=1,N>=3?m():(ea.reset(!0),n())}function m(){}function n(){o(),a.bind(W)(),W._enableHints()}function o(){var a;for(a=0;a<J.length;a++)W.panel.movingItemContainer.removeChild(J[a]);for(J=[],a=0;a<K.length;a++)W.panel.movingItemContainer.removeChild(K[a]);K=[],P=0}function p(){collapse&&collapse.constructor==snowflake_obj.constructor&&snowflake_obj.currentFrame!=collapse.currentFrame&&collapse.gotoAndStop(0)}function q(a,b){for(var c=-1;0>c||a.indexOf(c)>=0;)c=Math.floor(Math.random()*b);return c}var r=include("springroll.easeljs.BaseState"),s=include("springroll.Animator"),t=include("springroll.DragManager"),u=include("createjs.TextureAtlas"),v=include("springroll.ListTask"),w=include("createjs.Ease"),x=include("springroll.Sound"),y=include("createjs.Tween"),z=include("springroll.easeljs.DwellTimer"),A=[3,2,-1],B=[4,0,0],C=[2,3,0],D=[0,3,3],E="EX1GA1",F=[!1,!1,!0],G={SnowFlake_easy01:{x:8,y:-1},SnowFlake_easy02:{x:8,y:-1},SnowFlake_easy03:{x:8,y:-1},SnowFlake_easy04:{x:8,y:-1},SnowFlake_easy05:{x:8,y:-1},SnowFlake_easy06:{x:8,y:-1},SnowFlake_easy07:{x:8,y:-1},SnowFlake_easy08:{x:8,y:-1},SnowFlake_easy09:{x:8,y:-1},SnowFlake_easy10:{x:8,y:-1},SnowFlake_easy11:{x:8,y:-1},SnowFlake_easy12:{x:8,y:-1},SnowFlake_medium01:{x:-2,y:-1},SnowFlake_medium02:{x:-2,y:-1},SnowFlake_medium03:{x:-2,y:-1},SnowFlake_medium04:{x:-2,y:-1},SnowFlake_medium05:{x:-2,y:-1},SnowFlake_medium06:{x:-2,y:-1},SnowFlake_medium07:{x:-2,y:-1},SnowFlake_medium08:{x:5,y:-1},SnowFlake_hard01:{x:8,y:-1},SnowFlake_hard02:{x:-2,y:-1},SnowFlake_hard03:{x:-2,y:-1},SnowFlake_hard04:{x:-2,y:-1},SnowFlake_hard05:{x:-2,y:-1},SnowFlake_hard06:{x:-2,y:-1},SnowFlake_hard07:{x:-1,y:-1},SnowFlake_hard08:{x:-2,y:-1}},H={SnowFlake_medium02:{x:-4},SnowFlake_medium06:{x:-7},SnowFlake_medium07:{x:-2},SnowFlake_medium08:{x:-11},SnowFlake_hard02:{x:-2},SnowFlake_hard07:{x:-7},SnowFlake_hard08:{x:-1}},I=!0,J=[],K=[],L=[],M=[],N=0,O=0,P=0,Q=2,R=(Math.round(Math.random()*Math.random()*Q),Math.round(100*Math.random())),S=null,T=null,U=null,V=null,W=null,X=[],Y=1,Z=[],$=function(a){r.call(this,new sid.GamePanel,a),this.flakes=null,this.levels=this.game.config.gameplay.levels,this.dragManager=new t(this.game.display.stage,aa.bind(this),ba.bind(this)),O=da.get_saved_level(E),ea.callback=p,ea.reset(!1),W=this,this._instructionsDone=this._instructionsDone.bind(this),this.playHint=this.playHint.bind(this)},_=(r.prototype,extend($,r));_.addTasks=function(a){a.push(new v("flocons",this.config.sprites.flocons.manifest,this.onFloconsLoaded.bind(this))),a.push(new v("scintillation",this.config.sprites.scintillation.manifest,this.onScintillationLoaded.bind(this)))},_.onFloconsLoaded=function(a,b){S=new u(a.atlasImage.content,a.atlasData.content),T=a.animData.content},_.onDropzoneLoaded=function(a,b){dropzone=new u(a.atlasImage.content,a.atlasData.content)},_.onScintillationLoaded=function(a,b){U=new u(a.atlasImage.content,a.atlasData.content),V=a.animData.content},_.enterDone=function(){this.game.music="BackgroundMusic",this.panel.assemble(),a.bind(this)(),ca=ca.bind(this),this.panel.replayButton.on("click",ca),this.panel.mouseEnabled=!1,this.game.hints.func(this.playHint),this.playHint(!0)},_.playHint=function(a){if(this._disableHints(),!a){var e=L.map(b,J),f=M.map(b,K).filter(c);e.sort(d),f.sort(d),this.game.learning.clickHelp(f,e)}this.game.media.playInstruction(this.panel.geraldClip.gerald,"HELP",this._instructionsDone)},_._enableHints=function(){"pointer"!=this.panel.geraldClip.cursor&&(this.panel.geraldClip.cursor="pointer",this.panel.geraldClip.addEventListener("click",this.playHint)),this.game.hints.enabled=!0},_._disableHints=function(){this.panel.geraldClip.removeEventListener("click",this.playHint),this.panel.geraldClip.cursor="",this.game.hints.enabled=!1},_._instructionsDone=function(){this._enableHints(),this.panel.mouseEnabled=!0,s.play(this.panel.geraldClip.gerald,"idle"),W.panel.movingItemContainer.mouseEnabled=!0};var aa=function(a){a.parent.addChild(a),I&&this.game.media.playInstruction(this.panel.geraldClip.gerald,"START_DRAG"),x.instance.play("CLAP_GRAB_SFX");var b=[];Z.forEach(function(c){a.className!=c.className&&b.push({name:c.className})}),this.game.learning.startDrag(a.className,a.index+1,b),a.startDragTimer(),ea.reset(!0)},ba=function(a){if(a.setBounds(a.x,a.y,a.getBounds().width,a.getBounds().height),ea.reset(!0),a.stopDragTimer(),a.getBounds().intersects(a.target.getBounds())){var b=-1;b=J.indexOf(a),b>=0?(J.splice(b,1),L.splice(b,1)):(b=K.indexOf(a),b>=0&&(K.splice(b,1),M.splice(b,1))),a.disableDrag(),a.dropped=!0,a.target.matched=!0,da.increment_good(),Z.splice(Z.indexOf(a),1),W.game.learning.selectAnswer(a.className,a.target.index+1,!0,K.map(function(a){return{name:a.className}}),a.dragTime),y.get(a).to({x:a.target.x,y:a.target.y},300,w.sineOut).call(function(b){a.visible=!1,a.target.getChildByName("flake").visible=!0,a.target.getChildByName("flake").mask=null,P-=1,a.target.getChildByName("droparea").visible=!1,a.target.getChildByName("dropbg").visible=!1,a.target.getChildByName("stars").visible=!0,a.target.getChildByName("stars").gotoAndPlay(0),this._disableHints(),0>=P?(ea.reset(!1),i.bind(W)()):(I=!1,g.bind(W)())}.bind(this))}else{I=!1,y.get(a).to({x:a.origin.x,y:a.origin.y},300,w.sineOut);var c=this.game.normalizePosition(a.x,a.y),d=[];Z.forEach(function(a){d.push({name:a.className})});var e=!f(a,X);if(e){x.instance.play("CLICK_SFX");var j=a.getBounds().intersects(W.game.config.gameplay.binBounds);this.game.learning.endDragOutside(a.className,c,j?"resource bin":"space",d,a.dragTime)}else W.game.learning.selectAnswer(a.className,a.target.index+1,!1,K.map(function(a){return{name:a.className}}),a.dragTime),this._disableHints(),h.call(W),da.increment_wrong()}},ca=function(){N=0,O=0,da.save_level(E,O),ea.reset(!0),this.panel.replayButton.visible=!1,n()},da=function(a){var b="_lvl",c={};return a.wrong=a.good=0,a.ratio=-1,a.reset=function(b){a.ratio=null===b?-1:b,a.wrong=a.good=0},a.increment_wrong=function(){a.wrong++},a.increment_good=function(){a.good++},a.can_level_up=function(){return 0===a.wrong||a.good/a.wrong>a.ratio},a.get_saved_level=function(a){return parseInt(c[a+b])||0},a.save_level=function(a,d){c[a+b]=d.toString()},a}(da=da||{}),ea=function(a){return a.is_playing_phase=!1,a.inactivity=0,a.max_time=15,a.current_max_time=15,a.is_playing_phase=!1,a.callback=null,a.update=function(b){a.is_playing_phase&&(a.inactivity+=b),a.inactivity>=a.current_max_time&&(a.inactivity=0,a.current_max_time=2*a.max_time,a.callback())},a.reset_max_time=function(){a.current_max_time=a.max_time},a.reset=function(b){null===b&&(b=!0),a.inactivity=0,this._is_playing_phase=b},a}(ea=ea||{});namespace("sid").GameState=$}(),function(){var a=include("springroll.easeljs.BaseState"),b=function(b){a.call(this,new sid.TitlePanel,b),d=d.bind(this)},c=(a.prototype,extend(b,a));c.enterDone=function(){this.panel.playButton.addEventListener("click",d),this.panel.background.addEventListener("click",d),this.panel.background.cursor="pointer"};var d=function(){this.panel.background.cursor=null,this.panel.background.removeEventListener("click",d),this.panel.playButton.removeEventListener("click",d),this.manager.next()};namespace("sid").TitleState=b}(),function(){var a=include("springroll.Application"),b=include("sid.TitleState"),c=include("sid.GameState"),d=include("springroll.ListTask"),e=include("lib.Transition"),f=new a({fps:15,name:"SnowflakeMatch",state:"title",configPath:"assets/config/config.json",captionsPath:"assets/config/captions.json",manifestsPath:"assets/config/manifests.json"});f.once("manifestLoaded",function(a){a.addTask(new d("transitionAssets",this.manifests.Transition,function(a){for(var b in a)images[b]=a[b].content}))}),f.once("init",function(){this.transition=new e;var a=this.config.assets,d=this.manifests;this.states={title:new b({next:"game",manifest:a.title}),game:new c({next:"title",previous:"intro",manifest:[].concat(d.Gerald,a.game)})}}),window.app=f}();