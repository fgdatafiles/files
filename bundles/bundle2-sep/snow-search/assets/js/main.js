!function(){var a=include("springroll.easeljs.BasePanel"),b=include("createjs.Bitmap"),c=include("createjs.Container"),d=include("springroll.easeljs.SoundButton"),e=include("springroll.Animator"),f=include("springroll.easeljs.DwellTimer"),g=function(){a.call(this)},h=a.prototype,i=g.prototype=Object.create(h);i.setup=function(){var a=this.stage=window.app.display.stage,e=new b(images.GameBG),g=this,h=this.miniMap={x:20,y:330,width:308,height:184,mini_shovel:null,display:new c};this.mapObjects=this.scalingContainer=new c,this.addChild(this.scalingContainer),this.scalingContainer.addChild(e),this.gerald=new lib.Gerald,h.display.x=10,h.display.y=280;for(var i=0,j=this.config.spriteManifests.game.length;j>i;i++){var k=this.config.spriteManifests.game[i],l=k.id.substring(0,1).toLowerCase()+k.id.substring(1);if(this[l].x=k.x,this[l].y=k.y,this[l].landmark=k.landmark,this[l].name=k.name,this[l].hints="HINT_LM"+k.hint,this[l].landmark?this[l].gotoAndStop(3):this[l].gotoAndStop(k.init),this.scalingContainer.addChild(this[l]),this[l].landmark){var m=this[l].clone(!0);m.scaleX=m.scaleY=.4,m.x=30+.25*(k.circleX?k.circleX:this[l].x),m.y=60+.27*(k.circleY?k.circleY:this[l].y),m.visible=!1,m.name=k.name,this[l].gotoAndStop(k.init),this[l].mouseEnabled=!0;var n=new b(images.Circle);n.x=m.x-20,n.y=m.y-16,n.name="circle_"+k.name,n.visible=!1;var o=new b(images.Checkmark);o.x=k.checkmarkX?.25*k.checkmarkX:n.x+25,o.y=k.checkmarkY?.27*k.checkmarkY:n.y,o.visible=!1,h.display.addChild(n),h.display.addChild(o),h.display.addChild(m),this[l].mini=m,this[l].outline=n,this[l].checkmark=o}}this.shovel=this.scalingContainer.addChild(this.shovelCursor),this.shovel.mouseEnabled=!1,this.shovel.mouseChildren=!1,this.shovel.digging=!1,this.shovel.loop=!1,this.shovel.stopDrag=function(){this.shovel.digging=!0}.bind(this),a.cursor="none",h.mini_shovel=this.mini_shovel=this.shovel.clone(!0),this.mini_shovel.scaleX=this.mini_shovel.scaleY=.25,this.mini_shovel.x=200,this.mini_shovel.y=400,this.scalingContainer.addChild(this.mini_shovel),this.replayButton=new d(images.ReplayButton),this.replayButton.x=60,this.replayButton.y=340,this.replayButton.scaleX=this.replayButton.scaleY=.5,this.replayButton.on("mouseover",function(){a.cursor="pointer"}.bind(this)),this.replayButton.on("mouseout",function(){a.cursor="default"}.bind(this)),this.replayButton.visible=!1,this.replayButton.name="replay-button",f.create(this.replayButton),a.addEventListener("stagemousemove",function(a){var b=this.scalingContainer.getBounds(),c=this.scalingContainer.scaleX;return this.shovel.digging?!1:(this.shovel.y<=180?this.shovel.scaleX=this.shovel.scaleY=.37:this.shovel.scaleX=this.shovel.scaleY=this.shovel.y/500,g.shovelCursor.x=a.stageX/c,g.shovelCursor.y=a.stageY/c,g.mini_shovel.x=h.x+a.stageX*h.width/(b.width*c),void(g.mini_shovel.y=h.y+a.stageY*h.height/(b.height*c)))}.bind(this))},i.assemble=function(a){var c=a.frames,d={obj_Wheelbarrow0000:[855,160,"garden_landmark8"],obj_bench0000:[290,208,"garden_landmark4"],obj_bush0000:[505,220,"garden_landmark6"],obj_chair0000:[670,305,"garden_landmark11"],obj_flowerPot0000:[480,395,"garden_landmark5"],obj_fountain0000:[740,148,"garden_landmark3"],obj_lamps0000:[475,185,"garden_landmark9"],obj_shed0000:[345,105,"garden_landmark1"],obj_step0000:[538,182,"steps"],obj_table0000:[770,300,"garden_landmark7"],obj_terrasse0000:[592,189,"garden_landmark10"],obj_tree0000:[110,-40,"garden_landmark2"]};for(var e in c){var f=c[e],g=createjs.BitmapUtils.bitmapFromTexture(f);g.x=d[e][0],g.y=d[e][1],g.name=d[e][2],g.visible=!1,this.scalingContainer.addChild(g)}this.scalingContainer.addChild(this.shovelCursor);var h=new b(images.MiniMap);this.scalingContainer.addChild(this.gerald),this.miniMap.display.addChildAt(h,0),this.scalingContainer.addChild(this.miniMap.display),this.scalingContainer.addChild(this.mini_shovel),this.scalingContainer.addChild(this.snowfall),this.snowfall.stop(),this.snowfall.visible=!1,this.replayButton.mouseEnabled=!0,this.scalingContainer.addChild(this.replayButton)},i.snowFall=function(a){this.snowfall.visible=!a,a?e.stop(this.snowfall):e.play(this.snowfall,"anim")},i.resetObjects=function(a,b){for(var c=a.concat(b),d=0,e=c.length;e>d;d++){var f=c[d];f.visible=!0,f.loop=!1,f.outline&&(f.outline.visible=!1),f.checkmark&&(f.checkmark.visible=!1),f.gotoAndStop&&f.gotoAndStop(0)}},i.teardown=function(){this.scalingContainer.removeAllChildren(),h.teardown.call(this),this.skin=null},i.destroy=function(){this.scalingContainer=null,h.destroy.call(this)},namespace("sid").GamePanel=g}(),function(){var a=include("springroll.easeljs.BasePanel"),b=include("createjs.Bitmap"),c=include("springroll.easeljs.DwellTimer"),d=include("springroll.easeljs.SoundButton"),e=function(){a.call(this)},f=a.prototype,g=e.prototype=Object.create(f);g.setup=function(){this.background=new b(images.TitleBackground),this.addChildAt(this.background,0),this.background.name="TitleBackground",c.create(this.background);var a=this.config.scalingSize;this.playButton=new d(images.PlayButton),this.playButton.x=.75*a.width-.5*images.PlayButton.width,this.playButton.y=.77*a.height,this.addChild(this.playButton),this.playButton.name="playButton",c.create(this.playButton)},g.teardown=function(){f.teardown.call(this),this.background=null,this.playButton=null},namespace("sid").TitlePanel=e}(),function(){var a,b,c=include("springroll.easeljs.BaseState"),d=include("springroll.Animator"),e=include("springroll.Sound"),f=include("springroll.easeljs.DwellTimer"),g=include("springroll.DelayedCall"),h=include("createjs.MouseEvent"),i="EX1GA1",j=["map_obj1","map_obj2","map_obj3","map_obj4","map_obj5","map_obj6","map_obj7","map_obj8","map_obj9","map_obj10","map_obj11","map_obj12","map_obj13","map_obj14","map_obj15","map_obj16","map_obj17","map_obj18","map_obj19","map_obj21","map_obj22","map_obj23","map_obj24"],k=["garden_obj1","garden_obj2","garden_obj3","garden_obj4","garden_obj5","garden_obj6","garden_obj7","garden_obj8","garden_obj9","garden_obj10","garden_obj11","garden_obj12","garden_obj13","garden_obj14","garden_obj15","garden_obj16","garden_obj17","garden_obj18","garden_obj19","garden_obj21","garden_obj22","garden_obj23","garden_obj24"],l=["HINT_LM8","HINT_LM2","HINT_LM15","HINT_LM9","HINT_LM4","HINT_LM12","HINT_LM16","HINT_LM14","HINT_LM16","HINT_LM20","HINT_LM9","HINT_LM10","HINT_LM10","HINT_LM9","HINT_LM8","HINT_LM1","HINT_LM19","HINT_LM9","HINT_LM4","HINT_LM6","HINT_LM20","HINT_LM6","HINT_LM5","HINT_LM9","HINT_LM17"],m=["landmark1","landmark2","landmark3","landmark4","landmark5","landmark6","landmark7"],n=["landmark8","landmark9","landmark10","landmark11"],o={landmark1:["garden_landmark1","map_landmark1",[]],landmark2:["garden_landmark2","map_landmark2",[]],landmark3:["garden_landmark3","map_landmark3",[]],landmark4:["garden_landmark4","map_landmark4",["landmark2"]],landmark5:["garden_landmark5","map_landmark5",[]],landmark6:["garden_landmark6","map_landmark6",[]],landmark7:["garden_landmark7","map_landmark7",[]],landmark8:["garden_landmark8","map_landmark8",[]],landmark9:["garden_landmark9","map_landmark9",[]],landmark10:["garden_landmark10","map_landmark10",[]],landmark11:["garden_landmark11","map_landmark11",[]]},p=[3,5,6],q=[!0,!0,!0],r=[7,4],s=[7,4],t=[7,4],u=[5,3,-1],v=5,w=0,x=0,y=0,z=[],A=null,B=null,C=null,D=null,E=null,F=null,G=!1,H=function(a){c.call(this,new sid.GamePanel,a),this._onPlayHelp=this._onPlayHelp.bind(this),this.geraldIdle=this.geraldIdle.bind(this),this.already_found_click=this.already_found_click.bind(this),this.object_click_listener=this.object_click_listener.bind(this),this.gerald_click_listener=this.gerald_click_listener.bind(this)},I=c.prototype,J=extend(H,c);J.addTasks=function(a){for(var b=this.config.spriteManifests.game,c="assets/images/sprites/full/",d=0;d<b.length;d++){var e=b[d].id;a.push({anim:c+e+".json",atlas:c+e+"Sprite.json",image:c+e+"Sprite.png",complete:this.onBMCLoaded.bind(this,e)})}this.config.sprites.landmarks.manifest.complete=this.onLandmarksLoaded.bind(this),a.push(this.config.sprites.landmarks.manifest)},J.onBMCLoaded=function(a,b){b.gotoAndStop(0),a=a.charAt(0).toLowerCase()+a.slice(1),this.panel[a]=b},J.onLandmarksLoaded=function(a){F=a},J.onGeraldLoaded=function(a){},J.enterDone=function(){a=this.app.learning,b=this.app,this.gerald=this.panel.gerald.gerald,this.panel.assemble(F),x=K.get_saved_level("EX1GA2"),G=!1,this.app.hints.func(this.gerald_click_listener),this.app.hints.enabled=!1,this.generate_world(),this.gerald_instruction(),this.panel.on("click",this.mouseDown.bind(this)),this.panel.replayButton.on("click",this.startOver.bind(this)),this.app.container.on("playHelp",this._onPlayHelp),this.panel.snowFall(),f.create(this.panel.gerald)},J._enableHints=function(){this.panel.gerald.on("click",this.gerald_click_listener),this.app.hints.enabled=!0,this.app.hints.startTimer()},J._disableHints=function(){this.app.hints.stopTimer(),this.panel.gerald.removeAllEventListeners(),this.app.hints.enabled=!1},J._onPlayHelp=function(){a.clickHelp(this.app.normalizePosition(this.currentObject.x,this.currentObject.y),this.currentObject.name)},J.exitStart=function(){this.app.container.off("playHelp",this._onPlayHelp)},J.exit=function(){this.assetsLoaded&&I.exit.call(this)},J.geraldIdle=function(a){"function"==typeof a&&a(),d.play(this.gerald,"idle"),this._enableHints()},J.play_hint_speech=function(){this._disableHints(),D++,D>2?this.app.media.playInstruction(this.gerald,"INSTRREMINDER",this.geraldIdle):(D=0,z.length>y&&l.length>z[y]&&this.app.media.playIncorrectFeedback(this.gerald,this.currentObject.hints,this.geraldIdle))},J.mouseDown=function(){if(G){if(this.panel.replayButton.visible)return;e.instance.play("CLICK_SFX",{interrupt:!0}),K.increment_wrong(),E+=1,E>=v&&(this.play_hint_speech(),E=0)}},J.gerald_instruction=function(){this._disableHints(),this.app.media.playInstruction(this.gerald,"FINDOBJECT",function(){this.geraldIdle(),this.show_next_object(!0),this.panel.snowFall(!0)}.bind(this))},J.gerald_click_listener=function(b,c){this._disableHints(),b instanceof h&&a.clickHelp(this.app.normalizePosition(this.currentObject.x,this.currentObject.y),this.currentObject.name),this.app.media.playInstruction(this.gerald,"HELP",this.geraldIdle.bind(this,b),this.geraldIdle.bind(this,c))},J.hide_all_objects=function(){var a,b=this.panel;for(a=0;a<j.length;a++)b.mapObjects.getChildByName(j[a])&&(b.mapObjects.getChildByName(j[a]).visible=!1)},J._create_landmarks=function(a,b){var c,d,e,f,g,h=[],i=this.panel.scalingContainer;for(g=0;a>g;g++){for(d=null,e=0;(null===d||h.indexOf(d)>=0)&&(c=Math.floor(Math.random()*b.length),d=b[c],e+=1,!(e>50)););f=o[d],h.push(f[2]),h.push(d),B.push(i.getChildByName(f[0]))}},J.generate_world=function(){var a,b,c=this.panel;switch(D=0,E=0,this.hide_all_objects(),c.miniMap.mini_shovel.visible=!0,x){case 0:b=r;break;case 1:b=s;break;case 2:b=t}for(K.reset((b[0]+b[1])/u[x]),A=[],B=[],this._create_landmarks(b[0],m),this._create_landmarks(b[1],n),z=[],a=0;a<p[x];a++){for(var d=-1;0>d||z.indexOf(d)>=0;)d=Math.floor(Math.random()*j.length);z.push(d),A.push(c.scalingContainer.getChildByName(k[d]))}q[x]?c.miniMap.mini_shovel.visible=!0:c.miniMap.mini_shovel.visible=!1,c.resetObjects(B,A)},J.object_click_listener=function(b){var c=this.panel;if(G=!0,b.stopImmediatePropagation(),b.preventDefault(),!this.panel.shovel.digging&&!this.panel.replayButton.visible){var d=c.scalingContainer.getChildByName(k[z[y]]);if(d){this._disableHints(),G=!1,c.shovel.gotoAndPlay(1),c.shovel.stopDrag();var f=this.panel.scalingContainer.getBounds(),i=this.panel.scalingContainer.scaleX;this.panel.shovel.y<=180?this.panel.shovel.scaleX=this.panel.shovel.scaleY=.37:this.panel.shovel.scaleX=this.panel.shovel.scaleY=this.panel.shovel.y/500,this.panel.shovelCursor.x=b.stageX/i,this.panel.shovelCursor.y=b.stageY/i,this.panel.mini_shovel.x=this.panel.miniMap.x+b.stageX*this.panel.miniMap.width/(f.width*i),this.panel.mini_shovel.y=this.panel.miniMap.y+b.stageY*this.panel.miniMap.height/(f.height*i);var j=this.app.normalizePosition(b.stageX,b.stageY),l=this.app.normalizePosition(d.x,d.y),m=[];A.forEach(function(a){a.name==d.name||a.found||m.push({name:a.name})}),a.selectAnswer(j,l,d.name,!0,m,a.stopTimer("digging")),e.instance.stopContext("vo"),e.instance.play("SHOVEL_SFX",{interrupt:!0}),e.instance.play("POSITIVE_SFX",{interrupt:!1}),d.outline.visible=!1,d.mini.visible=!0,d.checkmark.visible=!0,d.found=!0,d.play(),d.removeEventListener("mousedown",this.object_click_listener),d.addEventListener("mousedown",this.already_found_click),y+=1,K.increment_good(),K.wrong>0&&(K.wrong-=1)}if(z.length==y)2==w?(c.gerald.removeEventListener(h.ROLL_OVER,c.characterMouseEvent),c.gerald.removeEventListener(h.ROLL_OUT,c.characterMouseEvent),new g(function(){this.panel.shovel.digging=!1,this.panel.shovel.gotoAndStop(0),c.resetObjects(B,A),c.shovel.visible=!1,c.miniMap.mini_shovel.visible=!1,c.miniMap.visible=!1,this.win()}.bind(this),2500)):new g(function(){this.panel.shovel.digging=!1,this.panel.shovel.gotoAndStop(0),this.win()}.bind(this),2500);else{var n=["OBJECTFOUND1","OBJECTFOUND2","OBJECTFOUND3"][Math.floor(3*Math.random())],o=["NEXTOBJECT1","NEXTOBJECT2","NEXTOBJECT3"][Math.floor(3*Math.random())];this.app.hints.enabled=!1,this.app.media.playCorrectFeedback(this.gerald,n,function(){this.app.media.playInstruction(this.gerald,o,function(){this.geraldIdle(),this.panel.shovel.digging=!1,this.panel.shovel.gotoAndStop(0),this.show_next_object(),this.app.hints.enabled=!0}.bind(this))}.bind(this))}}},J.show_next_object=function(c){function d(a){return this[a.name]=b.normalizePosition(a.x,a.y),a.name}var e=z[y],g=this.panel,h=g.scalingContainer.getChildByName(k[e]);h.mouseEnabled=!0,h.addEventListener("mousedown",this.object_click_listener),h.mini.visible=h.outline.visible=!0,a.startTimer("digging"),f.create(h),this.currentObject=h;for(var i=-1,j=0;j<g.numChildren;j++)if(g.getChildAt(j)==g.shovel){i=j;break}if(i>=0&&h.parent.setChildIndex(h,i-1),G=!0,c){var l={};a.startTimer("round"),a.startRound(A.map(d,l).join(", "),l)}},J.already_found_click=function(a){!G||"idle"!=this.gerald.currentLabel&&"idle_stop"!=this.gerald.currentLabel||(this._disableHints(),this.app.media.playIncorrectFeedback(this.gerald,{anim:"COMPLETED",audio:"COMPLETED"},this.geraldIdle))},J.win=function(){K.can_level_up()&&2>x&&(x+=1,K.save_level(i,x)),w+=1,w>=3?(this.unload(),this.panel.miniMap.display.visible=!1,a.endRound(a.stopTimer("round"),K.wrong),this.app.media.playCorrectFeedback(this.gerald,{anim:"FINAL",audio:{alias:"FINAL",start:5200}},function(){this.panel.replayButton.visible=!0,this.panel.miniMap.display.visible=!0,d.play(this.gerald,"idle"),this.panel.stage.cursor="default"}.bind(this))):(this.app.media.playCorrectFeedback(this.gerald,"MIDLVL2",this.replay.bind(this)),this.panel.snowFall(),a.endRound(a.stopTimer("round"),K.wrong))},J.unload=function(){for(var a,b=this.panel.scalingContainer,c=0,d=z.length;d>c;c++){var e=z[c];a=b.getChildByName(k[e]),a.checkmark&&(a.checkmark.visible=!1),a.outline&&(a.outline.visible=!1),a.mini&&(a.mini.visible=!1),a.gotoAndStop&&a.gotoAndStop(0),a.found=!1,a.removeEventListener("click",this.already_found_click)}y=0},J.replay=function(){this.geraldIdle(),this.unload(),this.generate_world(),this.show_next_object(!0),this.panel.snowFall(!0)},J.startOver=function(){w=0,x=0,y=0,z=[],A=null,B=null,C=null,D=null,E=null,F=null,K.reset(),x=K.get_saved_level("EX1GA2"),G=!1,this.generate_world(),this.gerald_instruction(),this.panel.replayButton.visible=!1,this.panel.shovel.visible=!0,this.panel.stage.cursor="none"};var K=function(a){var b="_lvl",c={};return a.wrong=a.good=0,a.ratio=-1,a.reset=function(b){a.ratio=null===b?-1:b,a.wrong=a.good=0},a.increment_wrong=function(){a.wrong++},a.increment_good=function(){a.good++},a.can_level_up=function(){return 0===a.wrong||a.good/a.wrong>a.ratio},a.get_saved_level=function(a){return parseInt(c[a+b])||0},a.save_level=function(a,d){c[a+b]=d.toString()},a}(K=K||{});namespace("sid").GameState=H}(),function(){var a=include("springroll.easeljs.BaseState"),b=function(b){a.call(this,new sid.TitlePanel,b),e=e.bind(this)},c=a.prototype,d=extend(b,a);d.enterDone=function(){this.panel.playButton.on("click",e),this.panel.background.on("click",e),this.panel.background.cursor="pointer"};var e=function(){this.app.learning.clickPlay(this.game.normalizePosition(this.panel.stage.mouseX,this.panel.stage.mouseY)),this.app.music="BackgroundMusic",this.nextState()};d.exit=function(){this.assetsLoaded&&(this.panel.background.cursor=null,this.panel.background.off("click",e),this.panel.playButton.off("click",e),c.exit.call(this))},namespace("sid").TitleState=b}(),function(){var a=include("springroll.Application"),b=new a({fps:15,name:"snow-search",state:"title",configPath:"assets/config/config.json",captionsPath:"assets/config/captions.json",manifestsPath:"assets/config/manifests.json"});b.once("init",function(){this.transition=new lib.Transition;var a=this.config.assets,b=this.config.scaling;this.states={title:new sid.TitleState({next:"game",scaling:b.title,preload:a.title}),game:new sid.GameState({next:"title",scaling:b.game,previous:"title",preload:a.game})}}),b.once("manifestLoaded",function(a){a.push({id:"transitionAssets",assets:this.manifests.Transition,complete:Object.merge.bind(this,images)})}),window.app=b}();